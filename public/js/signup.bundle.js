(()=>{"use strict";var e,t,n,r,o,i={797:(e,t,n)=>{const r=(0,n(303).UU)("https://ofeyssipibktmbfebibo.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9mZXlzc2lwaWJrdG1iZmViaWJvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM5MjUwOTQsImV4cCI6MjA1OTUwMTA5NH0.w71CAKfolktzRl-TmLVhHYaEbhCfVk4A7YraEUCglrU");function o(e,t="errorMessage"){const n=document.getElementById(t);n?(n.innerHTML=e,n.classList.remove("hidden")):console.error("Error element not found:",t)}function i(e,t){const n=document.getElementById(e),r=document.getElementById(t);n&&(n.disabled=!0),r&&r.classList.remove("hidden")}function s(e,t){const n=document.getElementById(e),r=document.getElementById(t);n&&(n.disabled=!1),r&&r.classList.add("hidden")}let l=null,a=null;function u(){console.log("initSignupPage called");const e=document.getElementById("signupForm"),t=(document.getElementById("errorMessage"),document.getElementById("statusMessage"),document.getElementById("googleSignUpBtn"));document.getElementById("turnstile-container")||console.error("#turnstile-container not found in the DOM. CAPTCHA cannot be rendered."),e?e.addEventListener("submit",(async t=>{t.preventDefault();const n=document.getElementById("email").value.trim(),u=document.getElementById("password").value,d=document.getElementById("confirmPassword").value;let c=document.getElementById("phone").value.trim(),p=[];if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)||p.push("L'adresse email n'est pas valide."),u!==d&&p.push("Les mots de passe ne correspondent pas."),(!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/.test(u)||u.length<8)&&p.push("Le format du mot de passe est invalide."),c||p.push("Le numéro de téléphone est requis."),c&&!/^(0|\+33)[1-9]\d{8}$/.test(c)&&p.push("Le format du numéro de téléphone est invalide (ex: 0612345678 ou +33612345678)."),l||p.push("Veuillez compléter le CAPTCHA."),p.length>0)o(p.join("<br>"));else{i("signupBtn","signupSpinner");try{let t=c;c.startsWith("0")&&(t=`+33${c.substring(1)}`);const{data:o,error:i}=await r.auth.signUp({email:n,password:u,options:{captchaToken:l}});if(i)throw i;if(!o.user)throw new Error("Erreur lors de la création de l'utilisateur.");t&&o.user.id&&await r.from("profiles").update({phone:t}).eq("id",o.user.id),function(e,t="info",n="statusMessage"){const r=document.getElementById(n);r?(r.textContent=e,r.classList.forEach((e=>{e.startsWith("alert-")&&r.classList.remove(e)})),r.classList.add(`alert-${t}`),r.classList.remove("hidden")):console.error("Status element not found:",n)}("Compte créé ! Un email de confirmation a été envoyé.","success"),e&&(e.classList.add("hidden"),e.reset())}catch(e){console.error("Email/Password Signup error:",e);let t=e.message||"Une erreur est survenue.";e.message&&e.message.includes("User already registered")?t="Cette adresse email est déjà utilisée. Veuillez vous connecter ou utiliser une autre adresse.":e.message&&e.message.includes("Unable to validate phone number")?t="Le numéro de téléphone fourni n'est pas valide.":e.message&&e.message.toLowerCase().includes("captcha protection")&&(t="Erreur CAPTCHA du serveur. Veuillez réessayer. ("+e.message+")"),o(t)}finally{s("signupBtn","signupSpinner"),window.turnstile&&a&&(window.turnstile.reset(a),console.log("Turnstile widget has been reset.")),l=null}}})):console.error("Signup form (signupForm) not found."),t?t.addEventListener("click",(async()=>{i("googleSignUpBtn","googleSignUpSpinner");try{const{error:e}=await r.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/profile.html`}});e&&(console.error("Error signing up with Google:",e),o(e.message||"Erreur lors de l'inscription avec Google."))}catch(e){console.error("Exception during Google sign-up:",e),o("Une exception est survenue lors de l'inscription avec Google.")}finally{s("googleSignUpBtn","googleSignUpSpinner")}})):console.warn("Google Sign-Up button (googleSignUpBtn) not found.")}window.onloadTurnstileCallback=function(){console.log("Turnstile API ready (onloadTurnstileCallback executed).");const e=document.getElementById("turnstile-container");if(e&&window.turnstile&&!a){console.log("Rendering Turnstile widget from onloadTurnstileCallback...");try{a=window.turnstile.render(e,{sitekey:"0x4AAAAAABdzY3InOU2_In99",callback:function(e){l=e,console.log("Turnstile token obtained:",e)},"expired-callback":()=>{console.log("Turnstile token expired. Resetting widget. ID:",a),window.turnstile&&a&&window.turnstile.reset(a),l=null},"error-callback":e=>{l=null,console.error("Turnstile error callback:",e),o(`Erreur CAPTCHA: ${e}. Veuillez réessayer.`)}}),void 0===a?(console.error("Turnstile.render did not return a widgetId. Sitekey or container issue?"),o("Erreur initialisation CAPTCHA (ID widget non retourné).")):console.log("Turnstile widget rendered. ID:",a)}catch(e){console.error("Error rendering Turnstile:",e),o("Impossible d'afficher le CAPTCHA.")}}else e?window.turnstile?a&&console.log("onloadTurnstileCallback: Widget already seems rendered."):console.error("onloadTurnstileCallback: window.turnstile API not found."):console.error("onloadTurnstileCallback: #turnstile-container not found.")},document.addEventListener("DOMContentLoaded",(()=>{u(),console.log("Signup page initialized")}))}},s={};function l(e){var t=s[e];if(void 0!==t)return t.exports;var n=s[e]={exports:{}};return i[e].call(n.exports,n,n.exports,l),n.exports}l.m=i,e=[],l.O=(t,n,r,o)=>{if(!n){var i=1/0;for(d=0;d<e.length;d++){for(var[n,r,o]=e[d],s=!0,a=0;a<n.length;a++)(!1&o||i>=o)&&Object.keys(l.O).every((e=>l.O[e](n[a])))?n.splice(a--,1):(s=!1,o<i&&(i=o));if(s){e.splice(d--,1);var u=r();void 0!==u&&(t=u)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[n,r,o]},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,l.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var o=Object.create(null);l.r(o);var i={};t=t||[null,n({}),n([]),n(n)];for(var s=2&r&&e;"object"==typeof s&&!~t.indexOf(s);s=n(s))Object.getOwnPropertyNames(s).forEach((t=>i[t]=()=>e[t]));return i.default=()=>e,l.d(o,i),o},l.d=(e,t)=>{for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},l.f={},l.e=e=>Promise.all(Object.keys(l.f).reduce(((t,n)=>(l.f[n](e,t),t)),[])),l.u=e=>"js/"+e+".bundle.js",l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r={},o="urbandocs_webapp:",l.l=(e,t,n,i)=>{if(r[e])r[e].push(t);else{var s,a;if(void 0!==n)for(var u=document.getElementsByTagName("script"),d=0;d<u.length;d++){var c=u[d];if(c.getAttribute("src")==e||c.getAttribute("data-webpack")==o+n){s=c;break}}s||(a=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,l.nc&&s.setAttribute("nonce",l.nc),s.setAttribute("data-webpack",o+n),s.src=e),r[e]=[t];var p=(t,n)=>{s.onerror=s.onload=null,clearTimeout(g);var o=r[e];if(delete r[e],s.parentNode&&s.parentNode.removeChild(s),o&&o.forEach((e=>e(n))),t)return t(n)},g=setTimeout(p.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=p.bind(null,s.onerror),s.onload=p.bind(null,s.onload),a&&document.head.appendChild(s)}},l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;l.g.importScripts&&(e=l.g.location+"");var t=l.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=n[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),l.p=e+"../"})(),(()=>{var e={787:0};l.f.j=(t,n)=>{var r=l.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var o=new Promise(((n,o)=>r=e[t]=[n,o]));n.push(r[2]=o);var i=l.p+l.u(t),s=new Error;l.l(i,(n=>{if(l.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;s.message="Loading chunk "+t+" failed.\n("+o+": "+i+")",s.name="ChunkLoadError",s.type=o,s.request=i,r[1](s)}}),"chunk-"+t,t)}},l.O.j=t=>0===e[t];var t=(t,n)=>{var r,o,[i,s,a]=n,u=0;if(i.some((t=>0!==e[t]))){for(r in s)l.o(s,r)&&(l.m[r]=s[r]);if(a)var d=a(l)}for(t&&t(n);u<i.length;u++)o=i[u],l.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return l.O(d)},n=self.webpackChunkurbandocs_webapp=self.webpackChunkurbandocs_webapp||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a=l.O(void 0,[303],(()=>l(797)));a=l.O(a)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEVBQXVCLENBQUNDLEVBQTRCOUksS0FDdkQsSUFHSXVDLEVBQVUyQyxHQUhUbEMsRUFBVStGLEVBQWFDLEdBQVdoSixFQUdoQnFELEVBQUksRUFDM0IsR0FBR0wsRUFBU2lHLE1BQU0xSSxHQUFnQyxJQUF4QjZILEVBQWdCN0gsS0FBYSxDQUN0RCxJQUFJZ0MsS0FBWXdHLEVBQ1p6RyxFQUFvQnVDLEVBQUVrRSxFQUFheEcsS0FDckNELEVBQW9CTyxFQUFFTixHQUFZd0csRUFBWXhHLElBR2hELEdBQUd5RyxFQUFTLElBQUlqRyxFQUFTaUcsRUFBUTFHLEVBQ2xDLENBRUEsSUFER3dHLEdBQTRCQSxFQUEyQjlJLEdBQ3JEcUQsRUFBSUwsRUFBU3JELE9BQVEwRCxJQUN6QjZCLEVBQVVsQyxFQUFTSyxHQUNoQmYsRUFBb0J1QyxFQUFFdUQsRUFBaUJsRCxJQUFZa0QsRUFBZ0JsRCxJQUNyRWtELEVBQWdCbEQsR0FBUyxLQUUxQmtELEVBQWdCbEQsR0FBVyxFQUU1QixPQUFPNUMsRUFBb0JRLEVBQUVDLEVBQU8sRUFHakNtRyxFQUFxQkMsS0FBbUMsNkJBQUlBLEtBQW1DLDhCQUFLLEdBQ3hHRCxFQUFtQnBJLFFBQVErSCxFQUFxQnRCLEtBQUssS0FBTSxJQUMzRDJCLEVBQW1CeEosS0FBT21KLEVBQXFCdEIsS0FBSyxLQUFNMkIsRUFBbUJ4SixLQUFLNkgsS0FBSzJCLEcsS0NsRnZGLElBQUlFLEVBQXNCOUcsRUFBb0JRLE9BQUVWLEVBQVcsQ0FBQyxNQUFNLElBQU9FLEVBQW9CLE9BQzdGOEcsRUFBc0I5RyxFQUFvQlEsRUFBRXNHLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9jaHVuayBsb2FkZWQiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvY3JlYXRlIGZha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9sb2FkIHNjcmlwdCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwLy4vc3JjL2pzL3N1cGFiYXNlLWNsaWVudC5qcyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwLy4vc3JjL2pzL2F1dGgvYXV0aC5qcyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwLy4vc3JjL2pzL2F1dGgvc2lnbnVwLmpzIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvLi9zcmMvanMvZW50cmllcy9zaWdudXAuanMiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9lbnN1cmUgY2h1bmsiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvZ2V0IGphdmFzY3JpcHQgY2h1bmsgZmlsZW5hbWUiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvZ2xvYmFsIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvcHVibGljUGF0aCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9qc29ucCBjaHVuayBsb2FkaW5nIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9zdGFydHVwIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBkZWZlcnJlZCA9IFtdO1xuX193ZWJwYWNrX3JlcXVpcmVfXy5PID0gKHJlc3VsdCwgY2h1bmtJZHMsIGZuLCBwcmlvcml0eSkgPT4ge1xuXHRpZihjaHVua0lkcykge1xuXHRcdHByaW9yaXR5ID0gcHJpb3JpdHkgfHwgMDtcblx0XHRmb3IodmFyIGkgPSBkZWZlcnJlZC5sZW5ndGg7IGkgPiAwICYmIGRlZmVycmVkW2kgLSAxXVsyXSA+IHByaW9yaXR5OyBpLS0pIGRlZmVycmVkW2ldID0gZGVmZXJyZWRbaSAtIDFdO1xuXHRcdGRlZmVycmVkW2ldID0gW2NodW5rSWRzLCBmbiwgcHJpb3JpdHldO1xuXHRcdHJldHVybjtcblx0fVxuXHR2YXIgbm90RnVsZmlsbGVkID0gSW5maW5pdHk7XG5cdGZvciAodmFyIGkgPSAwOyBpIDwgZGVmZXJyZWQubGVuZ3RoOyBpKyspIHtcblx0XHR2YXIgW2NodW5rSWRzLCBmbiwgcHJpb3JpdHldID0gZGVmZXJyZWRbaV07XG5cdFx0dmFyIGZ1bGZpbGxlZCA9IHRydWU7XG5cdFx0Zm9yICh2YXIgaiA9IDA7IGogPCBjaHVua0lkcy5sZW5ndGg7IGorKykge1xuXHRcdFx0aWYgKChwcmlvcml0eSAmIDEgPT09IDAgfHwgbm90RnVsZmlsbGVkID49IHByaW9yaXR5KSAmJiBPYmplY3Qua2V5cyhfX3dlYnBhY2tfcmVxdWlyZV9fLk8pLmV2ZXJ5KChrZXkpID0+IChfX3dlYnBhY2tfcmVxdWlyZV9fLk9ba2V5XShjaHVua0lkc1tqXSkpKSkge1xuXHRcdFx0XHRjaHVua0lkcy5zcGxpY2Uoai0tLCAxKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGZ1bGZpbGxlZCA9IGZhbHNlO1xuXHRcdFx0XHRpZihwcmlvcml0eSA8IG5vdEZ1bGZpbGxlZCkgbm90RnVsZmlsbGVkID0gcHJpb3JpdHk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmKGZ1bGZpbGxlZCkge1xuXHRcdFx0ZGVmZXJyZWQuc3BsaWNlKGktLSwgMSlcblx0XHRcdHZhciByID0gZm4oKTtcblx0XHRcdGlmIChyICE9PSB1bmRlZmluZWQpIHJlc3VsdCA9IHI7XG5cdFx0fVxuXHR9XG5cdHJldHVybiByZXN1bHQ7XG59OyIsInZhciBnZXRQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiA/IChvYmopID0+IChPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqKSkgOiAob2JqKSA9PiAob2JqLl9fcHJvdG9fXyk7XG52YXIgbGVhZlByb3RvdHlwZXM7XG4vLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3Rcbi8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuLy8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4vLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3Rcbi8vIG1vZGUgJiAxNjogcmV0dXJuIHZhbHVlIHdoZW4gaXQncyBQcm9taXNlLWxpa2Vcbi8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbl9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG5cdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IHRoaXModmFsdWUpO1xuXHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuXHRpZih0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlKSB7XG5cdFx0aWYoKG1vZGUgJiA0KSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG5cdFx0aWYoKG1vZGUgJiAxNikgJiYgdHlwZW9mIHZhbHVlLnRoZW4gPT09ICdmdW5jdGlvbicpIHJldHVybiB2YWx1ZTtcblx0fVxuXHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuXHR2YXIgZGVmID0ge307XG5cdGxlYWZQcm90b3R5cGVzID0gbGVhZlByb3RvdHlwZXMgfHwgW251bGwsIGdldFByb3RvKHt9KSwgZ2V0UHJvdG8oW10pLCBnZXRQcm90byhnZXRQcm90byldO1xuXHRmb3IodmFyIGN1cnJlbnQgPSBtb2RlICYgMiAmJiB2YWx1ZTsgdHlwZW9mIGN1cnJlbnQgPT0gJ29iamVjdCcgJiYgIX5sZWFmUHJvdG90eXBlcy5pbmRleE9mKGN1cnJlbnQpOyBjdXJyZW50ID0gZ2V0UHJvdG8oY3VycmVudCkpIHtcblx0XHRPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhjdXJyZW50KS5mb3JFYWNoKChrZXkpID0+IChkZWZba2V5XSA9ICgpID0+ICh2YWx1ZVtrZXldKSkpO1xuXHR9XG5cdGRlZlsnZGVmYXVsdCddID0gKCkgPT4gKHZhbHVlKTtcblx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBkZWYpO1xuXHRyZXR1cm4gbnM7XG59OyIsInZhciBpblByb2dyZXNzID0ge307XG52YXIgZGF0YVdlYnBhY2tQcmVmaXggPSBcInVyYmFuZG9jc193ZWJhcHA6XCI7XG4vLyBsb2FkU2NyaXB0IGZ1bmN0aW9uIHRvIGxvYWQgYSBzY3JpcHQgdmlhIHNjcmlwdCB0YWdcbl9fd2VicGFja19yZXF1aXJlX18ubCA9ICh1cmwsIGRvbmUsIGtleSwgY2h1bmtJZCkgPT4ge1xuXHRpZihpblByb2dyZXNzW3VybF0pIHsgaW5Qcm9ncmVzc1t1cmxdLnB1c2goZG9uZSk7IHJldHVybjsgfVxuXHR2YXIgc2NyaXB0LCBuZWVkQXR0YWNoO1xuXHRpZihrZXkgIT09IHVuZGVmaW5lZCkge1xuXHRcdHZhciBzY3JpcHRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIik7XG5cdFx0Zm9yKHZhciBpID0gMDsgaSA8IHNjcmlwdHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdHZhciBzID0gc2NyaXB0c1tpXTtcblx0XHRcdGlmKHMuZ2V0QXR0cmlidXRlKFwic3JjXCIpID09IHVybCB8fCBzLmdldEF0dHJpYnV0ZShcImRhdGEtd2VicGFja1wiKSA9PSBkYXRhV2VicGFja1ByZWZpeCArIGtleSkgeyBzY3JpcHQgPSBzOyBicmVhazsgfVxuXHRcdH1cblx0fVxuXHRpZighc2NyaXB0KSB7XG5cdFx0bmVlZEF0dGFjaCA9IHRydWU7XG5cdFx0c2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG5cblx0XHRzY3JpcHQuY2hhcnNldCA9ICd1dGYtOCc7XG5cdFx0c2NyaXB0LnRpbWVvdXQgPSAxMjA7XG5cdFx0aWYgKF9fd2VicGFja19yZXF1aXJlX18ubmMpIHtcblx0XHRcdHNjcmlwdC5zZXRBdHRyaWJ1dGUoXCJub25jZVwiLCBfX3dlYnBhY2tfcmVxdWlyZV9fLm5jKTtcblx0XHR9XG5cdFx0c2NyaXB0LnNldEF0dHJpYnV0ZShcImRhdGEtd2VicGFja1wiLCBkYXRhV2VicGFja1ByZWZpeCArIGtleSk7XG5cblx0XHRzY3JpcHQuc3JjID0gdXJsO1xuXHR9XG5cdGluUHJvZ3Jlc3NbdXJsXSA9IFtkb25lXTtcblx0dmFyIG9uU2NyaXB0Q29tcGxldGUgPSAocHJldiwgZXZlbnQpID0+IHtcblx0XHQvLyBhdm9pZCBtZW0gbGVha3MgaW4gSUUuXG5cdFx0c2NyaXB0Lm9uZXJyb3IgPSBzY3JpcHQub25sb2FkID0gbnVsbDtcblx0XHRjbGVhclRpbWVvdXQodGltZW91dCk7XG5cdFx0dmFyIGRvbmVGbnMgPSBpblByb2dyZXNzW3VybF07XG5cdFx0ZGVsZXRlIGluUHJvZ3Jlc3NbdXJsXTtcblx0XHRzY3JpcHQucGFyZW50Tm9kZSAmJiBzY3JpcHQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChzY3JpcHQpO1xuXHRcdGRvbmVGbnMgJiYgZG9uZUZucy5mb3JFYWNoKChmbikgPT4gKGZuKGV2ZW50KSkpO1xuXHRcdGlmKHByZXYpIHJldHVybiBwcmV2KGV2ZW50KTtcblx0fVxuXHR2YXIgdGltZW91dCA9IHNldFRpbWVvdXQob25TY3JpcHRDb21wbGV0ZS5iaW5kKG51bGwsIHVuZGVmaW5lZCwgeyB0eXBlOiAndGltZW91dCcsIHRhcmdldDogc2NyaXB0IH0pLCAxMjAwMDApO1xuXHRzY3JpcHQub25lcnJvciA9IG9uU2NyaXB0Q29tcGxldGUuYmluZChudWxsLCBzY3JpcHQub25lcnJvcik7XG5cdHNjcmlwdC5vbmxvYWQgPSBvblNjcmlwdENvbXBsZXRlLmJpbmQobnVsbCwgc2NyaXB0Lm9ubG9hZCk7XG5cdG5lZWRBdHRhY2ggJiYgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpO1xufTsiLCIvLyBzcmMvanMvc3VwYWJhc2UtY2xpZW50LmpzXG4vKipcbiAqIFN1cGFiYXNlIENsaWVudFxuICogQG1vZHVsZSBzdXBhYmFzZS1jbGllbnRcbiAqIEBkZXNjcmlwdGlvbiBUaGlzIG1vZHVsZSBoYW5kbGVzIHRoZSBTdXBhYmFzZSBjbGllbnQgaW5pdGlhbGl6YXRpb24gYW5kIGNvbmZpZ3VyYXRpb24uXG4gKiBAdmVyc2lvbiAwLjAuMVxuICogQGF1dGhvciBHcmV5UGFuZGFcbiAqXG4gKiBAY2hhbmdlbG9nXG4gKiAtIDAuMC4xICgyMDI1LTA1LTA5KTogSW5pdGlhbCB2ZXJzaW9uIHdpdGggYmFzaWMgU3VwYWJhc2UgY2xpZW50IGluaXRpYWxpemF0aW9uLlxuICovXG5cbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCJAc3VwYWJhc2Uvc3VwYWJhc2UtanNcIjtcblxuY29uc3Qgc3VwYWJhc2VVcmwgPSBcImh0dHBzOi8vb2ZleXNzaXBpYmt0bWJmZWJpYm8uc3VwYWJhc2UuY29cIjtcbmNvbnN0IHN1cGFiYXNlQW5vbktleSA9XG4gIFwiZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKemRYQmhZbUZ6WlNJc0luSmxaaUk2SW05bVpYbHpjMmx3YVdKcmRHMWlabVZpYVdKdklpd2ljbTlzWlNJNkltRnViMjRpTENKcFlYUWlPakUzTkRNNU1qVXdPVFFzSW1WNGNDSTZNakExT1RVd01UQTVOSDAudzcxQ0FLZm9sa3R6UmwtVG1MVmhIWWFFYmhDZlZrNEE3WXJhRVVDZ2xyVVwiO1xuXG5jb25zdCBjbGllbnQgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSk7XG5cbmV4cG9ydCBjb25zdCBzdXBhYmFzZSA9IGNsaWVudDtcbiIsIi8vIHNyYy9hdXRoL2F1dGguanNcbi8qKlxuICogQXV0aGVudGljYXRpb24gTW9kdWxlIC0gQmFzZVxuICogQG1vZHVsZSBhdXRoXG4gKiBAZGVzY3JpcHRpb24gQmFzZSBtb2R1bGUgZm9yIGF1dGhlbnRpY2F0aW9uIHdpdGggY29tbW9uIGZ1bmN0aW9ucyBhbmQgY29uZmlndXJhdGlvblxuICogQHZlcnNpb24gMC4wLjVcbiAqXG4gKiBAY2hhbmdlbG9nXG4gKiAtIDAuMC41ICgyMDI1LTA1LTE1KTogQWRkZWQgc2Vzc2lvbiB2YWxpZGF0aW9uIGFuZCBwcm90ZWN0aW9uIGFnYWluc3Qgc3RhbGUgc2Vzc2lvbnMuXG4gKiAtIDAuMC40ICgyMDI1LTA1LTE1KTogUmVtb3ZhbCBvZiBGaXJlYmFzZSBDbG91ZCBGdW5jdGlvbnMgY29uc3RhbnRzLlxuICogLSAwLjAuMyAoMjAyNS0wNS0xMyk6IE1vZGlmaWVkIHRoZSBhdXRoZW50aWNhdGlvbiBzdGF0ZSBtYW5hZ2VtZW50IHRvIHVzZSBTdXBhYmFzZSBBdXRoIHN5c3RlbS5cbiAqIC0gMC4wLjIgKDIwMjUtMDUtMTMpOiBSZW9yZ2FuaXphdGlvbiBpbnRvIHNlcGFyYXRlIG1vZHVsZXNcbiAqIC0gMC4wLjEgKDIwMjUtMDUtMDMpOiBJbml0aWFsIGNyZWF0aW9uXG4gKi9cblxuaW1wb3J0IHsgc3VwYWJhc2UgfSBmcm9tIFwiLi4vc3VwYWJhc2UtY2xpZW50LmpzXCI7XG5cbi8vIEdsb2JhbCBhdXRoZW50aWNhdGlvbiBzdGF0ZVxubGV0IGN1cnJlbnRVc2VyID0gbnVsbDtcbmxldCBzZXNzaW9uVmFsaWRhdGVkID0gZmFsc2U7XG5cbi8qKlxuICogU2V0cyB0aGUgY3VycmVudCB1c2VyXG4gKiBAcGFyYW0ge09iamVjdH0gdXNlciAtIFVzZXIgZGF0YVxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0Q3VycmVudFVzZXIodXNlcikge1xuICBjdXJyZW50VXNlciA9IHVzZXI7XG4gIC8vIFBvc3NpYmxlIHN0b3JhZ2UgaW4gbG9jYWxTdG9yYWdlL3Nlc3Npb25TdG9yYWdlXG4gIGlmICh1c2VyKSB7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJjdXJyZW50VXNlclwiLCBKU09OLnN0cmluZ2lmeSh1c2VyKSk7XG4gIH0gZWxzZSB7XG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJjdXJyZW50VXNlclwiKTtcbiAgfVxufVxuXG4vKipcbiAqIFZhbGlkYXRlcyBpZiB0aGUgY3VycmVudCBzZXNzaW9uIGlzIGFjdGl2ZSB3aXRoIFN1cGFiYXNlXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxib29sZWFuPn0gVHJ1ZSBpZiBzZXNzaW9uIGlzIHZhbGlkLCBmYWxzZSBvdGhlcndpc2VcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZhbGlkYXRlU2Vzc2lvbigpIHtcbiAgdHJ5IHtcbiAgICAvLyBHZXQgY3VycmVudCBzZXNzaW9uIGZyb20gU3VwYWJhc2VcbiAgICBjb25zdCB7XG4gICAgICBkYXRhOiB7IHNlc3Npb24gfSxcbiAgICAgIGVycm9yOiBzZXNzaW9uRXJyb3IsXG4gICAgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0U2Vzc2lvbigpO1xuXG4gICAgLy8gTm8gc2Vzc2lvbiBvciBlcnJvciByZXRyaWV2aW5nIHNlc3Npb25cbiAgICBpZiAoc2Vzc2lvbkVycm9yIHx8ICFzZXNzaW9uKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIk5vIHZhbGlkIHNlc3Npb24gZm91bmRcIik7XG4gICAgICBzZXRDdXJyZW50VXNlcihudWxsKTtcbiAgICAgIHNlc3Npb25WYWxpZGF0ZWQgPSBmYWxzZTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBUcnkgdG8gcmVmcmVzaCB0aGUgdG9rZW4gdG8gdmFsaWRhdGUgaXQgd2l0aCB0aGUgc2VydmVyXG4gICAgY29uc3QgeyBlcnJvcjogcmVmcmVzaEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLnJlZnJlc2hTZXNzaW9uKCk7XG5cbiAgICBpZiAocmVmcmVzaEVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJTZXNzaW9uIHZhbGlkYXRpb24gZmFpbGVkOlwiLCByZWZyZXNoRXJyb3IpO1xuICAgICAgLy8gRm9yY2UgY2xlYXIgdGhlIGludmFsaWQgc2Vzc2lvblxuICAgICAgYXdhaXQgc3VwYWJhc2UuYXV0aC5zaWduT3V0KCk7XG4gICAgICBzZXRDdXJyZW50VXNlcihudWxsKTtcbiAgICAgIHNlc3Npb25WYWxpZGF0ZWQgPSBmYWxzZTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBTZXNzaW9uIGlzIHZhbGlkLCB1cGRhdGUgdGhlIGN1cnJlbnQgdXNlclxuICAgIHNldEN1cnJlbnRVc2VyKHNlc3Npb24udXNlcik7XG4gICAgc2Vzc2lvblZhbGlkYXRlZCA9IHRydWU7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiU2Vzc2lvbiB2YWxpZGF0aW9uIGVycm9yOlwiLCBlKTtcbiAgICBzZXRDdXJyZW50VXNlcihudWxsKTtcbiAgICBzZXNzaW9uVmFsaWRhdGVkID0gZmFsc2U7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbi8qKlxuICogUmV0cmlldmVzIHRoZSBjdXJyZW50IHVzZXJcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsaWRhdGUgLSBXaGV0aGVyIHRvIHZhbGlkYXRlIHRoZSBzZXNzaW9uIHdpdGggU3VwYWJhc2VcbiAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdHxudWxsPn0gVGhlIGN1cnJlbnQgdXNlciBvciBudWxsXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDdXJyZW50VXNlcih2YWxpZGF0ZSA9IHRydWUpIHtcbiAgLy8gSWYgd2UgbmVlZCB0byB2YWxpZGF0ZSBhbmQgaGF2ZW4ndCBkb25lIHNvIHlldFxuICBpZiAodmFsaWRhdGUgJiYgIXNlc3Npb25WYWxpZGF0ZWQpIHtcbiAgICBhd2FpdCB2YWxpZGF0ZVNlc3Npb24oKTtcbiAgfVxuXG4gIC8vIElmIG5vIHZhbGlkYXRpb24gbmVlZGVkIG9yIGFscmVhZHkgdmFsaWRhdGVkXG4gIGlmICghdmFsaWRhdGUgJiYgIWN1cnJlbnRVc2VyKSB7XG4gICAgLy8gVHJ5IHRvIHJldHJpZXZlIGZyb20gc3RvcmFnZSBpZiBub3QgaW4gbWVtb3J5XG4gICAgY29uc3Qgc3RvcmVkVXNlciA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiY3VycmVudFVzZXJcIik7XG4gICAgaWYgKHN0b3JlZFVzZXIpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGN1cnJlbnRVc2VyID0gSlNPTi5wYXJzZShzdG9yZWRVc2VyKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHJldHJpZXZpbmcgdXNlcjpcIiwgZSk7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFwiY3VycmVudFVzZXJcIik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGN1cnJlbnRVc2VyO1xufVxuXG4vKipcbiAqIFN5bmNocm9ub3VzIHZlcnNpb24gb2YgZ2V0Q3VycmVudFVzZXIgZm9yIG5vbi1hc3luYyBjb250ZXh0c1xuICogV0FSTklORzogVGhpcyBtYXkgcmV0dXJuIHN0YWxlIGRhdGEgaWYgc2Vzc2lvbiBpcyBpbnZhbGlkXG4gKiBAcmV0dXJucyB7T2JqZWN0fG51bGx9IFRoZSBjdXJyZW50IHVzZXIgb3IgbnVsbFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q3VycmVudFVzZXJTeW5jKCkge1xuICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgY29uc3Qgc3RvcmVkVXNlciA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiY3VycmVudFVzZXJcIik7XG4gICAgaWYgKHN0b3JlZFVzZXIpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGN1cnJlbnRVc2VyID0gSlNPTi5wYXJzZShzdG9yZWRVc2VyKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHJldHJpZXZpbmcgdXNlcjpcIiwgZSk7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFwiY3VycmVudFVzZXJcIik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGN1cnJlbnRVc2VyO1xufVxuXG4vKipcbiAqIExvZ3Mgb3V0IHRoZSB1c2VyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx2b2lkPn1cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvZ291dCgpIHtcbiAgdHJ5IHtcbiAgICAvLyBTaWduIG91dCBmcm9tIFN1cGFiYXNlXG4gICAgYXdhaXQgc3VwYWJhc2UuYXV0aC5zaWduT3V0KCk7XG5cbiAgICAvLyBDbGVhciBsb2NhbCBzdGF0ZVxuICAgIGN1cnJlbnRVc2VyID0gbnVsbDtcbiAgICBzZXNzaW9uVmFsaWRhdGVkID0gZmFsc2U7XG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJjdXJyZW50VXNlclwiKTtcblxuICAgIC8vIFJlZGlyZWN0IHRvIHRoZSBob21lIHBhZ2UgYWZ0ZXIgbG9nb3V0XG4gICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcIi9cIjtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZHVyaW5nIGxvZ291dDpcIiwgZXJyb3IpO1xuICAgIC8vIFN0aWxsIGNsZWFyIGxvY2FsIHN0YXRlIGV2ZW4gaWYgU3VwYWJhc2Ugc2lnbk91dCBmYWlsc1xuICAgIGN1cnJlbnRVc2VyID0gbnVsbDtcbiAgICBzZXNzaW9uVmFsaWRhdGVkID0gZmFsc2U7XG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJjdXJyZW50VXNlclwiKTtcbiAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IFwiL1wiO1xuICB9XG59XG5cbi8qKlxuICogQ2hlY2tzIGlmIHRoZSB1c2VyIGlzIGxvZ2dlZCBpbiB3aXRoIHZhbGlkIHNlc3Npb25cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsaWRhdGUgLSBXaGV0aGVyIHRvIHZhbGlkYXRlIHdpdGggU3VwYWJhc2UgZmlyc3RcbiAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fSBUcnVlIGlmIHRoZSB1c2VyIGlzIGxvZ2dlZCBpbiB3aXRoIHZhbGlkIHNlc3Npb25cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGlzTG9nZ2VkSW4odmFsaWRhdGUgPSB0cnVlKSB7XG4gIGNvbnN0IHVzZXIgPSBhd2FpdCBnZXRDdXJyZW50VXNlcih2YWxpZGF0ZSk7XG4gIHJldHVybiB1c2VyICE9PSBudWxsO1xufVxuXG4vKipcbiAqIFN5bmNocm9ub3VzIHZlcnNpb24gb2YgaXNMb2dnZWRJblxuICogV0FSTklORzogVGhpcyBtYXkgcmV0dXJuIGluY29ycmVjdCByZXN1bHRzIGlmIHNlc3Npb24gaXMgaW52YWxpZFxuICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdXNlciBhcHBlYXJzIHRvIGJlIGxvZ2dlZCBpbiBsb2NhbGx5XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc0xvZ2dlZEluU3luYygpIHtcbiAgcmV0dXJuIGdldEN1cnJlbnRVc2VyU3luYygpICE9PSBudWxsO1xufVxuXG4vKipcbiAqIFByb3RlY3RzIGEgcGFnZSB0aGF0IHJlcXVpcmVzIGF1dGhlbnRpY2F0aW9uXG4gKiBAcGFyYW0ge3N0cmluZ30gcmVkaXJlY3RVcmwgLSBVUkwgdG8gcmVkaXJlY3QgaWYgbm90IGF1dGhlbnRpY2F0ZWRcbiAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fSBUcnVlIGlmIGF1dGhlbnRpY2F0ZWQsIGZhbHNlIG90aGVyd2lzZVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJvdGVjdFBhZ2UocmVkaXJlY3RVcmwgPSBcIi9sb2dpblwiKSB7XG4gIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCB2YWxpZGF0ZVNlc3Npb24oKTtcblxuICBpZiAoIWlzVmFsaWQpIHtcbiAgICAvLyBSZWRpcmVjdCB0byBsb2dpbiBwYWdlXG4gICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSByZWRpcmVjdFVybDtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn1cblxuLyoqXG4gKiBJbml0aWFsaXplcyBhdXRoIG9uIHBhZ2UgbG9hZFxuICogQ2FsbCB0aGlzIGF0IHRoZSBiZWdpbm5pbmcgb2YgeW91ciBhcHAgaW5pdGlhbGl6YXRpb25cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGluaXRBdXRoKCkge1xuICAvLyBWYWxpZGF0ZSBzZXNzaW9uIG9uIHBhZ2UgbG9hZFxuICBhd2FpdCB2YWxpZGF0ZVNlc3Npb24oKTtcblxuICAvLyBTZXQgdXAgYXV0aCBzdGF0ZSBjaGFuZ2UgbGlzdGVuZXJcbiAgc3VwYWJhc2UuYXV0aC5vbkF1dGhTdGF0ZUNoYW5nZShhc3luYyAoZXZlbnQsIHNlc3Npb24pID0+IHtcbiAgICBjb25zb2xlLmxvZyhcIkF1dGggc3RhdGUgY2hhbmdlZDpcIiwgZXZlbnQpO1xuXG4gICAgaWYgKGV2ZW50ID09PSBcIlNJR05FRF9JTlwiICYmIHNlc3Npb24pIHtcbiAgICAgIHNldEN1cnJlbnRVc2VyKHNlc3Npb24udXNlcik7XG4gICAgICBzZXNzaW9uVmFsaWRhdGVkID0gdHJ1ZTtcbiAgICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcIlNJR05FRF9PVVRcIikge1xuICAgICAgc2V0Q3VycmVudFVzZXIobnVsbCk7XG4gICAgICBzZXNzaW9uVmFsaWRhdGVkID0gZmFsc2U7XG4gICAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJUT0tFTl9SRUZSRVNIRURcIikge1xuICAgICAgc2V0Q3VycmVudFVzZXIoc2Vzc2lvbi51c2VyKTtcbiAgICAgIHNlc3Npb25WYWxpZGF0ZWQgPSB0cnVlO1xuICAgIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwiVVNFUl9VUERBVEVEXCIpIHtcbiAgICAgIHNldEN1cnJlbnRVc2VyKHNlc3Npb24udXNlcik7XG4gICAgICBzZXNzaW9uVmFsaWRhdGVkID0gdHJ1ZTtcbiAgICB9XG4gIH0pO1xufVxuXG4vKipcbiAqIERpc3BsYXlzIGFuIGVycm9yIG1lc3NhZ2VcbiAqIEBwYXJhbSB7c3RyaW5nfSBtZXNzYWdlIC0gRXJyb3IgbWVzc2FnZSB0byBkaXNwbGF5XG4gKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudElkIC0gSUQgb2YgdGhlIGVsZW1lbnQgd2hlcmUgdG8gZGlzcGxheSB0aGUgZXJyb3JcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNob3dFcnJvcihtZXNzYWdlLCBlbGVtZW50SWQgPSBcImVycm9yTWVzc2FnZVwiKSB7XG4gIGNvbnN0IGVycm9yRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRJZCk7XG4gIGlmIChlcnJvckVsZW1lbnQpIHtcbiAgICBlcnJvckVsZW1lbnQuaW5uZXJIVE1MID0gbWVzc2FnZTtcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZWxlbWVudCBub3QgZm91bmQ6XCIsIGVsZW1lbnRJZCk7XG4gIH1cbn1cblxuLyoqXG4gKiBEaXNwbGF5cyBhIHN0YXR1cyBtZXNzYWdlXG4gKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIE1lc3NhZ2UgdG8gZGlzcGxheVxuICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBNZXNzYWdlIHR5cGUgKHN1Y2Nlc3MsIGluZm8sIHdhcm5pbmcsIGRhbmdlcilcbiAqIEBwYXJhbSB7c3RyaW5nfSBlbGVtZW50SWQgLSBJRCBvZiB0aGUgZWxlbWVudCB3aGVyZSB0byBkaXNwbGF5IHRoZSBtZXNzYWdlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzaG93U3RhdHVzKFxuICBtZXNzYWdlLFxuICB0eXBlID0gXCJpbmZvXCIsXG4gIGVsZW1lbnRJZCA9IFwic3RhdHVzTWVzc2FnZVwiXG4pIHtcbiAgY29uc3Qgc3RhdHVzRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRJZCk7XG4gIGlmIChzdGF0dXNFbGVtZW50KSB7XG4gICAgc3RhdHVzRWxlbWVudC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG5cbiAgICAvLyBSZW1vdmUgYWxsIGFsZXJ0LSogY2xhc3Nlc1xuICAgIHN0YXR1c0VsZW1lbnQuY2xhc3NMaXN0LmZvckVhY2goKGNsYXNzTmFtZSkgPT4ge1xuICAgICAgaWYgKGNsYXNzTmFtZS5zdGFydHNXaXRoKFwiYWxlcnQtXCIpKSB7XG4gICAgICAgIHN0YXR1c0VsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gQWRkIHRoZSBjbGFzcyBjb3JyZXNwb25kaW5nIHRvIHRoZSB0eXBlXG4gICAgc3RhdHVzRWxlbWVudC5jbGFzc0xpc3QuYWRkKGBhbGVydC0ke3R5cGV9YCk7XG4gICAgc3RhdHVzRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJTdGF0dXMgZWxlbWVudCBub3QgZm91bmQ6XCIsIGVsZW1lbnRJZCk7XG4gIH1cbn1cblxuLyoqXG4gKiBIaWRlcyBhbiBlbGVtZW50XG4gKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudElkIC0gSUQgb2YgdGhlIGVsZW1lbnQgdG8gaGlkZVxuICovXG5leHBvcnQgZnVuY3Rpb24gaGlkZUVsZW1lbnQoZWxlbWVudElkKSB7XG4gIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50SWQpO1xuICBpZiAoZWxlbWVudCkge1xuICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgfVxufVxuXG4vKipcbiAqIFNob3dzIGFuIGVsZW1lbnRcbiAqIEBwYXJhbSB7c3RyaW5nfSBlbGVtZW50SWQgLSBJRCBvZiB0aGUgZWxlbWVudCB0byBzaG93XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzaG93RWxlbWVudChlbGVtZW50SWQpIHtcbiAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRJZCk7XG4gIGlmIChlbGVtZW50KSB7XG4gICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICB9XG59XG5cbi8qKlxuICogU2hvd3MgdGhlIGxvYWRpbmcgaW5kaWNhdG9yXG4gKiBAcGFyYW0ge3N0cmluZ30gYnV0dG9uSWQgLSBJRCBvZiB0aGUgYnV0dG9uXG4gKiBAcGFyYW0ge3N0cmluZ30gc3Bpbm5lcklkIC0gSUQgb2YgdGhlIHNwaW5uZXJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNob3dMb2FkaW5nKGJ1dHRvbklkLCBzcGlubmVySWQpIHtcbiAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYnV0dG9uSWQpO1xuICBjb25zdCBzcGlubmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc3Bpbm5lcklkKTtcblxuICBpZiAoYnV0dG9uKSBidXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICBpZiAoc3Bpbm5lcikgc3Bpbm5lci5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xufVxuXG4vKipcbiAqIEhpZGVzIHRoZSBsb2FkaW5nIGluZGljYXRvclxuICogQHBhcmFtIHtzdHJpbmd9IGJ1dHRvbklkIC0gSUQgb2YgdGhlIGJ1dHRvblxuICogQHBhcmFtIHtzdHJpbmd9IHNwaW5uZXJJZCAtIElEIG9mIHRoZSBzcGlubmVyXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBoaWRlTG9hZGluZyhidXR0b25JZCwgc3Bpbm5lcklkKSB7XG4gIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGJ1dHRvbklkKTtcbiAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNwaW5uZXJJZCk7XG5cbiAgaWYgKGJ1dHRvbikgYnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gIGlmIChzcGlubmVyKSBzcGlubmVyLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG59XG5cbi8vIEV4cG9ydCB0aGUgbmVjZXNzYXJ5IGZ1bmN0aW9ucyBhbmQgdmFyaWFibGVzXG5leHBvcnQgZGVmYXVsdCB7XG4gIGdldEN1cnJlbnRVc2VyLFxuICBnZXRDdXJyZW50VXNlclN5bmMsXG4gIHNldEN1cnJlbnRVc2VyLFxuICBsb2dvdXQsXG4gIGlzTG9nZ2VkSW4sXG4gIGlzTG9nZ2VkSW5TeW5jLFxuICB2YWxpZGF0ZVNlc3Npb24sXG4gIHByb3RlY3RQYWdlLFxuICBpbml0QXV0aCxcbiAgc2hvd0Vycm9yLFxuICBzaG93U3RhdHVzLFxuICBoaWRlRWxlbWVudCxcbiAgc2hvd0VsZW1lbnQsXG4gIHNob3dMb2FkaW5nLFxuICBoaWRlTG9hZGluZyxcbn07XG4iLCIvLyBzcmMvYXV0aC9zaWdudXAuanNcbi8qKlxuICogU2lnbnVwIE1vZHVsZVxuICogQG1vZHVsZSBzaWdudXBcbiAqIEBkZXNjcmlwdGlvbiBIYW5kbGVzIHVzZXIgcmVnaXN0cmF0aW9uIHdpdGggY2xpZW50LXNpZGUgdmFsaWRhdGlvbiwgR29vZ2xlIE9BdXRoLCBhbmQgcGhvbmUgdmVyaWZpY2F0aW9uIHVzaW5nIFN1cGFiYXNlLlxuICogQHZlcnNpb24gMC4yLjFcbiAqXG4gKiBAY2hhbmdlbG9nXG4gKiAtIDAuMi4xICgyMDI1LTA1LTE4KTogQWRkZWQgY2FwdGNoYSB3aXRoIENsb3VkZmxhcmUgVHVybnN0aWxlLlxuICogLSAwLjIuMCAoMjAyNS0wNS0xOCk6IEFkZGVkIHBob25lIG51bWJlciBpbnB1dCwgT1RQIHNlbmRpbmcgYW5kIHZlcmlmaWNhdGlvbiBmb3IgZW1haWwvcGFzc3dvcmQgc2lnbnVwLlxuICogLSAwLjEuMSAoMjAyNS0wNS0xOCk6IEFkZGVkIEdvb2dsZSBTaWduLVVwIGZ1bmN0aW9uYWxpdHkuXG4gKiAtIDAuMS4wICgyMDI1LTA1LTE1KTogTWlncmF0ZWQgdG8gU3VwYWJhc2UgY2xpZW50LXNpZGUgYXV0aCAodmVyc2lvbmluZyBhZGp1c3RlZClcbiAqL1xuXG5pbXBvcnQgeyBzaG93RXJyb3IsIHNob3dTdGF0dXMsIHNob3dMb2FkaW5nLCBoaWRlTG9hZGluZyB9IGZyb20gXCIuL2F1dGguanNcIjtcbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSBcIi4uL3N1cGFiYXNlLWNsaWVudC5qc1wiO1xuXG4vLyBTdG9yZSBwaG9uZSBudW1iZXIgdGVtcG9yYXJpbHkgYmV0d2VlbiBzdGVwc1xubGV0IGNhcHRjaGFUb2tlbiA9IG51bGw7IC8vIFRvIHN0b3JlIHRoZSBjYXB0Y2hhIHRva2VuICh1c2VkIGJ5IGJvdGggaENhcHRjaGEgYW5kIFR1cm5zdGlsZSlcbmxldCB0dXJuc3RpbGVXaWRnZXRJZCA9IG51bGw7IC8vIFRvIHN0b3JlIFR1cm5zdGlsZSB3aWRnZXQgSURcblxuLy8gVGhpcyBmdW5jdGlvbiB3aWxsIGJlIGNhbGxlZCBieSB0aGUgQ2xvdWRmbGFyZSBUdXJuc3RpbGUgc2NyaXB0IG9uY2UgaXQncyBsb2FkZWRcbi8vIChkdWUgdG8gJm9ubG9hZD1vbmxvYWRUdXJuc3RpbGVDYWxsYmFjayBpbiB0aGUgc2NyaXB0IHRhZyBpbiBzaWdudXAuaHRtbClcbndpbmRvdy5vbmxvYWRUdXJuc3RpbGVDYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtcbiAgY29uc29sZS5sb2coXCJUdXJuc3RpbGUgQVBJIHJlYWR5IChvbmxvYWRUdXJuc3RpbGVDYWxsYmFjayBleGVjdXRlZCkuXCIpO1xuICBjb25zdCB0dXJuc3RpbGVDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInR1cm5zdGlsZS1jb250YWluZXJcIik7XG5cbiAgaWYgKHR1cm5zdGlsZUNvbnRhaW5lciAmJiB3aW5kb3cudHVybnN0aWxlICYmICF0dXJuc3RpbGVXaWRnZXRJZCkge1xuICAgIGNvbnNvbGUubG9nKFwiUmVuZGVyaW5nIFR1cm5zdGlsZSB3aWRnZXQgZnJvbSBvbmxvYWRUdXJuc3RpbGVDYWxsYmFjay4uLlwiKTtcbiAgICB0cnkge1xuICAgICAgdHVybnN0aWxlV2lkZ2V0SWQgPSB3aW5kb3cudHVybnN0aWxlLnJlbmRlcih0dXJuc3RpbGVDb250YWluZXIsIHtcbiAgICAgICAgc2l0ZWtleTogXCIweDRBQUFBQUFCZHpZM0luT1UyX0luOTlcIixcbiAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uICh0b2tlbikge1xuICAgICAgICAgIGNhcHRjaGFUb2tlbiA9IHRva2VuO1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiVHVybnN0aWxlIHRva2VuIG9idGFpbmVkOlwiLCB0b2tlbik7XG4gICAgICAgIH0sXG4gICAgICAgIFwiZXhwaXJlZC1jYWxsYmFja1wiOiAoKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICBcIlR1cm5zdGlsZSB0b2tlbiBleHBpcmVkLiBSZXNldHRpbmcgd2lkZ2V0LiBJRDpcIixcbiAgICAgICAgICAgIHR1cm5zdGlsZVdpZGdldElkXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAod2luZG93LnR1cm5zdGlsZSAmJiB0dXJuc3RpbGVXaWRnZXRJZCkge1xuICAgICAgICAgICAgd2luZG93LnR1cm5zdGlsZS5yZXNldCh0dXJuc3RpbGVXaWRnZXRJZCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhcHRjaGFUb2tlbiA9IG51bGw7IC8vIENsZWFyIHRoZSB0b2tlblxuICAgICAgICAgIC8vIFdpZGdldCBzaG91bGQgYmUgcmVhZHkgZm9yIGEgbmV3IGNoYWxsZW5nZSBhZnRlciByZXNldC5cbiAgICAgICAgfSxcbiAgICAgICAgXCJlcnJvci1jYWxsYmFja1wiOiAoZXJyKSA9PiB7XG4gICAgICAgICAgY2FwdGNoYVRva2VuID0gbnVsbDtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiVHVybnN0aWxlIGVycm9yIGNhbGxiYWNrOlwiLCBlcnIpO1xuICAgICAgICAgIHNob3dFcnJvcihgRXJyZXVyIENBUFRDSEE6ICR7ZXJyfS4gVmV1aWxsZXogcsOpZXNzYXllci5gKTtcbiAgICAgICAgfSxcbiAgICAgICAgLy8gdGhlbWU6ICdsaWdodCcsIC8vIE9wdGlvbmFsOiAnbGlnaHQnLCAnZGFyaycsIG9yICdhdXRvJ1xuICAgICAgICAvLyBsYW5ndWFnZTogJ2ZyJywgLy8gT3B0aW9uYWw6IHNwZWNpZnkgbGFuZ3VhZ2VcbiAgICAgIH0pO1xuICAgICAgaWYgKHR1cm5zdGlsZVdpZGdldElkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcbiAgICAgICAgICBcIlR1cm5zdGlsZS5yZW5kZXIgZGlkIG5vdCByZXR1cm4gYSB3aWRnZXRJZC4gU2l0ZWtleSBvciBjb250YWluZXIgaXNzdWU/XCJcbiAgICAgICAgKTtcbiAgICAgICAgc2hvd0Vycm9yKFwiRXJyZXVyIGluaXRpYWxpc2F0aW9uIENBUFRDSEEgKElEIHdpZGdldCBub24gcmV0b3VybsOpKS5cIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlR1cm5zdGlsZSB3aWRnZXQgcmVuZGVyZWQuIElEOlwiLCB0dXJuc3RpbGVXaWRnZXRJZCk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHJlbmRlcmluZyBUdXJuc3RpbGU6XCIsIGUpO1xuICAgICAgc2hvd0Vycm9yKFwiSW1wb3NzaWJsZSBkJ2FmZmljaGVyIGxlIENBUFRDSEEuXCIpO1xuICAgIH1cbiAgfSBlbHNlIGlmICghdHVybnN0aWxlQ29udGFpbmVyKSB7XG4gICAgY29uc29sZS5lcnJvcihcIm9ubG9hZFR1cm5zdGlsZUNhbGxiYWNrOiAjdHVybnN0aWxlLWNvbnRhaW5lciBub3QgZm91bmQuXCIpO1xuICB9IGVsc2UgaWYgKCF3aW5kb3cudHVybnN0aWxlKSB7XG4gICAgY29uc29sZS5lcnJvcihcIm9ubG9hZFR1cm5zdGlsZUNhbGxiYWNrOiB3aW5kb3cudHVybnN0aWxlIEFQSSBub3QgZm91bmQuXCIpO1xuICB9IGVsc2UgaWYgKHR1cm5zdGlsZVdpZGdldElkKSB7XG4gICAgY29uc29sZS5sb2coXCJvbmxvYWRUdXJuc3RpbGVDYWxsYmFjazogV2lkZ2V0IGFscmVhZHkgc2VlbXMgcmVuZGVyZWQuXCIpO1xuICB9XG59O1xuXG4vKipcbiAqIEluaXRpYWxpemVzIHRoZSBzaWdudXAgcGFnZVxuICovXG5leHBvcnQgZnVuY3Rpb24gaW5pdFNpZ251cFBhZ2UoKSB7XG4gIGNvbnNvbGUubG9nKFwiaW5pdFNpZ251cFBhZ2UgY2FsbGVkXCIpO1xuICBjb25zdCBzaWdudXBGb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzaWdudXBGb3JtXCIpO1xuICAvLyBjb25zdCBvdHBGb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJvdHBGb3JtXCIpOyAvLyBPVFAgRm9ybSAtIFJlbW92ZWRcbiAgY29uc3QgZXJyb3JNZXNzYWdlRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJlcnJvck1lc3NhZ2VcIik7XG4gIGNvbnN0IHN0YXR1c01lc3NhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0YXR1c01lc3NhZ2VcIik7XG4gIGNvbnN0IGdvb2dsZVNpZ25VcEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZ29vZ2xlU2lnblVwQnRuXCIpO1xuICBjb25zdCB0dXJuc3RpbGVDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInR1cm5zdGlsZS1jb250YWluZXJcIik7IC8vIFVwZGF0ZWQgc2VsZWN0b3JcblxuICBpZiAoIXR1cm5zdGlsZUNvbnRhaW5lcikge1xuICAgIC8vIFVwZGF0ZWQgY2hlY2tcbiAgICBjb25zb2xlLmVycm9yKFxuICAgICAgXCIjdHVybnN0aWxlLWNvbnRhaW5lciBub3QgZm91bmQgaW4gdGhlIERPTS4gQ0FQVENIQSBjYW5ub3QgYmUgcmVuZGVyZWQuXCJcbiAgICApO1xuICB9XG5cbiAgLy8gVGhlIG9ubG9hZFR1cm5zdGlsZUNhbGxiYWNrIGlzIHRoZSBwcmltYXJ5IHdheSB0aGUgd2lkZ2V0IHNob3VsZCBiZSByZW5kZXJlZC5cbiAgLy8gVGhlIHJlZHVuZGFudCBibG9jayBwcmV2aW91c2x5IGhlcmUgaGFzIGJlZW4gcmVtb3ZlZC5cbiAgLy8gSWYgd2luZG93LnR1cm5zdGlsZSBpcyBhbHJlYWR5IGF2YWlsYWJsZSBhbmQgdGhlIGNhbGxiYWNrIGhhc24ndCBmaXJlZCB5ZXQgKGUuZy4gc2NyaXB0IGxvYWRlZCBmcm9tIGNhY2hlIGJlZm9yZSBET00gcmVhZHkgZm9yIGNvbnRhaW5lciksXG4gIC8vIHRoZSBgb25sb2FkVHVybnN0aWxlQ2FsbGJhY2tgIHdpbGwgc3RpbGwgZXhlY3V0ZSBvbmNlIHRoZSBzY3JpcHQgZnVsbHkgcHJvY2Vzc2VzIGl0cyBgb25sb2FkYCBwYXJhbWV0ZXIuXG5cbiAgaWYgKHNpZ251cEZvcm0pIHtcbiAgICBzaWdudXBGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgYXN5bmMgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgY29uc3QgZW1haWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImVtYWlsXCIpLnZhbHVlLnRyaW0oKTtcbiAgICAgIGNvbnN0IHBhc3N3b3JkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwYXNzd29yZFwiKS52YWx1ZTtcbiAgICAgIGNvbnN0IGNvbmZpcm1QYXNzd29yZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29uZmlybVBhc3N3b3JkXCIpLnZhbHVlO1xuICAgICAgbGV0IHBob25lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwaG9uZVwiKS52YWx1ZS50cmltKCk7IC8vIEdldCBwaG9uZSBudW1iZXJcblxuICAgICAgbGV0IHZhbGlkYXRpb25FcnJvcnMgPSBbXTtcbiAgICAgIGNvbnN0IGVtYWlsUGF0dGVybiA9IC9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvO1xuICAgICAgaWYgKCFlbWFpbFBhdHRlcm4udGVzdChlbWFpbCkpXG4gICAgICAgIHZhbGlkYXRpb25FcnJvcnMucHVzaChcIkwnYWRyZXNzZSBlbWFpbCBuJ2VzdCBwYXMgdmFsaWRlLlwiKTtcbiAgICAgIGlmIChwYXNzd29yZCAhPT0gY29uZmlybVBhc3N3b3JkKVxuICAgICAgICB2YWxpZGF0aW9uRXJyb3JzLnB1c2goXCJMZXMgbW90cyBkZSBwYXNzZSBuZSBjb3JyZXNwb25kZW50IHBhcy5cIik7XG4gICAgICBjb25zdCBwYXNzd29yZENvbXBsZXhpdHlQYXR0ZXJuID0gL14oPz0uKlthLXpdKSg/PS4qW0EtWl0pKD89LipcXGQpLiskLztcbiAgICAgIGlmICghcGFzc3dvcmRDb21wbGV4aXR5UGF0dGVybi50ZXN0KHBhc3N3b3JkKSB8fCBwYXNzd29yZC5sZW5ndGggPCA4KVxuICAgICAgICB2YWxpZGF0aW9uRXJyb3JzLnB1c2goXCJMZSBmb3JtYXQgZHUgbW90IGRlIHBhc3NlIGVzdCBpbnZhbGlkZS5cIik7XG4gICAgICBpZiAoIXBob25lKSB2YWxpZGF0aW9uRXJyb3JzLnB1c2goXCJMZSBudW3DqXJvIGRlIHTDqWzDqXBob25lIGVzdCByZXF1aXMuXCIpO1xuICAgICAgLy8gQmFzaWMgcGhvbmUgdmFsaWRhdGlvbiAoeW91IG1pZ2h0IHdhbnQgYSBtb3JlIHJvYnVzdCBvbmUpXG4gICAgICBjb25zdCBwaG9uZVBhdHRlcm4gPSAvXigwfFxcKzMzKVsxLTldXFxkezh9JC87IC8vIEV4YW1wbGU6IDA2MTIzNDU2Nzggb3IgKzMzNjEyMzQ1Njc4XG4gICAgICBpZiAocGhvbmUgJiYgIXBob25lUGF0dGVybi50ZXN0KHBob25lKSlcbiAgICAgICAgdmFsaWRhdGlvbkVycm9ycy5wdXNoKFxuICAgICAgICAgIFwiTGUgZm9ybWF0IGR1IG51bcOpcm8gZGUgdMOpbMOpcGhvbmUgZXN0IGludmFsaWRlIChleDogMDYxMjM0NTY3OCBvdSArMzM2MTIzNDU2NzgpLlwiXG4gICAgICAgICk7XG5cbiAgICAgIGlmICghY2FwdGNoYVRva2VuKSB7XG4gICAgICAgIC8vIENoZWNrIGlmIGNhcHRjaGEgaXMgc29sdmVkXG4gICAgICAgIHZhbGlkYXRpb25FcnJvcnMucHVzaChcIlZldWlsbGV6IGNvbXBsw6l0ZXIgbGUgQ0FQVENIQS5cIik7XG4gICAgICB9XG5cbiAgICAgIGlmICh2YWxpZGF0aW9uRXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgc2hvd0Vycm9yKHZhbGlkYXRpb25FcnJvcnMuam9pbihcIjxicj5cIikpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHNob3dMb2FkaW5nKFwic2lnbnVwQnRuXCIsIFwic2lnbnVwU3Bpbm5lclwiKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGxldCBlMTY0UGhvbmUgPSBwaG9uZTtcbiAgICAgICAgaWYgKHBob25lLnN0YXJ0c1dpdGgoXCIwXCIpKSB7XG4gICAgICAgICAgZTE2NFBob25lID0gYCszMyR7cGhvbmUuc3Vic3RyaW5nKDEpfWA7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTdGVwIDE6IFNpZ24gdXAgd2l0aCBlbWFpbCBhbmQgcGFzc3dvcmRcbiAgICAgICAgY29uc3QgeyBkYXRhLCBlcnJvcjogc2lnblVwRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnblVwKHtcbiAgICAgICAgICBlbWFpbCxcbiAgICAgICAgICBwYXNzd29yZCxcbiAgICAgICAgICBvcHRpb25zOiB7IGNhcHRjaGFUb2tlbiB9LCAvLyBQYXNzIGNhcHRjaGEgdG9rZW5cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHNpZ25VcEVycm9yKSB0aHJvdyBzaWduVXBFcnJvcjtcbiAgICAgICAgaWYgKCFkYXRhLnVzZXIpXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRXJyZXVyIGxvcnMgZGUgbGEgY3LDqWF0aW9uIGRlIGwndXRpbGlzYXRldXIuXCIpO1xuXG4gICAgICAgIGlmIChlMTY0UGhvbmUgJiYgZGF0YS51c2VyLmlkKSB7XG4gICAgICAgICAgYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgICAgIC5mcm9tKFwicHJvZmlsZXNcIilcbiAgICAgICAgICAgIC51cGRhdGUoeyBwaG9uZTogZTE2NFBob25lIH0pXG4gICAgICAgICAgICAuZXEoXCJpZFwiLCBkYXRhLnVzZXIuaWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXNlciBjcmVhdGVkLiBOb3cgdXBkYXRlIHRoZWlyIHByb2ZpbGUgd2l0aCB0aGUgcGhvbmUgbnVtYmVyIGlmIHByb3ZpZGVkLlxuICAgICAgICBsZXQgc3VjY2Vzc01lc3NhZ2UgPVxuICAgICAgICAgIFwiQ29tcHRlIGNyw6nDqSAhIFVuIGVtYWlsIGRlIGNvbmZpcm1hdGlvbiBhIMOpdMOpIGVudm95w6kuXCI7XG4gICAgICAgIHNob3dTdGF0dXMoc3VjY2Vzc01lc3NhZ2UsIFwic3VjY2Vzc1wiKTtcblxuICAgICAgICAvLyBIaWRlIHRoZSBmb3JtIGFuZCByZXNldCBpdFxuICAgICAgICBpZiAoc2lnbnVwRm9ybSkge1xuICAgICAgICAgIHNpZ251cEZvcm0uY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTsgLy8gSGlkZSB0aGUgZm9ybVxuICAgICAgICAgIHNpZ251cEZvcm0ucmVzZXQoKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVtYWlsL1Bhc3N3b3JkIFNpZ251cCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICBsZXQgZGlzcGxheUVycm9yID0gZXJyb3IubWVzc2FnZSB8fCBcIlVuZSBlcnJldXIgZXN0IHN1cnZlbnVlLlwiO1xuICAgICAgICBpZiAoXG4gICAgICAgICAgZXJyb3IubWVzc2FnZSAmJlxuICAgICAgICAgIGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoXCJVc2VyIGFscmVhZHkgcmVnaXN0ZXJlZFwiKVxuICAgICAgICApIHtcbiAgICAgICAgICBkaXNwbGF5RXJyb3IgPVxuICAgICAgICAgICAgXCJDZXR0ZSBhZHJlc3NlIGVtYWlsIGVzdCBkw6lqw6AgdXRpbGlzw6llLiBWZXVpbGxleiB2b3VzIGNvbm5lY3RlciBvdSB1dGlsaXNlciB1bmUgYXV0cmUgYWRyZXNzZS5cIjtcbiAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICBlcnJvci5tZXNzYWdlICYmXG4gICAgICAgICAgZXJyb3IubWVzc2FnZS5pbmNsdWRlcyhcIlVuYWJsZSB0byB2YWxpZGF0ZSBwaG9uZSBudW1iZXJcIilcbiAgICAgICAgKSB7XG4gICAgICAgICAgZGlzcGxheUVycm9yID0gXCJMZSBudW3DqXJvIGRlIHTDqWzDqXBob25lIGZvdXJuaSBuJ2VzdCBwYXMgdmFsaWRlLlwiO1xuICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgIGVycm9yLm1lc3NhZ2UgJiZcbiAgICAgICAgICBlcnJvci5tZXNzYWdlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJjYXB0Y2hhIHByb3RlY3Rpb25cIilcbiAgICAgICAgKSB7XG4gICAgICAgICAgZGlzcGxheUVycm9yID1cbiAgICAgICAgICAgIFwiRXJyZXVyIENBUFRDSEEgZHUgc2VydmV1ci4gVmV1aWxsZXogcsOpZXNzYXllci4gKFwiICtcbiAgICAgICAgICAgIGVycm9yLm1lc3NhZ2UgK1xuICAgICAgICAgICAgXCIpXCI7XG4gICAgICAgIH1cbiAgICAgICAgc2hvd0Vycm9yKGRpc3BsYXlFcnJvcik7XG4gICAgICB9IGZpbmFsbHkge1xuICAgICAgICBoaWRlTG9hZGluZyhcInNpZ251cEJ0blwiLCBcInNpZ251cFNwaW5uZXJcIik7XG4gICAgICAgIGlmICh3aW5kb3cudHVybnN0aWxlICYmIHR1cm5zdGlsZVdpZGdldElkKSB7XG4gICAgICAgICAgd2luZG93LnR1cm5zdGlsZS5yZXNldCh0dXJuc3RpbGVXaWRnZXRJZCk7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJUdXJuc3RpbGUgd2lkZ2V0IGhhcyBiZWVuIHJlc2V0LlwiKTtcbiAgICAgICAgfVxuICAgICAgICBjYXB0Y2hhVG9rZW4gPSBudWxsOyAvLyBDbGVhciB0b2tlbiBhZnRlciB1c2VcbiAgICAgIH1cbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmVycm9yKFwiU2lnbnVwIGZvcm0gKHNpZ251cEZvcm0pIG5vdCBmb3VuZC5cIik7XG4gIH1cblxuICBpZiAoZ29vZ2xlU2lnblVwQnRuKSB7XG4gICAgZ29vZ2xlU2lnblVwQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBzaG93TG9hZGluZyhcImdvb2dsZVNpZ25VcEJ0blwiLCBcImdvb2dsZVNpZ25VcFNwaW5uZXJcIik7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLnNpZ25JbldpdGhPQXV0aCh7XG4gICAgICAgICAgcHJvdmlkZXI6IFwiZ29vZ2xlXCIsXG4gICAgICAgICAgb3B0aW9uczogeyByZWRpcmVjdFRvOiBgJHt3aW5kb3cubG9jYXRpb24ub3JpZ2lufS9wcm9maWxlLmh0bWxgIH0sXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2lnbmluZyB1cCB3aXRoIEdvb2dsZTpcIiwgZXJyb3IpO1xuICAgICAgICAgIHNob3dFcnJvcihcbiAgICAgICAgICAgIGVycm9yLm1lc3NhZ2UgfHwgXCJFcnJldXIgbG9ycyBkZSBsJ2luc2NyaXB0aW9uIGF2ZWMgR29vZ2xlLlwiXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkV4Y2VwdGlvbiBkdXJpbmcgR29vZ2xlIHNpZ24tdXA6XCIsIGVycm9yKTtcbiAgICAgICAgc2hvd0Vycm9yKFxuICAgICAgICAgIFwiVW5lIGV4Y2VwdGlvbiBlc3Qgc3VydmVudWUgbG9ycyBkZSBsJ2luc2NyaXB0aW9uIGF2ZWMgR29vZ2xlLlwiXG4gICAgICAgICk7XG4gICAgICB9IGZpbmFsbHkge1xuICAgICAgICBoaWRlTG9hZGluZyhcImdvb2dsZVNpZ25VcEJ0blwiLCBcImdvb2dsZVNpZ25VcFNwaW5uZXJcIik7XG4gICAgICB9XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS53YXJuKFwiR29vZ2xlIFNpZ24tVXAgYnV0dG9uIChnb29nbGVTaWduVXBCdG4pIG5vdCBmb3VuZC5cIik7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuICBpbml0U2lnbnVwUGFnZSxcbn07XG4iLCIvLyBzcmMvZW50cmllcy9zaWdudXAuanNcbi8qKlxuICogU2lnbnVwIEVudHJ5IFBvaW50XG4gKlxuICogVGhpcyBtb2R1bGUgc2VydmVzIGFzIHRoZSBlbnRyeSBwb2ludCBmb3IgdGhlIHNpZ251cCBwYWdlLlxuICovXG5cbi8vIEltcG9ydCBvdXIgc2lnbnVwIG1vZHVsZVxuaW1wb3J0IHsgaW5pdFNpZ251cFBhZ2UgfSBmcm9tIFwiLi4vYXV0aC9zaWdudXAuanNcIjtcblxuLy8gSW5pdGlhbGl6ZSBzaWdudXAgcGFnZSB3aGVuIERPTSBpcyBsb2FkZWRcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+IHtcbiAgLy8gSW5pdGlhbGl6ZSBzaWdudXAgcGFnZVxuICBpbml0U2lnbnVwUGFnZSgpO1xuXG4gIGNvbnNvbGUubG9nKFwiU2lnbnVwIHBhZ2UgaW5pdGlhbGl6ZWRcIik7XG59KTtcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4vLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuX193ZWJwYWNrX3JlcXVpcmVfXy5tID0gX193ZWJwYWNrX21vZHVsZXNfXztcblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5mID0ge307XG4vLyBUaGlzIGZpbGUgY29udGFpbnMgb25seSB0aGUgZW50cnkgY2h1bmsuXG4vLyBUaGUgY2h1bmsgbG9hZGluZyBmdW5jdGlvbiBmb3IgYWRkaXRpb25hbCBjaHVua3Ncbl9fd2VicGFja19yZXF1aXJlX18uZSA9IChjaHVua0lkKSA9PiB7XG5cdHJldHVybiBQcm9taXNlLmFsbChPYmplY3Qua2V5cyhfX3dlYnBhY2tfcmVxdWlyZV9fLmYpLnJlZHVjZSgocHJvbWlzZXMsIGtleSkgPT4ge1xuXHRcdF9fd2VicGFja19yZXF1aXJlX18uZltrZXldKGNodW5rSWQsIHByb21pc2VzKTtcblx0XHRyZXR1cm4gcHJvbWlzZXM7XG5cdH0sIFtdKSk7XG59OyIsIi8vIFRoaXMgZnVuY3Rpb24gYWxsb3cgdG8gcmVmZXJlbmNlIGFzeW5jIGNodW5rc1xuX193ZWJwYWNrX3JlcXVpcmVfXy51ID0gKGNodW5rSWQpID0+IHtcblx0Ly8gcmV0dXJuIHVybCBmb3IgZmlsZW5hbWVzIGJhc2VkIG9uIHRlbXBsYXRlXG5cdHJldHVybiBcImpzL1wiICsgY2h1bmtJZCArIFwiLmJ1bmRsZS5qc1wiO1xufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLmcgPSAoZnVuY3Rpb24oKSB7XG5cdGlmICh0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gJ29iamVjdCcpIHJldHVybiBnbG9iYWxUaGlzO1xuXHR0cnkge1xuXHRcdHJldHVybiB0aGlzIHx8IG5ldyBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpO1xuXHR9IGNhdGNoIChlKSB7XG5cdFx0aWYgKHR5cGVvZiB3aW5kb3cgPT09ICdvYmplY3QnKSByZXR1cm4gd2luZG93O1xuXHR9XG59KSgpOyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSAoZXhwb3J0cykgPT4ge1xuXHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcblx0fVxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xufTsiLCJ2YXIgc2NyaXB0VXJsO1xuaWYgKF9fd2VicGFja19yZXF1aXJlX18uZy5pbXBvcnRTY3JpcHRzKSBzY3JpcHRVcmwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLmcubG9jYXRpb24gKyBcIlwiO1xudmFyIGRvY3VtZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXy5nLmRvY3VtZW50O1xuaWYgKCFzY3JpcHRVcmwgJiYgZG9jdW1lbnQpIHtcblx0aWYgKGRvY3VtZW50LmN1cnJlbnRTY3JpcHQgJiYgZG9jdW1lbnQuY3VycmVudFNjcmlwdC50YWdOYW1lLnRvVXBwZXJDYXNlKCkgPT09ICdTQ1JJUFQnKVxuXHRcdHNjcmlwdFVybCA9IGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuc3JjO1xuXHRpZiAoIXNjcmlwdFVybCkge1xuXHRcdHZhciBzY3JpcHRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIik7XG5cdFx0aWYoc2NyaXB0cy5sZW5ndGgpIHtcblx0XHRcdHZhciBpID0gc2NyaXB0cy5sZW5ndGggLSAxO1xuXHRcdFx0d2hpbGUgKGkgPiAtMSAmJiAoIXNjcmlwdFVybCB8fCAhL15odHRwKHM/KTovLnRlc3Qoc2NyaXB0VXJsKSkpIHNjcmlwdFVybCA9IHNjcmlwdHNbaS0tXS5zcmM7XG5cdFx0fVxuXHR9XG59XG4vLyBXaGVuIHN1cHBvcnRpbmcgYnJvd3NlcnMgd2hlcmUgYW4gYXV0b21hdGljIHB1YmxpY1BhdGggaXMgbm90IHN1cHBvcnRlZCB5b3UgbXVzdCBzcGVjaWZ5IGFuIG91dHB1dC5wdWJsaWNQYXRoIG1hbnVhbGx5IHZpYSBjb25maWd1cmF0aW9uXG4vLyBvciBwYXNzIGFuIGVtcHR5IHN0cmluZyAoXCJcIikgYW5kIHNldCB0aGUgX193ZWJwYWNrX3B1YmxpY19wYXRoX18gdmFyaWFibGUgZnJvbSB5b3VyIGNvZGUgdG8gdXNlIHlvdXIgb3duIGxvZ2ljLlxuaWYgKCFzY3JpcHRVcmwpIHRocm93IG5ldyBFcnJvcihcIkF1dG9tYXRpYyBwdWJsaWNQYXRoIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhpcyBicm93c2VyXCIpO1xuc2NyaXB0VXJsID0gc2NyaXB0VXJsLnJlcGxhY2UoL15ibG9iOi8sIFwiXCIpLnJlcGxhY2UoLyMuKiQvLCBcIlwiKS5yZXBsYWNlKC9cXD8uKiQvLCBcIlwiKS5yZXBsYWNlKC9cXC9bXlxcL10rJC8sIFwiL1wiKTtcbl9fd2VicGFja19yZXF1aXJlX18ucCA9IHNjcmlwdFVybCArIFwiLi4vXCI7IiwiLy8gbm8gYmFzZVVSSVxuXG4vLyBvYmplY3QgdG8gc3RvcmUgbG9hZGVkIGFuZCBsb2FkaW5nIGNodW5rc1xuLy8gdW5kZWZpbmVkID0gY2h1bmsgbm90IGxvYWRlZCwgbnVsbCA9IGNodW5rIHByZWxvYWRlZC9wcmVmZXRjaGVkXG4vLyBbcmVzb2x2ZSwgcmVqZWN0LCBQcm9taXNlXSA9IGNodW5rIGxvYWRpbmcsIDAgPSBjaHVuayBsb2FkZWRcbnZhciBpbnN0YWxsZWRDaHVua3MgPSB7XG5cdDc4NzogMFxufTtcblxuX193ZWJwYWNrX3JlcXVpcmVfXy5mLmogPSAoY2h1bmtJZCwgcHJvbWlzZXMpID0+IHtcblx0XHQvLyBKU09OUCBjaHVuayBsb2FkaW5nIGZvciBqYXZhc2NyaXB0XG5cdFx0dmFyIGluc3RhbGxlZENodW5rRGF0YSA9IF9fd2VicGFja19yZXF1aXJlX18ubyhpbnN0YWxsZWRDaHVua3MsIGNodW5rSWQpID8gaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdIDogdW5kZWZpbmVkO1xuXHRcdGlmKGluc3RhbGxlZENodW5rRGF0YSAhPT0gMCkgeyAvLyAwIG1lYW5zIFwiYWxyZWFkeSBpbnN0YWxsZWRcIi5cblxuXHRcdFx0Ly8gYSBQcm9taXNlIG1lYW5zIFwiY3VycmVudGx5IGxvYWRpbmdcIi5cblx0XHRcdGlmKGluc3RhbGxlZENodW5rRGF0YSkge1xuXHRcdFx0XHRwcm9taXNlcy5wdXNoKGluc3RhbGxlZENodW5rRGF0YVsyXSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZih0cnVlKSB7IC8vIGFsbCBjaHVua3MgaGF2ZSBKU1xuXHRcdFx0XHRcdC8vIHNldHVwIFByb21pc2UgaW4gY2h1bmsgY2FjaGVcblx0XHRcdFx0XHR2YXIgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IChpbnN0YWxsZWRDaHVua0RhdGEgPSBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gPSBbcmVzb2x2ZSwgcmVqZWN0XSkpO1xuXHRcdFx0XHRcdHByb21pc2VzLnB1c2goaW5zdGFsbGVkQ2h1bmtEYXRhWzJdID0gcHJvbWlzZSk7XG5cblx0XHRcdFx0XHQvLyBzdGFydCBjaHVuayBsb2FkaW5nXG5cdFx0XHRcdFx0dmFyIHVybCA9IF9fd2VicGFja19yZXF1aXJlX18ucCArIF9fd2VicGFja19yZXF1aXJlX18udShjaHVua0lkKTtcblx0XHRcdFx0XHQvLyBjcmVhdGUgZXJyb3IgYmVmb3JlIHN0YWNrIHVud291bmQgdG8gZ2V0IHVzZWZ1bCBzdGFja3RyYWNlIGxhdGVyXG5cdFx0XHRcdFx0dmFyIGVycm9yID0gbmV3IEVycm9yKCk7XG5cdFx0XHRcdFx0dmFyIGxvYWRpbmdFbmRlZCA9IChldmVudCkgPT4ge1xuXHRcdFx0XHRcdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGluc3RhbGxlZENodW5rcywgY2h1bmtJZCkpIHtcblx0XHRcdFx0XHRcdFx0aW5zdGFsbGVkQ2h1bmtEYXRhID0gaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdO1xuXHRcdFx0XHRcdFx0XHRpZihpbnN0YWxsZWRDaHVua0RhdGEgIT09IDApIGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA9IHVuZGVmaW5lZDtcblx0XHRcdFx0XHRcdFx0aWYoaW5zdGFsbGVkQ2h1bmtEYXRhKSB7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIGVycm9yVHlwZSA9IGV2ZW50ICYmIChldmVudC50eXBlID09PSAnbG9hZCcgPyAnbWlzc2luZycgOiBldmVudC50eXBlKTtcblx0XHRcdFx0XHRcdFx0XHR2YXIgcmVhbFNyYyA9IGV2ZW50ICYmIGV2ZW50LnRhcmdldCAmJiBldmVudC50YXJnZXQuc3JjO1xuXHRcdFx0XHRcdFx0XHRcdGVycm9yLm1lc3NhZ2UgPSAnTG9hZGluZyBjaHVuayAnICsgY2h1bmtJZCArICcgZmFpbGVkLlxcbignICsgZXJyb3JUeXBlICsgJzogJyArIHJlYWxTcmMgKyAnKSc7XG5cdFx0XHRcdFx0XHRcdFx0ZXJyb3IubmFtZSA9ICdDaHVua0xvYWRFcnJvcic7XG5cdFx0XHRcdFx0XHRcdFx0ZXJyb3IudHlwZSA9IGVycm9yVHlwZTtcblx0XHRcdFx0XHRcdFx0XHRlcnJvci5yZXF1ZXN0ID0gcmVhbFNyYztcblx0XHRcdFx0XHRcdFx0XHRpbnN0YWxsZWRDaHVua0RhdGFbMV0oZXJyb3IpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmwodXJsLCBsb2FkaW5nRW5kZWQsIFwiY2h1bmstXCIgKyBjaHVua0lkLCBjaHVua0lkKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cbn07XG5cbi8vIG5vIHByZWZldGNoaW5nXG5cbi8vIG5vIHByZWxvYWRlZFxuXG4vLyBubyBITVJcblxuLy8gbm8gSE1SIG1hbmlmZXN0XG5cbl9fd2VicGFja19yZXF1aXJlX18uTy5qID0gKGNodW5rSWQpID0+IChpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gPT09IDApO1xuXG4vLyBpbnN0YWxsIGEgSlNPTlAgY2FsbGJhY2sgZm9yIGNodW5rIGxvYWRpbmdcbnZhciB3ZWJwYWNrSnNvbnBDYWxsYmFjayA9IChwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbiwgZGF0YSkgPT4ge1xuXHR2YXIgW2NodW5rSWRzLCBtb3JlTW9kdWxlcywgcnVudGltZV0gPSBkYXRhO1xuXHQvLyBhZGQgXCJtb3JlTW9kdWxlc1wiIHRvIHRoZSBtb2R1bGVzIG9iamVjdCxcblx0Ly8gdGhlbiBmbGFnIGFsbCBcImNodW5rSWRzXCIgYXMgbG9hZGVkIGFuZCBmaXJlIGNhbGxiYWNrXG5cdHZhciBtb2R1bGVJZCwgY2h1bmtJZCwgaSA9IDA7XG5cdGlmKGNodW5rSWRzLnNvbWUoKGlkKSA9PiAoaW5zdGFsbGVkQ2h1bmtzW2lkXSAhPT0gMCkpKSB7XG5cdFx0Zm9yKG1vZHVsZUlkIGluIG1vcmVNb2R1bGVzKSB7XG5cdFx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8obW9yZU1vZHVsZXMsIG1vZHVsZUlkKSkge1xuXHRcdFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLm1bbW9kdWxlSWRdID0gbW9yZU1vZHVsZXNbbW9kdWxlSWRdO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZihydW50aW1lKSB2YXIgcmVzdWx0ID0gcnVudGltZShfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblx0fVxuXHRpZihwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbikgcGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24oZGF0YSk7XG5cdGZvcig7aSA8IGNodW5rSWRzLmxlbmd0aDsgaSsrKSB7XG5cdFx0Y2h1bmtJZCA9IGNodW5rSWRzW2ldO1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhpbnN0YWxsZWRDaHVua3MsIGNodW5rSWQpICYmIGluc3RhbGxlZENodW5rc1tjaHVua0lkXSkge1xuXHRcdFx0aW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdWzBdKCk7XG5cdFx0fVxuXHRcdGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA9IDA7XG5cdH1cblx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18uTyhyZXN1bHQpO1xufVxuXG52YXIgY2h1bmtMb2FkaW5nR2xvYmFsID0gc2VsZltcIndlYnBhY2tDaHVua3VyYmFuZG9jc193ZWJhcHBcIl0gPSBzZWxmW1wid2VicGFja0NodW5rdXJiYW5kb2NzX3dlYmFwcFwiXSB8fCBbXTtcbmNodW5rTG9hZGluZ0dsb2JhbC5mb3JFYWNoKHdlYnBhY2tKc29ucENhbGxiYWNrLmJpbmQobnVsbCwgMCkpO1xuY2h1bmtMb2FkaW5nR2xvYmFsLnB1c2ggPSB3ZWJwYWNrSnNvbnBDYWxsYmFjay5iaW5kKG51bGwsIGNodW5rTG9hZGluZ0dsb2JhbC5wdXNoLmJpbmQoY2h1bmtMb2FkaW5nR2xvYmFsKSk7IiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vLyBUaGlzIGVudHJ5IG1vZHVsZSBkZXBlbmRzIG9uIG90aGVyIGxvYWRlZCBjaHVua3MgYW5kIGV4ZWN1dGlvbiBuZWVkIHRvIGJlIGRlbGF5ZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXy5PKHVuZGVmaW5lZCwgWzMwM10sICgpID0+IChfX3dlYnBhY2tfcmVxdWlyZV9fKDc5NykpKVxuX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18uTyhfX3dlYnBhY2tfZXhwb3J0c19fKTtcbiJdLCJuYW1lcyI6WyJkZWZlcnJlZCIsImxlYWZQcm90b3R5cGVzIiwiZ2V0UHJvdG8iLCJpblByb2dyZXNzIiwiZGF0YVdlYnBhY2tQcmVmaXgiLCJzdXBhYmFzZSIsInNob3dFcnJvciIsIm1lc3NhZ2UiLCJlbGVtZW50SWQiLCJlcnJvckVsZW1lbnQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiaW5uZXJIVE1MIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwiY29uc29sZSIsImVycm9yIiwic2hvd0xvYWRpbmciLCJidXR0b25JZCIsInNwaW5uZXJJZCIsImJ1dHRvbiIsInNwaW5uZXIiLCJkaXNhYmxlZCIsImhpZGVMb2FkaW5nIiwiYWRkIiwiY2FwdGNoYVRva2VuIiwidHVybnN0aWxlV2lkZ2V0SWQiLCJpbml0U2lnbnVwUGFnZSIsImxvZyIsInNpZ251cEZvcm0iLCJnb29nbGVTaWduVXBCdG4iLCJhZGRFdmVudExpc3RlbmVyIiwiYXN5bmMiLCJlIiwicHJldmVudERlZmF1bHQiLCJlbWFpbCIsInZhbHVlIiwidHJpbSIsInBhc3N3b3JkIiwiY29uZmlybVBhc3N3b3JkIiwicGhvbmUiLCJ2YWxpZGF0aW9uRXJyb3JzIiwidGVzdCIsInB1c2giLCJsZW5ndGgiLCJqb2luIiwiZTE2NFBob25lIiwic3RhcnRzV2l0aCIsInN1YnN0cmluZyIsImRhdGEiLCJzaWduVXBFcnJvciIsImF1dGgiLCJzaWduVXAiLCJvcHRpb25zIiwidXNlciIsIkVycm9yIiwiaWQiLCJmcm9tIiwidXBkYXRlIiwiZXEiLCJ0eXBlIiwic3RhdHVzRWxlbWVudCIsInRleHRDb250ZW50IiwiZm9yRWFjaCIsImNsYXNzTmFtZSIsInNob3dTdGF0dXMiLCJyZXNldCIsImRpc3BsYXlFcnJvciIsImluY2x1ZGVzIiwidG9Mb3dlckNhc2UiLCJ3aW5kb3ciLCJ0dXJuc3RpbGUiLCJzaWduSW5XaXRoT0F1dGgiLCJwcm92aWRlciIsInJlZGlyZWN0VG8iLCJsb2NhdGlvbiIsIm9yaWdpbiIsIndhcm4iLCJvbmxvYWRUdXJuc3RpbGVDYWxsYmFjayIsInR1cm5zdGlsZUNvbnRhaW5lciIsInJlbmRlciIsInNpdGVrZXkiLCJjYWxsYmFjayIsInRva2VuIiwiZXJyIiwidW5kZWZpbmVkIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwiZXhwb3J0cyIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJjYWxsIiwibSIsIk8iLCJyZXN1bHQiLCJjaHVua0lkcyIsImZuIiwicHJpb3JpdHkiLCJub3RGdWxmaWxsZWQiLCJJbmZpbml0eSIsImkiLCJmdWxmaWxsZWQiLCJqIiwiT2JqZWN0Iiwia2V5cyIsImV2ZXJ5Iiwia2V5Iiwic3BsaWNlIiwiciIsImdldFByb3RvdHlwZU9mIiwib2JqIiwidCIsIm1vZGUiLCJ0aGlzIiwiX19lc01vZHVsZSIsInRoZW4iLCJucyIsImNyZWF0ZSIsImRlZiIsImN1cnJlbnQiLCJpbmRleE9mIiwiZ2V0T3duUHJvcGVydHlOYW1lcyIsImQiLCJkZWZpbml0aW9uIiwibyIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsImYiLCJjaHVua0lkIiwiUHJvbWlzZSIsImFsbCIsInJlZHVjZSIsInByb21pc2VzIiwidSIsImciLCJnbG9iYWxUaGlzIiwiRnVuY3Rpb24iLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJsIiwidXJsIiwiZG9uZSIsInNjcmlwdCIsIm5lZWRBdHRhY2giLCJzY3JpcHRzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJzIiwiZ2V0QXR0cmlidXRlIiwiY3JlYXRlRWxlbWVudCIsImNoYXJzZXQiLCJ0aW1lb3V0IiwibmMiLCJzZXRBdHRyaWJ1dGUiLCJzcmMiLCJvblNjcmlwdENvbXBsZXRlIiwicHJldiIsImV2ZW50Iiwib25lcnJvciIsIm9ubG9hZCIsImNsZWFyVGltZW91dCIsImRvbmVGbnMiLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJzZXRUaW1lb3V0IiwiYmluZCIsInRhcmdldCIsImhlYWQiLCJhcHBlbmRDaGlsZCIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwic2NyaXB0VXJsIiwiaW1wb3J0U2NyaXB0cyIsImN1cnJlbnRTY3JpcHQiLCJ0YWdOYW1lIiwidG9VcHBlckNhc2UiLCJyZXBsYWNlIiwicCIsImluc3RhbGxlZENodW5rcyIsImluc3RhbGxlZENodW5rRGF0YSIsInByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZXJyb3JUeXBlIiwicmVhbFNyYyIsIm5hbWUiLCJyZXF1ZXN0Iiwid2VicGFja0pzb25wQ2FsbGJhY2siLCJwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbiIsIm1vcmVNb2R1bGVzIiwicnVudGltZSIsInNvbWUiLCJjaHVua0xvYWRpbmdHbG9iYWwiLCJzZWxmIiwiX193ZWJwYWNrX2V4cG9ydHNfXyJdLCJzb3VyY2VSb290IjoiIn0=