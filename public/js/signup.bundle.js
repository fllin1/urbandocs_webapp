(()=>{"use strict";var e,t,n,r,o,s={4810:(e,t,n)=>{var r=n(3715),o=n(9660);let s=null,i=null;window.onloadTurnstileCallback=function(){console.log("Turnstile API ready (onloadTurnstileCallback executed).");const e=document.getElementById("turnstile-container");if(e&&window.turnstile&&!i){console.log("Rendering Turnstile widget from onloadTurnstileCallback...");try{i=window.turnstile.render(e,{sitekey:"0x4AAAAAABdzY3InOU2_In99",callback:function(e){s=e,console.log("Turnstile token obtained:",e)},"expired-callback":()=>{console.log("Turnstile token expired. Resetting widget. ID:",i),window.turnstile&&i&&window.turnstile.reset(i),s=null},"error-callback":e=>{s=null,console.error("Turnstile error callback:",e),(0,r.Qg)(`Erreur CAPTCHA: ${e}. Veuillez r√©essayer.`)}}),void 0===i?(console.error("Turnstile.render did not return a widgetId. Sitekey or container issue?"),(0,r.Qg)("Erreur initialisation CAPTCHA (ID widget non retourn√©).")):console.log("Turnstile widget rendered. ID:",i)}catch(e){console.error("Error rendering Turnstile:",e),(0,r.Qg)("Impossible d'afficher le CAPTCHA.")}}else e?window.turnstile?i&&console.log("onloadTurnstileCallback: Widget already seems rendered."):console.error("onloadTurnstileCallback: window.turnstile API not found."):console.error("onloadTurnstileCallback: #turnstile-container not found.")},document.addEventListener("DOMContentLoaded",(()=>{(function(){console.log("initSignupPage called");const e=document.getElementById("signupForm"),t=(document.getElementById("errorMessage"),document.getElementById("statusMessage"),document.getElementById("googleSignUpBtn")),n=document.getElementById("turnstile-container"),l=document.getElementById("tosCheckbox"),a=document.getElementById("tosModal"),d=document.getElementById("tosModalBody"),c=document.getElementById("signupBtn"),u=document.getElementById("tosStatusMessage"),p=document.getElementById("tosLink"),g=document.getElementById("tosModalClose");function m(){a&&(a.classList.remove("show"),a.style.display="none",document.body.style.overflow="")}c&&(c.disabled=!0),t&&(t.disabled=!0),l&&(l.disabled=!0),p&&a&&p.addEventListener("click",(e=>{e.preventDefault(),a&&(a.classList.add("show"),a.style.display="block",document.body.style.overflow="hidden",d&&"true"!==d.dataset.loaded&&async function(){try{d.innerHTML="<p>Chargement des conditions d'utilisation...</p>";const e=await fetch("/policies/terms");if(!e.ok)throw new Error(`Failed to load Terms of Service: ${e.status}`);const t=await e.text(),n=(new DOMParser).parseFromString(t,"text/html"),r=n.querySelector("main")||n.querySelector(".policy-container")||n.body;d.innerHTML=r?r.innerHTML:t,d.dataset.loaded="true",d.scrollTop=0,l&&(l.disabled=!1)}catch(e){console.error("Error loading ToS:",e),d.innerHTML='\n        <div style="color: #dc3545; padding: 1rem; border: 1px solid #dc3545; border-radius: 4px; background-color: #f8d7da;">\n          <p><strong>Erreur lors du chargement des conditions d\'utilisation.</strong></p>\n          <p>Veuillez r√©essayer ou consulter les conditions directement sur <a href="/policies/terms" target="_blank">cette page</a>.</p>\n        </div>\n      ',l&&(l.disabled=!1)}}(),l&&(l.disabled=!1))})),g&&g.addEventListener("click",(()=>{m()})),a&&a.addEventListener("click",(e=>{e.target===a&&m()})),l&&l.addEventListener("change",(()=>{const e=l.checked;if(c&&(c.disabled=!e),t&&(t.disabled=!e),u&&(e?u.classList.add("hidden"):u.classList.remove("hidden")),e){const e=document.getElementById("errorMessage");e&&e.innerHTML.includes("Conditions G√©n√©rales d'Utilisation")&&(0,r.Bt)("errorMessage")}else(0,r.Qg)("Veuillez accepter les Conditions G√©n√©rales d'Utilisation.","errorMessage")})),n||console.error("#turnstile-container not found in the DOM. CAPTCHA cannot be rendered."),e?e.addEventListener("submit",(async t=>{t.preventDefault();const n=document.getElementById("email").value.trim(),a=document.getElementById("password").value,d=document.getElementById("confirmPassword").value;let c=document.getElementById("phone").value.trim(),u=[];if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)||u.push("L'adresse email n'est pas valide."),a!==d&&u.push("Les mots de passe ne correspondent pas."),(!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/.test(a)||a.length<8)&&u.push("Le format du mot de passe est invalide."),c||u.push("Le num√©ro de t√©l√©phone est requis."),c&&!/^(0|\+33)[1-9]\d{8}$/.test(c)&&u.push("Le format du num√©ro de t√©l√©phone est invalide (ex: 0612345678 ou +33612345678)."),s||u.push("Veuillez compl√©ter le CAPTCHA."),l&&l.checked||u.push("Veuillez lire et accepter les Conditions G√©n√©rales d'Utilisation."),u.length>0)(0,r.Qg)(u.join("<br>"));else{(0,r.Cs)("signupBtn","signupSpinner");try{let t=c;c.startsWith("0")&&(t=`+33${c.substring(1)}`);const{data:r,error:i}=await o.N.auth.signUp({email:n,password:a,options:{captchaToken:s}});if(i)throw i;if(!r.user)throw new Error("Erreur lors de la cr√©ation de l'utilisateur.");if(t&&r.user.id)try{await new Promise((e=>setTimeout(e,100)));const{error:e}=await o.N.from("profiles").update({phone:t}).eq("id",r.user.id);e&&console.warn("Could not update profile with phone number:",e)}catch(e){console.warn("Profile update failed:",e)}!function(e){const t=document.getElementById("statusMessage");t&&(t.innerHTML=`\n      <div class="signup-success">\n        <h3>Compte cr√©√© avec succ√®s !</h3>\n        <p><strong>Un email de confirmation a √©t√© envoy√© √† :</strong><br>\n        <code>${e}</code></p>\n        \n        <div class="confirmation-instructions">\n          <h4>üìß Prochaines √©tapes :</h4>\n          <ol>\n            <li>V√©rifiez votre bo√Æte de r√©ception (et n'oubliez pas vos spams !)</li>\n            <li>Cliquez sur le lien de confirmation dans l'email</li>\n            <li>Vous pourrez ensuite vous connecter avec vos identifiants</li>\n          </ol>\n        </div>\n        \n        <div class="confirmation-note">\n          <p><strong>Note :</strong> Vous devez confirmer votre email avant de pouvoir vous connecter.</p>\n        </div>\n      </div>\n    `,t.classList.remove("hidden"),t.classList.add("success"))}(n),e&&(e.classList.add("hidden"),e.reset())}catch(e){console.error("Email/Password Signup error:",e);let t=e.message||"Une erreur est survenue.";e.message&&e.message.includes("User already registered")?t="Cette adresse email est d√©j√† utilis√©e. Veuillez vous connecter ou utiliser une autre adresse.":e.message&&e.message.includes("Unable to validate phone number")?t="Le num√©ro de t√©l√©phone fourni n'est pas valide.":e.message&&e.message.toLowerCase().includes("captcha protection")&&(t="Erreur CAPTCHA du serveur. Veuillez r√©essayer. ("+e.message+")"),(0,r.Qg)(t)}finally{(0,r.RZ)("signupBtn","signupSpinner"),window.turnstile&&i&&(window.turnstile.reset(i),console.log("Turnstile widget has been reset.")),s=null}}})):console.error("Signup form (signupForm) not found."),t?t.addEventListener("click",(async()=>{(0,r.Cs)("googleSignUpBtn","googleSignUpSpinner");try{const{error:e}=await o.N.auth.signInWithOAuth({provider:"google",options:{}});e&&(console.error("Error signing up with Google:",e),(0,r.Qg)(e.message||"Erreur lors de l'inscription avec Google."))}catch(e){console.error("Exception during Google sign-up:",e),(0,r.Qg)("Une exception est survenue lors de l'inscription avec Google.")}finally{(0,r.RZ)("googleSignUpBtn","googleSignUpSpinner")}})):console.warn("Google Sign-Up button (googleSignUpBtn) not found.")})(),console.log("Signup page initialized")}))}},i={};function l(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}};return s[e].call(n.exports,n,n.exports,l),n.exports}l.m=s,e=[],l.O=(t,n,r,o)=>{if(!n){var s=1/0;for(c=0;c<e.length;c++){for(var[n,r,o]=e[c],i=!0,a=0;a<n.length;a++)(!1&o||s>=o)&&Object.keys(l.O).every((e=>l.O[e](n[a])))?n.splice(a--,1):(i=!1,o<s&&(s=o));if(i){e.splice(c--,1);var d=r();void 0!==d&&(t=d)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[n,r,o]},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,l.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var o=Object.create(null);l.r(o);var s={};t=t||[null,n({}),n([]),n(n)];for(var i=2&r&&e;"object"==typeof i&&!~t.indexOf(i);i=n(i))Object.getOwnPropertyNames(i).forEach((t=>s[t]=()=>e[t]));return s.default=()=>e,l.d(o,s),o},l.d=(e,t)=>{for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},l.f={},l.e=e=>Promise.all(Object.keys(l.f).reduce(((t,n)=>(l.f[n](e,t),t)),[])),l.u=e=>"js/"+e+".bundle.js",l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r={},o="urbandocs_webapp:",l.l=(e,t,n,s)=>{if(r[e])r[e].push(t);else{var i,a;if(void 0!==n)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var u=d[c];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==o+n){i=u;break}}i||(a=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,l.nc&&i.setAttribute("nonce",l.nc),i.setAttribute("data-webpack",o+n),i.src=e),r[e]=[t];var p=(t,n)=>{i.onerror=i.onload=null,clearTimeout(g);var o=r[e];if(delete r[e],i.parentNode&&i.parentNode.removeChild(i),o&&o.forEach((e=>e(n))),t)return t(n)},g=setTimeout(p.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=p.bind(null,i.onerror),i.onload=p.bind(null,i.onload),a&&document.head.appendChild(i)}},l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.j=787,(()=>{var e;l.g.importScripts&&(e=l.g.location+"");var t=l.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=n[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),l.p=e+"../"})(),(()=>{var e={787:0};l.f.j=(t,n)=>{var r=l.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var o=new Promise(((n,o)=>r=e[t]=[n,o]));n.push(r[2]=o);var s=l.p+l.u(t),i=new Error;l.l(s,(n=>{if(l.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;i.message="Loading chunk "+t+" failed.\n("+o+": "+s+")",i.name="ChunkLoadError",i.type=o,i.request=s,r[1](i)}}),"chunk-"+t,t)}},l.O.j=t=>0===e[t];var t=(t,n)=>{var r,o,[s,i,a]=n,d=0;if(s.some((t=>0!==e[t]))){for(r in i)l.o(i,r)&&(l.m[r]=i[r]);if(a)var c=a(l)}for(t&&t(n);d<s.length;d++)o=s[d],l.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return l.O(c)},n=self.webpackChunkurbandocs_webapp=self.webpackChunkurbandocs_webapp||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a=l.O(void 0,[76],(()=>l(4810)));a=l.O(a)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoianMvc2lnbnVwLmJ1bmRsZS5qcyIsIm1hcHBpbmdzIjoidUJBQUlBLEVDQ0FDLEVBREFDLEVDQUFDLEVBQ0FDLEUsMENDdUJKLElBQUlDLEVBQWUsS0FDZkMsRUFBb0IsS0FJeEJDLE9BQU9DLHdCQUEwQixXQUMvQkMsUUFBUUMsSUFBSSwyREFDWixNQUFNQyxFQUFxQkMsU0FBU0MsZUFBZSx1QkFFbkQsR0FBSUYsR0FBc0JKLE9BQU9PLFlBQWNSLEVBQW1CLENBQ2hFRyxRQUFRQyxJQUFJLDhEQUNaLElBQ0VKLEVBQW9CQyxPQUFPTyxVQUFVQyxPQUFPSixFQUFvQixDQUM5REssUUFBUywyQkFDVEMsU0FBVSxTQUFVQyxHQUNsQmIsRUFBZWEsRUFDZlQsUUFBUUMsSUFBSSw0QkFBNkJRLEVBQzNDLEVBQ0EsbUJBQW9CLEtBQ2xCVCxRQUFRQyxJQUNOLGlEQUNBSixHQUVFQyxPQUFPTyxXQUFhUixHQUN0QkMsT0FBT08sVUFBVUssTUFBTWIsR0FFekJELEVBQWUsTUFHakIsaUJBQW1CZSxJQUNqQmYsRUFBZSxLQUNmSSxRQUFRWSxNQUFNLDRCQUE2QkQsSUFDM0MsUUFBVSxtQkFBbUJBLGtDQUdQRSxJQUF0QmhCLEdBQ0ZHLFFBQVFZLE1BQ04sNEVBRUYsUUFBVSw0REFFVlosUUFBUUMsSUFBSSxpQ0FBa0NKLEVBRWxELENBQUUsTUFBT2lCLEdBQ1BkLFFBQVFZLE1BQU0sNkJBQThCRSxJQUM1QyxRQUFVLG9DQUNaLENBQ0YsTUFBWVosRUFFQUosT0FBT08sVUFFUlIsR0FDVEcsUUFBUUMsSUFBSSwyREFGWkQsUUFBUVksTUFBTSw0REFGZFosUUFBUVksTUFBTSwyREFNbEIsRUNuRUFULFNBQVNZLGlCQUFpQixvQkFBb0IsTUR3R3ZDLFdBQ0xmLFFBQVFDLElBQUkseUJBQ1osTUFBTWUsRUFBYWIsU0FBU0MsZUFBZSxjQUdyQ2EsR0FGa0JkLFNBQVNDLGVBQWUsZ0JBQzFCRCxTQUFTQyxlQUFlLGlCQUN0QkQsU0FBU0MsZUFBZSxvQkFDMUNGLEVBQXFCQyxTQUFTQyxlQUFlLHVCQUc3Q2MsRUFBY2YsU0FBU0MsZUFBZSxlQUN0Q2UsRUFBa0JoQixTQUFTQyxlQUFlLFlBQzFDZ0IsRUFBZWpCLFNBQVNDLGVBQWUsZ0JBQ3ZDaUIsRUFBWWxCLFNBQVNDLGVBQWUsYUFDcENrQixFQUFtQm5CLFNBQVNDLGVBQWUsb0JBQzNDbUIsRUFBVXBCLFNBQVNDLGVBQWUsV0FDbENvQixFQUFnQnJCLFNBQVNDLGVBQWUsaUJBc0Q5QyxTQUFTcUIsSUFDSE4sSUFDRkEsRUFBZ0JPLFVBQVVDLE9BQU8sUUFDakNSLEVBQWdCUyxNQUFNQyxRQUFVLE9BQ2hDMUIsU0FBUzJCLEtBQUtGLE1BQU1HLFNBQVcsR0FFbkMsQ0F6RElWLElBQ0ZBLEVBQVVXLFVBQVcsR0FFbkJmLElBQ0ZBLEVBQWdCZSxVQUFXLEdBRXpCZCxJQUNGQSxFQUFZYyxVQUFXLEdBSXJCVCxHQUFXSixHQUNiSSxFQUFRUixpQkFBaUIsU0FBVUQsSUFDakNBLEVBQUVtQixpQkFxQkFkLElBQ0ZBLEVBQWdCTyxVQUFVUSxJQUFJLFFBQzlCZixFQUFnQlMsTUFBTUMsUUFBVSxRQUNoQzFCLFNBQVMyQixLQUFLRixNQUFNRyxTQUFXLFNBRzNCWCxHQUFnRCxTQUFoQ0EsRUFBYWUsUUFBUUMsUUFtQjdDQyxpQkFDRSxJQUNFakIsRUFBYWtCLFVBQ1gsb0RBRUYsTUFBTUMsUUFBaUJDLE1BQU0sbUJBQzdCLElBQUtELEVBQVNFLEdBQ1osTUFBTSxJQUFJQyxNQUFNLG9DQUFvQ0gsRUFBU0ksVUFHL0QsTUFBTUMsUUFBZ0JMLEVBQVNNLE9BSXpCQyxHQURTLElBQUlDLFdBQ0FDLGdCQUFnQkosRUFBUyxhQUN0Q0ssRUFDSkgsRUFBSUksY0FBYyxTQUNsQkosRUFBSUksY0FBYyxzQkFDbEJKLEVBQUloQixLQUdKVixFQUFha0IsVUFEWFcsRUFDdUJBLEVBQVlYLFVBRVpNLEVBRzNCeEIsRUFBYWUsUUFBUUMsT0FBUyxPQUM5QmhCLEVBQWErQixVQUFZLEVBR3JCakMsSUFDRkEsRUFBWWMsVUFBVyxFQUUzQixDQUFFLE1BQU9wQixHQUNQWixRQUFRWSxNQUFNLHFCQUFzQkEsR0FDcENRLEVBQWFrQixVQUFZLGtZQVFyQnBCLElBQ0ZBLEVBQVljLFVBQVcsRUFFM0IsQ0FDRixDQWpFTW9CLEdBSUVsQyxJQUNGQSxFQUFZYyxVQUFXLE9BNUJ6QlIsR0FDRkEsRUFBY1QsaUJBQWlCLFNBQVMsS0FDdENVLE9BS0FOLEdBQ0ZBLEVBQWdCSixpQkFBaUIsU0FBVUQsSUFDckNBLEVBQUV1QyxTQUFXbEMsR0FDZk0sT0FpRkZQLEdBQ0ZBLEVBQVlILGlCQUFpQixVQUFVLEtBQ3JDLE1BQU11QyxFQUFZcEMsRUFBWXFDLFFBbUI5QixHQWhCSWxDLElBQ0ZBLEVBQVVXLFVBQVlzQixHQUVwQnJDLElBQ0ZBLEVBQWdCZSxVQUFZc0IsR0FJMUJoQyxJQUNFZ0MsRUFDRmhDLEVBQWlCSSxVQUFVUSxJQUFJLFVBRS9CWixFQUFpQkksVUFBVUMsT0FBTyxXQUlqQzJCLEVBS0UsQ0FFTCxNQUFNRSxFQUFlckQsU0FBU0MsZUFBZSxnQkFFM0NvRCxHQUNBQSxFQUFhbEIsVUFBVW1CLFNBQVMsd0NBRWhDLFFBQVksZUFFaEIsTUFiRSxRQUNFLDREQUNBLG1CQWdCSHZELEdBQ0hGLFFBQVFZLE1BQ04sMEVBSUFJLEVBQ0ZBLEVBQVdELGlCQUFpQixVQUFVc0IsTUFBT3ZCLElBQzNDQSxFQUFFbUIsaUJBRUYsTUFBTXlCLEVBQVF2RCxTQUFTQyxlQUFlLFNBQVN1RCxNQUFNQyxPQUMvQ0MsRUFBVzFELFNBQVNDLGVBQWUsWUFBWXVELE1BQy9DRyxFQUFrQjNELFNBQVNDLGVBQWUsbUJBQW1CdUQsTUFDbkUsSUFBSUksRUFBUTVELFNBQVNDLGVBQWUsU0FBU3VELE1BQU1DLE9BRS9DSSxFQUFtQixHQTRCdkIsR0EzQnFCLDZCQUNIQyxLQUFLUCxJQUNyQk0sRUFBaUJFLEtBQUsscUNBQ3BCTCxJQUFhQyxHQUNmRSxFQUFpQkUsS0FBSyw2Q0FDVSxxQ0FDSEQsS0FBS0osSUFBYUEsRUFBU00sT0FBUyxJQUNqRUgsRUFBaUJFLEtBQUssMkNBQ25CSCxHQUFPQyxFQUFpQkUsS0FBSyxzQ0FHOUJILElBRGlCLHVCQUNNRSxLQUFLRixJQUM5QkMsRUFBaUJFLEtBQ2YsbUZBR0N0RSxHQUVIb0UsRUFBaUJFLEtBQUssa0NBR25CaEQsR0FBZ0JBLEVBQVlxQyxTQUMvQlMsRUFBaUJFLEtBQ2YscUVBSUFGLEVBQWlCRyxPQUFTLEdBQzVCLFFBQVVILEVBQWlCSSxLQUFLLGFBRGxDLEVBS0EsUUFBWSxZQUFhLGlCQUN6QixJQUNFLElBQUlDLEVBQVlOLEVBQ1pBLEVBQU1PLFdBQVcsT0FDbkJELEVBQVksTUFBTU4sRUFBTVEsVUFBVSxNQUlwQyxNQUFNLEtBQUVDLEVBQU01RCxNQUFPNkQsU0FBc0IsSUFBU0MsS0FBS0MsT0FBTyxDQUM5RGpCLFFBQ0FHLFdBQ0FlLFFBQVMsQ0FBRWhGLGtCQUdiLEdBQUk2RSxFQUFhLE1BQU1BLEVBQ3ZCLElBQUtELEVBQUtLLEtBQ1IsTUFBTSxJQUFJbkMsTUFBTSxnREFJbEIsR0FBSTJCLEdBQWFHLEVBQUtLLEtBQUtDLEdBQ3pCLFVBRVEsSUFBSUMsU0FBU0MsR0FBWUMsV0FBV0QsRUFBUyxPQUVuRCxNQUFRcEUsTUFBT3NFLFNBQXVCLElBQ25DQyxLQUFLLFlBQ0xDLE9BQU8sQ0FBRXJCLE1BQU9NLElBQ2hCZ0IsR0FBRyxLQUFNYixFQUFLSyxLQUFLQyxJQUVsQkksR0FDRmxGLFFBQVFzRixLQUNOLDhDQUNBSixFQUlOLENBQUUsTUFBT0ssR0FDUHZGLFFBQVFzRixLQUFLLHlCQUEwQkMsRUFFekMsRUE5UlYsU0FBMkI3QixHQUN6QixNQUFNOEIsRUFBZ0JyRixTQUFTQyxlQUFlLGlCQUMxQ29GLElBQ0ZBLEVBQWNsRCxVQUFZLDhLQUlkb0IsdWxCQWdCWjhCLEVBQWM5RCxVQUFVQyxPQUFPLFVBQy9CNkQsRUFBYzlELFVBQVVRLElBQUksV0FFaEMsQ0F3UVF1RCxDQUFrQi9CLEdBR2QxQyxJQUNGQSxFQUFXVSxVQUFVUSxJQUFJLFVBQ3pCbEIsRUFBV04sUUFFZixDQUFFLE1BQU9FLEdBQ1BaLFFBQVFZLE1BQU0sK0JBQWdDQSxHQUM5QyxJQUFJOEUsRUFBZTlFLEVBQU0rRSxTQUFXLDJCQUVsQy9FLEVBQU0rRSxTQUNOL0UsRUFBTStFLFFBQVFsQyxTQUFTLDJCQUV2QmlDLEVBQ0UsZ0dBRUY5RSxFQUFNK0UsU0FDTi9FLEVBQU0rRSxRQUFRbEMsU0FBUyxtQ0FFdkJpQyxFQUFlLGtEQUVmOUUsRUFBTStFLFNBQ04vRSxFQUFNK0UsUUFBUUMsY0FBY25DLFNBQVMsd0JBRXJDaUMsRUFDRSxtREFDQTlFLEVBQU0rRSxRQUNOLE1BRUosUUFBVUQsRUFDWixDQUFFLFNBQ0EsUUFBWSxZQUFhLGlCQUNyQjVGLE9BQU9PLFdBQWFSLElBQ3RCQyxPQUFPTyxVQUFVSyxNQUFNYixHQUN2QkcsUUFBUUMsSUFBSSxxQ0FFZEwsRUFBZSxJQUNqQixDQXBGQSxLQXVGRkksUUFBUVksTUFBTSx1Q0FHWkssRUFDRkEsRUFBZ0JGLGlCQUFpQixTQUFTc0IsV0FDeEMsUUFBWSxrQkFBbUIsdUJBQy9CLElBQ0UsTUFBTSxNQUFFekIsU0FBZ0IsSUFBUzhELEtBQUttQixnQkFBZ0IsQ0FDcERDLFNBQVUsU0FDVmxCLFFBQVMsQ0FHVCxJQUVFaEUsSUFDRlosUUFBUVksTUFBTSxnQ0FBaUNBLElBQy9DLFFBQ0VBLEVBQU0rRSxTQUFXLDZDQUl2QixDQUFFLE1BQU8vRSxHQUNQWixRQUFRWSxNQUFNLG1DQUFvQ0EsSUFDbEQsUUFDRSxnRUFFSixDQUFFLFNBQ0EsUUFBWSxrQkFBbUIsc0JBQ2pDLEtBR0ZaLFFBQVFzRixLQUFLLHFEQUVqQixFQ25iRVMsR0FFQS9GLFFBQVFDLElBQUksNkIsR0NkVitGLEVBQTJCLENBQUMsRUFHaEMsU0FBU0MsRUFBb0JDLEdBRTVCLElBQUlDLEVBQWVILEVBQXlCRSxHQUM1QyxRQUFxQnJGLElBQWpCc0YsRUFDSCxPQUFPQSxFQUFhQyxRQUdyQixJQUFJQyxFQUFTTCxFQUF5QkUsR0FBWSxDQUdqREUsUUFBUyxDQUFDLEdBT1gsT0FIQUUsRUFBb0JKLEdBQVVLLEtBQUtGLEVBQU9ELFFBQVNDLEVBQVFBLEVBQU9ELFFBQVNILEdBR3BFSSxFQUFPRCxPQUNmLENBR0FILEVBQW9CTyxFQUFJRixFTHpCcEIvRyxFQUFXLEdBQ2YwRyxFQUFvQlEsRUFBSSxDQUFDQyxFQUFRQyxFQUFVQyxFQUFJQyxLQUM5QyxJQUFHRixFQUFILENBTUEsSUFBSUcsRUFBZUMsSUFDbkIsSUFBU0MsRUFBSSxFQUFHQSxFQUFJekgsRUFBUzRFLE9BQVE2QyxJQUFLLENBR3pDLElBRkEsSUFBS0wsRUFBVUMsRUFBSUMsR0FBWXRILEVBQVN5SCxHQUNwQ0MsR0FBWSxFQUNQQyxFQUFJLEVBQUdBLEVBQUlQLEVBQVN4QyxPQUFRK0MsTUFDcEIsRUFBWEwsR0FBc0JDLEdBQWdCRCxJQUFhTSxPQUFPQyxLQUFLbkIsRUFBb0JRLEdBQUdZLE9BQU9DLEdBQVNyQixFQUFvQlEsRUFBRWEsR0FBS1gsRUFBU08sTUFDOUlQLEVBQVNZLE9BQU9MLElBQUssSUFFckJELEdBQVksRUFDVEosRUFBV0MsSUFBY0EsRUFBZUQsSUFHN0MsR0FBR0ksRUFBVyxDQUNiMUgsRUFBU2dJLE9BQU9QLElBQUssR0FDckIsSUFBSVEsRUFBSVosU0FDRS9GLElBQU4yRyxJQUFpQmQsRUFBU2MsRUFDL0IsQ0FDRCxDQUNBLE9BQU9kLENBbkJQLENBSkNHLEVBQVdBLEdBQVksRUFDdkIsSUFBSSxJQUFJRyxFQUFJekgsRUFBUzRFLE9BQVE2QyxFQUFJLEdBQUt6SCxFQUFTeUgsRUFBSSxHQUFHLEdBQUtILEVBQVVHLElBQUt6SCxFQUFTeUgsR0FBS3pILEVBQVN5SCxFQUFJLEdBQ3JHekgsRUFBU3lILEdBQUssQ0FBQ0wsRUFBVUMsRUFBSUMsSUNMM0JwSCxFQUFXMEgsT0FBT00sZUFBa0JDLEdBQVNQLE9BQU9NLGVBQWVDLEdBQVNBLEdBQVNBLEVBQWEsVUFRdEd6QixFQUFvQjBCLEVBQUksU0FBU2hFLEVBQU9pRSxHQUV2QyxHQURVLEVBQVBBLElBQVVqRSxFQUFRa0UsS0FBS2xFLElBQ2hCLEVBQVBpRSxFQUFVLE9BQU9qRSxFQUNwQixHQUFvQixpQkFBVkEsR0FBc0JBLEVBQU8sQ0FDdEMsR0FBVyxFQUFQaUUsR0FBYWpFLEVBQU1tRSxXQUFZLE9BQU9uRSxFQUMxQyxHQUFXLEdBQVBpRSxHQUFvQyxtQkFBZmpFLEVBQU1vRSxLQUFxQixPQUFPcEUsQ0FDNUQsQ0FDQSxJQUFJcUUsRUFBS2IsT0FBT2MsT0FBTyxNQUN2QmhDLEVBQW9CdUIsRUFBRVEsR0FDdEIsSUFBSUUsRUFBTSxDQUFDLEVBQ1gxSSxFQUFpQkEsR0FBa0IsQ0FBQyxLQUFNQyxFQUFTLENBQUMsR0FBSUEsRUFBUyxJQUFLQSxFQUFTQSxJQUMvRSxJQUFJLElBQUkwSSxFQUFpQixFQUFQUCxHQUFZakUsRUFBeUIsaUJBQVh3RSxLQUF5QjNJLEVBQWU0SSxRQUFRRCxHQUFVQSxFQUFVMUksRUFBUzBJLEdBQ3hIaEIsT0FBT2tCLG9CQUFvQkYsR0FBU0csU0FBU2hCLEdBQVNZLEVBQUlaLEdBQU8sSUFBTzNELEVBQU0yRCxLQUkvRSxPQUZBWSxFQUFhLFFBQUksSUFBTSxFQUN2QmpDLEVBQW9Cc0MsRUFBRVAsRUFBSUUsR0FDbkJGLENBQ1IsRUt4QkEvQixFQUFvQnNDLEVBQUksQ0FBQ25DLEVBQVNvQyxLQUNqQyxJQUFJLElBQUlsQixLQUFPa0IsRUFDWHZDLEVBQW9Cd0MsRUFBRUQsRUFBWWxCLEtBQVNyQixFQUFvQndDLEVBQUVyQyxFQUFTa0IsSUFDNUVILE9BQU91QixlQUFldEMsRUFBU2tCLEVBQUssQ0FBRXFCLFlBQVksRUFBTUMsSUFBS0osRUFBV2xCLE1DSjNFckIsRUFBb0I0QyxFQUFJLENBQUMsRUFHekI1QyxFQUFvQm5GLEVBQUtnSSxHQUNqQi9ELFFBQVFnRSxJQUFJNUIsT0FBT0MsS0FBS25CLEVBQW9CNEMsR0FBR0csUUFBTyxDQUFDQyxFQUFVM0IsS0FDdkVyQixFQUFvQjRDLEVBQUV2QixHQUFLd0IsRUFBU0csR0FDN0JBLElBQ0wsS0NOSmhELEVBQW9CaUQsRUFBS0osR0FFakIsTUFBUUEsRUFBVSxhQ0gxQjdDLEVBQW9Ca0QsRUFBSSxXQUN2QixHQUEwQixpQkFBZkMsV0FBeUIsT0FBT0EsV0FDM0MsSUFDQyxPQUFPdkIsTUFBUSxJQUFJd0IsU0FBUyxjQUFiLEVBQ2hCLENBQUUsTUFBT3ZJLEdBQ1IsR0FBc0IsaUJBQVhoQixPQUFxQixPQUFPQSxNQUN4QyxDQUNBLENBUHVCLEdDQXhCbUcsRUFBb0J3QyxFQUFJLENBQUNmLEVBQUs0QixJQUFVbkMsT0FBT29DLFVBQVVDLGVBQWVqRCxLQUFLbUIsRUFBSzRCLEdSQTlFNUosRUFBYSxDQUFDLEVBQ2RDLEVBQW9CLG9CQUV4QnNHLEVBQW9Cd0QsRUFBSSxDQUFDQyxFQUFLQyxFQUFNckMsRUFBS3dCLEtBQ3hDLEdBQUdwSixFQUFXZ0ssR0FBUWhLLEVBQVdnSyxHQUFLeEYsS0FBS3lGLE9BQTNDLENBQ0EsSUFBSUMsRUFBUUMsRUFDWixRQUFXaEosSUFBUnlHLEVBRUYsSUFEQSxJQUFJd0MsRUFBVTNKLFNBQVM0SixxQkFBcUIsVUFDcEMvQyxFQUFJLEVBQUdBLEVBQUk4QyxFQUFRM0YsT0FBUTZDLElBQUssQ0FDdkMsSUFBSWdELEVBQUlGLEVBQVE5QyxHQUNoQixHQUFHZ0QsRUFBRUMsYUFBYSxRQUFVUCxHQUFPTSxFQUFFQyxhQUFhLGlCQUFtQnRLLEVBQW9CMkgsRUFBSyxDQUFFc0MsRUFBU0ksRUFBRyxLQUFPLENBQ3BILENBRUdKLElBQ0hDLEdBQWEsR0FDYkQsRUFBU3pKLFNBQVMrSixjQUFjLFdBRXpCQyxRQUFVLFFBQ2pCUCxFQUFPUSxRQUFVLElBQ2JuRSxFQUFvQm9FLElBQ3ZCVCxFQUFPVSxhQUFhLFFBQVNyRSxFQUFvQm9FLElBRWxEVCxFQUFPVSxhQUFhLGVBQWdCM0ssRUFBb0IySCxHQUV4RHNDLEVBQU9XLElBQU1iLEdBRWRoSyxFQUFXZ0ssR0FBTyxDQUFDQyxHQUNuQixJQUFJYSxFQUFtQixDQUFDQyxFQUFNQyxLQUU3QmQsRUFBT2UsUUFBVWYsRUFBT2dCLE9BQVMsS0FDakNDLGFBQWFULEdBQ2IsSUFBSVUsRUFBVXBMLEVBQVdnSyxHQUl6QixVQUhPaEssRUFBV2dLLEdBQ2xCRSxFQUFPbUIsWUFBY25CLEVBQU9tQixXQUFXQyxZQUFZcEIsR0FDbkRrQixHQUFXQSxFQUFReEMsU0FBUzFCLEdBQVFBLEVBQUc4RCxLQUNwQ0QsRUFBTSxPQUFPQSxFQUFLQyxJQUVsQk4sRUFBVW5GLFdBQVd1RixFQUFpQlMsS0FBSyxVQUFNcEssRUFBVyxDQUFFcUssS0FBTSxVQUFXN0gsT0FBUXVHLElBQVcsTUFDdEdBLEVBQU9lLFFBQVVILEVBQWlCUyxLQUFLLEtBQU1yQixFQUFPZSxTQUNwRGYsRUFBT2dCLE9BQVNKLEVBQWlCUyxLQUFLLEtBQU1yQixFQUFPZ0IsUUFDbkRmLEdBQWMxSixTQUFTZ0wsS0FBS0MsWUFBWXhCLEVBcENrQixHU0gzRDNELEVBQW9CdUIsRUFBS3BCLElBQ0gsb0JBQVhpRixRQUEwQkEsT0FBT0MsYUFDMUNuRSxPQUFPdUIsZUFBZXRDLEVBQVNpRixPQUFPQyxZQUFhLENBQUUzSCxNQUFPLFdBRTdEd0QsT0FBT3VCLGVBQWV0QyxFQUFTLGFBQWMsQ0FBRXpDLE9BQU8sS0NMdkRzQyxFQUFvQmlCLEVBQUksSSxNQ0F4QixJQUFJcUUsRUFDQXRGLEVBQW9Ca0QsRUFBRXFDLGdCQUFlRCxFQUFZdEYsRUFBb0JrRCxFQUFFc0MsU0FBVyxJQUN0RixJQUFJdEwsRUFBVzhGLEVBQW9Ca0QsRUFBRWhKLFNBQ3JDLElBQUtvTCxHQUFhcEwsSUFDYkEsRUFBU3VMLGVBQWtFLFdBQWpEdkwsRUFBU3VMLGNBQWNDLFFBQVFDLGdCQUM1REwsRUFBWXBMLEVBQVN1TCxjQUFjbkIsTUFDL0JnQixHQUFXLENBQ2YsSUFBSXpCLEVBQVUzSixFQUFTNEoscUJBQXFCLFVBQzVDLEdBQUdELEVBQVEzRixPQUVWLElBREEsSUFBSTZDLEVBQUk4QyxFQUFRM0YsT0FBUyxFQUNsQjZDLEdBQUssS0FBT3VFLElBQWMsYUFBYXRILEtBQUtzSCxLQUFhQSxFQUFZekIsRUFBUTlDLEtBQUt1RCxHQUUzRixDQUlELElBQUtnQixFQUFXLE1BQU0sSUFBSTdJLE1BQU0seURBQ2hDNkksRUFBWUEsRUFBVU0sUUFBUSxTQUFVLElBQUlBLFFBQVEsT0FBUSxJQUFJQSxRQUFRLFFBQVMsSUFBSUEsUUFBUSxZQUFhLEtBQzFHNUYsRUFBb0I2RixFQUFJUCxFQUFZLEssV0NicEMsSUFBSVEsRUFBa0IsQ0FDckIsSUFBSyxHQUdOOUYsRUFBb0I0QyxFQUFFM0IsRUFBSSxDQUFDNEIsRUFBU0csS0FFbEMsSUFBSStDLEVBQXFCL0YsRUFBb0J3QyxFQUFFc0QsRUFBaUJqRCxHQUFXaUQsRUFBZ0JqRCxRQUFXakksRUFDdEcsR0FBMEIsSUFBdkJtTCxFQUdGLEdBQUdBLEVBQ0YvQyxFQUFTL0UsS0FBSzhILEVBQW1CLFFBQzNCLENBR0wsSUFBSUMsRUFBVSxJQUFJbEgsU0FBUSxDQUFDQyxFQUFTa0gsSUFBWUYsRUFBcUJELEVBQWdCakQsR0FBVyxDQUFDOUQsRUFBU2tILEtBQzFHakQsRUFBUy9FLEtBQUs4SCxFQUFtQixHQUFLQyxHQUd0QyxJQUFJdkMsRUFBTXpELEVBQW9CNkYsRUFBSTdGLEVBQW9CaUQsRUFBRUosR0FFcERsSSxFQUFRLElBQUk4QixNQWdCaEJ1RCxFQUFvQndELEVBQUVDLEdBZkZnQixJQUNuQixHQUFHekUsRUFBb0J3QyxFQUFFc0QsRUFBaUJqRCxLQUVmLEtBRDFCa0QsRUFBcUJELEVBQWdCakQsTUFDUmlELEVBQWdCakQsUUFBV2pJLEdBQ3JEbUwsR0FBb0IsQ0FDdEIsSUFBSUcsRUFBWXpCLElBQXlCLFNBQWZBLEVBQU1RLEtBQWtCLFVBQVlSLEVBQU1RLE1BQ2hFa0IsRUFBVTFCLEdBQVNBLEVBQU1ySCxRQUFVcUgsRUFBTXJILE9BQU9rSCxJQUNwRDNKLEVBQU0rRSxRQUFVLGlCQUFtQm1ELEVBQVUsY0FBZ0JxRCxFQUFZLEtBQU9DLEVBQVUsSUFDMUZ4TCxFQUFNeUwsS0FBTyxpQkFDYnpMLEVBQU1zSyxLQUFPaUIsRUFDYnZMLEVBQU0wTCxRQUFVRixFQUNoQkosRUFBbUIsR0FBR3BMLEVBQ3ZCLElBR3VDLFNBQVdrSSxFQUFTQSxFQUUvRCxHQVlIN0MsRUFBb0JRLEVBQUVTLEVBQUs0QixHQUEwQyxJQUE3QmlELEVBQWdCakQsR0FHeEQsSUFBSXlELEVBQXVCLENBQUNDLEVBQTRCaEksS0FDdkQsSUFHSTBCLEVBQVU0QyxHQUhUbkMsRUFBVThGLEVBQWFDLEdBQVdsSSxFQUdoQndDLEVBQUksRUFDM0IsR0FBR0wsRUFBU2dHLE1BQU03SCxHQUFnQyxJQUF4QmlILEVBQWdCakgsS0FBYSxDQUN0RCxJQUFJb0IsS0FBWXVHLEVBQ1p4RyxFQUFvQndDLEVBQUVnRSxFQUFhdkcsS0FDckNELEVBQW9CTyxFQUFFTixHQUFZdUcsRUFBWXZHLElBR2hELEdBQUd3RyxFQUFTLElBQUloRyxFQUFTZ0csRUFBUXpHLEVBQ2xDLENBRUEsSUFER3VHLEdBQTRCQSxFQUEyQmhJLEdBQ3JEd0MsRUFBSUwsRUFBU3hDLE9BQVE2QyxJQUN6QjhCLEVBQVVuQyxFQUFTSyxHQUNoQmYsRUFBb0J3QyxFQUFFc0QsRUFBaUJqRCxJQUFZaUQsRUFBZ0JqRCxJQUNyRWlELEVBQWdCakQsR0FBUyxLQUUxQmlELEVBQWdCakQsR0FBVyxFQUU1QixPQUFPN0MsRUFBb0JRLEVBQUVDLElBRzFCa0csRUFBcUJDLEtBQW1DLDZCQUFJQSxLQUFtQyw4QkFBSyxHQUN4R0QsRUFBbUJ0RSxRQUFRaUUsRUFBcUJ0QixLQUFLLEtBQU0sSUFDM0QyQixFQUFtQjFJLEtBQU9xSSxFQUFxQnRCLEtBQUssS0FBTTJCLEVBQW1CMUksS0FBSytHLEtBQUsyQixHLEtDbEZ2RixJQUFJRSxFQUFzQjdHLEVBQW9CUSxPQUFFNUYsRUFBVyxDQUFDLEtBQUssSUFBT29GLEVBQW9CLFFBQzVGNkcsRUFBc0I3RyxFQUFvQlEsRUFBRXFHLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9jaHVuayBsb2FkZWQiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvY3JlYXRlIGZha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9sb2FkIHNjcmlwdCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwLy4vc3JjL2pzL2F1dGgvc2lnbnVwLmpzIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvLi9zcmMvanMvZW50cmllcy9zaWdudXAuanMiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9lbnN1cmUgY2h1bmsiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvZ2V0IGphdmFzY3JpcHQgY2h1bmsgZmlsZW5hbWUiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvZ2xvYmFsIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvcnVudGltZUlkIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL3B1YmxpY1BhdGgiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvanNvbnAgY2h1bmsgbG9hZGluZyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZGVmZXJyZWQgPSBbXTtcbl9fd2VicGFja19yZXF1aXJlX18uTyA9IChyZXN1bHQsIGNodW5rSWRzLCBmbiwgcHJpb3JpdHkpID0+IHtcblx0aWYoY2h1bmtJZHMpIHtcblx0XHRwcmlvcml0eSA9IHByaW9yaXR5IHx8IDA7XG5cdFx0Zm9yKHZhciBpID0gZGVmZXJyZWQubGVuZ3RoOyBpID4gMCAmJiBkZWZlcnJlZFtpIC0gMV1bMl0gPiBwcmlvcml0eTsgaS0tKSBkZWZlcnJlZFtpXSA9IGRlZmVycmVkW2kgLSAxXTtcblx0XHRkZWZlcnJlZFtpXSA9IFtjaHVua0lkcywgZm4sIHByaW9yaXR5XTtcblx0XHRyZXR1cm47XG5cdH1cblx0dmFyIG5vdEZ1bGZpbGxlZCA9IEluZmluaXR5O1xuXHRmb3IgKHZhciBpID0gMDsgaSA8IGRlZmVycmVkLmxlbmd0aDsgaSsrKSB7XG5cdFx0dmFyIFtjaHVua0lkcywgZm4sIHByaW9yaXR5XSA9IGRlZmVycmVkW2ldO1xuXHRcdHZhciBmdWxmaWxsZWQgPSB0cnVlO1xuXHRcdGZvciAodmFyIGogPSAwOyBqIDwgY2h1bmtJZHMubGVuZ3RoOyBqKyspIHtcblx0XHRcdGlmICgocHJpb3JpdHkgJiAxID09PSAwIHx8IG5vdEZ1bGZpbGxlZCA+PSBwcmlvcml0eSkgJiYgT2JqZWN0LmtleXMoX193ZWJwYWNrX3JlcXVpcmVfXy5PKS5ldmVyeSgoa2V5KSA9PiAoX193ZWJwYWNrX3JlcXVpcmVfXy5PW2tleV0oY2h1bmtJZHNbal0pKSkpIHtcblx0XHRcdFx0Y2h1bmtJZHMuc3BsaWNlKGotLSwgMSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRmdWxmaWxsZWQgPSBmYWxzZTtcblx0XHRcdFx0aWYocHJpb3JpdHkgPCBub3RGdWxmaWxsZWQpIG5vdEZ1bGZpbGxlZCA9IHByaW9yaXR5O1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZihmdWxmaWxsZWQpIHtcblx0XHRcdGRlZmVycmVkLnNwbGljZShpLS0sIDEpXG5cdFx0XHR2YXIgciA9IGZuKCk7XG5cdFx0XHRpZiAociAhPT0gdW5kZWZpbmVkKSByZXN1bHQgPSByO1xuXHRcdH1cblx0fVxuXHRyZXR1cm4gcmVzdWx0O1xufTsiLCJ2YXIgZ2V0UHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YgPyAob2JqKSA9PiAoT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iaikpIDogKG9iaikgPT4gKG9iai5fX3Byb3RvX18pO1xudmFyIGxlYWZQcm90b3R5cGVzO1xuLy8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4vLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbi8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuLy8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4vLyBtb2RlICYgMTY6IHJldHVybiB2YWx1ZSB3aGVuIGl0J3MgUHJvbWlzZS1saWtlXG4vLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuXHRpZihtb2RlICYgMSkgdmFsdWUgPSB0aGlzKHZhbHVlKTtcblx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcblx0aWYodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSkge1xuXHRcdGlmKChtb2RlICYgNCkgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuXHRcdGlmKChtb2RlICYgMTYpICYmIHR5cGVvZiB2YWx1ZS50aGVuID09PSAnZnVuY3Rpb24nKSByZXR1cm4gdmFsdWU7XG5cdH1cblx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcblx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcblx0dmFyIGRlZiA9IHt9O1xuXHRsZWFmUHJvdG90eXBlcyA9IGxlYWZQcm90b3R5cGVzIHx8IFtudWxsLCBnZXRQcm90byh7fSksIGdldFByb3RvKFtdKSwgZ2V0UHJvdG8oZ2V0UHJvdG8pXTtcblx0Zm9yKHZhciBjdXJyZW50ID0gbW9kZSAmIDIgJiYgdmFsdWU7IHR5cGVvZiBjdXJyZW50ID09ICdvYmplY3QnICYmICF+bGVhZlByb3RvdHlwZXMuaW5kZXhPZihjdXJyZW50KTsgY3VycmVudCA9IGdldFByb3RvKGN1cnJlbnQpKSB7XG5cdFx0T2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoY3VycmVudCkuZm9yRWFjaCgoa2V5KSA9PiAoZGVmW2tleV0gPSAoKSA9PiAodmFsdWVba2V5XSkpKTtcblx0fVxuXHRkZWZbJ2RlZmF1bHQnXSA9ICgpID0+ICh2YWx1ZSk7XG5cdF9fd2VicGFja19yZXF1aXJlX18uZChucywgZGVmKTtcblx0cmV0dXJuIG5zO1xufTsiLCJ2YXIgaW5Qcm9ncmVzcyA9IHt9O1xudmFyIGRhdGFXZWJwYWNrUHJlZml4ID0gXCJ1cmJhbmRvY3Nfd2ViYXBwOlwiO1xuLy8gbG9hZFNjcmlwdCBmdW5jdGlvbiB0byBsb2FkIGEgc2NyaXB0IHZpYSBzY3JpcHQgdGFnXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmwgPSAodXJsLCBkb25lLCBrZXksIGNodW5rSWQpID0+IHtcblx0aWYoaW5Qcm9ncmVzc1t1cmxdKSB7IGluUHJvZ3Jlc3NbdXJsXS5wdXNoKGRvbmUpOyByZXR1cm47IH1cblx0dmFyIHNjcmlwdCwgbmVlZEF0dGFjaDtcblx0aWYoa2V5ICE9PSB1bmRlZmluZWQpIHtcblx0XHR2YXIgc2NyaXB0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpO1xuXHRcdGZvcih2YXIgaSA9IDA7IGkgPCBzY3JpcHRzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHR2YXIgcyA9IHNjcmlwdHNbaV07XG5cdFx0XHRpZihzLmdldEF0dHJpYnV0ZShcInNyY1wiKSA9PSB1cmwgfHwgcy5nZXRBdHRyaWJ1dGUoXCJkYXRhLXdlYnBhY2tcIikgPT0gZGF0YVdlYnBhY2tQcmVmaXggKyBrZXkpIHsgc2NyaXB0ID0gczsgYnJlYWs7IH1cblx0XHR9XG5cdH1cblx0aWYoIXNjcmlwdCkge1xuXHRcdG5lZWRBdHRhY2ggPSB0cnVlO1xuXHRcdHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuXG5cdFx0c2NyaXB0LmNoYXJzZXQgPSAndXRmLTgnO1xuXHRcdHNjcmlwdC50aW1lb3V0ID0gMTIwO1xuXHRcdGlmIChfX3dlYnBhY2tfcmVxdWlyZV9fLm5jKSB7XG5cdFx0XHRzY3JpcHQuc2V0QXR0cmlidXRlKFwibm9uY2VcIiwgX193ZWJwYWNrX3JlcXVpcmVfXy5uYyk7XG5cdFx0fVxuXHRcdHNjcmlwdC5zZXRBdHRyaWJ1dGUoXCJkYXRhLXdlYnBhY2tcIiwgZGF0YVdlYnBhY2tQcmVmaXggKyBrZXkpO1xuXG5cdFx0c2NyaXB0LnNyYyA9IHVybDtcblx0fVxuXHRpblByb2dyZXNzW3VybF0gPSBbZG9uZV07XG5cdHZhciBvblNjcmlwdENvbXBsZXRlID0gKHByZXYsIGV2ZW50KSA9PiB7XG5cdFx0Ly8gYXZvaWQgbWVtIGxlYWtzIGluIElFLlxuXHRcdHNjcmlwdC5vbmVycm9yID0gc2NyaXB0Lm9ubG9hZCA9IG51bGw7XG5cdFx0Y2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuXHRcdHZhciBkb25lRm5zID0gaW5Qcm9ncmVzc1t1cmxdO1xuXHRcdGRlbGV0ZSBpblByb2dyZXNzW3VybF07XG5cdFx0c2NyaXB0LnBhcmVudE5vZGUgJiYgc2NyaXB0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoc2NyaXB0KTtcblx0XHRkb25lRm5zICYmIGRvbmVGbnMuZm9yRWFjaCgoZm4pID0+IChmbihldmVudCkpKTtcblx0XHRpZihwcmV2KSByZXR1cm4gcHJldihldmVudCk7XG5cdH1cblx0dmFyIHRpbWVvdXQgPSBzZXRUaW1lb3V0KG9uU2NyaXB0Q29tcGxldGUuYmluZChudWxsLCB1bmRlZmluZWQsIHsgdHlwZTogJ3RpbWVvdXQnLCB0YXJnZXQ6IHNjcmlwdCB9KSwgMTIwMDAwKTtcblx0c2NyaXB0Lm9uZXJyb3IgPSBvblNjcmlwdENvbXBsZXRlLmJpbmQobnVsbCwgc2NyaXB0Lm9uZXJyb3IpO1xuXHRzY3JpcHQub25sb2FkID0gb25TY3JpcHRDb21wbGV0ZS5iaW5kKG51bGwsIHNjcmlwdC5vbmxvYWQpO1xuXHRuZWVkQXR0YWNoICYmIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTtcbn07IiwiLy8gc3JjL2F1dGgvc2lnbnVwLmpzXG4vKipcbiAqIFNpZ251cCBNb2R1bGVcbiAqIEBtb2R1bGUgc2lnbnVwXG4gKiBAZGVzY3JpcHRpb24gSGFuZGxlcyB1c2VyIHJlZ2lzdHJhdGlvbiB3aXRoIGNsaWVudC1zaWRlIHZhbGlkYXRpb24sIEdvb2dsZSBPQXV0aCwgYW5kIHBob25lIHZlcmlmaWNhdGlvbiB1c2luZyBTdXBhYmFzZS5cbiAqIEB2ZXJzaW9uIDAuMi4xXG4gKlxuICogQGNoYW5nZWxvZ1xuICogLSAwLjIuMSAoMjAyNS0wNS0xOCk6IEFkZGVkIGNhcHRjaGEgd2l0aCBDbG91ZGZsYXJlIFR1cm5zdGlsZS5cbiAqIC0gMC4yLjAgKDIwMjUtMDUtMTgpOiBBZGRlZCBwaG9uZSBudW1iZXIgaW5wdXQsIE9UUCBzZW5kaW5nIGFuZCB2ZXJpZmljYXRpb24gZm9yIGVtYWlsL3Bhc3N3b3JkIHNpZ251cC5cbiAqIC0gMC4xLjEgKDIwMjUtMDUtMTgpOiBBZGRlZCBHb29nbGUgU2lnbi1VcCBmdW5jdGlvbmFsaXR5LlxuICogLSAwLjEuMCAoMjAyNS0wNS0xNSk6IE1pZ3JhdGVkIHRvIFN1cGFiYXNlIGNsaWVudC1zaWRlIGF1dGggKHZlcnNpb25pbmcgYWRqdXN0ZWQpXG4gKi9cblxuaW1wb3J0IHtcbiAgc2hvd0Vycm9yLFxuICBzaG93U3RhdHVzLFxuICBzaG93TG9hZGluZyxcbiAgaGlkZUxvYWRpbmcsXG4gIGhpZGVFbGVtZW50LFxufSBmcm9tIFwiLi9hdXRoLmpzXCI7XG5pbXBvcnQgeyBzdXBhYmFzZSB9IGZyb20gXCIuLi9zdXBhYmFzZS1jbGllbnQuanNcIjtcblxuLy8gU3RvcmUgcGhvbmUgbnVtYmVyIHRlbXBvcmFyaWx5IGJldHdlZW4gc3RlcHNcbmxldCBjYXB0Y2hhVG9rZW4gPSBudWxsOyAvLyBUbyBzdG9yZSB0aGUgY2FwdGNoYSB0b2tlbiAodXNlZCBieSBib3RoIGhDYXB0Y2hhIGFuZCBUdXJuc3RpbGUpXG5sZXQgdHVybnN0aWxlV2lkZ2V0SWQgPSBudWxsOyAvLyBUbyBzdG9yZSBUdXJuc3RpbGUgd2lkZ2V0IElEXG5cbi8vIFRoaXMgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgYnkgdGhlIENsb3VkZmxhcmUgVHVybnN0aWxlIHNjcmlwdCBvbmNlIGl0J3MgbG9hZGVkXG4vLyAoZHVlIHRvICZvbmxvYWQ9b25sb2FkVHVybnN0aWxlQ2FsbGJhY2sgaW4gdGhlIHNjcmlwdCB0YWcgaW4gc2lnbnVwLmh0bWwpXG53aW5kb3cub25sb2FkVHVybnN0aWxlQ2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7XG4gIGNvbnNvbGUubG9nKFwiVHVybnN0aWxlIEFQSSByZWFkeSAob25sb2FkVHVybnN0aWxlQ2FsbGJhY2sgZXhlY3V0ZWQpLlwiKTtcbiAgY29uc3QgdHVybnN0aWxlQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0dXJuc3RpbGUtY29udGFpbmVyXCIpO1xuXG4gIGlmICh0dXJuc3RpbGVDb250YWluZXIgJiYgd2luZG93LnR1cm5zdGlsZSAmJiAhdHVybnN0aWxlV2lkZ2V0SWQpIHtcbiAgICBjb25zb2xlLmxvZyhcIlJlbmRlcmluZyBUdXJuc3RpbGUgd2lkZ2V0IGZyb20gb25sb2FkVHVybnN0aWxlQ2FsbGJhY2suLi5cIik7XG4gICAgdHJ5IHtcbiAgICAgIHR1cm5zdGlsZVdpZGdldElkID0gd2luZG93LnR1cm5zdGlsZS5yZW5kZXIodHVybnN0aWxlQ29udGFpbmVyLCB7XG4gICAgICAgIHNpdGVrZXk6IFwiMHg0QUFBQUFBQmR6WTNJbk9VMl9Jbjk5XCIsXG4gICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAodG9rZW4pIHtcbiAgICAgICAgICBjYXB0Y2hhVG9rZW4gPSB0b2tlbjtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIlR1cm5zdGlsZSB0b2tlbiBvYnRhaW5lZDpcIiwgdG9rZW4pO1xuICAgICAgICB9LFxuICAgICAgICBcImV4cGlyZWQtY2FsbGJhY2tcIjogKCkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgXCJUdXJuc3RpbGUgdG9rZW4gZXhwaXJlZC4gUmVzZXR0aW5nIHdpZGdldC4gSUQ6XCIsXG4gICAgICAgICAgICB0dXJuc3RpbGVXaWRnZXRJZFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKHdpbmRvdy50dXJuc3RpbGUgJiYgdHVybnN0aWxlV2lkZ2V0SWQpIHtcbiAgICAgICAgICAgIHdpbmRvdy50dXJuc3RpbGUucmVzZXQodHVybnN0aWxlV2lkZ2V0SWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXB0Y2hhVG9rZW4gPSBudWxsOyAvLyBDbGVhciB0aGUgdG9rZW5cbiAgICAgICAgICAvLyBXaWRnZXQgc2hvdWxkIGJlIHJlYWR5IGZvciBhIG5ldyBjaGFsbGVuZ2UgYWZ0ZXIgcmVzZXQuXG4gICAgICAgIH0sXG4gICAgICAgIFwiZXJyb3ItY2FsbGJhY2tcIjogKGVycikgPT4ge1xuICAgICAgICAgIGNhcHRjaGFUb2tlbiA9IG51bGw7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIlR1cm5zdGlsZSBlcnJvciBjYWxsYmFjazpcIiwgZXJyKTtcbiAgICAgICAgICBzaG93RXJyb3IoYEVycmV1ciBDQVBUQ0hBOiAke2Vycn0uIFZldWlsbGV6IHLDqWVzc2F5ZXIuYCk7XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIGlmICh0dXJuc3RpbGVXaWRnZXRJZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgICAgXCJUdXJuc3RpbGUucmVuZGVyIGRpZCBub3QgcmV0dXJuIGEgd2lkZ2V0SWQuIFNpdGVrZXkgb3IgY29udGFpbmVyIGlzc3VlP1wiXG4gICAgICAgICk7XG4gICAgICAgIHNob3dFcnJvcihcIkVycmV1ciBpbml0aWFsaXNhdGlvbiBDQVBUQ0hBIChJRCB3aWRnZXQgbm9uIHJldG91cm7DqSkuXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJUdXJuc3RpbGUgd2lkZ2V0IHJlbmRlcmVkLiBJRDpcIiwgdHVybnN0aWxlV2lkZ2V0SWQpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciByZW5kZXJpbmcgVHVybnN0aWxlOlwiLCBlKTtcbiAgICAgIHNob3dFcnJvcihcIkltcG9zc2libGUgZCdhZmZpY2hlciBsZSBDQVBUQ0hBLlwiKTtcbiAgICB9XG4gIH0gZWxzZSBpZiAoIXR1cm5zdGlsZUNvbnRhaW5lcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJvbmxvYWRUdXJuc3RpbGVDYWxsYmFjazogI3R1cm5zdGlsZS1jb250YWluZXIgbm90IGZvdW5kLlwiKTtcbiAgfSBlbHNlIGlmICghd2luZG93LnR1cm5zdGlsZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJvbmxvYWRUdXJuc3RpbGVDYWxsYmFjazogd2luZG93LnR1cm5zdGlsZSBBUEkgbm90IGZvdW5kLlwiKTtcbiAgfSBlbHNlIGlmICh0dXJuc3RpbGVXaWRnZXRJZCkge1xuICAgIGNvbnNvbGUubG9nKFwib25sb2FkVHVybnN0aWxlQ2FsbGJhY2s6IFdpZGdldCBhbHJlYWR5IHNlZW1zIHJlbmRlcmVkLlwiKTtcbiAgfVxufTtcblxuLyoqXG4gKiBTaG93IGRldGFpbGVkIHNpZ251cCBzdWNjZXNzIG1lc3NhZ2VcbiAqIEBwYXJhbSB7c3RyaW5nfSBlbWFpbCAtIFRoZSBlbWFpbCBhZGRyZXNzIHVzZWQgZm9yIHNpZ251cFxuICovXG5mdW5jdGlvbiBzaG93U2lnbnVwU3VjY2VzcyhlbWFpbCkge1xuICBjb25zdCBzdGF0dXNFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdGF0dXNNZXNzYWdlXCIpO1xuICBpZiAoc3RhdHVzRWxlbWVudCkge1xuICAgIHN0YXR1c0VsZW1lbnQuaW5uZXJIVE1MID0gYFxuICAgICAgPGRpdiBjbGFzcz1cInNpZ251cC1zdWNjZXNzXCI+XG4gICAgICAgIDxoMz5Db21wdGUgY3LDqcOpIGF2ZWMgc3VjY8OocyAhPC9oMz5cbiAgICAgICAgPHA+PHN0cm9uZz5VbiBlbWFpbCBkZSBjb25maXJtYXRpb24gYSDDqXTDqSBlbnZvecOpIMOgIDo8L3N0cm9uZz48YnI+XG4gICAgICAgIDxjb2RlPiR7ZW1haWx9PC9jb2RlPjwvcD5cbiAgICAgICAgXG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb25maXJtYXRpb24taW5zdHJ1Y3Rpb25zXCI+XG4gICAgICAgICAgPGg0PvCfk6cgUHJvY2hhaW5lcyDDqXRhcGVzIDo8L2g0PlxuICAgICAgICAgIDxvbD5cbiAgICAgICAgICAgIDxsaT5Ww6lyaWZpZXogdm90cmUgYm/DrnRlIGRlIHLDqWNlcHRpb24gKGV0IG4nb3VibGlleiBwYXMgdm9zIHNwYW1zICEpPC9saT5cbiAgICAgICAgICAgIDxsaT5DbGlxdWV6IHN1ciBsZSBsaWVuIGRlIGNvbmZpcm1hdGlvbiBkYW5zIGwnZW1haWw8L2xpPlxuICAgICAgICAgICAgPGxpPlZvdXMgcG91cnJleiBlbnN1aXRlIHZvdXMgY29ubmVjdGVyIGF2ZWMgdm9zIGlkZW50aWZpYW50czwvbGk+XG4gICAgICAgICAgPC9vbD5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIFxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29uZmlybWF0aW9uLW5vdGVcIj5cbiAgICAgICAgICA8cD48c3Ryb25nPk5vdGUgOjwvc3Ryb25nPiBWb3VzIGRldmV6IGNvbmZpcm1lciB2b3RyZSBlbWFpbCBhdmFudCBkZSBwb3V2b2lyIHZvdXMgY29ubmVjdGVyLjwvcD5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICBgO1xuICAgIHN0YXR1c0VsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcbiAgICBzdGF0dXNFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJzdWNjZXNzXCIpO1xuICB9XG59XG5cbi8qKlxuICogSW5pdGlhbGl6ZXMgdGhlIHNpZ251cCBwYWdlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbml0U2lnbnVwUGFnZSgpIHtcbiAgY29uc29sZS5sb2coXCJpbml0U2lnbnVwUGFnZSBjYWxsZWRcIik7XG4gIGNvbnN0IHNpZ251cEZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNpZ251cEZvcm1cIik7XG4gIGNvbnN0IGVycm9yTWVzc2FnZURpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZXJyb3JNZXNzYWdlXCIpO1xuICBjb25zdCBzdGF0dXNNZXNzYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdGF0dXNNZXNzYWdlXCIpO1xuICBjb25zdCBnb29nbGVTaWduVXBCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImdvb2dsZVNpZ25VcEJ0blwiKTtcbiAgY29uc3QgdHVybnN0aWxlQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0dXJuc3RpbGUtY29udGFpbmVyXCIpO1xuXG4gIC8vIC0tLSBUZXJtcyBvZiBTZXJ2aWNlIExvZ2ljIGZvciBTaWdudXAgLS0tXG4gIGNvbnN0IHRvc0NoZWNrYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0b3NDaGVja2JveFwiKTtcbiAgY29uc3QgdG9zTW9kYWxFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0b3NNb2RhbFwiKTtcbiAgY29uc3QgdG9zTW9kYWxCb2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0b3NNb2RhbEJvZHlcIik7XG4gIGNvbnN0IHNpZ251cEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic2lnbnVwQnRuXCIpO1xuICBjb25zdCB0b3NTdGF0dXNNZXNzYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0b3NTdGF0dXNNZXNzYWdlXCIpO1xuICBjb25zdCB0b3NMaW5rID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0b3NMaW5rXCIpO1xuICBjb25zdCB0b3NNb2RhbENsb3NlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0b3NNb2RhbENsb3NlXCIpO1xuXG4gIC8vIEluaXRpYWxseSBkaXNhYmxlIHNpZ251cCBidXR0b24sIEdvb2dsZSBidXR0b24sIGFuZCBjaGVja2JveFxuICBpZiAoc2lnbnVwQnRuKSB7XG4gICAgc2lnbnVwQnRuLmRpc2FibGVkID0gdHJ1ZTtcbiAgfVxuICBpZiAoZ29vZ2xlU2lnblVwQnRuKSB7XG4gICAgZ29vZ2xlU2lnblVwQnRuLmRpc2FibGVkID0gdHJ1ZTtcbiAgfVxuICBpZiAodG9zQ2hlY2tib3gpIHtcbiAgICB0b3NDaGVja2JveC5kaXNhYmxlZCA9IHRydWU7XG4gIH1cblxuICAvLyBDdXN0b20gbW9kYWwgaGFuZGxpbmdcbiAgaWYgKHRvc0xpbmsgJiYgdG9zTW9kYWxFbGVtZW50KSB7XG4gICAgdG9zTGluay5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHNob3dNb2RhbCgpO1xuICAgIH0pO1xuICB9XG5cbiAgaWYgKHRvc01vZGFsQ2xvc2UpIHtcbiAgICB0b3NNb2RhbENsb3NlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBoaWRlTW9kYWwoKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIENsb3NlIG1vZGFsIHdoZW4gY2xpY2tpbmcgb3V0c2lkZVxuICBpZiAodG9zTW9kYWxFbGVtZW50KSB7XG4gICAgdG9zTW9kYWxFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgaWYgKGUudGFyZ2V0ID09PSB0b3NNb2RhbEVsZW1lbnQpIHtcbiAgICAgICAgaGlkZU1vZGFsKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBzaG93TW9kYWwoKSB7XG4gICAgaWYgKHRvc01vZGFsRWxlbWVudCkge1xuICAgICAgdG9zTW9kYWxFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJzaG93XCIpO1xuICAgICAgdG9zTW9kYWxFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gXCJoaWRkZW5cIjtcblxuICAgICAgLy8gTG9hZCBUb1MgY29udGVudCBpZiBub3QgYWxyZWFkeSBsb2FkZWRcbiAgICAgIGlmICh0b3NNb2RhbEJvZHkgJiYgdG9zTW9kYWxCb2R5LmRhdGFzZXQubG9hZGVkICE9PSBcInRydWVcIikge1xuICAgICAgICBsb2FkVG9TQ29udGVudCgpO1xuICAgICAgfVxuXG4gICAgICAvLyBFbmFibGUgY2hlY2tib3ggaW1tZWRpYXRlbHkgd2hlbiBtb2RhbCBvcGVuc1xuICAgICAgaWYgKHRvc0NoZWNrYm94KSB7XG4gICAgICAgIHRvc0NoZWNrYm94LmRpc2FibGVkID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gaGlkZU1vZGFsKCkge1xuICAgIGlmICh0b3NNb2RhbEVsZW1lbnQpIHtcbiAgICAgIHRvc01vZGFsRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwic2hvd1wiKTtcbiAgICAgIHRvc01vZGFsRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gXCJcIjtcbiAgICB9XG4gIH1cblxuICBhc3luYyBmdW5jdGlvbiBsb2FkVG9TQ29udGVudCgpIHtcbiAgICB0cnkge1xuICAgICAgdG9zTW9kYWxCb2R5LmlubmVySFRNTCA9XG4gICAgICAgIFwiPHA+Q2hhcmdlbWVudCBkZXMgY29uZGl0aW9ucyBkJ3V0aWxpc2F0aW9uLi4uPC9wPlwiO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFwiL3BvbGljaWVzL3Rlcm1zXCIpO1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBsb2FkIFRlcm1zIG9mIFNlcnZpY2U6ICR7cmVzcG9uc2Uuc3RhdHVzfWApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB0b3NIdG1sID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuXG4gICAgICAvLyBFeHRyYWN0IGp1c3QgdGhlIGNvbnRlbnQgZnJvbSB0aGUgSFRNTFxuICAgICAgY29uc3QgcGFyc2VyID0gbmV3IERPTVBhcnNlcigpO1xuICAgICAgY29uc3QgZG9jID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyh0b3NIdG1sLCBcInRleHQvaHRtbFwiKTtcbiAgICAgIGNvbnN0IG1haW5Db250ZW50ID1cbiAgICAgICAgZG9jLnF1ZXJ5U2VsZWN0b3IoXCJtYWluXCIpIHx8XG4gICAgICAgIGRvYy5xdWVyeVNlbGVjdG9yKFwiLnBvbGljeS1jb250YWluZXJcIikgfHxcbiAgICAgICAgZG9jLmJvZHk7XG5cbiAgICAgIGlmIChtYWluQ29udGVudCkge1xuICAgICAgICB0b3NNb2RhbEJvZHkuaW5uZXJIVE1MID0gbWFpbkNvbnRlbnQuaW5uZXJIVE1MO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdG9zTW9kYWxCb2R5LmlubmVySFRNTCA9IHRvc0h0bWw7XG4gICAgICB9XG5cbiAgICAgIHRvc01vZGFsQm9keS5kYXRhc2V0LmxvYWRlZCA9IFwidHJ1ZVwiO1xuICAgICAgdG9zTW9kYWxCb2R5LnNjcm9sbFRvcCA9IDA7XG5cbiAgICAgIC8vIEVuYWJsZSBjaGVja2JveCBhZnRlciBjb250ZW50IGlzIGxvYWRlZFxuICAgICAgaWYgKHRvc0NoZWNrYm94KSB7XG4gICAgICAgIHRvc0NoZWNrYm94LmRpc2FibGVkID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBsb2FkaW5nIFRvUzpcIiwgZXJyb3IpO1xuICAgICAgdG9zTW9kYWxCb2R5LmlubmVySFRNTCA9IGBcbiAgICAgICAgPGRpdiBzdHlsZT1cImNvbG9yOiAjZGMzNTQ1OyBwYWRkaW5nOiAxcmVtOyBib3JkZXI6IDFweCBzb2xpZCAjZGMzNTQ1OyBib3JkZXItcmFkaXVzOiA0cHg7IGJhY2tncm91bmQtY29sb3I6ICNmOGQ3ZGE7XCI+XG4gICAgICAgICAgPHA+PHN0cm9uZz5FcnJldXIgbG9ycyBkdSBjaGFyZ2VtZW50IGRlcyBjb25kaXRpb25zIGQndXRpbGlzYXRpb24uPC9zdHJvbmc+PC9wPlxuICAgICAgICAgIDxwPlZldWlsbGV6IHLDqWVzc2F5ZXIgb3UgY29uc3VsdGVyIGxlcyBjb25kaXRpb25zIGRpcmVjdGVtZW50IHN1ciA8YSBocmVmPVwiL3BvbGljaWVzL3Rlcm1zXCIgdGFyZ2V0PVwiX2JsYW5rXCI+Y2V0dGUgcGFnZTwvYT4uPC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIGA7XG5cbiAgICAgIC8vIEVuYWJsZSBjaGVja2JveCBldmVuIGlmIHRoZXJlJ3MgYW4gZXJyb3IgbG9hZGluZyBjb250ZW50XG4gICAgICBpZiAodG9zQ2hlY2tib3gpIHtcbiAgICAgICAgdG9zQ2hlY2tib3guZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBIYW5kbGUgY2hlY2tib3ggY2hhbmdlXG4gIGlmICh0b3NDaGVja2JveCkge1xuICAgIHRvc0NoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgaXNDaGVja2VkID0gdG9zQ2hlY2tib3guY2hlY2tlZDtcblxuICAgICAgLy8gRW5hYmxlL2Rpc2FibGUgYm90aCBidXR0b25zIGJhc2VkIG9uIFRvUyBhY2NlcHRhbmNlXG4gICAgICBpZiAoc2lnbnVwQnRuKSB7XG4gICAgICAgIHNpZ251cEJ0bi5kaXNhYmxlZCA9ICFpc0NoZWNrZWQ7XG4gICAgICB9XG4gICAgICBpZiAoZ29vZ2xlU2lnblVwQnRuKSB7XG4gICAgICAgIGdvb2dsZVNpZ25VcEJ0bi5kaXNhYmxlZCA9ICFpc0NoZWNrZWQ7XG4gICAgICB9XG5cbiAgICAgIC8vIEhpZGUvc2hvdyBUb1Mgc3RhdHVzIG1lc3NhZ2VcbiAgICAgIGlmICh0b3NTdGF0dXNNZXNzYWdlKSB7XG4gICAgICAgIGlmIChpc0NoZWNrZWQpIHtcbiAgICAgICAgICB0b3NTdGF0dXNNZXNzYWdlLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdG9zU3RhdHVzTWVzc2FnZS5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICghaXNDaGVja2VkKSB7XG4gICAgICAgIHNob3dFcnJvcihcbiAgICAgICAgICBcIlZldWlsbGV6IGFjY2VwdGVyIGxlcyBDb25kaXRpb25zIEfDqW7DqXJhbGVzIGQnVXRpbGlzYXRpb24uXCIsXG4gICAgICAgICAgXCJlcnJvck1lc3NhZ2VcIlxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gQ2xlYXIgVG9TLXJlbGF0ZWQgZXJyb3IgbWVzc2FnZXNcbiAgICAgICAgY29uc3QgZXJyb3JFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJlcnJvck1lc3NhZ2VcIik7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBlcnJvckVsZW1lbnQgJiZcbiAgICAgICAgICBlcnJvckVsZW1lbnQuaW5uZXJIVE1MLmluY2x1ZGVzKFwiQ29uZGl0aW9ucyBHw6luw6lyYWxlcyBkJ1V0aWxpc2F0aW9uXCIpXG4gICAgICAgICkge1xuICAgICAgICAgIGhpZGVFbGVtZW50KFwiZXJyb3JNZXNzYWdlXCIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbiAgLy8gLS0tIEVuZCBUZXJtcyBvZiBTZXJ2aWNlIExvZ2ljIGZvciBTaWdudXAgLS0tXG5cbiAgaWYgKCF0dXJuc3RpbGVDb250YWluZXIpIHtcbiAgICBjb25zb2xlLmVycm9yKFxuICAgICAgXCIjdHVybnN0aWxlLWNvbnRhaW5lciBub3QgZm91bmQgaW4gdGhlIERPTS4gQ0FQVENIQSBjYW5ub3QgYmUgcmVuZGVyZWQuXCJcbiAgICApO1xuICB9XG5cbiAgaWYgKHNpZ251cEZvcm0pIHtcbiAgICBzaWdudXBGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgYXN5bmMgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgY29uc3QgZW1haWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImVtYWlsXCIpLnZhbHVlLnRyaW0oKTtcbiAgICAgIGNvbnN0IHBhc3N3b3JkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwYXNzd29yZFwiKS52YWx1ZTtcbiAgICAgIGNvbnN0IGNvbmZpcm1QYXNzd29yZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29uZmlybVBhc3N3b3JkXCIpLnZhbHVlO1xuICAgICAgbGV0IHBob25lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwaG9uZVwiKS52YWx1ZS50cmltKCk7IC8vIEdldCBwaG9uZSBudW1iZXJcblxuICAgICAgbGV0IHZhbGlkYXRpb25FcnJvcnMgPSBbXTtcbiAgICAgIGNvbnN0IGVtYWlsUGF0dGVybiA9IC9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvO1xuICAgICAgaWYgKCFlbWFpbFBhdHRlcm4udGVzdChlbWFpbCkpXG4gICAgICAgIHZhbGlkYXRpb25FcnJvcnMucHVzaChcIkwnYWRyZXNzZSBlbWFpbCBuJ2VzdCBwYXMgdmFsaWRlLlwiKTtcbiAgICAgIGlmIChwYXNzd29yZCAhPT0gY29uZmlybVBhc3N3b3JkKVxuICAgICAgICB2YWxpZGF0aW9uRXJyb3JzLnB1c2goXCJMZXMgbW90cyBkZSBwYXNzZSBuZSBjb3JyZXNwb25kZW50IHBhcy5cIik7XG4gICAgICBjb25zdCBwYXNzd29yZENvbXBsZXhpdHlQYXR0ZXJuID0gL14oPz0uKlthLXpdKSg/PS4qW0EtWl0pKD89LipcXGQpLiskLztcbiAgICAgIGlmICghcGFzc3dvcmRDb21wbGV4aXR5UGF0dGVybi50ZXN0KHBhc3N3b3JkKSB8fCBwYXNzd29yZC5sZW5ndGggPCA4KVxuICAgICAgICB2YWxpZGF0aW9uRXJyb3JzLnB1c2goXCJMZSBmb3JtYXQgZHUgbW90IGRlIHBhc3NlIGVzdCBpbnZhbGlkZS5cIik7XG4gICAgICBpZiAoIXBob25lKSB2YWxpZGF0aW9uRXJyb3JzLnB1c2goXCJMZSBudW3DqXJvIGRlIHTDqWzDqXBob25lIGVzdCByZXF1aXMuXCIpO1xuICAgICAgLy8gQmFzaWMgcGhvbmUgdmFsaWRhdGlvbiAoeW91IG1pZ2h0IHdhbnQgYSBtb3JlIHJvYnVzdCBvbmUpXG4gICAgICBjb25zdCBwaG9uZVBhdHRlcm4gPSAvXigwfFxcKzMzKVsxLTldXFxkezh9JC87IC8vIEV4YW1wbGU6IDA2MTIzNDU2Nzggb3IgKzMzNjEyMzQ1Njc4XG4gICAgICBpZiAocGhvbmUgJiYgIXBob25lUGF0dGVybi50ZXN0KHBob25lKSlcbiAgICAgICAgdmFsaWRhdGlvbkVycm9ycy5wdXNoKFxuICAgICAgICAgIFwiTGUgZm9ybWF0IGR1IG51bcOpcm8gZGUgdMOpbMOpcGhvbmUgZXN0IGludmFsaWRlIChleDogMDYxMjM0NTY3OCBvdSArMzM2MTIzNDU2NzgpLlwiXG4gICAgICAgICk7XG5cbiAgICAgIGlmICghY2FwdGNoYVRva2VuKSB7XG4gICAgICAgIC8vIENoZWNrIGlmIGNhcHRjaGEgaXMgc29sdmVkXG4gICAgICAgIHZhbGlkYXRpb25FcnJvcnMucHVzaChcIlZldWlsbGV6IGNvbXBsw6l0ZXIgbGUgQ0FQVENIQS5cIik7XG4gICAgICB9XG5cbiAgICAgIGlmICghdG9zQ2hlY2tib3ggfHwgIXRvc0NoZWNrYm94LmNoZWNrZWQpIHtcbiAgICAgICAgdmFsaWRhdGlvbkVycm9ycy5wdXNoKFxuICAgICAgICAgIFwiVmV1aWxsZXogbGlyZSBldCBhY2NlcHRlciBsZXMgQ29uZGl0aW9ucyBHw6luw6lyYWxlcyBkJ1V0aWxpc2F0aW9uLlwiXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGlmICh2YWxpZGF0aW9uRXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgc2hvd0Vycm9yKHZhbGlkYXRpb25FcnJvcnMuam9pbihcIjxicj5cIikpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHNob3dMb2FkaW5nKFwic2lnbnVwQnRuXCIsIFwic2lnbnVwU3Bpbm5lclwiKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGxldCBlMTY0UGhvbmUgPSBwaG9uZTtcbiAgICAgICAgaWYgKHBob25lLnN0YXJ0c1dpdGgoXCIwXCIpKSB7XG4gICAgICAgICAgZTE2NFBob25lID0gYCszMyR7cGhvbmUuc3Vic3RyaW5nKDEpfWA7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTdGVwIDE6IFNpZ24gdXAgd2l0aCBlbWFpbCBhbmQgcGFzc3dvcmRcbiAgICAgICAgY29uc3QgeyBkYXRhLCBlcnJvcjogc2lnblVwRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnblVwKHtcbiAgICAgICAgICBlbWFpbCxcbiAgICAgICAgICBwYXNzd29yZCxcbiAgICAgICAgICBvcHRpb25zOiB7IGNhcHRjaGFUb2tlbiB9LCAvLyBQYXNzIGNhcHRjaGEgdG9rZW5cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHNpZ25VcEVycm9yKSB0aHJvdyBzaWduVXBFcnJvcjtcbiAgICAgICAgaWYgKCFkYXRhLnVzZXIpXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRXJyZXVyIGxvcnMgZGUgbGEgY3LDqWF0aW9uIGRlIGwndXRpbGlzYXRldXIuXCIpO1xuXG4gICAgICAgIC8vIFN0ZXAgMjogVXBkYXRlIHByb2ZpbGUgd2l0aCBwaG9uZSBudW1iZXIgaWYgcHJvdmlkZWRcbiAgICAgICAgLy8gTm90ZTogVGhlIHByb2ZpbGUgc2hvdWxkIGJlIGF1dG9tYXRpY2FsbHkgY3JlYXRlZCBieSB0aGUgZGF0YWJhc2UgdHJpZ2dlclxuICAgICAgICBpZiAoZTE2NFBob25lICYmIGRhdGEudXNlci5pZCkge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBXYWl0IGEgbW9tZW50IGZvciB0aGUgdHJpZ2dlciB0byBjcmVhdGUgdGhlIHByb2ZpbGVcbiAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMCkpO1xuXG4gICAgICAgICAgICBjb25zdCB7IGVycm9yOiBwcm9maWxlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgICAgICAgIC5mcm9tKFwicHJvZmlsZXNcIilcbiAgICAgICAgICAgICAgLnVwZGF0ZSh7IHBob25lOiBlMTY0UGhvbmUgfSlcbiAgICAgICAgICAgICAgLmVxKFwiaWRcIiwgZGF0YS51c2VyLmlkKTtcblxuICAgICAgICAgICAgaWYgKHByb2ZpbGVFcnJvcikge1xuICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICAgICAgXCJDb3VsZCBub3QgdXBkYXRlIHByb2ZpbGUgd2l0aCBwaG9uZSBudW1iZXI6XCIsXG4gICAgICAgICAgICAgICAgcHJvZmlsZUVycm9yXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIC8vIERvbid0IHRocm93IGVycm9yIGhlcmUgYXMgdGhlIG1haW4gc2lnbnVwIHdhcyBzdWNjZXNzZnVsXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBjYXRjaCAocHJvZmlsZVVwZGF0ZUVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXCJQcm9maWxlIHVwZGF0ZSBmYWlsZWQ6XCIsIHByb2ZpbGVVcGRhdGVFcnJvcik7XG4gICAgICAgICAgICAvLyBEb24ndCB0aHJvdyBlcnJvciBoZXJlIGFzIHRoZSBtYWluIHNpZ251cCB3YXMgc3VjY2Vzc2Z1bFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNob3cgc3VjY2VzcyBtZXNzYWdlIHdpdGggZGV0YWlsZWQgaW5zdHJ1Y3Rpb25zXG4gICAgICAgIHNob3dTaWdudXBTdWNjZXNzKGVtYWlsKTtcblxuICAgICAgICAvLyBIaWRlIHRoZSBmb3JtIGFuZCByZXNldCBpdFxuICAgICAgICBpZiAoc2lnbnVwRm9ybSkge1xuICAgICAgICAgIHNpZ251cEZvcm0uY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTsgLy8gSGlkZSB0aGUgZm9ybVxuICAgICAgICAgIHNpZ251cEZvcm0ucmVzZXQoKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVtYWlsL1Bhc3N3b3JkIFNpZ251cCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICBsZXQgZGlzcGxheUVycm9yID0gZXJyb3IubWVzc2FnZSB8fCBcIlVuZSBlcnJldXIgZXN0IHN1cnZlbnVlLlwiO1xuICAgICAgICBpZiAoXG4gICAgICAgICAgZXJyb3IubWVzc2FnZSAmJlxuICAgICAgICAgIGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoXCJVc2VyIGFscmVhZHkgcmVnaXN0ZXJlZFwiKVxuICAgICAgICApIHtcbiAgICAgICAgICBkaXNwbGF5RXJyb3IgPVxuICAgICAgICAgICAgXCJDZXR0ZSBhZHJlc3NlIGVtYWlsIGVzdCBkw6lqw6AgdXRpbGlzw6llLiBWZXVpbGxleiB2b3VzIGNvbm5lY3RlciBvdSB1dGlsaXNlciB1bmUgYXV0cmUgYWRyZXNzZS5cIjtcbiAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICBlcnJvci5tZXNzYWdlICYmXG4gICAgICAgICAgZXJyb3IubWVzc2FnZS5pbmNsdWRlcyhcIlVuYWJsZSB0byB2YWxpZGF0ZSBwaG9uZSBudW1iZXJcIilcbiAgICAgICAgKSB7XG4gICAgICAgICAgZGlzcGxheUVycm9yID0gXCJMZSBudW3DqXJvIGRlIHTDqWzDqXBob25lIGZvdXJuaSBuJ2VzdCBwYXMgdmFsaWRlLlwiO1xuICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgIGVycm9yLm1lc3NhZ2UgJiZcbiAgICAgICAgICBlcnJvci5tZXNzYWdlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJjYXB0Y2hhIHByb3RlY3Rpb25cIilcbiAgICAgICAgKSB7XG4gICAgICAgICAgZGlzcGxheUVycm9yID1cbiAgICAgICAgICAgIFwiRXJyZXVyIENBUFRDSEEgZHUgc2VydmV1ci4gVmV1aWxsZXogcsOpZXNzYXllci4gKFwiICtcbiAgICAgICAgICAgIGVycm9yLm1lc3NhZ2UgK1xuICAgICAgICAgICAgXCIpXCI7XG4gICAgICAgIH1cbiAgICAgICAgc2hvd0Vycm9yKGRpc3BsYXlFcnJvcik7XG4gICAgICB9IGZpbmFsbHkge1xuICAgICAgICBoaWRlTG9hZGluZyhcInNpZ251cEJ0blwiLCBcInNpZ251cFNwaW5uZXJcIik7XG4gICAgICAgIGlmICh3aW5kb3cudHVybnN0aWxlICYmIHR1cm5zdGlsZVdpZGdldElkKSB7XG4gICAgICAgICAgd2luZG93LnR1cm5zdGlsZS5yZXNldCh0dXJuc3RpbGVXaWRnZXRJZCk7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJUdXJuc3RpbGUgd2lkZ2V0IGhhcyBiZWVuIHJlc2V0LlwiKTtcbiAgICAgICAgfVxuICAgICAgICBjYXB0Y2hhVG9rZW4gPSBudWxsOyAvLyBDbGVhciB0b2tlbiBhZnRlciB1c2VcbiAgICAgIH1cbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmVycm9yKFwiU2lnbnVwIGZvcm0gKHNpZ251cEZvcm0pIG5vdCBmb3VuZC5cIik7XG4gIH1cblxuICBpZiAoZ29vZ2xlU2lnblVwQnRuKSB7XG4gICAgZ29vZ2xlU2lnblVwQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBzaG93TG9hZGluZyhcImdvb2dsZVNpZ25VcEJ0blwiLCBcImdvb2dsZVNpZ25VcFNwaW5uZXJcIik7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLnNpZ25JbldpdGhPQXV0aCh7XG4gICAgICAgICAgcHJvdmlkZXI6IFwiZ29vZ2xlXCIsXG4gICAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgLy8gR29vZ2xlIE9BdXQgaCB3aWxsIGhhbmRsZSB0aGUgcmVkaXJlY3QgYWZ0ZXIgc3VjY2Vzc2Z1bCBhdXRoZW50aWNhdGlvblxuICAgICAgICAgICAgLy8gTm8gY3VzdG9tIHJlZGlyZWN0VG8gbmVlZGVkIC0gbGV0IFN1cGFiYXNlIGhhbmRsZSB0aGUgZGVmYXVsdCBmbG93XG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzaWduaW5nIHVwIHdpdGggR29vZ2xlOlwiLCBlcnJvcik7XG4gICAgICAgICAgc2hvd0Vycm9yKFxuICAgICAgICAgICAgZXJyb3IubWVzc2FnZSB8fCBcIkVycmV1ciBsb3JzIGRlIGwnaW5zY3JpcHRpb24gYXZlYyBHb29nbGUuXCJcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIC8vIE9uIHN1Y2Nlc3MsIFN1cGFiYXNlIGhhbmRsZXMgdGhlIHJlZGlyZWN0IGF1dG9tYXRpY2FsbHlcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFeGNlcHRpb24gZHVyaW5nIEdvb2dsZSBzaWduLXVwOlwiLCBlcnJvcik7XG4gICAgICAgIHNob3dFcnJvcihcbiAgICAgICAgICBcIlVuZSBleGNlcHRpb24gZXN0IHN1cnZlbnVlIGxvcnMgZGUgbCdpbnNjcmlwdGlvbiBhdmVjIEdvb2dsZS5cIlxuICAgICAgICApO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgaGlkZUxvYWRpbmcoXCJnb29nbGVTaWduVXBCdG5cIiwgXCJnb29nbGVTaWduVXBTcGlubmVyXCIpO1xuICAgICAgfVxuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUud2FybihcIkdvb2dsZSBTaWduLVVwIGJ1dHRvbiAoZ29vZ2xlU2lnblVwQnRuKSBub3QgZm91bmQuXCIpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgaW5pdFNpZ251cFBhZ2UsXG59O1xuIiwiLy8gc3JjL2VudHJpZXMvc2lnbnVwLmpzXG4vKipcbiAqIFNpZ251cCBFbnRyeSBQb2ludFxuICpcbiAqIFRoaXMgbW9kdWxlIHNlcnZlcyBhcyB0aGUgZW50cnkgcG9pbnQgZm9yIHRoZSBzaWdudXAgcGFnZS5cbiAqL1xuXG4vLyBJbXBvcnQgb3VyIHNpZ251cCBtb2R1bGVcbmltcG9ydCB7IGluaXRTaWdudXBQYWdlIH0gZnJvbSBcIi4uL2F1dGgvc2lnbnVwLmpzXCI7XG5cbi8vIEluaXRpYWxpemUgc2lnbnVwIHBhZ2Ugd2hlbiBET00gaXMgbG9hZGVkXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCAoKSA9PiB7XG4gIC8vIEluaXRpYWxpemUgc2lnbnVwIHBhZ2VcbiAgaW5pdFNpZ251cFBhZ2UoKTtcblxuICBjb25zb2xlLmxvZyhcIlNpZ251cCBwYWdlIGluaXRpYWxpemVkXCIpO1xufSk7XG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuLy8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbl9fd2VicGFja19yZXF1aXJlX18ubSA9IF9fd2VicGFja19tb2R1bGVzX187XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18uZiA9IHt9O1xuLy8gVGhpcyBmaWxlIGNvbnRhaW5zIG9ubHkgdGhlIGVudHJ5IGNodW5rLlxuLy8gVGhlIGNodW5rIGxvYWRpbmcgZnVuY3Rpb24gZm9yIGFkZGl0aW9uYWwgY2h1bmtzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmUgPSAoY2h1bmtJZCkgPT4ge1xuXHRyZXR1cm4gUHJvbWlzZS5hbGwoT2JqZWN0LmtleXMoX193ZWJwYWNrX3JlcXVpcmVfXy5mKS5yZWR1Y2UoKHByb21pc2VzLCBrZXkpID0+IHtcblx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmZba2V5XShjaHVua0lkLCBwcm9taXNlcyk7XG5cdFx0cmV0dXJuIHByb21pc2VzO1xuXHR9LCBbXSkpO1xufTsiLCIvLyBUaGlzIGZ1bmN0aW9uIGFsbG93IHRvIHJlZmVyZW5jZSBhc3luYyBjaHVua3Ncbl9fd2VicGFja19yZXF1aXJlX18udSA9IChjaHVua0lkKSA9PiB7XG5cdC8vIHJldHVybiB1cmwgZm9yIGZpbGVuYW1lcyBiYXNlZCBvbiB0ZW1wbGF0ZVxuXHRyZXR1cm4gXCJqcy9cIiArIGNodW5rSWQgKyBcIi5idW5kbGUuanNcIjtcbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5nID0gKGZ1bmN0aW9uKCkge1xuXHRpZiAodHlwZW9mIGdsb2JhbFRoaXMgPT09ICdvYmplY3QnKSByZXR1cm4gZ2xvYmFsVGhpcztcblx0dHJ5IHtcblx0XHRyZXR1cm4gdGhpcyB8fCBuZXcgRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTtcblx0fSBjYXRjaCAoZSkge1xuXHRcdGlmICh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JykgcmV0dXJuIHdpbmRvdztcblx0fVxufSkoKTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5qID0gNzg3OyIsInZhciBzY3JpcHRVcmw7XG5pZiAoX193ZWJwYWNrX3JlcXVpcmVfXy5nLmltcG9ydFNjcmlwdHMpIHNjcmlwdFVybCA9IF9fd2VicGFja19yZXF1aXJlX18uZy5sb2NhdGlvbiArIFwiXCI7XG52YXIgZG9jdW1lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLmcuZG9jdW1lbnQ7XG5pZiAoIXNjcmlwdFVybCAmJiBkb2N1bWVudCkge1xuXHRpZiAoZG9jdW1lbnQuY3VycmVudFNjcmlwdCAmJiBkb2N1bWVudC5jdXJyZW50U2NyaXB0LnRhZ05hbWUudG9VcHBlckNhc2UoKSA9PT0gJ1NDUklQVCcpXG5cdFx0c2NyaXB0VXJsID0gZG9jdW1lbnQuY3VycmVudFNjcmlwdC5zcmM7XG5cdGlmICghc2NyaXB0VXJsKSB7XG5cdFx0dmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNjcmlwdFwiKTtcblx0XHRpZihzY3JpcHRzLmxlbmd0aCkge1xuXHRcdFx0dmFyIGkgPSBzY3JpcHRzLmxlbmd0aCAtIDE7XG5cdFx0XHR3aGlsZSAoaSA+IC0xICYmICghc2NyaXB0VXJsIHx8ICEvXmh0dHAocz8pOi8udGVzdChzY3JpcHRVcmwpKSkgc2NyaXB0VXJsID0gc2NyaXB0c1tpLS1dLnNyYztcblx0XHR9XG5cdH1cbn1cbi8vIFdoZW4gc3VwcG9ydGluZyBicm93c2VycyB3aGVyZSBhbiBhdXRvbWF0aWMgcHVibGljUGF0aCBpcyBub3Qgc3VwcG9ydGVkIHlvdSBtdXN0IHNwZWNpZnkgYW4gb3V0cHV0LnB1YmxpY1BhdGggbWFudWFsbHkgdmlhIGNvbmZpZ3VyYXRpb25cbi8vIG9yIHBhc3MgYW4gZW1wdHkgc3RyaW5nIChcIlwiKSBhbmQgc2V0IHRoZSBfX3dlYnBhY2tfcHVibGljX3BhdGhfXyB2YXJpYWJsZSBmcm9tIHlvdXIgY29kZSB0byB1c2UgeW91ciBvd24gbG9naWMuXG5pZiAoIXNjcmlwdFVybCkgdGhyb3cgbmV3IEVycm9yKFwiQXV0b21hdGljIHB1YmxpY1BhdGggaXMgbm90IHN1cHBvcnRlZCBpbiB0aGlzIGJyb3dzZXJcIik7XG5zY3JpcHRVcmwgPSBzY3JpcHRVcmwucmVwbGFjZSgvXmJsb2I6LywgXCJcIikucmVwbGFjZSgvIy4qJC8sIFwiXCIpLnJlcGxhY2UoL1xcPy4qJC8sIFwiXCIpLnJlcGxhY2UoL1xcL1teXFwvXSskLywgXCIvXCIpO1xuX193ZWJwYWNrX3JlcXVpcmVfXy5wID0gc2NyaXB0VXJsICsgXCIuLi9cIjsiLCIvLyBubyBiYXNlVVJJXG5cbi8vIG9iamVjdCB0byBzdG9yZSBsb2FkZWQgYW5kIGxvYWRpbmcgY2h1bmtzXG4vLyB1bmRlZmluZWQgPSBjaHVuayBub3QgbG9hZGVkLCBudWxsID0gY2h1bmsgcHJlbG9hZGVkL3ByZWZldGNoZWRcbi8vIFtyZXNvbHZlLCByZWplY3QsIFByb21pc2VdID0gY2h1bmsgbG9hZGluZywgMCA9IGNodW5rIGxvYWRlZFxudmFyIGluc3RhbGxlZENodW5rcyA9IHtcblx0Nzg3OiAwXG59O1xuXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmYuaiA9IChjaHVua0lkLCBwcm9taXNlcykgPT4ge1xuXHRcdC8vIEpTT05QIGNodW5rIGxvYWRpbmcgZm9yIGphdmFzY3JpcHRcblx0XHR2YXIgaW5zdGFsbGVkQ2h1bmtEYXRhID0gX193ZWJwYWNrX3JlcXVpcmVfXy5vKGluc3RhbGxlZENodW5rcywgY2h1bmtJZCkgPyBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gOiB1bmRlZmluZWQ7XG5cdFx0aWYoaW5zdGFsbGVkQ2h1bmtEYXRhICE9PSAwKSB7IC8vIDAgbWVhbnMgXCJhbHJlYWR5IGluc3RhbGxlZFwiLlxuXG5cdFx0XHQvLyBhIFByb21pc2UgbWVhbnMgXCJjdXJyZW50bHkgbG9hZGluZ1wiLlxuXHRcdFx0aWYoaW5zdGFsbGVkQ2h1bmtEYXRhKSB7XG5cdFx0XHRcdHByb21pc2VzLnB1c2goaW5zdGFsbGVkQ2h1bmtEYXRhWzJdKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmKHRydWUpIHsgLy8gYWxsIGNodW5rcyBoYXZlIEpTXG5cdFx0XHRcdFx0Ly8gc2V0dXAgUHJvbWlzZSBpbiBjaHVuayBjYWNoZVxuXHRcdFx0XHRcdHZhciBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gKGluc3RhbGxlZENodW5rRGF0YSA9IGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA9IFtyZXNvbHZlLCByZWplY3RdKSk7XG5cdFx0XHRcdFx0cHJvbWlzZXMucHVzaChpbnN0YWxsZWRDaHVua0RhdGFbMl0gPSBwcm9taXNlKTtcblxuXHRcdFx0XHRcdC8vIHN0YXJ0IGNodW5rIGxvYWRpbmdcblx0XHRcdFx0XHR2YXIgdXJsID0gX193ZWJwYWNrX3JlcXVpcmVfXy5wICsgX193ZWJwYWNrX3JlcXVpcmVfXy51KGNodW5rSWQpO1xuXHRcdFx0XHRcdC8vIGNyZWF0ZSBlcnJvciBiZWZvcmUgc3RhY2sgdW53b3VuZCB0byBnZXQgdXNlZnVsIHN0YWNrdHJhY2UgbGF0ZXJcblx0XHRcdFx0XHR2YXIgZXJyb3IgPSBuZXcgRXJyb3IoKTtcblx0XHRcdFx0XHR2YXIgbG9hZGluZ0VuZGVkID0gKGV2ZW50KSA9PiB7XG5cdFx0XHRcdFx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oaW5zdGFsbGVkQ2h1bmtzLCBjaHVua0lkKSkge1xuXHRcdFx0XHRcdFx0XHRpbnN0YWxsZWRDaHVua0RhdGEgPSBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF07XG5cdFx0XHRcdFx0XHRcdGlmKGluc3RhbGxlZENodW5rRGF0YSAhPT0gMCkgaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdID0gdW5kZWZpbmVkO1xuXHRcdFx0XHRcdFx0XHRpZihpbnN0YWxsZWRDaHVua0RhdGEpIHtcblx0XHRcdFx0XHRcdFx0XHR2YXIgZXJyb3JUeXBlID0gZXZlbnQgJiYgKGV2ZW50LnR5cGUgPT09ICdsb2FkJyA/ICdtaXNzaW5nJyA6IGV2ZW50LnR5cGUpO1xuXHRcdFx0XHRcdFx0XHRcdHZhciByZWFsU3JjID0gZXZlbnQgJiYgZXZlbnQudGFyZ2V0ICYmIGV2ZW50LnRhcmdldC5zcmM7XG5cdFx0XHRcdFx0XHRcdFx0ZXJyb3IubWVzc2FnZSA9ICdMb2FkaW5nIGNodW5rICcgKyBjaHVua0lkICsgJyBmYWlsZWQuXFxuKCcgKyBlcnJvclR5cGUgKyAnOiAnICsgcmVhbFNyYyArICcpJztcblx0XHRcdFx0XHRcdFx0XHRlcnJvci5uYW1lID0gJ0NodW5rTG9hZEVycm9yJztcblx0XHRcdFx0XHRcdFx0XHRlcnJvci50eXBlID0gZXJyb3JUeXBlO1xuXHRcdFx0XHRcdFx0XHRcdGVycm9yLnJlcXVlc3QgPSByZWFsU3JjO1xuXHRcdFx0XHRcdFx0XHRcdGluc3RhbGxlZENodW5rRGF0YVsxXShlcnJvcik7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdF9fd2VicGFja19yZXF1aXJlX18ubCh1cmwsIGxvYWRpbmdFbmRlZCwgXCJjaHVuay1cIiArIGNodW5rSWQsIGNodW5rSWQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxufTtcblxuLy8gbm8gcHJlZmV0Y2hpbmdcblxuLy8gbm8gcHJlbG9hZGVkXG5cbi8vIG5vIEhNUlxuXG4vLyBubyBITVIgbWFuaWZlc3RcblxuX193ZWJwYWNrX3JlcXVpcmVfXy5PLmogPSAoY2h1bmtJZCkgPT4gKGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA9PT0gMCk7XG5cbi8vIGluc3RhbGwgYSBKU09OUCBjYWxsYmFjayBmb3IgY2h1bmsgbG9hZGluZ1xudmFyIHdlYnBhY2tKc29ucENhbGxiYWNrID0gKHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uLCBkYXRhKSA9PiB7XG5cdHZhciBbY2h1bmtJZHMsIG1vcmVNb2R1bGVzLCBydW50aW1lXSA9IGRhdGE7XG5cdC8vIGFkZCBcIm1vcmVNb2R1bGVzXCIgdG8gdGhlIG1vZHVsZXMgb2JqZWN0LFxuXHQvLyB0aGVuIGZsYWcgYWxsIFwiY2h1bmtJZHNcIiBhcyBsb2FkZWQgYW5kIGZpcmUgY2FsbGJhY2tcblx0dmFyIG1vZHVsZUlkLCBjaHVua0lkLCBpID0gMDtcblx0aWYoY2h1bmtJZHMuc29tZSgoaWQpID0+IChpbnN0YWxsZWRDaHVua3NbaWRdICE9PSAwKSkpIHtcblx0XHRmb3IobW9kdWxlSWQgaW4gbW9yZU1vZHVsZXMpIHtcblx0XHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhtb3JlTW9kdWxlcywgbW9kdWxlSWQpKSB7XG5cdFx0XHRcdF9fd2VicGFja19yZXF1aXJlX18ubVttb2R1bGVJZF0gPSBtb3JlTW9kdWxlc1ttb2R1bGVJZF07XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmKHJ1bnRpbWUpIHZhciByZXN1bHQgPSBydW50aW1lKF9fd2VicGFja19yZXF1aXJlX18pO1xuXHR9XG5cdGlmKHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uKSBwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbihkYXRhKTtcblx0Zm9yKDtpIDwgY2h1bmtJZHMubGVuZ3RoOyBpKyspIHtcblx0XHRjaHVua0lkID0gY2h1bmtJZHNbaV07XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGluc3RhbGxlZENodW5rcywgY2h1bmtJZCkgJiYgaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdKSB7XG5cdFx0XHRpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF1bMF0oKTtcblx0XHR9XG5cdFx0aW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdID0gMDtcblx0fVxuXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXy5PKHJlc3VsdCk7XG59XG5cbnZhciBjaHVua0xvYWRpbmdHbG9iYWwgPSBzZWxmW1wid2VicGFja0NodW5rdXJiYW5kb2NzX3dlYmFwcFwiXSA9IHNlbGZbXCJ3ZWJwYWNrQ2h1bmt1cmJhbmRvY3Nfd2ViYXBwXCJdIHx8IFtdO1xuY2h1bmtMb2FkaW5nR2xvYmFsLmZvckVhY2god2VicGFja0pzb25wQ2FsbGJhY2suYmluZChudWxsLCAwKSk7XG5jaHVua0xvYWRpbmdHbG9iYWwucHVzaCA9IHdlYnBhY2tKc29ucENhbGxiYWNrLmJpbmQobnVsbCwgY2h1bmtMb2FkaW5nR2xvYmFsLnB1c2guYmluZChjaHVua0xvYWRpbmdHbG9iYWwpKTsiLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGRlcGVuZHMgb24gb3RoZXIgbG9hZGVkIGNodW5rcyBhbmQgZXhlY3V0aW9uIG5lZWQgdG8gYmUgZGVsYXllZFxudmFyIF9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fLk8odW5kZWZpbmVkLCBbNzZdLCAoKSA9PiAoX193ZWJwYWNrX3JlcXVpcmVfXyg0ODEwKSkpXG5fX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXy5PKF9fd2VicGFja19leHBvcnRzX18pO1xuIl0sIm5hbWVzIjpbImRlZmVycmVkIiwibGVhZlByb3RvdHlwZXMiLCJnZXRQcm90byIsImluUHJvZ3Jlc3MiLCJkYXRhV2VicGFja1ByZWZpeCIsImNhcHRjaGFUb2tlbiIsInR1cm5zdGlsZVdpZGdldElkIiwid2luZG93Iiwib25sb2FkVHVybnN0aWxlQ2FsbGJhY2siLCJjb25zb2xlIiwibG9nIiwidHVybnN0aWxlQ29udGFpbmVyIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInR1cm5zdGlsZSIsInJlbmRlciIsInNpdGVrZXkiLCJjYWxsYmFjayIsInRva2VuIiwicmVzZXQiLCJlcnIiLCJlcnJvciIsInVuZGVmaW5lZCIsImUiLCJhZGRFdmVudExpc3RlbmVyIiwic2lnbnVwRm9ybSIsImdvb2dsZVNpZ25VcEJ0biIsInRvc0NoZWNrYm94IiwidG9zTW9kYWxFbGVtZW50IiwidG9zTW9kYWxCb2R5Iiwic2lnbnVwQnRuIiwidG9zU3RhdHVzTWVzc2FnZSIsInRvc0xpbmsiLCJ0b3NNb2RhbENsb3NlIiwiaGlkZU1vZGFsIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwic3R5bGUiLCJkaXNwbGF5IiwiYm9keSIsIm92ZXJmbG93IiwiZGlzYWJsZWQiLCJwcmV2ZW50RGVmYXVsdCIsImFkZCIsImRhdGFzZXQiLCJsb2FkZWQiLCJhc3luYyIsImlubmVySFRNTCIsInJlc3BvbnNlIiwiZmV0Y2giLCJvayIsIkVycm9yIiwic3RhdHVzIiwidG9zSHRtbCIsInRleHQiLCJkb2MiLCJET01QYXJzZXIiLCJwYXJzZUZyb21TdHJpbmciLCJtYWluQ29udGVudCIsInF1ZXJ5U2VsZWN0b3IiLCJzY3JvbGxUb3AiLCJsb2FkVG9TQ29udGVudCIsInRhcmdldCIsImlzQ2hlY2tlZCIsImNoZWNrZWQiLCJlcnJvckVsZW1lbnQiLCJpbmNsdWRlcyIsImVtYWlsIiwidmFsdWUiLCJ0cmltIiwicGFzc3dvcmQiLCJjb25maXJtUGFzc3dvcmQiLCJwaG9uZSIsInZhbGlkYXRpb25FcnJvcnMiLCJ0ZXN0IiwicHVzaCIsImxlbmd0aCIsImpvaW4iLCJlMTY0UGhvbmUiLCJzdGFydHNXaXRoIiwic3Vic3RyaW5nIiwiZGF0YSIsInNpZ25VcEVycm9yIiwiYXV0aCIsInNpZ25VcCIsIm9wdGlvbnMiLCJ1c2VyIiwiaWQiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJwcm9maWxlRXJyb3IiLCJmcm9tIiwidXBkYXRlIiwiZXEiLCJ3YXJuIiwicHJvZmlsZVVwZGF0ZUVycm9yIiwic3RhdHVzRWxlbWVudCIsInNob3dTaWdudXBTdWNjZXNzIiwiZGlzcGxheUVycm9yIiwibWVzc2FnZSIsInRvTG93ZXJDYXNlIiwic2lnbkluV2l0aE9BdXRoIiwicHJvdmlkZXIiLCJpbml0U2lnbnVwUGFnZSIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiY2FsbCIsIm0iLCJPIiwicmVzdWx0IiwiY2h1bmtJZHMiLCJmbiIsInByaW9yaXR5Iiwibm90RnVsZmlsbGVkIiwiSW5maW5pdHkiLCJpIiwiZnVsZmlsbGVkIiwiaiIsIk9iamVjdCIsImtleXMiLCJldmVyeSIsImtleSIsInNwbGljZSIsInIiLCJnZXRQcm90b3R5cGVPZiIsIm9iaiIsInQiLCJtb2RlIiwidGhpcyIsIl9fZXNNb2R1bGUiLCJ0aGVuIiwibnMiLCJjcmVhdGUiLCJkZWYiLCJjdXJyZW50IiwiaW5kZXhPZiIsImdldE93blByb3BlcnR5TmFtZXMiLCJmb3JFYWNoIiwiZCIsImRlZmluaXRpb24iLCJvIiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiZiIsImNodW5rSWQiLCJhbGwiLCJyZWR1Y2UiLCJwcm9taXNlcyIsInUiLCJnIiwiZ2xvYmFsVGhpcyIsIkZ1bmN0aW9uIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwibCIsInVybCIsImRvbmUiLCJzY3JpcHQiLCJuZWVkQXR0YWNoIiwic2NyaXB0cyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwicyIsImdldEF0dHJpYnV0ZSIsImNyZWF0ZUVsZW1lbnQiLCJjaGFyc2V0IiwidGltZW91dCIsIm5jIiwic2V0QXR0cmlidXRlIiwic3JjIiwib25TY3JpcHRDb21wbGV0ZSIsInByZXYiLCJldmVudCIsIm9uZXJyb3IiLCJvbmxvYWQiLCJjbGVhclRpbWVvdXQiLCJkb25lRm5zIiwicGFyZW50Tm9kZSIsInJlbW92ZUNoaWxkIiwiYmluZCIsInR5cGUiLCJoZWFkIiwiYXBwZW5kQ2hpbGQiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInNjcmlwdFVybCIsImltcG9ydFNjcmlwdHMiLCJsb2NhdGlvbiIsImN1cnJlbnRTY3JpcHQiLCJ0YWdOYW1lIiwidG9VcHBlckNhc2UiLCJyZXBsYWNlIiwicCIsImluc3RhbGxlZENodW5rcyIsImluc3RhbGxlZENodW5rRGF0YSIsInByb21pc2UiLCJyZWplY3QiLCJlcnJvclR5cGUiLCJyZWFsU3JjIiwibmFtZSIsInJlcXVlc3QiLCJ3ZWJwYWNrSnNvbnBDYWxsYmFjayIsInBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uIiwibW9yZU1vZHVsZXMiLCJydW50aW1lIiwic29tZSIsImNodW5rTG9hZGluZ0dsb2JhbCIsInNlbGYiLCJfX3dlYnBhY2tfZXhwb3J0c19fIl0sInNvdXJjZVJvb3QiOiIifQ==