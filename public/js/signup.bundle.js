(()=>{"use strict";var e,t,n,r,o,s={797:(e,t,n)=>{const r=(0,n(303).UU)("https://ofeyssipibktmbfebibo.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9mZXlzc2lwaWJrdG1iZmViaWJvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM5MjUwOTQsImV4cCI6MjA1OTUwMTA5NH0.w71CAKfolktzRl-TmLVhHYaEbhCfVk4A7YraEUCglrU");function o(e,t="errorMessage"){const n=document.getElementById(t);n?(n.innerHTML=e,n.classList.remove("hidden")):console.error("Error element not found:",t)}function s(e,t){const n=document.getElementById(e),r=document.getElementById(t);n&&(n.disabled=!0),r&&r.classList.remove("hidden")}function i(e,t){const n=document.getElementById(e),r=document.getElementById(t);n&&(n.disabled=!1),r&&r.classList.add("hidden")}let l=null,a=null;function d(){console.log("initSignupPage called");const e=document.getElementById("signupForm"),t=document.getElementById("errorMessage"),n=document.getElementById("statusMessage"),d=document.getElementById("googleSignUpBtn");document.getElementById("turnstile-container")||console.error("#turnstile-container not found in the DOM. CAPTCHA cannot be rendered."),e?e.addEventListener("submit",(async d=>{d.preventDefault(),t&&t.classList.add("hidden"),n&&n.classList.add("hidden");const u=document.getElementById("email").value.trim(),c=document.getElementById("password").value,p=document.getElementById("confirmPassword").value;let g=document.getElementById("phone").value.trim(),m=[];if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u)||m.push("L'adresse email n'est pas valide."),c!==p&&m.push("Les mots de passe ne correspondent pas."),(!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/.test(c)||c.length<8)&&m.push("Le format du mot de passe est invalide."),g||m.push("Le numéro de téléphone est requis."),g&&!/^(0|\+33)[1-9]\d{8}$/.test(g)&&m.push("Le format du numéro de téléphone est invalide (ex: 0612345678 ou +33612345678)."),l||m.push("Veuillez compléter le CAPTCHA."),m.length>0)o(m.join("<br>"));else{s("signupBtn","signupSpinner");try{g.startsWith("0")&&(e164Phone=`+33${g.substring(1)}`);const{data:t,error:n}=await r.auth.signUp({email:u,password:c,options:{captchaToken:l}});if(n)throw n;if(!t.user)throw new Error("Erreur lors de la création de l'utilisateur.");(function(e,t="info",n="statusMessage"){const r=document.getElementById(n);r?(r.textContent=e,r.classList.forEach((e=>{e.startsWith("alert-")&&r.classList.remove(e)})),r.classList.add(`alert-${t}`),r.classList.remove("hidden")):console.error("Status element not found:",n)})("Compte créé ! Un email de confirmation a été envoyé.","success"),e&&(e.classList.add("hidden"),e.reset())}catch(e){console.error("Email/Password Signup error:",e);let t=e.message||"Une erreur est survenue.";e.message&&e.message.includes("User already registered")?t="Cette adresse email est déjà utilisée. Veuillez vous connecter ou utiliser une autre adresse.":e.message&&e.message.includes("Unable to validate phone number")?t="Le numéro de téléphone fourni n'est pas valide.":e.message&&e.message.toLowerCase().includes("captcha protection")&&(t="Erreur CAPTCHA du serveur. Veuillez réessayer. ("+e.message+")"),o(t)}finally{i("signupBtn","signupSpinner"),window.turnstile&&a&&(window.turnstile.reset(a),console.log("Turnstile widget has been reset.")),l=null}}})):console.error("Signup form (signupForm) not found."),d?d.addEventListener("click",(async()=>{s("googleSignUpBtn","googleSignUpSpinner");try{const{error:e}=await r.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/profile.html`}});e&&(console.error("Error signing up with Google:",e),o(e.message||"Erreur lors de l'inscription avec Google."))}catch(e){console.error("Exception during Google sign-up:",e),o("Une exception est survenue lors de l'inscription avec Google.")}finally{i("googleSignUpBtn","googleSignUpSpinner")}})):console.warn("Google Sign-Up button (googleSignUpBtn) not found.")}window.onloadTurnstileCallback=function(){console.log("Turnstile API ready (onloadTurnstileCallback executed).");const e=document.getElementById("turnstile-container");if(e&&window.turnstile&&!a){console.log("Rendering Turnstile widget from onloadTurnstileCallback...");try{a=window.turnstile.render(e,{sitekey:"0x4AAAAAABdzY3InOU2_In99",callback:function(e){l=e,console.log("Turnstile token obtained:",e)},"expired-callback":()=>{console.log("Turnstile token expired. Resetting widget. ID:",a),window.turnstile&&a&&window.turnstile.reset(a),l=null},"error-callback":e=>{l=null,console.error("Turnstile error callback:",e),o(`Erreur CAPTCHA: ${e}. Veuillez réessayer.`)}}),void 0===a?(console.error("Turnstile.render did not return a widgetId. Sitekey or container issue?"),o("Erreur initialisation CAPTCHA (ID widget non retourné).")):console.log("Turnstile widget rendered. ID:",a)}catch(e){console.error("Error rendering Turnstile:",e),o("Impossible d'afficher le CAPTCHA.")}}else e?window.turnstile?a&&console.log("onloadTurnstileCallback: Widget already seems rendered."):console.error("onloadTurnstileCallback: window.turnstile API not found."):console.error("onloadTurnstileCallback: #turnstile-container not found.")},document.addEventListener("DOMContentLoaded",(()=>{d(),console.log("Signup page initialized")}))}},i={};function l(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}};return s[e].call(n.exports,n,n.exports,l),n.exports}l.m=s,e=[],l.O=(t,n,r,o)=>{if(!n){var s=1/0;for(u=0;u<e.length;u++){for(var[n,r,o]=e[u],i=!0,a=0;a<n.length;a++)(!1&o||s>=o)&&Object.keys(l.O).every((e=>l.O[e](n[a])))?n.splice(a--,1):(i=!1,o<s&&(s=o));if(i){e.splice(u--,1);var d=r();void 0!==d&&(t=d)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[n,r,o]},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,l.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var o=Object.create(null);l.r(o);var s={};t=t||[null,n({}),n([]),n(n)];for(var i=2&r&&e;"object"==typeof i&&!~t.indexOf(i);i=n(i))Object.getOwnPropertyNames(i).forEach((t=>s[t]=()=>e[t]));return s.default=()=>e,l.d(o,s),o},l.d=(e,t)=>{for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},l.f={},l.e=e=>Promise.all(Object.keys(l.f).reduce(((t,n)=>(l.f[n](e,t),t)),[])),l.u=e=>"js/"+e+".bundle.js",l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r={},o="urbandocs_webapp:",l.l=(e,t,n,s)=>{if(r[e])r[e].push(t);else{var i,a;if(void 0!==n)for(var d=document.getElementsByTagName("script"),u=0;u<d.length;u++){var c=d[u];if(c.getAttribute("src")==e||c.getAttribute("data-webpack")==o+n){i=c;break}}i||(a=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,l.nc&&i.setAttribute("nonce",l.nc),i.setAttribute("data-webpack",o+n),i.src=e),r[e]=[t];var p=(t,n)=>{i.onerror=i.onload=null,clearTimeout(g);var o=r[e];if(delete r[e],i.parentNode&&i.parentNode.removeChild(i),o&&o.forEach((e=>e(n))),t)return t(n)},g=setTimeout(p.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=p.bind(null,i.onerror),i.onload=p.bind(null,i.onload),a&&document.head.appendChild(i)}},l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;l.g.importScripts&&(e=l.g.location+"");var t=l.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=n[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),l.p=e+"../"})(),(()=>{var e={787:0};l.f.j=(t,n)=>{var r=l.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var o=new Promise(((n,o)=>r=e[t]=[n,o]));n.push(r[2]=o);var s=l.p+l.u(t),i=new Error;l.l(s,(n=>{if(l.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;i.message="Loading chunk "+t+" failed.\n("+o+": "+s+")",i.name="ChunkLoadError",i.type=o,i.request=s,r[1](i)}}),"chunk-"+t,t)}},l.O.j=t=>0===e[t];var t=(t,n)=>{var r,o,[s,i,a]=n,d=0;if(s.some((t=>0!==e[t]))){for(r in i)l.o(i,r)&&(l.m[r]=i[r]);if(a)var u=a(l)}for(t&&t(n);d<s.length;d++)o=s[d],l.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return l.O(u)},n=self.webpackChunkurbandocs_webapp=self.webpackChunkurbandocs_webapp||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a=l.O(void 0,[303],(()=>l(797)));a=l.O(a)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxFQUFVMkMsR0FIVGxDLEVBQVUrRixFQUFhQyxHQUFXNUksRUFHaEJpRCxFQUFJLEVBQzNCLEdBQUdMLEVBQVNpRyxNQUFNQyxHQUFnQyxJQUF4QmQsRUFBZ0JjLEtBQWEsQ0FDdEQsSUFBSTNHLEtBQVl3RyxFQUNaekcsRUFBb0J1QyxFQUFFa0UsRUFBYXhHLEtBQ3JDRCxFQUFvQk8sRUFBRU4sR0FBWXdHLEVBQVl4RyxJQUdoRCxHQUFHeUcsRUFBUyxJQUFJakcsRUFBU2lHLEVBQVExRyxFQUNsQyxDQUVBLElBREd3RyxHQUE0QkEsRUFBMkIxSSxHQUNyRGlELEVBQUlMLEVBQVNqRCxPQUFRc0QsSUFDekI2QixFQUFVbEMsRUFBU0ssR0FDaEJmLEVBQW9CdUMsRUFBRXVELEVBQWlCbEQsSUFBWWtELEVBQWdCbEQsSUFDckVrRCxFQUFnQmxELEdBQVMsS0FFMUJrRCxFQUFnQmxELEdBQVcsRUFFNUIsT0FBTzVDLEVBQW9CUSxFQUFFQyxFQUFPLEVBR2pDb0csRUFBcUJDLEtBQW1DLDZCQUFJQSxLQUFtQyw4QkFBSyxHQUN4R0QsRUFBbUJySSxRQUFRK0gsRUFBcUJ0QixLQUFLLEtBQU0sSUFDM0Q0QixFQUFtQnJKLEtBQU8rSSxFQUFxQnRCLEtBQUssS0FBTTRCLEVBQW1CckosS0FBS3lILEtBQUs0QixHLEtDbEZ2RixJQUFJRSxFQUFzQi9HLEVBQW9CUSxPQUFFVixFQUFXLENBQUMsTUFBTSxJQUFPRSxFQUFvQixPQUM3RitHLEVBQXNCL0csRUFBb0JRLEVBQUV1RyxFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvY2h1bmsgbG9hZGVkIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2NyZWF0ZSBmYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvbG9hZCBzY3JpcHQiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC8uL3NyYy9qcy9zdXBhYmFzZS1jbGllbnQuanMiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC8uL3NyYy9qcy9hdXRoL2F1dGguanMiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC8uL3NyYy9qcy9hdXRoL3NpZ251cC5qcyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwLy4vc3JjL2pzL2VudHJpZXMvc2lnbnVwLmpzIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvZW5zdXJlIGNodW5rIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2dldCBqYXZhc2NyaXB0IGNodW5rIGZpbGVuYW1lIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2dsb2JhbCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvbWFrZSBuYW1lc3BhY2Ugb2JqZWN0Iiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL3B1YmxpY1BhdGgiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvanNvbnAgY2h1bmsgbG9hZGluZyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZGVmZXJyZWQgPSBbXTtcbl9fd2VicGFja19yZXF1aXJlX18uTyA9IChyZXN1bHQsIGNodW5rSWRzLCBmbiwgcHJpb3JpdHkpID0+IHtcblx0aWYoY2h1bmtJZHMpIHtcblx0XHRwcmlvcml0eSA9IHByaW9yaXR5IHx8IDA7XG5cdFx0Zm9yKHZhciBpID0gZGVmZXJyZWQubGVuZ3RoOyBpID4gMCAmJiBkZWZlcnJlZFtpIC0gMV1bMl0gPiBwcmlvcml0eTsgaS0tKSBkZWZlcnJlZFtpXSA9IGRlZmVycmVkW2kgLSAxXTtcblx0XHRkZWZlcnJlZFtpXSA9IFtjaHVua0lkcywgZm4sIHByaW9yaXR5XTtcblx0XHRyZXR1cm47XG5cdH1cblx0dmFyIG5vdEZ1bGZpbGxlZCA9IEluZmluaXR5O1xuXHRmb3IgKHZhciBpID0gMDsgaSA8IGRlZmVycmVkLmxlbmd0aDsgaSsrKSB7XG5cdFx0dmFyIFtjaHVua0lkcywgZm4sIHByaW9yaXR5XSA9IGRlZmVycmVkW2ldO1xuXHRcdHZhciBmdWxmaWxsZWQgPSB0cnVlO1xuXHRcdGZvciAodmFyIGogPSAwOyBqIDwgY2h1bmtJZHMubGVuZ3RoOyBqKyspIHtcblx0XHRcdGlmICgocHJpb3JpdHkgJiAxID09PSAwIHx8IG5vdEZ1bGZpbGxlZCA+PSBwcmlvcml0eSkgJiYgT2JqZWN0LmtleXMoX193ZWJwYWNrX3JlcXVpcmVfXy5PKS5ldmVyeSgoa2V5KSA9PiAoX193ZWJwYWNrX3JlcXVpcmVfXy5PW2tleV0oY2h1bmtJZHNbal0pKSkpIHtcblx0XHRcdFx0Y2h1bmtJZHMuc3BsaWNlKGotLSwgMSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRmdWxmaWxsZWQgPSBmYWxzZTtcblx0XHRcdFx0aWYocHJpb3JpdHkgPCBub3RGdWxmaWxsZWQpIG5vdEZ1bGZpbGxlZCA9IHByaW9yaXR5O1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZihmdWxmaWxsZWQpIHtcblx0XHRcdGRlZmVycmVkLnNwbGljZShpLS0sIDEpXG5cdFx0XHR2YXIgciA9IGZuKCk7XG5cdFx0XHRpZiAociAhPT0gdW5kZWZpbmVkKSByZXN1bHQgPSByO1xuXHRcdH1cblx0fVxuXHRyZXR1cm4gcmVzdWx0O1xufTsiLCJ2YXIgZ2V0UHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YgPyAob2JqKSA9PiAoT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iaikpIDogKG9iaikgPT4gKG9iai5fX3Byb3RvX18pO1xudmFyIGxlYWZQcm90b3R5cGVzO1xuLy8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4vLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbi8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuLy8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4vLyBtb2RlICYgMTY6IHJldHVybiB2YWx1ZSB3aGVuIGl0J3MgUHJvbWlzZS1saWtlXG4vLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuXHRpZihtb2RlICYgMSkgdmFsdWUgPSB0aGlzKHZhbHVlKTtcblx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcblx0aWYodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSkge1xuXHRcdGlmKChtb2RlICYgNCkgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuXHRcdGlmKChtb2RlICYgMTYpICYmIHR5cGVvZiB2YWx1ZS50aGVuID09PSAnZnVuY3Rpb24nKSByZXR1cm4gdmFsdWU7XG5cdH1cblx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcblx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcblx0dmFyIGRlZiA9IHt9O1xuXHRsZWFmUHJvdG90eXBlcyA9IGxlYWZQcm90b3R5cGVzIHx8IFtudWxsLCBnZXRQcm90byh7fSksIGdldFByb3RvKFtdKSwgZ2V0UHJvdG8oZ2V0UHJvdG8pXTtcblx0Zm9yKHZhciBjdXJyZW50ID0gbW9kZSAmIDIgJiYgdmFsdWU7IHR5cGVvZiBjdXJyZW50ID09ICdvYmplY3QnICYmICF+bGVhZlByb3RvdHlwZXMuaW5kZXhPZihjdXJyZW50KTsgY3VycmVudCA9IGdldFByb3RvKGN1cnJlbnQpKSB7XG5cdFx0T2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoY3VycmVudCkuZm9yRWFjaCgoa2V5KSA9PiAoZGVmW2tleV0gPSAoKSA9PiAodmFsdWVba2V5XSkpKTtcblx0fVxuXHRkZWZbJ2RlZmF1bHQnXSA9ICgpID0+ICh2YWx1ZSk7XG5cdF9fd2VicGFja19yZXF1aXJlX18uZChucywgZGVmKTtcblx0cmV0dXJuIG5zO1xufTsiLCJ2YXIgaW5Qcm9ncmVzcyA9IHt9O1xudmFyIGRhdGFXZWJwYWNrUHJlZml4ID0gXCJ1cmJhbmRvY3Nfd2ViYXBwOlwiO1xuLy8gbG9hZFNjcmlwdCBmdW5jdGlvbiB0byBsb2FkIGEgc2NyaXB0IHZpYSBzY3JpcHQgdGFnXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmwgPSAodXJsLCBkb25lLCBrZXksIGNodW5rSWQpID0+IHtcblx0aWYoaW5Qcm9ncmVzc1t1cmxdKSB7IGluUHJvZ3Jlc3NbdXJsXS5wdXNoKGRvbmUpOyByZXR1cm47IH1cblx0dmFyIHNjcmlwdCwgbmVlZEF0dGFjaDtcblx0aWYoa2V5ICE9PSB1bmRlZmluZWQpIHtcblx0XHR2YXIgc2NyaXB0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpO1xuXHRcdGZvcih2YXIgaSA9IDA7IGkgPCBzY3JpcHRzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHR2YXIgcyA9IHNjcmlwdHNbaV07XG5cdFx0XHRpZihzLmdldEF0dHJpYnV0ZShcInNyY1wiKSA9PSB1cmwgfHwgcy5nZXRBdHRyaWJ1dGUoXCJkYXRhLXdlYnBhY2tcIikgPT0gZGF0YVdlYnBhY2tQcmVmaXggKyBrZXkpIHsgc2NyaXB0ID0gczsgYnJlYWs7IH1cblx0XHR9XG5cdH1cblx0aWYoIXNjcmlwdCkge1xuXHRcdG5lZWRBdHRhY2ggPSB0cnVlO1xuXHRcdHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuXG5cdFx0c2NyaXB0LmNoYXJzZXQgPSAndXRmLTgnO1xuXHRcdHNjcmlwdC50aW1lb3V0ID0gMTIwO1xuXHRcdGlmIChfX3dlYnBhY2tfcmVxdWlyZV9fLm5jKSB7XG5cdFx0XHRzY3JpcHQuc2V0QXR0cmlidXRlKFwibm9uY2VcIiwgX193ZWJwYWNrX3JlcXVpcmVfXy5uYyk7XG5cdFx0fVxuXHRcdHNjcmlwdC5zZXRBdHRyaWJ1dGUoXCJkYXRhLXdlYnBhY2tcIiwgZGF0YVdlYnBhY2tQcmVmaXggKyBrZXkpO1xuXG5cdFx0c2NyaXB0LnNyYyA9IHVybDtcblx0fVxuXHRpblByb2dyZXNzW3VybF0gPSBbZG9uZV07XG5cdHZhciBvblNjcmlwdENvbXBsZXRlID0gKHByZXYsIGV2ZW50KSA9PiB7XG5cdFx0Ly8gYXZvaWQgbWVtIGxlYWtzIGluIElFLlxuXHRcdHNjcmlwdC5vbmVycm9yID0gc2NyaXB0Lm9ubG9hZCA9IG51bGw7XG5cdFx0Y2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuXHRcdHZhciBkb25lRm5zID0gaW5Qcm9ncmVzc1t1cmxdO1xuXHRcdGRlbGV0ZSBpblByb2dyZXNzW3VybF07XG5cdFx0c2NyaXB0LnBhcmVudE5vZGUgJiYgc2NyaXB0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoc2NyaXB0KTtcblx0XHRkb25lRm5zICYmIGRvbmVGbnMuZm9yRWFjaCgoZm4pID0+IChmbihldmVudCkpKTtcblx0XHRpZihwcmV2KSByZXR1cm4gcHJldihldmVudCk7XG5cdH1cblx0dmFyIHRpbWVvdXQgPSBzZXRUaW1lb3V0KG9uU2NyaXB0Q29tcGxldGUuYmluZChudWxsLCB1bmRlZmluZWQsIHsgdHlwZTogJ3RpbWVvdXQnLCB0YXJnZXQ6IHNjcmlwdCB9KSwgMTIwMDAwKTtcblx0c2NyaXB0Lm9uZXJyb3IgPSBvblNjcmlwdENvbXBsZXRlLmJpbmQobnVsbCwgc2NyaXB0Lm9uZXJyb3IpO1xuXHRzY3JpcHQub25sb2FkID0gb25TY3JpcHRDb21wbGV0ZS5iaW5kKG51bGwsIHNjcmlwdC5vbmxvYWQpO1xuXHRuZWVkQXR0YWNoICYmIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTtcbn07IiwiLy8gc3JjL2pzL3N1cGFiYXNlLWNsaWVudC5qc1xuLyoqXG4gKiBTdXBhYmFzZSBDbGllbnRcbiAqIEBtb2R1bGUgc3VwYWJhc2UtY2xpZW50XG4gKiBAZGVzY3JpcHRpb24gVGhpcyBtb2R1bGUgaGFuZGxlcyB0aGUgU3VwYWJhc2UgY2xpZW50IGluaXRpYWxpemF0aW9uIGFuZCBjb25maWd1cmF0aW9uLlxuICogQHZlcnNpb24gMC4wLjFcbiAqIEBhdXRob3IgR3JleVBhbmRhXG4gKlxuICogQGNoYW5nZWxvZ1xuICogLSAwLjAuMSAoMjAyNS0wNS0wOSk6IEluaXRpYWwgdmVyc2lvbiB3aXRoIGJhc2ljIFN1cGFiYXNlIGNsaWVudCBpbml0aWFsaXphdGlvbi5cbiAqL1xuXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tIFwiQHN1cGFiYXNlL3N1cGFiYXNlLWpzXCI7XG5cbmNvbnN0IHN1cGFiYXNlVXJsID0gXCJodHRwczovL29mZXlzc2lwaWJrdG1iZmViaWJvLnN1cGFiYXNlLmNvXCI7XG5jb25zdCBzdXBhYmFzZUFub25LZXkgPVxuICBcImV5SmhiR2NpT2lKSVV6STFOaUlzSW5SNWNDSTZJa3BYVkNKOS5leUpwYzNNaU9pSnpkWEJoWW1GelpTSXNJbkpsWmlJNkltOW1aWGx6YzJsd2FXSnJkRzFpWm1WaWFXSnZJaXdpY205c1pTSTZJbUZ1YjI0aUxDSnBZWFFpT2pFM05ETTVNalV3T1RRc0ltVjRjQ0k2TWpBMU9UVXdNVEE1TkgwLnc3MUNBS2ZvbGt0elJsLVRtTFZoSFlhRWJoQ2ZWazRBN1lyYUVVQ2dsclVcIjtcblxuY29uc3QgY2xpZW50ID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXkpO1xuXG5leHBvcnQgY29uc3Qgc3VwYWJhc2UgPSBjbGllbnQ7XG4iLCIvLyBzcmMvYXV0aC9hdXRoLmpzXG4vKipcbiAqIEF1dGhlbnRpY2F0aW9uIE1vZHVsZSAtIEJhc2VcbiAqIEBtb2R1bGUgYXV0aFxuICogQGRlc2NyaXB0aW9uIEJhc2UgbW9kdWxlIGZvciBhdXRoZW50aWNhdGlvbiB3aXRoIGNvbW1vbiBmdW5jdGlvbnMgYW5kIGNvbmZpZ3VyYXRpb25cbiAqIEB2ZXJzaW9uIDAuMC41XG4gKlxuICogQGNoYW5nZWxvZ1xuICogLSAwLjAuNSAoMjAyNS0wNS0xNSk6IEFkZGVkIHNlc3Npb24gdmFsaWRhdGlvbiBhbmQgcHJvdGVjdGlvbiBhZ2FpbnN0IHN0YWxlIHNlc3Npb25zLlxuICogLSAwLjAuNCAoMjAyNS0wNS0xNSk6IFJlbW92YWwgb2YgRmlyZWJhc2UgQ2xvdWQgRnVuY3Rpb25zIGNvbnN0YW50cy5cbiAqIC0gMC4wLjMgKDIwMjUtMDUtMTMpOiBNb2RpZmllZCB0aGUgYXV0aGVudGljYXRpb24gc3RhdGUgbWFuYWdlbWVudCB0byB1c2UgU3VwYWJhc2UgQXV0aCBzeXN0ZW0uXG4gKiAtIDAuMC4yICgyMDI1LTA1LTEzKTogUmVvcmdhbml6YXRpb24gaW50byBzZXBhcmF0ZSBtb2R1bGVzXG4gKiAtIDAuMC4xICgyMDI1LTA1LTAzKTogSW5pdGlhbCBjcmVhdGlvblxuICovXG5cbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSBcIi4uL3N1cGFiYXNlLWNsaWVudC5qc1wiO1xuXG4vLyBHbG9iYWwgYXV0aGVudGljYXRpb24gc3RhdGVcbmxldCBjdXJyZW50VXNlciA9IG51bGw7XG5sZXQgc2Vzc2lvblZhbGlkYXRlZCA9IGZhbHNlO1xuXG4vKipcbiAqIFNldHMgdGhlIGN1cnJlbnQgdXNlclxuICogQHBhcmFtIHtPYmplY3R9IHVzZXIgLSBVc2VyIGRhdGFcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldEN1cnJlbnRVc2VyKHVzZXIpIHtcbiAgY3VycmVudFVzZXIgPSB1c2VyO1xuICAvLyBQb3NzaWJsZSBzdG9yYWdlIGluIGxvY2FsU3RvcmFnZS9zZXNzaW9uU3RvcmFnZVxuICBpZiAodXNlcikge1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiY3VycmVudFVzZXJcIiwgSlNPTi5zdHJpbmdpZnkodXNlcikpO1xuICB9IGVsc2Uge1xuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFwiY3VycmVudFVzZXJcIik7XG4gIH1cbn1cblxuLyoqXG4gKiBWYWxpZGF0ZXMgaWYgdGhlIGN1cnJlbnQgc2Vzc2lvbiBpcyBhY3RpdmUgd2l0aCBTdXBhYmFzZVxuICogQHJldHVybnMge1Byb21pc2U8Ym9vbGVhbj59IFRydWUgaWYgc2Vzc2lvbiBpcyB2YWxpZCwgZmFsc2Ugb3RoZXJ3aXNlXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2YWxpZGF0ZVNlc3Npb24oKSB7XG4gIHRyeSB7XG4gICAgLy8gR2V0IGN1cnJlbnQgc2Vzc2lvbiBmcm9tIFN1cGFiYXNlXG4gICAgY29uc3Qge1xuICAgICAgZGF0YTogeyBzZXNzaW9uIH0sXG4gICAgICBlcnJvcjogc2Vzc2lvbkVycm9yLFxuICAgIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFNlc3Npb24oKTtcblxuICAgIC8vIE5vIHNlc3Npb24gb3IgZXJyb3IgcmV0cmlldmluZyBzZXNzaW9uXG4gICAgaWYgKHNlc3Npb25FcnJvciB8fCAhc2Vzc2lvbikge1xuICAgICAgY29uc29sZS5sb2coXCJObyB2YWxpZCBzZXNzaW9uIGZvdW5kXCIpO1xuICAgICAgc2V0Q3VycmVudFVzZXIobnVsbCk7XG4gICAgICBzZXNzaW9uVmFsaWRhdGVkID0gZmFsc2U7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gVHJ5IHRvIHJlZnJlc2ggdGhlIHRva2VuIHRvIHZhbGlkYXRlIGl0IHdpdGggdGhlIHNlcnZlclxuICAgIGNvbnN0IHsgZXJyb3I6IHJlZnJlc2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5yZWZyZXNoU2Vzc2lvbigpO1xuXG4gICAgaWYgKHJlZnJlc2hFcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKFwiU2Vzc2lvbiB2YWxpZGF0aW9uIGZhaWxlZDpcIiwgcmVmcmVzaEVycm9yKTtcbiAgICAgIC8vIEZvcmNlIGNsZWFyIHRoZSBpbnZhbGlkIHNlc3Npb25cbiAgICAgIGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnbk91dCgpO1xuICAgICAgc2V0Q3VycmVudFVzZXIobnVsbCk7XG4gICAgICBzZXNzaW9uVmFsaWRhdGVkID0gZmFsc2U7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gU2Vzc2lvbiBpcyB2YWxpZCwgdXBkYXRlIHRoZSBjdXJyZW50IHVzZXJcbiAgICBzZXRDdXJyZW50VXNlcihzZXNzaW9uLnVzZXIpO1xuICAgIHNlc3Npb25WYWxpZGF0ZWQgPSB0cnVlO1xuICAgIHJldHVybiB0cnVlO1xuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5lcnJvcihcIlNlc3Npb24gdmFsaWRhdGlvbiBlcnJvcjpcIiwgZSk7XG4gICAgc2V0Q3VycmVudFVzZXIobnVsbCk7XG4gICAgc2Vzc2lvblZhbGlkYXRlZCA9IGZhbHNlO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG4vKipcbiAqIFJldHJpZXZlcyB0aGUgY3VycmVudCB1c2VyXG4gKiBAcGFyYW0ge2Jvb2xlYW59IHZhbGlkYXRlIC0gV2hldGhlciB0byB2YWxpZGF0ZSB0aGUgc2Vzc2lvbiB3aXRoIFN1cGFiYXNlXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxPYmplY3R8bnVsbD59IFRoZSBjdXJyZW50IHVzZXIgb3IgbnVsbFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q3VycmVudFVzZXIodmFsaWRhdGUgPSB0cnVlKSB7XG4gIC8vIElmIHdlIG5lZWQgdG8gdmFsaWRhdGUgYW5kIGhhdmVuJ3QgZG9uZSBzbyB5ZXRcbiAgaWYgKHZhbGlkYXRlICYmICFzZXNzaW9uVmFsaWRhdGVkKSB7XG4gICAgYXdhaXQgdmFsaWRhdGVTZXNzaW9uKCk7XG4gIH1cblxuICAvLyBJZiBubyB2YWxpZGF0aW9uIG5lZWRlZCBvciBhbHJlYWR5IHZhbGlkYXRlZFxuICBpZiAoIXZhbGlkYXRlICYmICFjdXJyZW50VXNlcikge1xuICAgIC8vIFRyeSB0byByZXRyaWV2ZSBmcm9tIHN0b3JhZ2UgaWYgbm90IGluIG1lbW9yeVxuICAgIGNvbnN0IHN0b3JlZFVzZXIgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImN1cnJlbnRVc2VyXCIpO1xuICAgIGlmIChzdG9yZWRVc2VyKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjdXJyZW50VXNlciA9IEpTT04ucGFyc2Uoc3RvcmVkVXNlcik7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciByZXRyaWV2aW5nIHVzZXI6XCIsIGUpO1xuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShcImN1cnJlbnRVc2VyXCIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBjdXJyZW50VXNlcjtcbn1cblxuLyoqXG4gKiBTeW5jaHJvbm91cyB2ZXJzaW9uIG9mIGdldEN1cnJlbnRVc2VyIGZvciBub24tYXN5bmMgY29udGV4dHNcbiAqIFdBUk5JTkc6IFRoaXMgbWF5IHJldHVybiBzdGFsZSBkYXRhIGlmIHNlc3Npb24gaXMgaW52YWxpZFxuICogQHJldHVybnMge09iamVjdHxudWxsfSBUaGUgY3VycmVudCB1c2VyIG9yIG51bGxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEN1cnJlbnRVc2VyU3luYygpIHtcbiAgaWYgKCFjdXJyZW50VXNlcikge1xuICAgIGNvbnN0IHN0b3JlZFVzZXIgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImN1cnJlbnRVc2VyXCIpO1xuICAgIGlmIChzdG9yZWRVc2VyKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjdXJyZW50VXNlciA9IEpTT04ucGFyc2Uoc3RvcmVkVXNlcik7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciByZXRyaWV2aW5nIHVzZXI6XCIsIGUpO1xuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShcImN1cnJlbnRVc2VyXCIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBjdXJyZW50VXNlcjtcbn1cblxuLyoqXG4gKiBMb2dzIG91dCB0aGUgdXNlclxuICogQHJldHVybnMge1Byb21pc2U8dm9pZD59XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dvdXQoKSB7XG4gIHRyeSB7XG4gICAgLy8gU2lnbiBvdXQgZnJvbSBTdXBhYmFzZVxuICAgIGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnbk91dCgpO1xuXG4gICAgLy8gQ2xlYXIgbG9jYWwgc3RhdGVcbiAgICBjdXJyZW50VXNlciA9IG51bGw7XG4gICAgc2Vzc2lvblZhbGlkYXRlZCA9IGZhbHNlO1xuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFwiY3VycmVudFVzZXJcIik7XG5cbiAgICAvLyBSZWRpcmVjdCB0byB0aGUgaG9tZSBwYWdlIGFmdGVyIGxvZ291dFxuICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCIvXCI7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGR1cmluZyBsb2dvdXQ6XCIsIGVycm9yKTtcbiAgICAvLyBTdGlsbCBjbGVhciBsb2NhbCBzdGF0ZSBldmVuIGlmIFN1cGFiYXNlIHNpZ25PdXQgZmFpbHNcbiAgICBjdXJyZW50VXNlciA9IG51bGw7XG4gICAgc2Vzc2lvblZhbGlkYXRlZCA9IGZhbHNlO1xuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFwiY3VycmVudFVzZXJcIik7XG4gICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcIi9cIjtcbiAgfVxufVxuXG4vKipcbiAqIENoZWNrcyBpZiB0aGUgdXNlciBpcyBsb2dnZWQgaW4gd2l0aCB2YWxpZCBzZXNzaW9uXG4gKiBAcGFyYW0ge2Jvb2xlYW59IHZhbGlkYXRlIC0gV2hldGhlciB0byB2YWxpZGF0ZSB3aXRoIFN1cGFiYXNlIGZpcnN0XG4gKiBAcmV0dXJucyB7UHJvbWlzZTxib29sZWFuPn0gVHJ1ZSBpZiB0aGUgdXNlciBpcyBsb2dnZWQgaW4gd2l0aCB2YWxpZCBzZXNzaW9uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpc0xvZ2dlZEluKHZhbGlkYXRlID0gdHJ1ZSkge1xuICBjb25zdCB1c2VyID0gYXdhaXQgZ2V0Q3VycmVudFVzZXIodmFsaWRhdGUpO1xuICByZXR1cm4gdXNlciAhPT0gbnVsbDtcbn1cblxuLyoqXG4gKiBTeW5jaHJvbm91cyB2ZXJzaW9uIG9mIGlzTG9nZ2VkSW5cbiAqIFdBUk5JTkc6IFRoaXMgbWF5IHJldHVybiBpbmNvcnJlY3QgcmVzdWx0cyBpZiBzZXNzaW9uIGlzIGludmFsaWRcbiAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIHVzZXIgYXBwZWFycyB0byBiZSBsb2dnZWQgaW4gbG9jYWxseVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNMb2dnZWRJblN5bmMoKSB7XG4gIHJldHVybiBnZXRDdXJyZW50VXNlclN5bmMoKSAhPT0gbnVsbDtcbn1cblxuLyoqXG4gKiBQcm90ZWN0cyBhIHBhZ2UgdGhhdCByZXF1aXJlcyBhdXRoZW50aWNhdGlvblxuICogQHBhcmFtIHtzdHJpbmd9IHJlZGlyZWN0VXJsIC0gVVJMIHRvIHJlZGlyZWN0IGlmIG5vdCBhdXRoZW50aWNhdGVkXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxib29sZWFuPn0gVHJ1ZSBpZiBhdXRoZW50aWNhdGVkLCBmYWxzZSBvdGhlcndpc2VcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb3RlY3RQYWdlKHJlZGlyZWN0VXJsID0gXCIvbG9naW5cIikge1xuICBjb25zdCBpc1ZhbGlkID0gYXdhaXQgdmFsaWRhdGVTZXNzaW9uKCk7XG5cbiAgaWYgKCFpc1ZhbGlkKSB7XG4gICAgLy8gUmVkaXJlY3QgdG8gbG9naW4gcGFnZVxuICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gcmVkaXJlY3RVcmw7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59XG5cbi8qKlxuICogSW5pdGlhbGl6ZXMgYXV0aCBvbiBwYWdlIGxvYWRcbiAqIENhbGwgdGhpcyBhdCB0aGUgYmVnaW5uaW5nIG9mIHlvdXIgYXBwIGluaXRpYWxpemF0aW9uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpbml0QXV0aCgpIHtcbiAgLy8gVmFsaWRhdGUgc2Vzc2lvbiBvbiBwYWdlIGxvYWRcbiAgYXdhaXQgdmFsaWRhdGVTZXNzaW9uKCk7XG5cbiAgLy8gU2V0IHVwIGF1dGggc3RhdGUgY2hhbmdlIGxpc3RlbmVyXG4gIHN1cGFiYXNlLmF1dGgub25BdXRoU3RhdGVDaGFuZ2UoYXN5bmMgKGV2ZW50LCBzZXNzaW9uKSA9PiB7XG4gICAgY29uc29sZS5sb2coXCJBdXRoIHN0YXRlIGNoYW5nZWQ6XCIsIGV2ZW50KTtcblxuICAgIGlmIChldmVudCA9PT0gXCJTSUdORURfSU5cIiAmJiBzZXNzaW9uKSB7XG4gICAgICBzZXRDdXJyZW50VXNlcihzZXNzaW9uLnVzZXIpO1xuICAgICAgc2Vzc2lvblZhbGlkYXRlZCA9IHRydWU7XG4gICAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJTSUdORURfT1VUXCIpIHtcbiAgICAgIHNldEN1cnJlbnRVc2VyKG51bGwpO1xuICAgICAgc2Vzc2lvblZhbGlkYXRlZCA9IGZhbHNlO1xuICAgIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwiVE9LRU5fUkVGUkVTSEVEXCIpIHtcbiAgICAgIHNldEN1cnJlbnRVc2VyKHNlc3Npb24udXNlcik7XG4gICAgICBzZXNzaW9uVmFsaWRhdGVkID0gdHJ1ZTtcbiAgICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcIlVTRVJfVVBEQVRFRFwiKSB7XG4gICAgICBzZXRDdXJyZW50VXNlcihzZXNzaW9uLnVzZXIpO1xuICAgICAgc2Vzc2lvblZhbGlkYXRlZCA9IHRydWU7XG4gICAgfVxuICB9KTtcbn1cblxuLyoqXG4gKiBEaXNwbGF5cyBhbiBlcnJvciBtZXNzYWdlXG4gKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIEVycm9yIG1lc3NhZ2UgdG8gZGlzcGxheVxuICogQHBhcmFtIHtzdHJpbmd9IGVsZW1lbnRJZCAtIElEIG9mIHRoZSBlbGVtZW50IHdoZXJlIHRvIGRpc3BsYXkgdGhlIGVycm9yXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzaG93RXJyb3IobWVzc2FnZSwgZWxlbWVudElkID0gXCJlcnJvck1lc3NhZ2VcIikge1xuICBjb25zdCBlcnJvckVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50SWQpO1xuICBpZiAoZXJyb3JFbGVtZW50KSB7XG4gICAgZXJyb3JFbGVtZW50LmlubmVySFRNTCA9IG1lc3NhZ2U7XG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGVsZW1lbnQgbm90IGZvdW5kOlwiLCBlbGVtZW50SWQpO1xuICB9XG59XG5cbi8qKlxuICogRGlzcGxheXMgYSBzdGF0dXMgbWVzc2FnZVxuICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2UgLSBNZXNzYWdlIHRvIGRpc3BsYXlcbiAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIC0gTWVzc2FnZSB0eXBlIChzdWNjZXNzLCBpbmZvLCB3YXJuaW5nLCBkYW5nZXIpXG4gKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudElkIC0gSUQgb2YgdGhlIGVsZW1lbnQgd2hlcmUgdG8gZGlzcGxheSB0aGUgbWVzc2FnZVxuICovXG5leHBvcnQgZnVuY3Rpb24gc2hvd1N0YXR1cyhcbiAgbWVzc2FnZSxcbiAgdHlwZSA9IFwiaW5mb1wiLFxuICBlbGVtZW50SWQgPSBcInN0YXR1c01lc3NhZ2VcIlxuKSB7XG4gIGNvbnN0IHN0YXR1c0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50SWQpO1xuICBpZiAoc3RhdHVzRWxlbWVudCkge1xuICAgIHN0YXR1c0VsZW1lbnQudGV4dENvbnRlbnQgPSBtZXNzYWdlO1xuXG4gICAgLy8gUmVtb3ZlIGFsbCBhbGVydC0qIGNsYXNzZXNcbiAgICBzdGF0dXNFbGVtZW50LmNsYXNzTGlzdC5mb3JFYWNoKChjbGFzc05hbWUpID0+IHtcbiAgICAgIGlmIChjbGFzc05hbWUuc3RhcnRzV2l0aChcImFsZXJ0LVwiKSkge1xuICAgICAgICBzdGF0dXNFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NOYW1lKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEFkZCB0aGUgY2xhc3MgY29ycmVzcG9uZGluZyB0byB0aGUgdHlwZVxuICAgIHN0YXR1c0VsZW1lbnQuY2xhc3NMaXN0LmFkZChgYWxlcnQtJHt0eXBlfWApO1xuICAgIHN0YXR1c0VsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmVycm9yKFwiU3RhdHVzIGVsZW1lbnQgbm90IGZvdW5kOlwiLCBlbGVtZW50SWQpO1xuICB9XG59XG5cbi8qKlxuICogSGlkZXMgYW4gZWxlbWVudFxuICogQHBhcmFtIHtzdHJpbmd9IGVsZW1lbnRJZCAtIElEIG9mIHRoZSBlbGVtZW50IHRvIGhpZGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGhpZGVFbGVtZW50KGVsZW1lbnRJZCkge1xuICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudElkKTtcbiAgaWYgKGVsZW1lbnQpIHtcbiAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gIH1cbn1cblxuLyoqXG4gKiBTaG93cyBhbiBlbGVtZW50XG4gKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudElkIC0gSUQgb2YgdGhlIGVsZW1lbnQgdG8gc2hvd1xuICovXG5leHBvcnQgZnVuY3Rpb24gc2hvd0VsZW1lbnQoZWxlbWVudElkKSB7XG4gIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50SWQpO1xuICBpZiAoZWxlbWVudCkge1xuICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcbiAgfVxufVxuXG4vKipcbiAqIFNob3dzIHRoZSBsb2FkaW5nIGluZGljYXRvclxuICogQHBhcmFtIHtzdHJpbmd9IGJ1dHRvbklkIC0gSUQgb2YgdGhlIGJ1dHRvblxuICogQHBhcmFtIHtzdHJpbmd9IHNwaW5uZXJJZCAtIElEIG9mIHRoZSBzcGlubmVyXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzaG93TG9hZGluZyhidXR0b25JZCwgc3Bpbm5lcklkKSB7XG4gIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGJ1dHRvbklkKTtcbiAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNwaW5uZXJJZCk7XG5cbiAgaWYgKGJ1dHRvbikgYnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgaWYgKHNwaW5uZXIpIHNwaW5uZXIuY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcbn1cblxuLyoqXG4gKiBIaWRlcyB0aGUgbG9hZGluZyBpbmRpY2F0b3JcbiAqIEBwYXJhbSB7c3RyaW5nfSBidXR0b25JZCAtIElEIG9mIHRoZSBidXR0b25cbiAqIEBwYXJhbSB7c3RyaW5nfSBzcGlubmVySWQgLSBJRCBvZiB0aGUgc3Bpbm5lclxuICovXG5leHBvcnQgZnVuY3Rpb24gaGlkZUxvYWRpbmcoYnV0dG9uSWQsIHNwaW5uZXJJZCkge1xuICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChidXR0b25JZCk7XG4gIGNvbnN0IHNwaW5uZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzcGlubmVySWQpO1xuXG4gIGlmIChidXR0b24pIGJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuICBpZiAoc3Bpbm5lcikgc3Bpbm5lci5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xufVxuXG4vLyBFeHBvcnQgdGhlIG5lY2Vzc2FyeSBmdW5jdGlvbnMgYW5kIHZhcmlhYmxlc1xuZXhwb3J0IGRlZmF1bHQge1xuICBnZXRDdXJyZW50VXNlcixcbiAgZ2V0Q3VycmVudFVzZXJTeW5jLFxuICBzZXRDdXJyZW50VXNlcixcbiAgbG9nb3V0LFxuICBpc0xvZ2dlZEluLFxuICBpc0xvZ2dlZEluU3luYyxcbiAgdmFsaWRhdGVTZXNzaW9uLFxuICBwcm90ZWN0UGFnZSxcbiAgaW5pdEF1dGgsXG4gIHNob3dFcnJvcixcbiAgc2hvd1N0YXR1cyxcbiAgaGlkZUVsZW1lbnQsXG4gIHNob3dFbGVtZW50LFxuICBzaG93TG9hZGluZyxcbiAgaGlkZUxvYWRpbmcsXG59O1xuIiwiLy8gc3JjL2F1dGgvc2lnbnVwLmpzXG4vKipcbiAqIFNpZ251cCBNb2R1bGVcbiAqIEBtb2R1bGUgc2lnbnVwXG4gKiBAZGVzY3JpcHRpb24gSGFuZGxlcyB1c2VyIHJlZ2lzdHJhdGlvbiB3aXRoIGNsaWVudC1zaWRlIHZhbGlkYXRpb24sIEdvb2dsZSBPQXV0aCwgYW5kIHBob25lIHZlcmlmaWNhdGlvbiB1c2luZyBTdXBhYmFzZS5cbiAqIEB2ZXJzaW9uIDAuMi4xXG4gKlxuICogQGNoYW5nZWxvZ1xuICogLSAwLjIuMSAoMjAyNS0wNS0xOCk6IEFkZGVkIGNhcHRjaGEgd2l0aCBDbG91ZGZsYXJlIFR1cm5zdGlsZS5cbiAqIC0gMC4yLjAgKDIwMjUtMDUtMTgpOiBBZGRlZCBwaG9uZSBudW1iZXIgaW5wdXQsIE9UUCBzZW5kaW5nIGFuZCB2ZXJpZmljYXRpb24gZm9yIGVtYWlsL3Bhc3N3b3JkIHNpZ251cC5cbiAqIC0gMC4xLjEgKDIwMjUtMDUtMTgpOiBBZGRlZCBHb29nbGUgU2lnbi1VcCBmdW5jdGlvbmFsaXR5LlxuICogLSAwLjEuMCAoMjAyNS0wNS0xNSk6IE1pZ3JhdGVkIHRvIFN1cGFiYXNlIGNsaWVudC1zaWRlIGF1dGggKHZlcnNpb25pbmcgYWRqdXN0ZWQpXG4gKi9cblxuaW1wb3J0IHsgc2hvd0Vycm9yLCBzaG93U3RhdHVzLCBzaG93TG9hZGluZywgaGlkZUxvYWRpbmcgfSBmcm9tIFwiLi9hdXRoLmpzXCI7XG5pbXBvcnQgeyBzdXBhYmFzZSB9IGZyb20gXCIuLi9zdXBhYmFzZS1jbGllbnQuanNcIjtcblxuLy8gU3RvcmUgcGhvbmUgbnVtYmVyIHRlbXBvcmFyaWx5IGJldHdlZW4gc3RlcHNcbmxldCBjYXB0Y2hhVG9rZW4gPSBudWxsOyAvLyBUbyBzdG9yZSB0aGUgY2FwdGNoYSB0b2tlbiAodXNlZCBieSBib3RoIGhDYXB0Y2hhIGFuZCBUdXJuc3RpbGUpXG5sZXQgdHVybnN0aWxlV2lkZ2V0SWQgPSBudWxsOyAvLyBUbyBzdG9yZSBUdXJuc3RpbGUgd2lkZ2V0IElEXG5cbi8vIFRoaXMgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgYnkgdGhlIENsb3VkZmxhcmUgVHVybnN0aWxlIHNjcmlwdCBvbmNlIGl0J3MgbG9hZGVkXG4vLyAoZHVlIHRvICZvbmxvYWQ9b25sb2FkVHVybnN0aWxlQ2FsbGJhY2sgaW4gdGhlIHNjcmlwdCB0YWcgaW4gc2lnbnVwLmh0bWwpXG53aW5kb3cub25sb2FkVHVybnN0aWxlQ2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7XG4gIGNvbnNvbGUubG9nKFwiVHVybnN0aWxlIEFQSSByZWFkeSAob25sb2FkVHVybnN0aWxlQ2FsbGJhY2sgZXhlY3V0ZWQpLlwiKTtcbiAgY29uc3QgdHVybnN0aWxlQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0dXJuc3RpbGUtY29udGFpbmVyXCIpO1xuXG4gIGlmICh0dXJuc3RpbGVDb250YWluZXIgJiYgd2luZG93LnR1cm5zdGlsZSAmJiAhdHVybnN0aWxlV2lkZ2V0SWQpIHtcbiAgICBjb25zb2xlLmxvZyhcIlJlbmRlcmluZyBUdXJuc3RpbGUgd2lkZ2V0IGZyb20gb25sb2FkVHVybnN0aWxlQ2FsbGJhY2suLi5cIik7XG4gICAgdHJ5IHtcbiAgICAgIHR1cm5zdGlsZVdpZGdldElkID0gd2luZG93LnR1cm5zdGlsZS5yZW5kZXIodHVybnN0aWxlQ29udGFpbmVyLCB7XG4gICAgICAgIHNpdGVrZXk6IFwiMHg0QUFBQUFBQmR6WTNJbk9VMl9Jbjk5XCIsXG4gICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAodG9rZW4pIHtcbiAgICAgICAgICBjYXB0Y2hhVG9rZW4gPSB0b2tlbjtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIlR1cm5zdGlsZSB0b2tlbiBvYnRhaW5lZDpcIiwgdG9rZW4pO1xuICAgICAgICB9LFxuICAgICAgICBcImV4cGlyZWQtY2FsbGJhY2tcIjogKCkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgXCJUdXJuc3RpbGUgdG9rZW4gZXhwaXJlZC4gUmVzZXR0aW5nIHdpZGdldC4gSUQ6XCIsXG4gICAgICAgICAgICB0dXJuc3RpbGVXaWRnZXRJZFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKHdpbmRvdy50dXJuc3RpbGUgJiYgdHVybnN0aWxlV2lkZ2V0SWQpIHtcbiAgICAgICAgICAgIHdpbmRvdy50dXJuc3RpbGUucmVzZXQodHVybnN0aWxlV2lkZ2V0SWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXB0Y2hhVG9rZW4gPSBudWxsOyAvLyBDbGVhciB0aGUgdG9rZW5cbiAgICAgICAgICAvLyBXaWRnZXQgc2hvdWxkIGJlIHJlYWR5IGZvciBhIG5ldyBjaGFsbGVuZ2UgYWZ0ZXIgcmVzZXQuXG4gICAgICAgIH0sXG4gICAgICAgIFwiZXJyb3ItY2FsbGJhY2tcIjogKGVycikgPT4ge1xuICAgICAgICAgIGNhcHRjaGFUb2tlbiA9IG51bGw7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIlR1cm5zdGlsZSBlcnJvciBjYWxsYmFjazpcIiwgZXJyKTtcbiAgICAgICAgICBzaG93RXJyb3IoYEVycmV1ciBDQVBUQ0hBOiAke2Vycn0uIFZldWlsbGV6IHLDqWVzc2F5ZXIuYCk7XG4gICAgICAgIH0sXG4gICAgICAgIC8vIHRoZW1lOiAnbGlnaHQnLCAvLyBPcHRpb25hbDogJ2xpZ2h0JywgJ2RhcmsnLCBvciAnYXV0bydcbiAgICAgICAgLy8gbGFuZ3VhZ2U6ICdmcicsIC8vIE9wdGlvbmFsOiBzcGVjaWZ5IGxhbmd1YWdlXG4gICAgICB9KTtcbiAgICAgIGlmICh0dXJuc3RpbGVXaWRnZXRJZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgICAgXCJUdXJuc3RpbGUucmVuZGVyIGRpZCBub3QgcmV0dXJuIGEgd2lkZ2V0SWQuIFNpdGVrZXkgb3IgY29udGFpbmVyIGlzc3VlP1wiXG4gICAgICAgICk7XG4gICAgICAgIHNob3dFcnJvcihcIkVycmV1ciBpbml0aWFsaXNhdGlvbiBDQVBUQ0hBIChJRCB3aWRnZXQgbm9uIHJldG91cm7DqSkuXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJUdXJuc3RpbGUgd2lkZ2V0IHJlbmRlcmVkLiBJRDpcIiwgdHVybnN0aWxlV2lkZ2V0SWQpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciByZW5kZXJpbmcgVHVybnN0aWxlOlwiLCBlKTtcbiAgICAgIHNob3dFcnJvcihcIkltcG9zc2libGUgZCdhZmZpY2hlciBsZSBDQVBUQ0hBLlwiKTtcbiAgICB9XG4gIH0gZWxzZSBpZiAoIXR1cm5zdGlsZUNvbnRhaW5lcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJvbmxvYWRUdXJuc3RpbGVDYWxsYmFjazogI3R1cm5zdGlsZS1jb250YWluZXIgbm90IGZvdW5kLlwiKTtcbiAgfSBlbHNlIGlmICghd2luZG93LnR1cm5zdGlsZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJvbmxvYWRUdXJuc3RpbGVDYWxsYmFjazogd2luZG93LnR1cm5zdGlsZSBBUEkgbm90IGZvdW5kLlwiKTtcbiAgfSBlbHNlIGlmICh0dXJuc3RpbGVXaWRnZXRJZCkge1xuICAgIGNvbnNvbGUubG9nKFwib25sb2FkVHVybnN0aWxlQ2FsbGJhY2s6IFdpZGdldCBhbHJlYWR5IHNlZW1zIHJlbmRlcmVkLlwiKTtcbiAgfVxufTtcblxuLyoqXG4gKiBJbml0aWFsaXplcyB0aGUgc2lnbnVwIHBhZ2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGluaXRTaWdudXBQYWdlKCkge1xuICBjb25zb2xlLmxvZyhcImluaXRTaWdudXBQYWdlIGNhbGxlZFwiKTtcbiAgY29uc3Qgc2lnbnVwRm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic2lnbnVwRm9ybVwiKTtcbiAgLy8gY29uc3Qgb3RwRm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3RwRm9ybVwiKTsgLy8gT1RQIEZvcm0gLSBSZW1vdmVkXG4gIGNvbnN0IGVycm9yTWVzc2FnZURpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZXJyb3JNZXNzYWdlXCIpO1xuICBjb25zdCBzdGF0dXNNZXNzYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdGF0dXNNZXNzYWdlXCIpO1xuICBjb25zdCBnb29nbGVTaWduVXBCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImdvb2dsZVNpZ25VcEJ0blwiKTtcbiAgY29uc3QgdHVybnN0aWxlQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0dXJuc3RpbGUtY29udGFpbmVyXCIpOyAvLyBVcGRhdGVkIHNlbGVjdG9yXG5cbiAgaWYgKCF0dXJuc3RpbGVDb250YWluZXIpIHtcbiAgICAvLyBVcGRhdGVkIGNoZWNrXG4gICAgY29uc29sZS5lcnJvcihcbiAgICAgIFwiI3R1cm5zdGlsZS1jb250YWluZXIgbm90IGZvdW5kIGluIHRoZSBET00uIENBUFRDSEEgY2Fubm90IGJlIHJlbmRlcmVkLlwiXG4gICAgKTtcbiAgfVxuXG4gIC8vIFRoZSBvbmxvYWRUdXJuc3RpbGVDYWxsYmFjayBpcyB0aGUgcHJpbWFyeSB3YXkgdGhlIHdpZGdldCBzaG91bGQgYmUgcmVuZGVyZWQuXG4gIC8vIFRoZSByZWR1bmRhbnQgYmxvY2sgcHJldmlvdXNseSBoZXJlIGhhcyBiZWVuIHJlbW92ZWQuXG4gIC8vIElmIHdpbmRvdy50dXJuc3RpbGUgaXMgYWxyZWFkeSBhdmFpbGFibGUgYW5kIHRoZSBjYWxsYmFjayBoYXNuJ3QgZmlyZWQgeWV0IChlLmcuIHNjcmlwdCBsb2FkZWQgZnJvbSBjYWNoZSBiZWZvcmUgRE9NIHJlYWR5IGZvciBjb250YWluZXIpLFxuICAvLyB0aGUgYG9ubG9hZFR1cm5zdGlsZUNhbGxiYWNrYCB3aWxsIHN0aWxsIGV4ZWN1dGUgb25jZSB0aGUgc2NyaXB0IGZ1bGx5IHByb2Nlc3NlcyBpdHMgYG9ubG9hZGAgcGFyYW1ldGVyLlxuXG4gIGlmIChzaWdudXBGb3JtKSB7XG4gICAgc2lnbnVwRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGFzeW5jIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBpZiAoZXJyb3JNZXNzYWdlRGl2KSBlcnJvck1lc3NhZ2VEaXYuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgIGlmIChzdGF0dXNNZXNzYWdlKSBzdGF0dXNNZXNzYWdlLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG5cbiAgICAgIGNvbnN0IGVtYWlsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJlbWFpbFwiKS52YWx1ZS50cmltKCk7XG4gICAgICBjb25zdCBwYXNzd29yZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGFzc3dvcmRcIikudmFsdWU7XG4gICAgICBjb25zdCBjb25maXJtUGFzc3dvcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbmZpcm1QYXNzd29yZFwiKS52YWx1ZTtcbiAgICAgIGxldCBwaG9uZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGhvbmVcIikudmFsdWUudHJpbSgpOyAvLyBHZXQgcGhvbmUgbnVtYmVyXG5cbiAgICAgIGxldCB2YWxpZGF0aW9uRXJyb3JzID0gW107XG4gICAgICBjb25zdCBlbWFpbFBhdHRlcm4gPSAvXlteXFxzQF0rQFteXFxzQF0rXFwuW15cXHNAXSskLztcbiAgICAgIGlmICghZW1haWxQYXR0ZXJuLnRlc3QoZW1haWwpKVxuICAgICAgICB2YWxpZGF0aW9uRXJyb3JzLnB1c2goXCJMJ2FkcmVzc2UgZW1haWwgbidlc3QgcGFzIHZhbGlkZS5cIik7XG4gICAgICBpZiAocGFzc3dvcmQgIT09IGNvbmZpcm1QYXNzd29yZClcbiAgICAgICAgdmFsaWRhdGlvbkVycm9ycy5wdXNoKFwiTGVzIG1vdHMgZGUgcGFzc2UgbmUgY29ycmVzcG9uZGVudCBwYXMuXCIpO1xuICAgICAgY29uc3QgcGFzc3dvcmRDb21wbGV4aXR5UGF0dGVybiA9IC9eKD89LipbYS16XSkoPz0uKltBLVpdKSg/PS4qXFxkKS4rJC87XG4gICAgICBpZiAoIXBhc3N3b3JkQ29tcGxleGl0eVBhdHRlcm4udGVzdChwYXNzd29yZCkgfHwgcGFzc3dvcmQubGVuZ3RoIDwgOClcbiAgICAgICAgdmFsaWRhdGlvbkVycm9ycy5wdXNoKFwiTGUgZm9ybWF0IGR1IG1vdCBkZSBwYXNzZSBlc3QgaW52YWxpZGUuXCIpO1xuICAgICAgaWYgKCFwaG9uZSkgdmFsaWRhdGlvbkVycm9ycy5wdXNoKFwiTGUgbnVtw6lybyBkZSB0w6lsw6lwaG9uZSBlc3QgcmVxdWlzLlwiKTtcbiAgICAgIC8vIEJhc2ljIHBob25lIHZhbGlkYXRpb24gKHlvdSBtaWdodCB3YW50IGEgbW9yZSByb2J1c3Qgb25lKVxuICAgICAgY29uc3QgcGhvbmVQYXR0ZXJuID0gL14oMHxcXCszMylbMS05XVxcZHs4fSQvOyAvLyBFeGFtcGxlOiAwNjEyMzQ1Njc4IG9yICszMzYxMjM0NTY3OFxuICAgICAgaWYgKHBob25lICYmICFwaG9uZVBhdHRlcm4udGVzdChwaG9uZSkpXG4gICAgICAgIHZhbGlkYXRpb25FcnJvcnMucHVzaChcbiAgICAgICAgICBcIkxlIGZvcm1hdCBkdSBudW3DqXJvIGRlIHTDqWzDqXBob25lIGVzdCBpbnZhbGlkZSAoZXg6IDA2MTIzNDU2Nzggb3UgKzMzNjEyMzQ1Njc4KS5cIlxuICAgICAgICApO1xuXG4gICAgICBpZiAoIWNhcHRjaGFUb2tlbikge1xuICAgICAgICAvLyBDaGVjayBpZiBjYXB0Y2hhIGlzIHNvbHZlZFxuICAgICAgICB2YWxpZGF0aW9uRXJyb3JzLnB1c2goXCJWZXVpbGxleiBjb21wbMOpdGVyIGxlIENBUFRDSEEuXCIpO1xuICAgICAgfVxuXG4gICAgICBpZiAodmFsaWRhdGlvbkVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHNob3dFcnJvcih2YWxpZGF0aW9uRXJyb3JzLmpvaW4oXCI8YnI+XCIpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBzaG93TG9hZGluZyhcInNpZ251cEJ0blwiLCBcInNpZ251cFNwaW5uZXJcIik7XG4gICAgICB0cnkge1xuICAgICAgICBpZiAocGhvbmUuc3RhcnRzV2l0aChcIjBcIikpIHtcbiAgICAgICAgICBlMTY0UGhvbmUgPSBgKzMzJHtwaG9uZS5zdWJzdHJpbmcoMSl9YDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFN0ZXAgMTogU2lnbiB1cCB3aXRoIGVtYWlsIGFuZCBwYXNzd29yZFxuICAgICAgICBjb25zdCB7IGRhdGEsIGVycm9yOiBzaWduVXBFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5zaWduVXAoe1xuICAgICAgICAgIGVtYWlsLFxuICAgICAgICAgIHBhc3N3b3JkLFxuICAgICAgICAgIG9wdGlvbnM6IHsgY2FwdGNoYVRva2VuIH0sIC8vIFBhc3MgY2FwdGNoYSB0b2tlblxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoc2lnblVwRXJyb3IpIHRocm93IHNpZ25VcEVycm9yO1xuICAgICAgICBpZiAoIWRhdGEudXNlcilcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJFcnJldXIgbG9ycyBkZSBsYSBjcsOpYXRpb24gZGUgbCd1dGlsaXNhdGV1ci5cIik7XG5cbiAgICAgICAgLy8gVXNlciBjcmVhdGVkLiBOb3cgdXBkYXRlIHRoZWlyIHByb2ZpbGUgd2l0aCB0aGUgcGhvbmUgbnVtYmVyIGlmIHByb3ZpZGVkLlxuICAgICAgICBsZXQgc3VjY2Vzc01lc3NhZ2UgPVxuICAgICAgICAgIFwiQ29tcHRlIGNyw6nDqSAhIFVuIGVtYWlsIGRlIGNvbmZpcm1hdGlvbiBhIMOpdMOpIGVudm95w6kuXCI7XG4gICAgICAgIHNob3dTdGF0dXMoc3VjY2Vzc01lc3NhZ2UsIFwic3VjY2Vzc1wiKTtcblxuICAgICAgICAvLyBIaWRlIHRoZSBmb3JtIGFuZCByZXNldCBpdFxuICAgICAgICBpZiAoc2lnbnVwRm9ybSkge1xuICAgICAgICAgIHNpZ251cEZvcm0uY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTsgLy8gSGlkZSB0aGUgZm9ybVxuICAgICAgICAgIHNpZ251cEZvcm0ucmVzZXQoKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVtYWlsL1Bhc3N3b3JkIFNpZ251cCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICBsZXQgZGlzcGxheUVycm9yID0gZXJyb3IubWVzc2FnZSB8fCBcIlVuZSBlcnJldXIgZXN0IHN1cnZlbnVlLlwiO1xuICAgICAgICBpZiAoXG4gICAgICAgICAgZXJyb3IubWVzc2FnZSAmJlxuICAgICAgICAgIGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoXCJVc2VyIGFscmVhZHkgcmVnaXN0ZXJlZFwiKVxuICAgICAgICApIHtcbiAgICAgICAgICBkaXNwbGF5RXJyb3IgPVxuICAgICAgICAgICAgXCJDZXR0ZSBhZHJlc3NlIGVtYWlsIGVzdCBkw6lqw6AgdXRpbGlzw6llLiBWZXVpbGxleiB2b3VzIGNvbm5lY3RlciBvdSB1dGlsaXNlciB1bmUgYXV0cmUgYWRyZXNzZS5cIjtcbiAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICBlcnJvci5tZXNzYWdlICYmXG4gICAgICAgICAgZXJyb3IubWVzc2FnZS5pbmNsdWRlcyhcIlVuYWJsZSB0byB2YWxpZGF0ZSBwaG9uZSBudW1iZXJcIilcbiAgICAgICAgKSB7XG4gICAgICAgICAgZGlzcGxheUVycm9yID0gXCJMZSBudW3DqXJvIGRlIHTDqWzDqXBob25lIGZvdXJuaSBuJ2VzdCBwYXMgdmFsaWRlLlwiO1xuICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgIGVycm9yLm1lc3NhZ2UgJiZcbiAgICAgICAgICBlcnJvci5tZXNzYWdlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJjYXB0Y2hhIHByb3RlY3Rpb25cIilcbiAgICAgICAgKSB7XG4gICAgICAgICAgZGlzcGxheUVycm9yID1cbiAgICAgICAgICAgIFwiRXJyZXVyIENBUFRDSEEgZHUgc2VydmV1ci4gVmV1aWxsZXogcsOpZXNzYXllci4gKFwiICtcbiAgICAgICAgICAgIGVycm9yLm1lc3NhZ2UgK1xuICAgICAgICAgICAgXCIpXCI7XG4gICAgICAgIH1cbiAgICAgICAgc2hvd0Vycm9yKGRpc3BsYXlFcnJvcik7XG4gICAgICB9IGZpbmFsbHkge1xuICAgICAgICBoaWRlTG9hZGluZyhcInNpZ251cEJ0blwiLCBcInNpZ251cFNwaW5uZXJcIik7XG4gICAgICAgIGlmICh3aW5kb3cudHVybnN0aWxlICYmIHR1cm5zdGlsZVdpZGdldElkKSB7XG4gICAgICAgICAgd2luZG93LnR1cm5zdGlsZS5yZXNldCh0dXJuc3RpbGVXaWRnZXRJZCk7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJUdXJuc3RpbGUgd2lkZ2V0IGhhcyBiZWVuIHJlc2V0LlwiKTtcbiAgICAgICAgfVxuICAgICAgICBjYXB0Y2hhVG9rZW4gPSBudWxsOyAvLyBDbGVhciB0b2tlbiBhZnRlciB1c2VcbiAgICAgIH1cbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmVycm9yKFwiU2lnbnVwIGZvcm0gKHNpZ251cEZvcm0pIG5vdCBmb3VuZC5cIik7XG4gIH1cblxuICBpZiAoZ29vZ2xlU2lnblVwQnRuKSB7XG4gICAgZ29vZ2xlU2lnblVwQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBzaG93TG9hZGluZyhcImdvb2dsZVNpZ25VcEJ0blwiLCBcImdvb2dsZVNpZ25VcFNwaW5uZXJcIik7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLnNpZ25JbldpdGhPQXV0aCh7XG4gICAgICAgICAgcHJvdmlkZXI6IFwiZ29vZ2xlXCIsXG4gICAgICAgICAgb3B0aW9uczogeyByZWRpcmVjdFRvOiBgJHt3aW5kb3cubG9jYXRpb24ub3JpZ2lufS9wcm9maWxlLmh0bWxgIH0sXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2lnbmluZyB1cCB3aXRoIEdvb2dsZTpcIiwgZXJyb3IpO1xuICAgICAgICAgIHNob3dFcnJvcihcbiAgICAgICAgICAgIGVycm9yLm1lc3NhZ2UgfHwgXCJFcnJldXIgbG9ycyBkZSBsJ2luc2NyaXB0aW9uIGF2ZWMgR29vZ2xlLlwiXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkV4Y2VwdGlvbiBkdXJpbmcgR29vZ2xlIHNpZ24tdXA6XCIsIGVycm9yKTtcbiAgICAgICAgc2hvd0Vycm9yKFxuICAgICAgICAgIFwiVW5lIGV4Y2VwdGlvbiBlc3Qgc3VydmVudWUgbG9ycyBkZSBsJ2luc2NyaXB0aW9uIGF2ZWMgR29vZ2xlLlwiXG4gICAgICAgICk7XG4gICAgICB9IGZpbmFsbHkge1xuICAgICAgICBoaWRlTG9hZGluZyhcImdvb2dsZVNpZ25VcEJ0blwiLCBcImdvb2dsZVNpZ25VcFNwaW5uZXJcIik7XG4gICAgICB9XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS53YXJuKFwiR29vZ2xlIFNpZ24tVXAgYnV0dG9uIChnb29nbGVTaWduVXBCdG4pIG5vdCBmb3VuZC5cIik7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuICBpbml0U2lnbnVwUGFnZSxcbn07XG4iLCIvLyBzcmMvZW50cmllcy9zaWdudXAuanNcbi8qKlxuICogU2lnbnVwIEVudHJ5IFBvaW50XG4gKlxuICogVGhpcyBtb2R1bGUgc2VydmVzIGFzIHRoZSBlbnRyeSBwb2ludCBmb3IgdGhlIHNpZ251cCBwYWdlLlxuICovXG5cbi8vIEltcG9ydCBvdXIgc2lnbnVwIG1vZHVsZVxuaW1wb3J0IHsgaW5pdFNpZ251cFBhZ2UgfSBmcm9tIFwiLi4vYXV0aC9zaWdudXAuanNcIjtcblxuLy8gSW5pdGlhbGl6ZSBzaWdudXAgcGFnZSB3aGVuIERPTSBpcyBsb2FkZWRcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+IHtcbiAgLy8gSW5pdGlhbGl6ZSBzaWdudXAgcGFnZVxuICBpbml0U2lnbnVwUGFnZSgpO1xuXG4gIGNvbnNvbGUubG9nKFwiU2lnbnVwIHBhZ2UgaW5pdGlhbGl6ZWRcIik7XG59KTtcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4vLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuX193ZWJwYWNrX3JlcXVpcmVfXy5tID0gX193ZWJwYWNrX21vZHVsZXNfXztcblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5mID0ge307XG4vLyBUaGlzIGZpbGUgY29udGFpbnMgb25seSB0aGUgZW50cnkgY2h1bmsuXG4vLyBUaGUgY2h1bmsgbG9hZGluZyBmdW5jdGlvbiBmb3IgYWRkaXRpb25hbCBjaHVua3Ncbl9fd2VicGFja19yZXF1aXJlX18uZSA9IChjaHVua0lkKSA9PiB7XG5cdHJldHVybiBQcm9taXNlLmFsbChPYmplY3Qua2V5cyhfX3dlYnBhY2tfcmVxdWlyZV9fLmYpLnJlZHVjZSgocHJvbWlzZXMsIGtleSkgPT4ge1xuXHRcdF9fd2VicGFja19yZXF1aXJlX18uZltrZXldKGNodW5rSWQsIHByb21pc2VzKTtcblx0XHRyZXR1cm4gcHJvbWlzZXM7XG5cdH0sIFtdKSk7XG59OyIsIi8vIFRoaXMgZnVuY3Rpb24gYWxsb3cgdG8gcmVmZXJlbmNlIGFzeW5jIGNodW5rc1xuX193ZWJwYWNrX3JlcXVpcmVfXy51ID0gKGNodW5rSWQpID0+IHtcblx0Ly8gcmV0dXJuIHVybCBmb3IgZmlsZW5hbWVzIGJhc2VkIG9uIHRlbXBsYXRlXG5cdHJldHVybiBcImpzL1wiICsgY2h1bmtJZCArIFwiLmJ1bmRsZS5qc1wiO1xufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLmcgPSAoZnVuY3Rpb24oKSB7XG5cdGlmICh0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gJ29iamVjdCcpIHJldHVybiBnbG9iYWxUaGlzO1xuXHR0cnkge1xuXHRcdHJldHVybiB0aGlzIHx8IG5ldyBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpO1xuXHR9IGNhdGNoIChlKSB7XG5cdFx0aWYgKHR5cGVvZiB3aW5kb3cgPT09ICdvYmplY3QnKSByZXR1cm4gd2luZG93O1xuXHR9XG59KSgpOyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSAoZXhwb3J0cykgPT4ge1xuXHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcblx0fVxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xufTsiLCJ2YXIgc2NyaXB0VXJsO1xuaWYgKF9fd2VicGFja19yZXF1aXJlX18uZy5pbXBvcnRTY3JpcHRzKSBzY3JpcHRVcmwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLmcubG9jYXRpb24gKyBcIlwiO1xudmFyIGRvY3VtZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXy5nLmRvY3VtZW50O1xuaWYgKCFzY3JpcHRVcmwgJiYgZG9jdW1lbnQpIHtcblx0aWYgKGRvY3VtZW50LmN1cnJlbnRTY3JpcHQgJiYgZG9jdW1lbnQuY3VycmVudFNjcmlwdC50YWdOYW1lLnRvVXBwZXJDYXNlKCkgPT09ICdTQ1JJUFQnKVxuXHRcdHNjcmlwdFVybCA9IGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuc3JjO1xuXHRpZiAoIXNjcmlwdFVybCkge1xuXHRcdHZhciBzY3JpcHRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIik7XG5cdFx0aWYoc2NyaXB0cy5sZW5ndGgpIHtcblx0XHRcdHZhciBpID0gc2NyaXB0cy5sZW5ndGggLSAxO1xuXHRcdFx0d2hpbGUgKGkgPiAtMSAmJiAoIXNjcmlwdFVybCB8fCAhL15odHRwKHM/KTovLnRlc3Qoc2NyaXB0VXJsKSkpIHNjcmlwdFVybCA9IHNjcmlwdHNbaS0tXS5zcmM7XG5cdFx0fVxuXHR9XG59XG4vLyBXaGVuIHN1cHBvcnRpbmcgYnJvd3NlcnMgd2hlcmUgYW4gYXV0b21hdGljIHB1YmxpY1BhdGggaXMgbm90IHN1cHBvcnRlZCB5b3UgbXVzdCBzcGVjaWZ5IGFuIG91dHB1dC5wdWJsaWNQYXRoIG1hbnVhbGx5IHZpYSBjb25maWd1cmF0aW9uXG4vLyBvciBwYXNzIGFuIGVtcHR5IHN0cmluZyAoXCJcIikgYW5kIHNldCB0aGUgX193ZWJwYWNrX3B1YmxpY19wYXRoX18gdmFyaWFibGUgZnJvbSB5b3VyIGNvZGUgdG8gdXNlIHlvdXIgb3duIGxvZ2ljLlxuaWYgKCFzY3JpcHRVcmwpIHRocm93IG5ldyBFcnJvcihcIkF1dG9tYXRpYyBwdWJsaWNQYXRoIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhpcyBicm93c2VyXCIpO1xuc2NyaXB0VXJsID0gc2NyaXB0VXJsLnJlcGxhY2UoL15ibG9iOi8sIFwiXCIpLnJlcGxhY2UoLyMuKiQvLCBcIlwiKS5yZXBsYWNlKC9cXD8uKiQvLCBcIlwiKS5yZXBsYWNlKC9cXC9bXlxcL10rJC8sIFwiL1wiKTtcbl9fd2VicGFja19yZXF1aXJlX18ucCA9IHNjcmlwdFVybCArIFwiLi4vXCI7IiwiLy8gbm8gYmFzZVVSSVxuXG4vLyBvYmplY3QgdG8gc3RvcmUgbG9hZGVkIGFuZCBsb2FkaW5nIGNodW5rc1xuLy8gdW5kZWZpbmVkID0gY2h1bmsgbm90IGxvYWRlZCwgbnVsbCA9IGNodW5rIHByZWxvYWRlZC9wcmVmZXRjaGVkXG4vLyBbcmVzb2x2ZSwgcmVqZWN0LCBQcm9taXNlXSA9IGNodW5rIGxvYWRpbmcsIDAgPSBjaHVuayBsb2FkZWRcbnZhciBpbnN0YWxsZWRDaHVua3MgPSB7XG5cdDc4NzogMFxufTtcblxuX193ZWJwYWNrX3JlcXVpcmVfXy5mLmogPSAoY2h1bmtJZCwgcHJvbWlzZXMpID0+IHtcblx0XHQvLyBKU09OUCBjaHVuayBsb2FkaW5nIGZvciBqYXZhc2NyaXB0XG5cdFx0dmFyIGluc3RhbGxlZENodW5rRGF0YSA9IF9fd2VicGFja19yZXF1aXJlX18ubyhpbnN0YWxsZWRDaHVua3MsIGNodW5rSWQpID8gaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdIDogdW5kZWZpbmVkO1xuXHRcdGlmKGluc3RhbGxlZENodW5rRGF0YSAhPT0gMCkgeyAvLyAwIG1lYW5zIFwiYWxyZWFkeSBpbnN0YWxsZWRcIi5cblxuXHRcdFx0Ly8gYSBQcm9taXNlIG1lYW5zIFwiY3VycmVudGx5IGxvYWRpbmdcIi5cblx0XHRcdGlmKGluc3RhbGxlZENodW5rRGF0YSkge1xuXHRcdFx0XHRwcm9taXNlcy5wdXNoKGluc3RhbGxlZENodW5rRGF0YVsyXSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZih0cnVlKSB7IC8vIGFsbCBjaHVua3MgaGF2ZSBKU1xuXHRcdFx0XHRcdC8vIHNldHVwIFByb21pc2UgaW4gY2h1bmsgY2FjaGVcblx0XHRcdFx0XHR2YXIgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IChpbnN0YWxsZWRDaHVua0RhdGEgPSBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gPSBbcmVzb2x2ZSwgcmVqZWN0XSkpO1xuXHRcdFx0XHRcdHByb21pc2VzLnB1c2goaW5zdGFsbGVkQ2h1bmtEYXRhWzJdID0gcHJvbWlzZSk7XG5cblx0XHRcdFx0XHQvLyBzdGFydCBjaHVuayBsb2FkaW5nXG5cdFx0XHRcdFx0dmFyIHVybCA9IF9fd2VicGFja19yZXF1aXJlX18ucCArIF9fd2VicGFja19yZXF1aXJlX18udShjaHVua0lkKTtcblx0XHRcdFx0XHQvLyBjcmVhdGUgZXJyb3IgYmVmb3JlIHN0YWNrIHVud291bmQgdG8gZ2V0IHVzZWZ1bCBzdGFja3RyYWNlIGxhdGVyXG5cdFx0XHRcdFx0dmFyIGVycm9yID0gbmV3IEVycm9yKCk7XG5cdFx0XHRcdFx0dmFyIGxvYWRpbmdFbmRlZCA9IChldmVudCkgPT4ge1xuXHRcdFx0XHRcdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGluc3RhbGxlZENodW5rcywgY2h1bmtJZCkpIHtcblx0XHRcdFx0XHRcdFx0aW5zdGFsbGVkQ2h1bmtEYXRhID0gaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdO1xuXHRcdFx0XHRcdFx0XHRpZihpbnN0YWxsZWRDaHVua0RhdGEgIT09IDApIGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA9IHVuZGVmaW5lZDtcblx0XHRcdFx0XHRcdFx0aWYoaW5zdGFsbGVkQ2h1bmtEYXRhKSB7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIGVycm9yVHlwZSA9IGV2ZW50ICYmIChldmVudC50eXBlID09PSAnbG9hZCcgPyAnbWlzc2luZycgOiBldmVudC50eXBlKTtcblx0XHRcdFx0XHRcdFx0XHR2YXIgcmVhbFNyYyA9IGV2ZW50ICYmIGV2ZW50LnRhcmdldCAmJiBldmVudC50YXJnZXQuc3JjO1xuXHRcdFx0XHRcdFx0XHRcdGVycm9yLm1lc3NhZ2UgPSAnTG9hZGluZyBjaHVuayAnICsgY2h1bmtJZCArICcgZmFpbGVkLlxcbignICsgZXJyb3JUeXBlICsgJzogJyArIHJlYWxTcmMgKyAnKSc7XG5cdFx0XHRcdFx0XHRcdFx0ZXJyb3IubmFtZSA9ICdDaHVua0xvYWRFcnJvcic7XG5cdFx0XHRcdFx0XHRcdFx0ZXJyb3IudHlwZSA9IGVycm9yVHlwZTtcblx0XHRcdFx0XHRcdFx0XHRlcnJvci5yZXF1ZXN0ID0gcmVhbFNyYztcblx0XHRcdFx0XHRcdFx0XHRpbnN0YWxsZWRDaHVua0RhdGFbMV0oZXJyb3IpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmwodXJsLCBsb2FkaW5nRW5kZWQsIFwiY2h1bmstXCIgKyBjaHVua0lkLCBjaHVua0lkKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cbn07XG5cbi8vIG5vIHByZWZldGNoaW5nXG5cbi8vIG5vIHByZWxvYWRlZFxuXG4vLyBubyBITVJcblxuLy8gbm8gSE1SIG1hbmlmZXN0XG5cbl9fd2VicGFja19yZXF1aXJlX18uTy5qID0gKGNodW5rSWQpID0+IChpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gPT09IDApO1xuXG4vLyBpbnN0YWxsIGEgSlNPTlAgY2FsbGJhY2sgZm9yIGNodW5rIGxvYWRpbmdcbnZhciB3ZWJwYWNrSnNvbnBDYWxsYmFjayA9IChwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbiwgZGF0YSkgPT4ge1xuXHR2YXIgW2NodW5rSWRzLCBtb3JlTW9kdWxlcywgcnVudGltZV0gPSBkYXRhO1xuXHQvLyBhZGQgXCJtb3JlTW9kdWxlc1wiIHRvIHRoZSBtb2R1bGVzIG9iamVjdCxcblx0Ly8gdGhlbiBmbGFnIGFsbCBcImNodW5rSWRzXCIgYXMgbG9hZGVkIGFuZCBmaXJlIGNhbGxiYWNrXG5cdHZhciBtb2R1bGVJZCwgY2h1bmtJZCwgaSA9IDA7XG5cdGlmKGNodW5rSWRzLnNvbWUoKGlkKSA9PiAoaW5zdGFsbGVkQ2h1bmtzW2lkXSAhPT0gMCkpKSB7XG5cdFx0Zm9yKG1vZHVsZUlkIGluIG1vcmVNb2R1bGVzKSB7XG5cdFx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8obW9yZU1vZHVsZXMsIG1vZHVsZUlkKSkge1xuXHRcdFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLm1bbW9kdWxlSWRdID0gbW9yZU1vZHVsZXNbbW9kdWxlSWRdO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZihydW50aW1lKSB2YXIgcmVzdWx0ID0gcnVudGltZShfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblx0fVxuXHRpZihwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbikgcGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24oZGF0YSk7XG5cdGZvcig7aSA8IGNodW5rSWRzLmxlbmd0aDsgaSsrKSB7XG5cdFx0Y2h1bmtJZCA9IGNodW5rSWRzW2ldO1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhpbnN0YWxsZWRDaHVua3MsIGNodW5rSWQpICYmIGluc3RhbGxlZENodW5rc1tjaHVua0lkXSkge1xuXHRcdFx0aW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdWzBdKCk7XG5cdFx0fVxuXHRcdGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA9IDA7XG5cdH1cblx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18uTyhyZXN1bHQpO1xufVxuXG52YXIgY2h1bmtMb2FkaW5nR2xvYmFsID0gc2VsZltcIndlYnBhY2tDaHVua3VyYmFuZG9jc193ZWJhcHBcIl0gPSBzZWxmW1wid2VicGFja0NodW5rdXJiYW5kb2NzX3dlYmFwcFwiXSB8fCBbXTtcbmNodW5rTG9hZGluZ0dsb2JhbC5mb3JFYWNoKHdlYnBhY2tKc29ucENhbGxiYWNrLmJpbmQobnVsbCwgMCkpO1xuY2h1bmtMb2FkaW5nR2xvYmFsLnB1c2ggPSB3ZWJwYWNrSnNvbnBDYWxsYmFjay5iaW5kKG51bGwsIGNodW5rTG9hZGluZ0dsb2JhbC5wdXNoLmJpbmQoY2h1bmtMb2FkaW5nR2xvYmFsKSk7IiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vLyBUaGlzIGVudHJ5IG1vZHVsZSBkZXBlbmRzIG9uIG90aGVyIGxvYWRlZCBjaHVua3MgYW5kIGV4ZWN1dGlvbiBuZWVkIHRvIGJlIGRlbGF5ZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXy5PKHVuZGVmaW5lZCwgWzMwM10sICgpID0+IChfX3dlYnBhY2tfcmVxdWlyZV9fKDc5NykpKVxuX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18uTyhfX3dlYnBhY2tfZXhwb3J0c19fKTtcbiJdLCJuYW1lcyI6WyJkZWZlcnJlZCIsImxlYWZQcm90b3R5cGVzIiwiZ2V0UHJvdG8iLCJpblByb2dyZXNzIiwiZGF0YVdlYnBhY2tQcmVmaXgiLCJzdXBhYmFzZSIsInNob3dFcnJvciIsIm1lc3NhZ2UiLCJlbGVtZW50SWQiLCJlcnJvckVsZW1lbnQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiaW5uZXJIVE1MIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwiY29uc29sZSIsImVycm9yIiwic2hvd0xvYWRpbmciLCJidXR0b25JZCIsInNwaW5uZXJJZCIsImJ1dHRvbiIsInNwaW5uZXIiLCJkaXNhYmxlZCIsImhpZGVMb2FkaW5nIiwiYWRkIiwiY2FwdGNoYVRva2VuIiwidHVybnN0aWxlV2lkZ2V0SWQiLCJpbml0U2lnbnVwUGFnZSIsImxvZyIsInNpZ251cEZvcm0iLCJlcnJvck1lc3NhZ2VEaXYiLCJzdGF0dXNNZXNzYWdlIiwiZ29vZ2xlU2lnblVwQnRuIiwiYWRkRXZlbnRMaXN0ZW5lciIsImFzeW5jIiwiZSIsInByZXZlbnREZWZhdWx0IiwiZW1haWwiLCJ2YWx1ZSIsInRyaW0iLCJwYXNzd29yZCIsImNvbmZpcm1QYXNzd29yZCIsInBob25lIiwidmFsaWRhdGlvbkVycm9ycyIsInRlc3QiLCJwdXNoIiwibGVuZ3RoIiwiam9pbiIsInN0YXJ0c1dpdGgiLCJlMTY0UGhvbmUiLCJzdWJzdHJpbmciLCJkYXRhIiwic2lnblVwRXJyb3IiLCJhdXRoIiwic2lnblVwIiwib3B0aW9ucyIsInVzZXIiLCJFcnJvciIsInR5cGUiLCJzdGF0dXNFbGVtZW50IiwidGV4dENvbnRlbnQiLCJmb3JFYWNoIiwiY2xhc3NOYW1lIiwic2hvd1N0YXR1cyIsInJlc2V0IiwiZGlzcGxheUVycm9yIiwiaW5jbHVkZXMiLCJ0b0xvd2VyQ2FzZSIsIndpbmRvdyIsInR1cm5zdGlsZSIsInNpZ25JbldpdGhPQXV0aCIsInByb3ZpZGVyIiwicmVkaXJlY3RUbyIsImxvY2F0aW9uIiwib3JpZ2luIiwid2FybiIsIm9ubG9hZFR1cm5zdGlsZUNhbGxiYWNrIiwidHVybnN0aWxlQ29udGFpbmVyIiwicmVuZGVyIiwic2l0ZWtleSIsImNhbGxiYWNrIiwidG9rZW4iLCJlcnIiLCJ1bmRlZmluZWQiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsImNhbGwiLCJtIiwiTyIsInJlc3VsdCIsImNodW5rSWRzIiwiZm4iLCJwcmlvcml0eSIsIm5vdEZ1bGZpbGxlZCIsIkluZmluaXR5IiwiaSIsImZ1bGZpbGxlZCIsImoiLCJPYmplY3QiLCJrZXlzIiwiZXZlcnkiLCJrZXkiLCJzcGxpY2UiLCJyIiwiZ2V0UHJvdG90eXBlT2YiLCJvYmoiLCJ0IiwibW9kZSIsInRoaXMiLCJfX2VzTW9kdWxlIiwidGhlbiIsIm5zIiwiY3JlYXRlIiwiZGVmIiwiY3VycmVudCIsImluZGV4T2YiLCJnZXRPd25Qcm9wZXJ0eU5hbWVzIiwiZCIsImRlZmluaXRpb24iLCJvIiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiZiIsImNodW5rSWQiLCJQcm9taXNlIiwiYWxsIiwicmVkdWNlIiwicHJvbWlzZXMiLCJ1IiwiZyIsImdsb2JhbFRoaXMiLCJGdW5jdGlvbiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImwiLCJ1cmwiLCJkb25lIiwic2NyaXB0IiwibmVlZEF0dGFjaCIsInNjcmlwdHMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInMiLCJnZXRBdHRyaWJ1dGUiLCJjcmVhdGVFbGVtZW50IiwiY2hhcnNldCIsInRpbWVvdXQiLCJuYyIsInNldEF0dHJpYnV0ZSIsInNyYyIsIm9uU2NyaXB0Q29tcGxldGUiLCJwcmV2IiwiZXZlbnQiLCJvbmVycm9yIiwib25sb2FkIiwiY2xlYXJUaW1lb3V0IiwiZG9uZUZucyIsInBhcmVudE5vZGUiLCJyZW1vdmVDaGlsZCIsInNldFRpbWVvdXQiLCJiaW5kIiwidGFyZ2V0IiwiaGVhZCIsImFwcGVuZENoaWxkIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJzY3JpcHRVcmwiLCJpbXBvcnRTY3JpcHRzIiwiY3VycmVudFNjcmlwdCIsInRhZ05hbWUiLCJ0b1VwcGVyQ2FzZSIsInJlcGxhY2UiLCJwIiwiaW5zdGFsbGVkQ2h1bmtzIiwiaW5zdGFsbGVkQ2h1bmtEYXRhIiwicHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJlcnJvclR5cGUiLCJyZWFsU3JjIiwibmFtZSIsInJlcXVlc3QiLCJ3ZWJwYWNrSnNvbnBDYWxsYmFjayIsInBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uIiwibW9yZU1vZHVsZXMiLCJydW50aW1lIiwic29tZSIsImlkIiwiY2h1bmtMb2FkaW5nR2xvYmFsIiwic2VsZiIsIl9fd2VicGFja19leHBvcnRzX18iXSwic291cmNlUm9vdCI6IiJ9