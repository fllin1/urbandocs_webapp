(()=>{"use strict";var e,t,n,r,o,i={797:(e,t,n)=>{const r=(0,n(303).UU)("https://ofeyssipibktmbfebibo.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9mZXlzc2lwaWJrdG1iZmViaWJvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM5MjUwOTQsImV4cCI6MjA1OTUwMTA5NH0.w71CAKfolktzRl-TmLVhHYaEbhCfVk4A7YraEUCglrU");function o(e,t="errorMessage"){const n=document.getElementById(t);n?(n.innerHTML=e,n.classList.remove("hidden")):console.error("Error element not found:",t)}function i(e,t){const n=document.getElementById(e),r=document.getElementById(t);n&&(n.disabled=!0),r&&r.classList.remove("hidden")}function s(e,t){const n=document.getElementById(e),r=document.getElementById(t);n&&(n.disabled=!1),r&&r.classList.add("hidden")}let l=null,a=null;function u(){console.log("initSignupPage called");const e=document.getElementById("signupForm"),t=(document.getElementById("errorMessage"),document.getElementById("statusMessage"),document.getElementById("googleSignUpBtn"));document.getElementById("turnstile-container")||console.error("#turnstile-container not found in the DOM. CAPTCHA cannot be rendered."),e?e.addEventListener("submit",(async t=>{t.preventDefault();const n=document.getElementById("email").value.trim(),u=document.getElementById("password").value,d=document.getElementById("confirmPassword").value;let c=document.getElementById("phone").value.trim(),p=[];if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)||p.push("L'adresse email n'est pas valide."),u!==d&&p.push("Les mots de passe ne correspondent pas."),(!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/.test(u)||u.length<8)&&p.push("Le format du mot de passe est invalide."),c||p.push("Le numéro de téléphone est requis."),c&&!/^(0|\+33)[1-9]\d{8}$/.test(c)&&p.push("Le format du numéro de téléphone est invalide (ex: 0612345678 ou +33612345678)."),l||p.push("Veuillez compléter le CAPTCHA."),p.length>0)o(p.join("<br>"));else{i("signupBtn","signupSpinner");try{let t=c;c.startsWith("0")&&(t=`+33${c.substring(1)}`);const{data:o,error:i}=await r.auth.signUp({email:n,password:u,options:{captchaToken:l}});if(i)throw i;if(!o.user)throw new Error("Erreur lors de la création de l'utilisateur.");t&&o.user.id&&await r.from("profiles").update({phone:t}).eq("id",o.user.id),function(e,t="info",n="statusMessage"){const r=document.getElementById(n);r?(r.textContent=e,r.classList.forEach((e=>{e.startsWith("alert-")&&r.classList.remove(e)})),r.classList.add(`alert-${t}`),r.classList.remove("hidden")):console.error("Status element not found:",n)}("Compte créé ! Un email de confirmation a été envoyé.","success"),e&&(e.classList.add("hidden"),e.reset())}catch(e){console.error("Email/Password Signup error:",e);let t=e.message||"Une erreur est survenue.";e.message&&e.message.includes("User already registered")?t="Cette adresse email est déjà utilisée. Veuillez vous connecter ou utiliser une autre adresse.":e.message&&e.message.includes("Unable to validate phone number")?t="Le numéro de téléphone fourni n'est pas valide.":e.message&&e.message.toLowerCase().includes("captcha protection")&&(t="Erreur CAPTCHA du serveur. Veuillez réessayer. ("+e.message+")"),o(t)}finally{s("signupBtn","signupSpinner"),window.turnstile&&a&&(window.turnstile.reset(a),console.log("Turnstile widget has been reset.")),l=null}}})):console.error("Signup form (signupForm) not found."),t?t.addEventListener("click",(async()=>{i("googleSignUpBtn","googleSignUpSpinner");try{const{error:e}=await r.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/profile.html`}});e&&(console.error("Error signing up with Google:",e),o(e.message||"Erreur lors de l'inscription avec Google."))}catch(e){console.error("Exception during Google sign-up:",e),o("Une exception est survenue lors de l'inscription avec Google.")}finally{s("googleSignUpBtn","googleSignUpSpinner")}})):console.warn("Google Sign-Up button (googleSignUpBtn) not found.")}window.onloadTurnstileCallback=function(){console.log("Turnstile API ready (onloadTurnstileCallback executed).");const e=document.getElementById("turnstile-container");if(e&&window.turnstile&&!a){console.log("Rendering Turnstile widget from onloadTurnstileCallback...");try{a=window.turnstile.render(e,{sitekey:"0x4AAAAAABdzY3InOU2_In99",callback:function(e){l=e,console.log("Turnstile token obtained:",e)},"expired-callback":()=>{console.log("Turnstile token expired. Resetting widget. ID:",a),window.turnstile&&a&&window.turnstile.reset(a),l=null},"error-callback":e=>{l=null,console.error("Turnstile error callback:",e),o(`Erreur CAPTCHA: ${e}. Veuillez réessayer.`)}}),void 0===a?(console.error("Turnstile.render did not return a widgetId. Sitekey or container issue?"),o("Erreur initialisation CAPTCHA (ID widget non retourné).")):console.log("Turnstile widget rendered. ID:",a)}catch(e){console.error("Error rendering Turnstile:",e),o("Impossible d'afficher le CAPTCHA.")}}else e?window.turnstile?a&&console.log("onloadTurnstileCallback: Widget already seems rendered."):console.error("onloadTurnstileCallback: window.turnstile API not found."):console.error("onloadTurnstileCallback: #turnstile-container not found.")},document.addEventListener("DOMContentLoaded",(()=>{u(),console.log("Signup page initialized")}))}},s={};function l(e){var t=s[e];if(void 0!==t)return t.exports;var n=s[e]={exports:{}};return i[e].call(n.exports,n,n.exports,l),n.exports}l.m=i,e=[],l.O=(t,n,r,o)=>{if(!n){var i=1/0;for(d=0;d<e.length;d++){for(var[n,r,o]=e[d],s=!0,a=0;a<n.length;a++)(!1&o||i>=o)&&Object.keys(l.O).every((e=>l.O[e](n[a])))?n.splice(a--,1):(s=!1,o<i&&(i=o));if(s){e.splice(d--,1);var u=r();void 0!==u&&(t=u)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[n,r,o]},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,l.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var o=Object.create(null);l.r(o);var i={};t=t||[null,n({}),n([]),n(n)];for(var s=2&r&&e;"object"==typeof s&&!~t.indexOf(s);s=n(s))Object.getOwnPropertyNames(s).forEach((t=>i[t]=()=>e[t]));return i.default=()=>e,l.d(o,i),o},l.d=(e,t)=>{for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},l.f={},l.e=e=>Promise.all(Object.keys(l.f).reduce(((t,n)=>(l.f[n](e,t),t)),[])),l.u=e=>"js/"+e+".bundle.js",l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r={},o="urbandocs_webapp:",l.l=(e,t,n,i)=>{if(r[e])r[e].push(t);else{var s,a;if(void 0!==n)for(var u=document.getElementsByTagName("script"),d=0;d<u.length;d++){var c=u[d];if(c.getAttribute("src")==e||c.getAttribute("data-webpack")==o+n){s=c;break}}s||(a=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,l.nc&&s.setAttribute("nonce",l.nc),s.setAttribute("data-webpack",o+n),s.src=e),r[e]=[t];var p=(t,n)=>{s.onerror=s.onload=null,clearTimeout(g);var o=r[e];if(delete r[e],s.parentNode&&s.parentNode.removeChild(s),o&&o.forEach((e=>e(n))),t)return t(n)},g=setTimeout(p.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=p.bind(null,s.onerror),s.onload=p.bind(null,s.onload),a&&document.head.appendChild(s)}},l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;l.g.importScripts&&(e=l.g.location+"");var t=l.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=n[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),l.p=e+"../"})(),(()=>{var e={787:0};l.f.j=(t,n)=>{var r=l.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var o=new Promise(((n,o)=>r=e[t]=[n,o]));n.push(r[2]=o);var i=l.p+l.u(t),s=new Error;l.l(i,(n=>{if(l.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;s.message="Loading chunk "+t+" failed.\n("+o+": "+i+")",s.name="ChunkLoadError",s.type=o,s.request=i,r[1](s)}}),"chunk-"+t,t)}},l.O.j=t=>0===e[t];var t=(t,n)=>{var r,o,[i,s,a]=n,u=0;if(i.some((t=>0!==e[t]))){for(r in s)l.o(s,r)&&(l.m[r]=s[r]);if(a)var d=a(l)}for(t&&t(n);u<i.length;u++)o=i[u],l.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return l.O(d)},n=self.webpackChunkurbandocs_webapp=self.webpackChunkurbandocs_webapp||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a=l.O(void 0,[303],(()=>l(797)));a=l.O(a)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEVBQXVCLENBQUNDLEVBQTRCOUksS0FDdkQsSUFHSXVDLEVBQVUyQyxHQUhUbEMsRUFBVStGLEVBQWFDLEdBQVdoSixFQUdoQnFELEVBQUksRUFDM0IsR0FBR0wsRUFBU2lHLE1BQU0xSSxHQUFnQyxJQUF4QjZILEVBQWdCN0gsS0FBYSxDQUN0RCxJQUFJZ0MsS0FBWXdHLEVBQ1p6RyxFQUFvQnVDLEVBQUVrRSxFQUFheEcsS0FDckNELEVBQW9CTyxFQUFFTixHQUFZd0csRUFBWXhHLElBR2hELEdBQUd5RyxFQUFTLElBQUlqRyxFQUFTaUcsRUFBUTFHLEVBQ2xDLENBRUEsSUFER3dHLEdBQTRCQSxFQUEyQjlJLEdBQ3JEcUQsRUFBSUwsRUFBU3JELE9BQVEwRCxJQUN6QjZCLEVBQVVsQyxFQUFTSyxHQUNoQmYsRUFBb0J1QyxFQUFFdUQsRUFBaUJsRCxJQUFZa0QsRUFBZ0JsRCxJQUNyRWtELEVBQWdCbEQsR0FBUyxLQUUxQmtELEVBQWdCbEQsR0FBVyxFQUU1QixPQUFPNUMsRUFBb0JRLEVBQUVDLEVBQU8sRUFHakNtRyxFQUFxQkMsS0FBbUMsNkJBQUlBLEtBQW1DLDhCQUFLLEdBQ3hHRCxFQUFtQnBJLFFBQVErSCxFQUFxQnRCLEtBQUssS0FBTSxJQUMzRDJCLEVBQW1CeEosS0FBT21KLEVBQXFCdEIsS0FBSyxLQUFNMkIsRUFBbUJ4SixLQUFLNkgsS0FBSzJCLEcsS0NsRnZGLElBQUlFLEVBQXNCOUcsRUFBb0JRLE9BQUVWLEVBQVcsQ0FBQyxNQUFNLElBQU9FLEVBQW9CLE9BQzdGOEcsRUFBc0I5RyxFQUFvQlEsRUFBRXNHLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9jaHVuayBsb2FkZWQiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvY3JlYXRlIGZha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9sb2FkIHNjcmlwdCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwLy4vc3JjL2pzL3N1cGFiYXNlLWNsaWVudC5qcyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwLy4vc3JjL2pzL2F1dGgvYXV0aC5qcyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwLy4vc3JjL2pzL2F1dGgvc2lnbnVwLmpzIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvLi9zcmMvanMvZW50cmllcy9zaWdudXAuanMiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9lbnN1cmUgY2h1bmsiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvZ2V0IGphdmFzY3JpcHQgY2h1bmsgZmlsZW5hbWUiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvZ2xvYmFsIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvcHVibGljUGF0aCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9qc29ucCBjaHVuayBsb2FkaW5nIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9zdGFydHVwIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBkZWZlcnJlZCA9IFtdO1xuX193ZWJwYWNrX3JlcXVpcmVfXy5PID0gKHJlc3VsdCwgY2h1bmtJZHMsIGZuLCBwcmlvcml0eSkgPT4ge1xuXHRpZihjaHVua0lkcykge1xuXHRcdHByaW9yaXR5ID0gcHJpb3JpdHkgfHwgMDtcblx0XHRmb3IodmFyIGkgPSBkZWZlcnJlZC5sZW5ndGg7IGkgPiAwICYmIGRlZmVycmVkW2kgLSAxXVsyXSA+IHByaW9yaXR5OyBpLS0pIGRlZmVycmVkW2ldID0gZGVmZXJyZWRbaSAtIDFdO1xuXHRcdGRlZmVycmVkW2ldID0gW2NodW5rSWRzLCBmbiwgcHJpb3JpdHldO1xuXHRcdHJldHVybjtcblx0fVxuXHR2YXIgbm90RnVsZmlsbGVkID0gSW5maW5pdHk7XG5cdGZvciAodmFyIGkgPSAwOyBpIDwgZGVmZXJyZWQubGVuZ3RoOyBpKyspIHtcblx0XHR2YXIgW2NodW5rSWRzLCBmbiwgcHJpb3JpdHldID0gZGVmZXJyZWRbaV07XG5cdFx0dmFyIGZ1bGZpbGxlZCA9IHRydWU7XG5cdFx0Zm9yICh2YXIgaiA9IDA7IGogPCBjaHVua0lkcy5sZW5ndGg7IGorKykge1xuXHRcdFx0aWYgKChwcmlvcml0eSAmIDEgPT09IDAgfHwgbm90RnVsZmlsbGVkID49IHByaW9yaXR5KSAmJiBPYmplY3Qua2V5cyhfX3dlYnBhY2tfcmVxdWlyZV9fLk8pLmV2ZXJ5KChrZXkpID0+IChfX3dlYnBhY2tfcmVxdWlyZV9fLk9ba2V5XShjaHVua0lkc1tqXSkpKSkge1xuXHRcdFx0XHRjaHVua0lkcy5zcGxpY2Uoai0tLCAxKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGZ1bGZpbGxlZCA9IGZhbHNlO1xuXHRcdFx0XHRpZihwcmlvcml0eSA8IG5vdEZ1bGZpbGxlZCkgbm90RnVsZmlsbGVkID0gcHJpb3JpdHk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmKGZ1bGZpbGxlZCkge1xuXHRcdFx0ZGVmZXJyZWQuc3BsaWNlKGktLSwgMSlcblx0XHRcdHZhciByID0gZm4oKTtcblx0XHRcdGlmIChyICE9PSB1bmRlZmluZWQpIHJlc3VsdCA9IHI7XG5cdFx0fVxuXHR9XG5cdHJldHVybiByZXN1bHQ7XG59OyIsInZhciBnZXRQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiA/IChvYmopID0+IChPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqKSkgOiAob2JqKSA9PiAob2JqLl9fcHJvdG9fXyk7XG52YXIgbGVhZlByb3RvdHlwZXM7XG4vLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3Rcbi8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuLy8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4vLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3Rcbi8vIG1vZGUgJiAxNjogcmV0dXJuIHZhbHVlIHdoZW4gaXQncyBQcm9taXNlLWxpa2Vcbi8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbl9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG5cdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IHRoaXModmFsdWUpO1xuXHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuXHRpZih0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlKSB7XG5cdFx0aWYoKG1vZGUgJiA0KSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG5cdFx0aWYoKG1vZGUgJiAxNikgJiYgdHlwZW9mIHZhbHVlLnRoZW4gPT09ICdmdW5jdGlvbicpIHJldHVybiB2YWx1ZTtcblx0fVxuXHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuXHR2YXIgZGVmID0ge307XG5cdGxlYWZQcm90b3R5cGVzID0gbGVhZlByb3RvdHlwZXMgfHwgW251bGwsIGdldFByb3RvKHt9KSwgZ2V0UHJvdG8oW10pLCBnZXRQcm90byhnZXRQcm90byldO1xuXHRmb3IodmFyIGN1cnJlbnQgPSBtb2RlICYgMiAmJiB2YWx1ZTsgdHlwZW9mIGN1cnJlbnQgPT0gJ29iamVjdCcgJiYgIX5sZWFmUHJvdG90eXBlcy5pbmRleE9mKGN1cnJlbnQpOyBjdXJyZW50ID0gZ2V0UHJvdG8oY3VycmVudCkpIHtcblx0XHRPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhjdXJyZW50KS5mb3JFYWNoKChrZXkpID0+IChkZWZba2V5XSA9ICgpID0+ICh2YWx1ZVtrZXldKSkpO1xuXHR9XG5cdGRlZlsnZGVmYXVsdCddID0gKCkgPT4gKHZhbHVlKTtcblx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBkZWYpO1xuXHRyZXR1cm4gbnM7XG59OyIsInZhciBpblByb2dyZXNzID0ge307XG52YXIgZGF0YVdlYnBhY2tQcmVmaXggPSBcInVyYmFuZG9jc193ZWJhcHA6XCI7XG4vLyBsb2FkU2NyaXB0IGZ1bmN0aW9uIHRvIGxvYWQgYSBzY3JpcHQgdmlhIHNjcmlwdCB0YWdcbl9fd2VicGFja19yZXF1aXJlX18ubCA9ICh1cmwsIGRvbmUsIGtleSwgY2h1bmtJZCkgPT4ge1xuXHRpZihpblByb2dyZXNzW3VybF0pIHsgaW5Qcm9ncmVzc1t1cmxdLnB1c2goZG9uZSk7IHJldHVybjsgfVxuXHR2YXIgc2NyaXB0LCBuZWVkQXR0YWNoO1xuXHRpZihrZXkgIT09IHVuZGVmaW5lZCkge1xuXHRcdHZhciBzY3JpcHRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIik7XG5cdFx0Zm9yKHZhciBpID0gMDsgaSA8IHNjcmlwdHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdHZhciBzID0gc2NyaXB0c1tpXTtcblx0XHRcdGlmKHMuZ2V0QXR0cmlidXRlKFwic3JjXCIpID09IHVybCB8fCBzLmdldEF0dHJpYnV0ZShcImRhdGEtd2VicGFja1wiKSA9PSBkYXRhV2VicGFja1ByZWZpeCArIGtleSkgeyBzY3JpcHQgPSBzOyBicmVhazsgfVxuXHRcdH1cblx0fVxuXHRpZighc2NyaXB0KSB7XG5cdFx0bmVlZEF0dGFjaCA9IHRydWU7XG5cdFx0c2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG5cblx0XHRzY3JpcHQuY2hhcnNldCA9ICd1dGYtOCc7XG5cdFx0c2NyaXB0LnRpbWVvdXQgPSAxMjA7XG5cdFx0aWYgKF9fd2VicGFja19yZXF1aXJlX18ubmMpIHtcblx0XHRcdHNjcmlwdC5zZXRBdHRyaWJ1dGUoXCJub25jZVwiLCBfX3dlYnBhY2tfcmVxdWlyZV9fLm5jKTtcblx0XHR9XG5cdFx0c2NyaXB0LnNldEF0dHJpYnV0ZShcImRhdGEtd2VicGFja1wiLCBkYXRhV2VicGFja1ByZWZpeCArIGtleSk7XG5cblx0XHRzY3JpcHQuc3JjID0gdXJsO1xuXHR9XG5cdGluUHJvZ3Jlc3NbdXJsXSA9IFtkb25lXTtcblx0dmFyIG9uU2NyaXB0Q29tcGxldGUgPSAocHJldiwgZXZlbnQpID0+IHtcblx0XHQvLyBhdm9pZCBtZW0gbGVha3MgaW4gSUUuXG5cdFx0c2NyaXB0Lm9uZXJyb3IgPSBzY3JpcHQub25sb2FkID0gbnVsbDtcblx0XHRjbGVhclRpbWVvdXQodGltZW91dCk7XG5cdFx0dmFyIGRvbmVGbnMgPSBpblByb2dyZXNzW3VybF07XG5cdFx0ZGVsZXRlIGluUHJvZ3Jlc3NbdXJsXTtcblx0XHRzY3JpcHQucGFyZW50Tm9kZSAmJiBzY3JpcHQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChzY3JpcHQpO1xuXHRcdGRvbmVGbnMgJiYgZG9uZUZucy5mb3JFYWNoKChmbikgPT4gKGZuKGV2ZW50KSkpO1xuXHRcdGlmKHByZXYpIHJldHVybiBwcmV2KGV2ZW50KTtcblx0fVxuXHR2YXIgdGltZW91dCA9IHNldFRpbWVvdXQob25TY3JpcHRDb21wbGV0ZS5iaW5kKG51bGwsIHVuZGVmaW5lZCwgeyB0eXBlOiAndGltZW91dCcsIHRhcmdldDogc2NyaXB0IH0pLCAxMjAwMDApO1xuXHRzY3JpcHQub25lcnJvciA9IG9uU2NyaXB0Q29tcGxldGUuYmluZChudWxsLCBzY3JpcHQub25lcnJvcik7XG5cdHNjcmlwdC5vbmxvYWQgPSBvblNjcmlwdENvbXBsZXRlLmJpbmQobnVsbCwgc2NyaXB0Lm9ubG9hZCk7XG5cdG5lZWRBdHRhY2ggJiYgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpO1xufTsiLCIvLyBzcmMvanMvc3VwYWJhc2UtY2xpZW50LmpzXG4vKipcbiAqIFN1cGFiYXNlIENsaWVudFxuICogQG1vZHVsZSBzdXBhYmFzZS1jbGllbnRcbiAqIEBkZXNjcmlwdGlvbiBUaGlzIG1vZHVsZSBoYW5kbGVzIHRoZSBTdXBhYmFzZSBjbGllbnQgaW5pdGlhbGl6YXRpb24gYW5kIGNvbmZpZ3VyYXRpb24uXG4gKiBAdmVyc2lvbiAwLjAuMlxuICogQGF1dGhvciBHcmV5UGFuZGFcbiAqXG4gKiBAY2hhbmdlbG9nXG4gKiAtIDAuMC4yICgyMDI1LTA1LTI3KTogQWRkZWQgZW52aXJvbmVtZW50IHZhcmlhYmxlcyBlcnJvciBoYW5kbGluZyBmb3IgbWlzc2luZy5cbiAqIC0gMC4wLjEgKDIwMjUtMDUtMDkpOiBJbml0aWFsIHZlcnNpb24gd2l0aCBiYXNpYyBTdXBhYmFzZSBjbGllbnQgaW5pdGlhbGl6YXRpb24uXG4gKi9cblxuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSBcIkBzdXBhYmFzZS9zdXBhYmFzZS1qc1wiO1xuXG5jb25zdCBzdXBhYmFzZVVybCA9IFwiaHR0cHM6Ly9vZmV5c3NpcGlia3RtYmZlYmliby5zdXBhYmFzZS5jb1wiO1xuY29uc3Qgc3VwYWJhc2VBbm9uS2V5ID1cbiAgXCJleUpoYkdjaU9pSklVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKcGMzTWlPaUp6ZFhCaFltRnpaU0lzSW5KbFppSTZJbTltWlhsemMybHdhV0pyZEcxaVptVmlhV0p2SWl3aWNtOXNaU0k2SW1GdWIyNGlMQ0pwWVhRaU9qRTNORE01TWpVd09UUXNJbVY0Y0NJNk1qQTFPVFV3TVRBNU5IMC53NzFDQUtmb2xrdHpSbC1UbUxWaEhZYUViaENmVms0QTdZcmFFVUNnbHJVXCI7XG5cbmlmICghc3VwYWJhc2VVcmwgfHwgIXN1cGFiYXNlQW5vbktleSkge1xuICB0aHJvdyBuZXcgRXJyb3IoXCJNaXNzaW5nIFN1cGFiYXNlIGVudmlyb25tZW50IHZhcmlhYmxlc1wiKTtcbn1cblxuY29uc3QgY2xpZW50ID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXkpO1xuXG5leHBvcnQgY29uc3Qgc3VwYWJhc2UgPSBjbGllbnQ7XG4iLCIvLyBzcmMvYXV0aC9hdXRoLmpzXG4vKipcbiAqIEF1dGhlbnRpY2F0aW9uIE1vZHVsZSAtIEJhc2VcbiAqIEBtb2R1bGUgYXV0aFxuICogQGRlc2NyaXB0aW9uIEJhc2UgbW9kdWxlIGZvciBhdXRoZW50aWNhdGlvbiB3aXRoIGNvbW1vbiBmdW5jdGlvbnMgYW5kIGNvbmZpZ3VyYXRpb25cbiAqIEB2ZXJzaW9uIDAuMC41XG4gKlxuICogQGNoYW5nZWxvZ1xuICogLSAwLjAuNSAoMjAyNS0wNS0xNSk6IEFkZGVkIHNlc3Npb24gdmFsaWRhdGlvbiBhbmQgcHJvdGVjdGlvbiBhZ2FpbnN0IHN0YWxlIHNlc3Npb25zLlxuICogLSAwLjAuNCAoMjAyNS0wNS0xNSk6IFJlbW92YWwgb2YgRmlyZWJhc2UgQ2xvdWQgRnVuY3Rpb25zIGNvbnN0YW50cy5cbiAqIC0gMC4wLjMgKDIwMjUtMDUtMTMpOiBNb2RpZmllZCB0aGUgYXV0aGVudGljYXRpb24gc3RhdGUgbWFuYWdlbWVudCB0byB1c2UgU3VwYWJhc2UgQXV0aCBzeXN0ZW0uXG4gKiAtIDAuMC4yICgyMDI1LTA1LTEzKTogUmVvcmdhbml6YXRpb24gaW50byBzZXBhcmF0ZSBtb2R1bGVzXG4gKiAtIDAuMC4xICgyMDI1LTA1LTAzKTogSW5pdGlhbCBjcmVhdGlvblxuICovXG5cbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSBcIi4uL3N1cGFiYXNlLWNsaWVudC5qc1wiO1xuXG4vLyBHbG9iYWwgYXV0aGVudGljYXRpb24gc3RhdGVcbmxldCBjdXJyZW50VXNlciA9IG51bGw7XG5sZXQgc2Vzc2lvblZhbGlkYXRlZCA9IGZhbHNlO1xuXG4vKipcbiAqIFNldHMgdGhlIGN1cnJlbnQgdXNlclxuICogQHBhcmFtIHtPYmplY3R9IHVzZXIgLSBVc2VyIGRhdGFcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldEN1cnJlbnRVc2VyKHVzZXIpIHtcbiAgY3VycmVudFVzZXIgPSB1c2VyO1xuICAvLyBQb3NzaWJsZSBzdG9yYWdlIGluIGxvY2FsU3RvcmFnZS9zZXNzaW9uU3RvcmFnZVxuICBpZiAodXNlcikge1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwiY3VycmVudFVzZXJcIiwgSlNPTi5zdHJpbmdpZnkodXNlcikpO1xuICB9IGVsc2Uge1xuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFwiY3VycmVudFVzZXJcIik7XG4gIH1cbn1cblxuLyoqXG4gKiBWYWxpZGF0ZXMgaWYgdGhlIGN1cnJlbnQgc2Vzc2lvbiBpcyBhY3RpdmUgd2l0aCBTdXBhYmFzZVxuICogQHJldHVybnMge1Byb21pc2U8Ym9vbGVhbj59IFRydWUgaWYgc2Vzc2lvbiBpcyB2YWxpZCwgZmFsc2Ugb3RoZXJ3aXNlXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2YWxpZGF0ZVNlc3Npb24oKSB7XG4gIHRyeSB7XG4gICAgLy8gR2V0IGN1cnJlbnQgc2Vzc2lvbiBmcm9tIFN1cGFiYXNlXG4gICAgY29uc3Qge1xuICAgICAgZGF0YTogeyBzZXNzaW9uIH0sXG4gICAgICBlcnJvcjogc2Vzc2lvbkVycm9yLFxuICAgIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFNlc3Npb24oKTtcblxuICAgIC8vIE5vIHNlc3Npb24gb3IgZXJyb3IgcmV0cmlldmluZyBzZXNzaW9uXG4gICAgaWYgKHNlc3Npb25FcnJvciB8fCAhc2Vzc2lvbikge1xuICAgICAgY29uc29sZS5sb2coXCJObyB2YWxpZCBzZXNzaW9uIGZvdW5kXCIpO1xuICAgICAgc2V0Q3VycmVudFVzZXIobnVsbCk7XG4gICAgICBzZXNzaW9uVmFsaWRhdGVkID0gZmFsc2U7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gVHJ5IHRvIHJlZnJlc2ggdGhlIHRva2VuIHRvIHZhbGlkYXRlIGl0IHdpdGggdGhlIHNlcnZlclxuICAgIGNvbnN0IHsgZXJyb3I6IHJlZnJlc2hFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5yZWZyZXNoU2Vzc2lvbigpO1xuXG4gICAgaWYgKHJlZnJlc2hFcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKFwiU2Vzc2lvbiB2YWxpZGF0aW9uIGZhaWxlZDpcIiwgcmVmcmVzaEVycm9yKTtcbiAgICAgIC8vIEZvcmNlIGNsZWFyIHRoZSBpbnZhbGlkIHNlc3Npb25cbiAgICAgIGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnbk91dCgpO1xuICAgICAgc2V0Q3VycmVudFVzZXIobnVsbCk7XG4gICAgICBzZXNzaW9uVmFsaWRhdGVkID0gZmFsc2U7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gU2Vzc2lvbiBpcyB2YWxpZCwgdXBkYXRlIHRoZSBjdXJyZW50IHVzZXJcbiAgICBzZXRDdXJyZW50VXNlcihzZXNzaW9uLnVzZXIpO1xuICAgIHNlc3Npb25WYWxpZGF0ZWQgPSB0cnVlO1xuICAgIHJldHVybiB0cnVlO1xuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5lcnJvcihcIlNlc3Npb24gdmFsaWRhdGlvbiBlcnJvcjpcIiwgZSk7XG4gICAgc2V0Q3VycmVudFVzZXIobnVsbCk7XG4gICAgc2Vzc2lvblZhbGlkYXRlZCA9IGZhbHNlO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG4vKipcbiAqIFJldHJpZXZlcyB0aGUgY3VycmVudCB1c2VyXG4gKiBAcGFyYW0ge2Jvb2xlYW59IHZhbGlkYXRlIC0gV2hldGhlciB0byB2YWxpZGF0ZSB0aGUgc2Vzc2lvbiB3aXRoIFN1cGFiYXNlXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxPYmplY3R8bnVsbD59IFRoZSBjdXJyZW50IHVzZXIgb3IgbnVsbFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q3VycmVudFVzZXIodmFsaWRhdGUgPSB0cnVlKSB7XG4gIC8vIElmIHdlIG5lZWQgdG8gdmFsaWRhdGUgYW5kIGhhdmVuJ3QgZG9uZSBzbyB5ZXRcbiAgaWYgKHZhbGlkYXRlICYmICFzZXNzaW9uVmFsaWRhdGVkKSB7XG4gICAgYXdhaXQgdmFsaWRhdGVTZXNzaW9uKCk7XG4gIH1cblxuICAvLyBJZiBubyB2YWxpZGF0aW9uIG5lZWRlZCBvciBhbHJlYWR5IHZhbGlkYXRlZFxuICBpZiAoIXZhbGlkYXRlICYmICFjdXJyZW50VXNlcikge1xuICAgIC8vIFRyeSB0byByZXRyaWV2ZSBmcm9tIHN0b3JhZ2UgaWYgbm90IGluIG1lbW9yeVxuICAgIGNvbnN0IHN0b3JlZFVzZXIgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImN1cnJlbnRVc2VyXCIpO1xuICAgIGlmIChzdG9yZWRVc2VyKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjdXJyZW50VXNlciA9IEpTT04ucGFyc2Uoc3RvcmVkVXNlcik7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciByZXRyaWV2aW5nIHVzZXI6XCIsIGUpO1xuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShcImN1cnJlbnRVc2VyXCIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBjdXJyZW50VXNlcjtcbn1cblxuLyoqXG4gKiBTeW5jaHJvbm91cyB2ZXJzaW9uIG9mIGdldEN1cnJlbnRVc2VyIGZvciBub24tYXN5bmMgY29udGV4dHNcbiAqIFdBUk5JTkc6IFRoaXMgbWF5IHJldHVybiBzdGFsZSBkYXRhIGlmIHNlc3Npb24gaXMgaW52YWxpZFxuICogQHJldHVybnMge09iamVjdHxudWxsfSBUaGUgY3VycmVudCB1c2VyIG9yIG51bGxcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEN1cnJlbnRVc2VyU3luYygpIHtcbiAgaWYgKCFjdXJyZW50VXNlcikge1xuICAgIGNvbnN0IHN0b3JlZFVzZXIgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcImN1cnJlbnRVc2VyXCIpO1xuICAgIGlmIChzdG9yZWRVc2VyKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjdXJyZW50VXNlciA9IEpTT04ucGFyc2Uoc3RvcmVkVXNlcik7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciByZXRyaWV2aW5nIHVzZXI6XCIsIGUpO1xuICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShcImN1cnJlbnRVc2VyXCIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBjdXJyZW50VXNlcjtcbn1cblxuLyoqXG4gKiBMb2dzIG91dCB0aGUgdXNlclxuICogQHJldHVybnMge1Byb21pc2U8dm9pZD59XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dvdXQoKSB7XG4gIHRyeSB7XG4gICAgLy8gU2lnbiBvdXQgZnJvbSBTdXBhYmFzZVxuICAgIGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnbk91dCgpO1xuXG4gICAgLy8gQ2xlYXIgbG9jYWwgc3RhdGVcbiAgICBjdXJyZW50VXNlciA9IG51bGw7XG4gICAgc2Vzc2lvblZhbGlkYXRlZCA9IGZhbHNlO1xuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFwiY3VycmVudFVzZXJcIik7XG5cbiAgICAvLyBSZWRpcmVjdCB0byB0aGUgaG9tZSBwYWdlIGFmdGVyIGxvZ291dFxuICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCIvXCI7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGR1cmluZyBsb2dvdXQ6XCIsIGVycm9yKTtcbiAgICAvLyBTdGlsbCBjbGVhciBsb2NhbCBzdGF0ZSBldmVuIGlmIFN1cGFiYXNlIHNpZ25PdXQgZmFpbHNcbiAgICBjdXJyZW50VXNlciA9IG51bGw7XG4gICAgc2Vzc2lvblZhbGlkYXRlZCA9IGZhbHNlO1xuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFwiY3VycmVudFVzZXJcIik7XG4gICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcIi9cIjtcbiAgfVxufVxuXG4vKipcbiAqIENoZWNrcyBpZiB0aGUgdXNlciBpcyBsb2dnZWQgaW4gd2l0aCB2YWxpZCBzZXNzaW9uXG4gKiBAcGFyYW0ge2Jvb2xlYW59IHZhbGlkYXRlIC0gV2hldGhlciB0byB2YWxpZGF0ZSB3aXRoIFN1cGFiYXNlIGZpcnN0XG4gKiBAcmV0dXJucyB7UHJvbWlzZTxib29sZWFuPn0gVHJ1ZSBpZiB0aGUgdXNlciBpcyBsb2dnZWQgaW4gd2l0aCB2YWxpZCBzZXNzaW9uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpc0xvZ2dlZEluKHZhbGlkYXRlID0gdHJ1ZSkge1xuICBjb25zdCB1c2VyID0gYXdhaXQgZ2V0Q3VycmVudFVzZXIodmFsaWRhdGUpO1xuICByZXR1cm4gdXNlciAhPT0gbnVsbDtcbn1cblxuLyoqXG4gKiBTeW5jaHJvbm91cyB2ZXJzaW9uIG9mIGlzTG9nZ2VkSW5cbiAqIFdBUk5JTkc6IFRoaXMgbWF5IHJldHVybiBpbmNvcnJlY3QgcmVzdWx0cyBpZiBzZXNzaW9uIGlzIGludmFsaWRcbiAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIHVzZXIgYXBwZWFycyB0byBiZSBsb2dnZWQgaW4gbG9jYWxseVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNMb2dnZWRJblN5bmMoKSB7XG4gIHJldHVybiBnZXRDdXJyZW50VXNlclN5bmMoKSAhPT0gbnVsbDtcbn1cblxuLyoqXG4gKiBQcm90ZWN0cyBhIHBhZ2UgdGhhdCByZXF1aXJlcyBhdXRoZW50aWNhdGlvblxuICogQHBhcmFtIHtzdHJpbmd9IHJlZGlyZWN0VXJsIC0gVVJMIHRvIHJlZGlyZWN0IGlmIG5vdCBhdXRoZW50aWNhdGVkXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxib29sZWFuPn0gVHJ1ZSBpZiBhdXRoZW50aWNhdGVkLCBmYWxzZSBvdGhlcndpc2VcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb3RlY3RQYWdlKHJlZGlyZWN0VXJsID0gXCIvbG9naW5cIikge1xuICBjb25zdCBpc1ZhbGlkID0gYXdhaXQgdmFsaWRhdGVTZXNzaW9uKCk7XG5cbiAgaWYgKCFpc1ZhbGlkKSB7XG4gICAgLy8gUmVkaXJlY3QgdG8gbG9naW4gcGFnZVxuICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gcmVkaXJlY3RVcmw7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59XG5cbi8qKlxuICogSW5pdGlhbGl6ZXMgYXV0aCBvbiBwYWdlIGxvYWRcbiAqIENhbGwgdGhpcyBhdCB0aGUgYmVnaW5uaW5nIG9mIHlvdXIgYXBwIGluaXRpYWxpemF0aW9uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpbml0QXV0aCgpIHtcbiAgLy8gVmFsaWRhdGUgc2Vzc2lvbiBvbiBwYWdlIGxvYWRcbiAgYXdhaXQgdmFsaWRhdGVTZXNzaW9uKCk7XG5cbiAgLy8gU2V0IHVwIGF1dGggc3RhdGUgY2hhbmdlIGxpc3RlbmVyXG4gIHN1cGFiYXNlLmF1dGgub25BdXRoU3RhdGVDaGFuZ2UoYXN5bmMgKGV2ZW50LCBzZXNzaW9uKSA9PiB7XG4gICAgY29uc29sZS5sb2coXCJBdXRoIHN0YXRlIGNoYW5nZWQ6XCIsIGV2ZW50KTtcblxuICAgIGlmIChldmVudCA9PT0gXCJTSUdORURfSU5cIiAmJiBzZXNzaW9uKSB7XG4gICAgICBzZXRDdXJyZW50VXNlcihzZXNzaW9uLnVzZXIpO1xuICAgICAgc2Vzc2lvblZhbGlkYXRlZCA9IHRydWU7XG4gICAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJTSUdORURfT1VUXCIpIHtcbiAgICAgIHNldEN1cnJlbnRVc2VyKG51bGwpO1xuICAgICAgc2Vzc2lvblZhbGlkYXRlZCA9IGZhbHNlO1xuICAgIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwiVE9LRU5fUkVGUkVTSEVEXCIpIHtcbiAgICAgIHNldEN1cnJlbnRVc2VyKHNlc3Npb24udXNlcik7XG4gICAgICBzZXNzaW9uVmFsaWRhdGVkID0gdHJ1ZTtcbiAgICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcIlVTRVJfVVBEQVRFRFwiKSB7XG4gICAgICBzZXRDdXJyZW50VXNlcihzZXNzaW9uLnVzZXIpO1xuICAgICAgc2Vzc2lvblZhbGlkYXRlZCA9IHRydWU7XG4gICAgfVxuICB9KTtcbn1cblxuLyoqXG4gKiBEaXNwbGF5cyBhbiBlcnJvciBtZXNzYWdlXG4gKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIEVycm9yIG1lc3NhZ2UgdG8gZGlzcGxheVxuICogQHBhcmFtIHtzdHJpbmd9IGVsZW1lbnRJZCAtIElEIG9mIHRoZSBlbGVtZW50IHdoZXJlIHRvIGRpc3BsYXkgdGhlIGVycm9yXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzaG93RXJyb3IobWVzc2FnZSwgZWxlbWVudElkID0gXCJlcnJvck1lc3NhZ2VcIikge1xuICBjb25zdCBlcnJvckVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50SWQpO1xuICBpZiAoZXJyb3JFbGVtZW50KSB7XG4gICAgZXJyb3JFbGVtZW50LmlubmVySFRNTCA9IG1lc3NhZ2U7XG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGVsZW1lbnQgbm90IGZvdW5kOlwiLCBlbGVtZW50SWQpO1xuICB9XG59XG5cbi8qKlxuICogRGlzcGxheXMgYSBzdGF0dXMgbWVzc2FnZVxuICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2UgLSBNZXNzYWdlIHRvIGRpc3BsYXlcbiAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIC0gTWVzc2FnZSB0eXBlIChzdWNjZXNzLCBpbmZvLCB3YXJuaW5nLCBkYW5nZXIpXG4gKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudElkIC0gSUQgb2YgdGhlIGVsZW1lbnQgd2hlcmUgdG8gZGlzcGxheSB0aGUgbWVzc2FnZVxuICovXG5leHBvcnQgZnVuY3Rpb24gc2hvd1N0YXR1cyhcbiAgbWVzc2FnZSxcbiAgdHlwZSA9IFwiaW5mb1wiLFxuICBlbGVtZW50SWQgPSBcInN0YXR1c01lc3NhZ2VcIlxuKSB7XG4gIGNvbnN0IHN0YXR1c0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50SWQpO1xuICBpZiAoc3RhdHVzRWxlbWVudCkge1xuICAgIHN0YXR1c0VsZW1lbnQudGV4dENvbnRlbnQgPSBtZXNzYWdlO1xuXG4gICAgLy8gUmVtb3ZlIGFsbCBhbGVydC0qIGNsYXNzZXNcbiAgICBzdGF0dXNFbGVtZW50LmNsYXNzTGlzdC5mb3JFYWNoKChjbGFzc05hbWUpID0+IHtcbiAgICAgIGlmIChjbGFzc05hbWUuc3RhcnRzV2l0aChcImFsZXJ0LVwiKSkge1xuICAgICAgICBzdGF0dXNFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NOYW1lKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEFkZCB0aGUgY2xhc3MgY29ycmVzcG9uZGluZyB0byB0aGUgdHlwZVxuICAgIHN0YXR1c0VsZW1lbnQuY2xhc3NMaXN0LmFkZChgYWxlcnQtJHt0eXBlfWApO1xuICAgIHN0YXR1c0VsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmVycm9yKFwiU3RhdHVzIGVsZW1lbnQgbm90IGZvdW5kOlwiLCBlbGVtZW50SWQpO1xuICB9XG59XG5cbi8qKlxuICogSGlkZXMgYW4gZWxlbWVudFxuICogQHBhcmFtIHtzdHJpbmd9IGVsZW1lbnRJZCAtIElEIG9mIHRoZSBlbGVtZW50IHRvIGhpZGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGhpZGVFbGVtZW50KGVsZW1lbnRJZCkge1xuICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudElkKTtcbiAgaWYgKGVsZW1lbnQpIHtcbiAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gIH1cbn1cblxuLyoqXG4gKiBTaG93cyBhbiBlbGVtZW50XG4gKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudElkIC0gSUQgb2YgdGhlIGVsZW1lbnQgdG8gc2hvd1xuICovXG5leHBvcnQgZnVuY3Rpb24gc2hvd0VsZW1lbnQoZWxlbWVudElkKSB7XG4gIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50SWQpO1xuICBpZiAoZWxlbWVudCkge1xuICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcbiAgfVxufVxuXG4vKipcbiAqIFNob3dzIHRoZSBsb2FkaW5nIGluZGljYXRvclxuICogQHBhcmFtIHtzdHJpbmd9IGJ1dHRvbklkIC0gSUQgb2YgdGhlIGJ1dHRvblxuICogQHBhcmFtIHtzdHJpbmd9IHNwaW5uZXJJZCAtIElEIG9mIHRoZSBzcGlubmVyXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzaG93TG9hZGluZyhidXR0b25JZCwgc3Bpbm5lcklkKSB7XG4gIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGJ1dHRvbklkKTtcbiAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNwaW5uZXJJZCk7XG5cbiAgaWYgKGJ1dHRvbikgYnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgaWYgKHNwaW5uZXIpIHNwaW5uZXIuY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcbn1cblxuLyoqXG4gKiBIaWRlcyB0aGUgbG9hZGluZyBpbmRpY2F0b3JcbiAqIEBwYXJhbSB7c3RyaW5nfSBidXR0b25JZCAtIElEIG9mIHRoZSBidXR0b25cbiAqIEBwYXJhbSB7c3RyaW5nfSBzcGlubmVySWQgLSBJRCBvZiB0aGUgc3Bpbm5lclxuICovXG5leHBvcnQgZnVuY3Rpb24gaGlkZUxvYWRpbmcoYnV0dG9uSWQsIHNwaW5uZXJJZCkge1xuICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChidXR0b25JZCk7XG4gIGNvbnN0IHNwaW5uZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzcGlubmVySWQpO1xuXG4gIGlmIChidXR0b24pIGJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuICBpZiAoc3Bpbm5lcikgc3Bpbm5lci5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xufVxuXG4vLyBFeHBvcnQgdGhlIG5lY2Vzc2FyeSBmdW5jdGlvbnMgYW5kIHZhcmlhYmxlc1xuZXhwb3J0IGRlZmF1bHQge1xuICBnZXRDdXJyZW50VXNlcixcbiAgZ2V0Q3VycmVudFVzZXJTeW5jLFxuICBzZXRDdXJyZW50VXNlcixcbiAgbG9nb3V0LFxuICBpc0xvZ2dlZEluLFxuICBpc0xvZ2dlZEluU3luYyxcbiAgdmFsaWRhdGVTZXNzaW9uLFxuICBwcm90ZWN0UGFnZSxcbiAgaW5pdEF1dGgsXG4gIHNob3dFcnJvcixcbiAgc2hvd1N0YXR1cyxcbiAgaGlkZUVsZW1lbnQsXG4gIHNob3dFbGVtZW50LFxuICBzaG93TG9hZGluZyxcbiAgaGlkZUxvYWRpbmcsXG59O1xuIiwiLy8gc3JjL2F1dGgvc2lnbnVwLmpzXG4vKipcbiAqIFNpZ251cCBNb2R1bGVcbiAqIEBtb2R1bGUgc2lnbnVwXG4gKiBAZGVzY3JpcHRpb24gSGFuZGxlcyB1c2VyIHJlZ2lzdHJhdGlvbiB3aXRoIGNsaWVudC1zaWRlIHZhbGlkYXRpb24sIEdvb2dsZSBPQXV0aCwgYW5kIHBob25lIHZlcmlmaWNhdGlvbiB1c2luZyBTdXBhYmFzZS5cbiAqIEB2ZXJzaW9uIDAuMi4xXG4gKlxuICogQGNoYW5nZWxvZ1xuICogLSAwLjIuMSAoMjAyNS0wNS0xOCk6IEFkZGVkIGNhcHRjaGEgd2l0aCBDbG91ZGZsYXJlIFR1cm5zdGlsZS5cbiAqIC0gMC4yLjAgKDIwMjUtMDUtMTgpOiBBZGRlZCBwaG9uZSBudW1iZXIgaW5wdXQsIE9UUCBzZW5kaW5nIGFuZCB2ZXJpZmljYXRpb24gZm9yIGVtYWlsL3Bhc3N3b3JkIHNpZ251cC5cbiAqIC0gMC4xLjEgKDIwMjUtMDUtMTgpOiBBZGRlZCBHb29nbGUgU2lnbi1VcCBmdW5jdGlvbmFsaXR5LlxuICogLSAwLjEuMCAoMjAyNS0wNS0xNSk6IE1pZ3JhdGVkIHRvIFN1cGFiYXNlIGNsaWVudC1zaWRlIGF1dGggKHZlcnNpb25pbmcgYWRqdXN0ZWQpXG4gKi9cblxuaW1wb3J0IHsgc2hvd0Vycm9yLCBzaG93U3RhdHVzLCBzaG93TG9hZGluZywgaGlkZUxvYWRpbmcgfSBmcm9tIFwiLi9hdXRoLmpzXCI7XG5pbXBvcnQgeyBzdXBhYmFzZSB9IGZyb20gXCIuLi9zdXBhYmFzZS1jbGllbnQuanNcIjtcblxuLy8gU3RvcmUgcGhvbmUgbnVtYmVyIHRlbXBvcmFyaWx5IGJldHdlZW4gc3RlcHNcbmxldCBjYXB0Y2hhVG9rZW4gPSBudWxsOyAvLyBUbyBzdG9yZSB0aGUgY2FwdGNoYSB0b2tlbiAodXNlZCBieSBib3RoIGhDYXB0Y2hhIGFuZCBUdXJuc3RpbGUpXG5sZXQgdHVybnN0aWxlV2lkZ2V0SWQgPSBudWxsOyAvLyBUbyBzdG9yZSBUdXJuc3RpbGUgd2lkZ2V0IElEXG5cbi8vIFRoaXMgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgYnkgdGhlIENsb3VkZmxhcmUgVHVybnN0aWxlIHNjcmlwdCBvbmNlIGl0J3MgbG9hZGVkXG4vLyAoZHVlIHRvICZvbmxvYWQ9b25sb2FkVHVybnN0aWxlQ2FsbGJhY2sgaW4gdGhlIHNjcmlwdCB0YWcgaW4gc2lnbnVwLmh0bWwpXG53aW5kb3cub25sb2FkVHVybnN0aWxlQ2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7XG4gIGNvbnNvbGUubG9nKFwiVHVybnN0aWxlIEFQSSByZWFkeSAob25sb2FkVHVybnN0aWxlQ2FsbGJhY2sgZXhlY3V0ZWQpLlwiKTtcbiAgY29uc3QgdHVybnN0aWxlQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0dXJuc3RpbGUtY29udGFpbmVyXCIpO1xuXG4gIGlmICh0dXJuc3RpbGVDb250YWluZXIgJiYgd2luZG93LnR1cm5zdGlsZSAmJiAhdHVybnN0aWxlV2lkZ2V0SWQpIHtcbiAgICBjb25zb2xlLmxvZyhcIlJlbmRlcmluZyBUdXJuc3RpbGUgd2lkZ2V0IGZyb20gb25sb2FkVHVybnN0aWxlQ2FsbGJhY2suLi5cIik7XG4gICAgdHJ5IHtcbiAgICAgIHR1cm5zdGlsZVdpZGdldElkID0gd2luZG93LnR1cm5zdGlsZS5yZW5kZXIodHVybnN0aWxlQ29udGFpbmVyLCB7XG4gICAgICAgIHNpdGVrZXk6IFwiMHg0QUFBQUFBQmR6WTNJbk9VMl9Jbjk5XCIsXG4gICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAodG9rZW4pIHtcbiAgICAgICAgICBjYXB0Y2hhVG9rZW4gPSB0b2tlbjtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIlR1cm5zdGlsZSB0b2tlbiBvYnRhaW5lZDpcIiwgdG9rZW4pO1xuICAgICAgICB9LFxuICAgICAgICBcImV4cGlyZWQtY2FsbGJhY2tcIjogKCkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgXCJUdXJuc3RpbGUgdG9rZW4gZXhwaXJlZC4gUmVzZXR0aW5nIHdpZGdldC4gSUQ6XCIsXG4gICAgICAgICAgICB0dXJuc3RpbGVXaWRnZXRJZFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKHdpbmRvdy50dXJuc3RpbGUgJiYgdHVybnN0aWxlV2lkZ2V0SWQpIHtcbiAgICAgICAgICAgIHdpbmRvdy50dXJuc3RpbGUucmVzZXQodHVybnN0aWxlV2lkZ2V0SWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXB0Y2hhVG9rZW4gPSBudWxsOyAvLyBDbGVhciB0aGUgdG9rZW5cbiAgICAgICAgICAvLyBXaWRnZXQgc2hvdWxkIGJlIHJlYWR5IGZvciBhIG5ldyBjaGFsbGVuZ2UgYWZ0ZXIgcmVzZXQuXG4gICAgICAgIH0sXG4gICAgICAgIFwiZXJyb3ItY2FsbGJhY2tcIjogKGVycikgPT4ge1xuICAgICAgICAgIGNhcHRjaGFUb2tlbiA9IG51bGw7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIlR1cm5zdGlsZSBlcnJvciBjYWxsYmFjazpcIiwgZXJyKTtcbiAgICAgICAgICBzaG93RXJyb3IoYEVycmV1ciBDQVBUQ0hBOiAke2Vycn0uIFZldWlsbGV6IHLDqWVzc2F5ZXIuYCk7XG4gICAgICAgIH0sXG4gICAgICAgIC8vIHRoZW1lOiAnbGlnaHQnLCAvLyBPcHRpb25hbDogJ2xpZ2h0JywgJ2RhcmsnLCBvciAnYXV0bydcbiAgICAgICAgLy8gbGFuZ3VhZ2U6ICdmcicsIC8vIE9wdGlvbmFsOiBzcGVjaWZ5IGxhbmd1YWdlXG4gICAgICB9KTtcbiAgICAgIGlmICh0dXJuc3RpbGVXaWRnZXRJZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgICAgXCJUdXJuc3RpbGUucmVuZGVyIGRpZCBub3QgcmV0dXJuIGEgd2lkZ2V0SWQuIFNpdGVrZXkgb3IgY29udGFpbmVyIGlzc3VlP1wiXG4gICAgICAgICk7XG4gICAgICAgIHNob3dFcnJvcihcIkVycmV1ciBpbml0aWFsaXNhdGlvbiBDQVBUQ0hBIChJRCB3aWRnZXQgbm9uIHJldG91cm7DqSkuXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJUdXJuc3RpbGUgd2lkZ2V0IHJlbmRlcmVkLiBJRDpcIiwgdHVybnN0aWxlV2lkZ2V0SWQpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciByZW5kZXJpbmcgVHVybnN0aWxlOlwiLCBlKTtcbiAgICAgIHNob3dFcnJvcihcIkltcG9zc2libGUgZCdhZmZpY2hlciBsZSBDQVBUQ0hBLlwiKTtcbiAgICB9XG4gIH0gZWxzZSBpZiAoIXR1cm5zdGlsZUNvbnRhaW5lcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJvbmxvYWRUdXJuc3RpbGVDYWxsYmFjazogI3R1cm5zdGlsZS1jb250YWluZXIgbm90IGZvdW5kLlwiKTtcbiAgfSBlbHNlIGlmICghd2luZG93LnR1cm5zdGlsZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJvbmxvYWRUdXJuc3RpbGVDYWxsYmFjazogd2luZG93LnR1cm5zdGlsZSBBUEkgbm90IGZvdW5kLlwiKTtcbiAgfSBlbHNlIGlmICh0dXJuc3RpbGVXaWRnZXRJZCkge1xuICAgIGNvbnNvbGUubG9nKFwib25sb2FkVHVybnN0aWxlQ2FsbGJhY2s6IFdpZGdldCBhbHJlYWR5IHNlZW1zIHJlbmRlcmVkLlwiKTtcbiAgfVxufTtcblxuLyoqXG4gKiBJbml0aWFsaXplcyB0aGUgc2lnbnVwIHBhZ2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGluaXRTaWdudXBQYWdlKCkge1xuICBjb25zb2xlLmxvZyhcImluaXRTaWdudXBQYWdlIGNhbGxlZFwiKTtcbiAgY29uc3Qgc2lnbnVwRm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic2lnbnVwRm9ybVwiKTtcbiAgLy8gY29uc3Qgb3RwRm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib3RwRm9ybVwiKTsgLy8gT1RQIEZvcm0gLSBSZW1vdmVkXG4gIGNvbnN0IGVycm9yTWVzc2FnZURpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZXJyb3JNZXNzYWdlXCIpO1xuICBjb25zdCBzdGF0dXNNZXNzYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdGF0dXNNZXNzYWdlXCIpO1xuICBjb25zdCBnb29nbGVTaWduVXBCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImdvb2dsZVNpZ25VcEJ0blwiKTtcbiAgY29uc3QgdHVybnN0aWxlQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0dXJuc3RpbGUtY29udGFpbmVyXCIpOyAvLyBVcGRhdGVkIHNlbGVjdG9yXG5cbiAgaWYgKCF0dXJuc3RpbGVDb250YWluZXIpIHtcbiAgICAvLyBVcGRhdGVkIGNoZWNrXG4gICAgY29uc29sZS5lcnJvcihcbiAgICAgIFwiI3R1cm5zdGlsZS1jb250YWluZXIgbm90IGZvdW5kIGluIHRoZSBET00uIENBUFRDSEEgY2Fubm90IGJlIHJlbmRlcmVkLlwiXG4gICAgKTtcbiAgfVxuXG4gIC8vIFRoZSBvbmxvYWRUdXJuc3RpbGVDYWxsYmFjayBpcyB0aGUgcHJpbWFyeSB3YXkgdGhlIHdpZGdldCBzaG91bGQgYmUgcmVuZGVyZWQuXG4gIC8vIFRoZSByZWR1bmRhbnQgYmxvY2sgcHJldmlvdXNseSBoZXJlIGhhcyBiZWVuIHJlbW92ZWQuXG4gIC8vIElmIHdpbmRvdy50dXJuc3RpbGUgaXMgYWxyZWFkeSBhdmFpbGFibGUgYW5kIHRoZSBjYWxsYmFjayBoYXNuJ3QgZmlyZWQgeWV0IChlLmcuIHNjcmlwdCBsb2FkZWQgZnJvbSBjYWNoZSBiZWZvcmUgRE9NIHJlYWR5IGZvciBjb250YWluZXIpLFxuICAvLyB0aGUgYG9ubG9hZFR1cm5zdGlsZUNhbGxiYWNrYCB3aWxsIHN0aWxsIGV4ZWN1dGUgb25jZSB0aGUgc2NyaXB0IGZ1bGx5IHByb2Nlc3NlcyBpdHMgYG9ubG9hZGAgcGFyYW1ldGVyLlxuXG4gIGlmIChzaWdudXBGb3JtKSB7XG4gICAgc2lnbnVwRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGFzeW5jIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgIGNvbnN0IGVtYWlsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJlbWFpbFwiKS52YWx1ZS50cmltKCk7XG4gICAgICBjb25zdCBwYXNzd29yZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGFzc3dvcmRcIikudmFsdWU7XG4gICAgICBjb25zdCBjb25maXJtUGFzc3dvcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbmZpcm1QYXNzd29yZFwiKS52YWx1ZTtcbiAgICAgIGxldCBwaG9uZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGhvbmVcIikudmFsdWUudHJpbSgpOyAvLyBHZXQgcGhvbmUgbnVtYmVyXG5cbiAgICAgIGxldCB2YWxpZGF0aW9uRXJyb3JzID0gW107XG4gICAgICBjb25zdCBlbWFpbFBhdHRlcm4gPSAvXlteXFxzQF0rQFteXFxzQF0rXFwuW15cXHNAXSskLztcbiAgICAgIGlmICghZW1haWxQYXR0ZXJuLnRlc3QoZW1haWwpKVxuICAgICAgICB2YWxpZGF0aW9uRXJyb3JzLnB1c2goXCJMJ2FkcmVzc2UgZW1haWwgbidlc3QgcGFzIHZhbGlkZS5cIik7XG4gICAgICBpZiAocGFzc3dvcmQgIT09IGNvbmZpcm1QYXNzd29yZClcbiAgICAgICAgdmFsaWRhdGlvbkVycm9ycy5wdXNoKFwiTGVzIG1vdHMgZGUgcGFzc2UgbmUgY29ycmVzcG9uZGVudCBwYXMuXCIpO1xuICAgICAgY29uc3QgcGFzc3dvcmRDb21wbGV4aXR5UGF0dGVybiA9IC9eKD89LipbYS16XSkoPz0uKltBLVpdKSg/PS4qXFxkKS4rJC87XG4gICAgICBpZiAoIXBhc3N3b3JkQ29tcGxleGl0eVBhdHRlcm4udGVzdChwYXNzd29yZCkgfHwgcGFzc3dvcmQubGVuZ3RoIDwgOClcbiAgICAgICAgdmFsaWRhdGlvbkVycm9ycy5wdXNoKFwiTGUgZm9ybWF0IGR1IG1vdCBkZSBwYXNzZSBlc3QgaW52YWxpZGUuXCIpO1xuICAgICAgaWYgKCFwaG9uZSkgdmFsaWRhdGlvbkVycm9ycy5wdXNoKFwiTGUgbnVtw6lybyBkZSB0w6lsw6lwaG9uZSBlc3QgcmVxdWlzLlwiKTtcbiAgICAgIC8vIEJhc2ljIHBob25lIHZhbGlkYXRpb24gKHlvdSBtaWdodCB3YW50IGEgbW9yZSByb2J1c3Qgb25lKVxuICAgICAgY29uc3QgcGhvbmVQYXR0ZXJuID0gL14oMHxcXCszMylbMS05XVxcZHs4fSQvOyAvLyBFeGFtcGxlOiAwNjEyMzQ1Njc4IG9yICszMzYxMjM0NTY3OFxuICAgICAgaWYgKHBob25lICYmICFwaG9uZVBhdHRlcm4udGVzdChwaG9uZSkpXG4gICAgICAgIHZhbGlkYXRpb25FcnJvcnMucHVzaChcbiAgICAgICAgICBcIkxlIGZvcm1hdCBkdSBudW3DqXJvIGRlIHTDqWzDqXBob25lIGVzdCBpbnZhbGlkZSAoZXg6IDA2MTIzNDU2Nzggb3UgKzMzNjEyMzQ1Njc4KS5cIlxuICAgICAgICApO1xuXG4gICAgICBpZiAoIWNhcHRjaGFUb2tlbikge1xuICAgICAgICAvLyBDaGVjayBpZiBjYXB0Y2hhIGlzIHNvbHZlZFxuICAgICAgICB2YWxpZGF0aW9uRXJyb3JzLnB1c2goXCJWZXVpbGxleiBjb21wbMOpdGVyIGxlIENBUFRDSEEuXCIpO1xuICAgICAgfVxuXG4gICAgICBpZiAodmFsaWRhdGlvbkVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHNob3dFcnJvcih2YWxpZGF0aW9uRXJyb3JzLmpvaW4oXCI8YnI+XCIpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBzaG93TG9hZGluZyhcInNpZ251cEJ0blwiLCBcInNpZ251cFNwaW5uZXJcIik7XG4gICAgICB0cnkge1xuICAgICAgICBsZXQgZTE2NFBob25lID0gcGhvbmU7XG4gICAgICAgIGlmIChwaG9uZS5zdGFydHNXaXRoKFwiMFwiKSkge1xuICAgICAgICAgIGUxNjRQaG9uZSA9IGArMzMke3Bob25lLnN1YnN0cmluZygxKX1gO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU3RlcCAxOiBTaWduIHVwIHdpdGggZW1haWwgYW5kIHBhc3N3b3JkXG4gICAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3I6IHNpZ25VcEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLnNpZ25VcCh7XG4gICAgICAgICAgZW1haWwsXG4gICAgICAgICAgcGFzc3dvcmQsXG4gICAgICAgICAgb3B0aW9uczogeyBjYXB0Y2hhVG9rZW4gfSwgLy8gUGFzcyBjYXB0Y2hhIHRva2VuXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChzaWduVXBFcnJvcikgdGhyb3cgc2lnblVwRXJyb3I7XG4gICAgICAgIGlmICghZGF0YS51c2VyKVxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkVycmV1ciBsb3JzIGRlIGxhIGNyw6lhdGlvbiBkZSBsJ3V0aWxpc2F0ZXVyLlwiKTtcblxuICAgICAgICBpZiAoZTE2NFBob25lICYmIGRhdGEudXNlci5pZCkge1xuICAgICAgICAgIGF3YWl0IHN1cGFiYXNlXG4gICAgICAgICAgICAuZnJvbShcInByb2ZpbGVzXCIpXG4gICAgICAgICAgICAudXBkYXRlKHsgcGhvbmU6IGUxNjRQaG9uZSB9KVxuICAgICAgICAgICAgLmVxKFwiaWRcIiwgZGF0YS51c2VyLmlkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVzZXIgY3JlYXRlZC4gTm93IHVwZGF0ZSB0aGVpciBwcm9maWxlIHdpdGggdGhlIHBob25lIG51bWJlciBpZiBwcm92aWRlZC5cbiAgICAgICAgbGV0IHN1Y2Nlc3NNZXNzYWdlID1cbiAgICAgICAgICBcIkNvbXB0ZSBjcsOpw6kgISBVbiBlbWFpbCBkZSBjb25maXJtYXRpb24gYSDDqXTDqSBlbnZvecOpLlwiO1xuICAgICAgICBzaG93U3RhdHVzKHN1Y2Nlc3NNZXNzYWdlLCBcInN1Y2Nlc3NcIik7XG5cbiAgICAgICAgLy8gSGlkZSB0aGUgZm9ybSBhbmQgcmVzZXQgaXRcbiAgICAgICAgaWYgKHNpZ251cEZvcm0pIHtcbiAgICAgICAgICBzaWdudXBGb3JtLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7IC8vIEhpZGUgdGhlIGZvcm1cbiAgICAgICAgICBzaWdudXBGb3JtLnJlc2V0KCk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFbWFpbC9QYXNzd29yZCBTaWdudXAgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgbGV0IGRpc3BsYXlFcnJvciA9IGVycm9yLm1lc3NhZ2UgfHwgXCJVbmUgZXJyZXVyIGVzdCBzdXJ2ZW51ZS5cIjtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGVycm9yLm1lc3NhZ2UgJiZcbiAgICAgICAgICBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKFwiVXNlciBhbHJlYWR5IHJlZ2lzdGVyZWRcIilcbiAgICAgICAgKSB7XG4gICAgICAgICAgZGlzcGxheUVycm9yID1cbiAgICAgICAgICAgIFwiQ2V0dGUgYWRyZXNzZSBlbWFpbCBlc3QgZMOpasOgIHV0aWxpc8OpZS4gVmV1aWxsZXogdm91cyBjb25uZWN0ZXIgb3UgdXRpbGlzZXIgdW5lIGF1dHJlIGFkcmVzc2UuXCI7XG4gICAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgZXJyb3IubWVzc2FnZSAmJlxuICAgICAgICAgIGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoXCJVbmFibGUgdG8gdmFsaWRhdGUgcGhvbmUgbnVtYmVyXCIpXG4gICAgICAgICkge1xuICAgICAgICAgIGRpc3BsYXlFcnJvciA9IFwiTGUgbnVtw6lybyBkZSB0w6lsw6lwaG9uZSBmb3Vybmkgbidlc3QgcGFzIHZhbGlkZS5cIjtcbiAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICBlcnJvci5tZXNzYWdlICYmXG4gICAgICAgICAgZXJyb3IubWVzc2FnZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwiY2FwdGNoYSBwcm90ZWN0aW9uXCIpXG4gICAgICAgICkge1xuICAgICAgICAgIGRpc3BsYXlFcnJvciA9XG4gICAgICAgICAgICBcIkVycmV1ciBDQVBUQ0hBIGR1IHNlcnZldXIuIFZldWlsbGV6IHLDqWVzc2F5ZXIuIChcIiArXG4gICAgICAgICAgICBlcnJvci5tZXNzYWdlICtcbiAgICAgICAgICAgIFwiKVwiO1xuICAgICAgICB9XG4gICAgICAgIHNob3dFcnJvcihkaXNwbGF5RXJyb3IpO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgaGlkZUxvYWRpbmcoXCJzaWdudXBCdG5cIiwgXCJzaWdudXBTcGlubmVyXCIpO1xuICAgICAgICBpZiAod2luZG93LnR1cm5zdGlsZSAmJiB0dXJuc3RpbGVXaWRnZXRJZCkge1xuICAgICAgICAgIHdpbmRvdy50dXJuc3RpbGUucmVzZXQodHVybnN0aWxlV2lkZ2V0SWQpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiVHVybnN0aWxlIHdpZGdldCBoYXMgYmVlbiByZXNldC5cIik7XG4gICAgICAgIH1cbiAgICAgICAgY2FwdGNoYVRva2VuID0gbnVsbDsgLy8gQ2xlYXIgdG9rZW4gYWZ0ZXIgdXNlXG4gICAgICB9XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS5lcnJvcihcIlNpZ251cCBmb3JtIChzaWdudXBGb3JtKSBub3QgZm91bmQuXCIpO1xuICB9XG5cbiAgaWYgKGdvb2dsZVNpZ25VcEJ0bikge1xuICAgIGdvb2dsZVNpZ25VcEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgc2hvd0xvYWRpbmcoXCJnb29nbGVTaWduVXBCdG5cIiwgXCJnb29nbGVTaWduVXBTcGlubmVyXCIpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5zaWduSW5XaXRoT0F1dGgoe1xuICAgICAgICAgIHByb3ZpZGVyOiBcImdvb2dsZVwiLFxuICAgICAgICAgIG9wdGlvbnM6IHsgcmVkaXJlY3RUbzogYCR7d2luZG93LmxvY2F0aW9uLm9yaWdpbn0vcHJvZmlsZS5odG1sYCB9LFxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHNpZ25pbmcgdXAgd2l0aCBHb29nbGU6XCIsIGVycm9yKTtcbiAgICAgICAgICBzaG93RXJyb3IoXG4gICAgICAgICAgICBlcnJvci5tZXNzYWdlIHx8IFwiRXJyZXVyIGxvcnMgZGUgbCdpbnNjcmlwdGlvbiBhdmVjIEdvb2dsZS5cIlxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFeGNlcHRpb24gZHVyaW5nIEdvb2dsZSBzaWduLXVwOlwiLCBlcnJvcik7XG4gICAgICAgIHNob3dFcnJvcihcbiAgICAgICAgICBcIlVuZSBleGNlcHRpb24gZXN0IHN1cnZlbnVlIGxvcnMgZGUgbCdpbnNjcmlwdGlvbiBhdmVjIEdvb2dsZS5cIlxuICAgICAgICApO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgaGlkZUxvYWRpbmcoXCJnb29nbGVTaWduVXBCdG5cIiwgXCJnb29nbGVTaWduVXBTcGlubmVyXCIpO1xuICAgICAgfVxuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUud2FybihcIkdvb2dsZSBTaWduLVVwIGJ1dHRvbiAoZ29vZ2xlU2lnblVwQnRuKSBub3QgZm91bmQuXCIpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgaW5pdFNpZ251cFBhZ2UsXG59O1xuIiwiLy8gc3JjL2VudHJpZXMvc2lnbnVwLmpzXG4vKipcbiAqIFNpZ251cCBFbnRyeSBQb2ludFxuICpcbiAqIFRoaXMgbW9kdWxlIHNlcnZlcyBhcyB0aGUgZW50cnkgcG9pbnQgZm9yIHRoZSBzaWdudXAgcGFnZS5cbiAqL1xuXG4vLyBJbXBvcnQgb3VyIHNpZ251cCBtb2R1bGVcbmltcG9ydCB7IGluaXRTaWdudXBQYWdlIH0gZnJvbSBcIi4uL2F1dGgvc2lnbnVwLmpzXCI7XG5cbi8vIEluaXRpYWxpemUgc2lnbnVwIHBhZ2Ugd2hlbiBET00gaXMgbG9hZGVkXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCAoKSA9PiB7XG4gIC8vIEluaXRpYWxpemUgc2lnbnVwIHBhZ2VcbiAgaW5pdFNpZ251cFBhZ2UoKTtcblxuICBjb25zb2xlLmxvZyhcIlNpZ251cCBwYWdlIGluaXRpYWxpemVkXCIpO1xufSk7XG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuLy8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbl9fd2VicGFja19yZXF1aXJlX18ubSA9IF9fd2VicGFja19tb2R1bGVzX187XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18uZiA9IHt9O1xuLy8gVGhpcyBmaWxlIGNvbnRhaW5zIG9ubHkgdGhlIGVudHJ5IGNodW5rLlxuLy8gVGhlIGNodW5rIGxvYWRpbmcgZnVuY3Rpb24gZm9yIGFkZGl0aW9uYWwgY2h1bmtzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmUgPSAoY2h1bmtJZCkgPT4ge1xuXHRyZXR1cm4gUHJvbWlzZS5hbGwoT2JqZWN0LmtleXMoX193ZWJwYWNrX3JlcXVpcmVfXy5mKS5yZWR1Y2UoKHByb21pc2VzLCBrZXkpID0+IHtcblx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmZba2V5XShjaHVua0lkLCBwcm9taXNlcyk7XG5cdFx0cmV0dXJuIHByb21pc2VzO1xuXHR9LCBbXSkpO1xufTsiLCIvLyBUaGlzIGZ1bmN0aW9uIGFsbG93IHRvIHJlZmVyZW5jZSBhc3luYyBjaHVua3Ncbl9fd2VicGFja19yZXF1aXJlX18udSA9IChjaHVua0lkKSA9PiB7XG5cdC8vIHJldHVybiB1cmwgZm9yIGZpbGVuYW1lcyBiYXNlZCBvbiB0ZW1wbGF0ZVxuXHRyZXR1cm4gXCJqcy9cIiArIGNodW5rSWQgKyBcIi5idW5kbGUuanNcIjtcbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5nID0gKGZ1bmN0aW9uKCkge1xuXHRpZiAodHlwZW9mIGdsb2JhbFRoaXMgPT09ICdvYmplY3QnKSByZXR1cm4gZ2xvYmFsVGhpcztcblx0dHJ5IHtcblx0XHRyZXR1cm4gdGhpcyB8fCBuZXcgRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTtcblx0fSBjYXRjaCAoZSkge1xuXHRcdGlmICh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JykgcmV0dXJuIHdpbmRvdztcblx0fVxufSkoKTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwidmFyIHNjcmlwdFVybDtcbmlmIChfX3dlYnBhY2tfcmVxdWlyZV9fLmcuaW1wb3J0U2NyaXB0cykgc2NyaXB0VXJsID0gX193ZWJwYWNrX3JlcXVpcmVfXy5nLmxvY2F0aW9uICsgXCJcIjtcbnZhciBkb2N1bWVudCA9IF9fd2VicGFja19yZXF1aXJlX18uZy5kb2N1bWVudDtcbmlmICghc2NyaXB0VXJsICYmIGRvY3VtZW50KSB7XG5cdGlmIChkb2N1bWVudC5jdXJyZW50U2NyaXB0ICYmIGRvY3VtZW50LmN1cnJlbnRTY3JpcHQudGFnTmFtZS50b1VwcGVyQ2FzZSgpID09PSAnU0NSSVBUJylcblx0XHRzY3JpcHRVcmwgPSBkb2N1bWVudC5jdXJyZW50U2NyaXB0LnNyYztcblx0aWYgKCFzY3JpcHRVcmwpIHtcblx0XHR2YXIgc2NyaXB0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpO1xuXHRcdGlmKHNjcmlwdHMubGVuZ3RoKSB7XG5cdFx0XHR2YXIgaSA9IHNjcmlwdHMubGVuZ3RoIC0gMTtcblx0XHRcdHdoaWxlIChpID4gLTEgJiYgKCFzY3JpcHRVcmwgfHwgIS9eaHR0cChzPyk6Ly50ZXN0KHNjcmlwdFVybCkpKSBzY3JpcHRVcmwgPSBzY3JpcHRzW2ktLV0uc3JjO1xuXHRcdH1cblx0fVxufVxuLy8gV2hlbiBzdXBwb3J0aW5nIGJyb3dzZXJzIHdoZXJlIGFuIGF1dG9tYXRpYyBwdWJsaWNQYXRoIGlzIG5vdCBzdXBwb3J0ZWQgeW91IG11c3Qgc3BlY2lmeSBhbiBvdXRwdXQucHVibGljUGF0aCBtYW51YWxseSB2aWEgY29uZmlndXJhdGlvblxuLy8gb3IgcGFzcyBhbiBlbXB0eSBzdHJpbmcgKFwiXCIpIGFuZCBzZXQgdGhlIF9fd2VicGFja19wdWJsaWNfcGF0aF9fIHZhcmlhYmxlIGZyb20geW91ciBjb2RlIHRvIHVzZSB5b3VyIG93biBsb2dpYy5cbmlmICghc2NyaXB0VXJsKSB0aHJvdyBuZXcgRXJyb3IoXCJBdXRvbWF0aWMgcHVibGljUGF0aCBpcyBub3Qgc3VwcG9ydGVkIGluIHRoaXMgYnJvd3NlclwiKTtcbnNjcmlwdFVybCA9IHNjcmlwdFVybC5yZXBsYWNlKC9eYmxvYjovLCBcIlwiKS5yZXBsYWNlKC8jLiokLywgXCJcIikucmVwbGFjZSgvXFw/LiokLywgXCJcIikucmVwbGFjZSgvXFwvW15cXC9dKyQvLCBcIi9cIik7XG5fX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBzY3JpcHRVcmwgKyBcIi4uL1wiOyIsIi8vIG5vIGJhc2VVUklcblxuLy8gb2JqZWN0IHRvIHN0b3JlIGxvYWRlZCBhbmQgbG9hZGluZyBjaHVua3Ncbi8vIHVuZGVmaW5lZCA9IGNodW5rIG5vdCBsb2FkZWQsIG51bGwgPSBjaHVuayBwcmVsb2FkZWQvcHJlZmV0Y2hlZFxuLy8gW3Jlc29sdmUsIHJlamVjdCwgUHJvbWlzZV0gPSBjaHVuayBsb2FkaW5nLCAwID0gY2h1bmsgbG9hZGVkXG52YXIgaW5zdGFsbGVkQ2h1bmtzID0ge1xuXHQ3ODc6IDBcbn07XG5cbl9fd2VicGFja19yZXF1aXJlX18uZi5qID0gKGNodW5rSWQsIHByb21pc2VzKSA9PiB7XG5cdFx0Ly8gSlNPTlAgY2h1bmsgbG9hZGluZyBmb3IgamF2YXNjcmlwdFxuXHRcdHZhciBpbnN0YWxsZWRDaHVua0RhdGEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLm8oaW5zdGFsbGVkQ2h1bmtzLCBjaHVua0lkKSA/IGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA6IHVuZGVmaW5lZDtcblx0XHRpZihpbnN0YWxsZWRDaHVua0RhdGEgIT09IDApIHsgLy8gMCBtZWFucyBcImFscmVhZHkgaW5zdGFsbGVkXCIuXG5cblx0XHRcdC8vIGEgUHJvbWlzZSBtZWFucyBcImN1cnJlbnRseSBsb2FkaW5nXCIuXG5cdFx0XHRpZihpbnN0YWxsZWRDaHVua0RhdGEpIHtcblx0XHRcdFx0cHJvbWlzZXMucHVzaChpbnN0YWxsZWRDaHVua0RhdGFbMl0pO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYodHJ1ZSkgeyAvLyBhbGwgY2h1bmtzIGhhdmUgSlNcblx0XHRcdFx0XHQvLyBzZXR1cCBQcm9taXNlIGluIGNodW5rIGNhY2hlXG5cdFx0XHRcdFx0dmFyIHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiAoaW5zdGFsbGVkQ2h1bmtEYXRhID0gaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdID0gW3Jlc29sdmUsIHJlamVjdF0pKTtcblx0XHRcdFx0XHRwcm9taXNlcy5wdXNoKGluc3RhbGxlZENodW5rRGF0YVsyXSA9IHByb21pc2UpO1xuXG5cdFx0XHRcdFx0Ly8gc3RhcnQgY2h1bmsgbG9hZGluZ1xuXHRcdFx0XHRcdHZhciB1cmwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLnAgKyBfX3dlYnBhY2tfcmVxdWlyZV9fLnUoY2h1bmtJZCk7XG5cdFx0XHRcdFx0Ly8gY3JlYXRlIGVycm9yIGJlZm9yZSBzdGFjayB1bndvdW5kIHRvIGdldCB1c2VmdWwgc3RhY2t0cmFjZSBsYXRlclxuXHRcdFx0XHRcdHZhciBlcnJvciA9IG5ldyBFcnJvcigpO1xuXHRcdFx0XHRcdHZhciBsb2FkaW5nRW5kZWQgPSAoZXZlbnQpID0+IHtcblx0XHRcdFx0XHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhpbnN0YWxsZWRDaHVua3MsIGNodW5rSWQpKSB7XG5cdFx0XHRcdFx0XHRcdGluc3RhbGxlZENodW5rRGF0YSA9IGluc3RhbGxlZENodW5rc1tjaHVua0lkXTtcblx0XHRcdFx0XHRcdFx0aWYoaW5zdGFsbGVkQ2h1bmtEYXRhICE9PSAwKSBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gPSB1bmRlZmluZWQ7XG5cdFx0XHRcdFx0XHRcdGlmKGluc3RhbGxlZENodW5rRGF0YSkge1xuXHRcdFx0XHRcdFx0XHRcdHZhciBlcnJvclR5cGUgPSBldmVudCAmJiAoZXZlbnQudHlwZSA9PT0gJ2xvYWQnID8gJ21pc3NpbmcnIDogZXZlbnQudHlwZSk7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIHJlYWxTcmMgPSBldmVudCAmJiBldmVudC50YXJnZXQgJiYgZXZlbnQudGFyZ2V0LnNyYztcblx0XHRcdFx0XHRcdFx0XHRlcnJvci5tZXNzYWdlID0gJ0xvYWRpbmcgY2h1bmsgJyArIGNodW5rSWQgKyAnIGZhaWxlZC5cXG4oJyArIGVycm9yVHlwZSArICc6ICcgKyByZWFsU3JjICsgJyknO1xuXHRcdFx0XHRcdFx0XHRcdGVycm9yLm5hbWUgPSAnQ2h1bmtMb2FkRXJyb3InO1xuXHRcdFx0XHRcdFx0XHRcdGVycm9yLnR5cGUgPSBlcnJvclR5cGU7XG5cdFx0XHRcdFx0XHRcdFx0ZXJyb3IucmVxdWVzdCA9IHJlYWxTcmM7XG5cdFx0XHRcdFx0XHRcdFx0aW5zdGFsbGVkQ2h1bmtEYXRhWzFdKGVycm9yKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5sKHVybCwgbG9hZGluZ0VuZGVkLCBcImNodW5rLVwiICsgY2h1bmtJZCwgY2h1bmtJZCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG59O1xuXG4vLyBubyBwcmVmZXRjaGluZ1xuXG4vLyBubyBwcmVsb2FkZWRcblxuLy8gbm8gSE1SXG5cbi8vIG5vIEhNUiBtYW5pZmVzdFxuXG5fX3dlYnBhY2tfcmVxdWlyZV9fLk8uaiA9IChjaHVua0lkKSA9PiAoaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdID09PSAwKTtcblxuLy8gaW5zdGFsbCBhIEpTT05QIGNhbGxiYWNrIGZvciBjaHVuayBsb2FkaW5nXG52YXIgd2VicGFja0pzb25wQ2FsbGJhY2sgPSAocGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24sIGRhdGEpID0+IHtcblx0dmFyIFtjaHVua0lkcywgbW9yZU1vZHVsZXMsIHJ1bnRpbWVdID0gZGF0YTtcblx0Ly8gYWRkIFwibW9yZU1vZHVsZXNcIiB0byB0aGUgbW9kdWxlcyBvYmplY3QsXG5cdC8vIHRoZW4gZmxhZyBhbGwgXCJjaHVua0lkc1wiIGFzIGxvYWRlZCBhbmQgZmlyZSBjYWxsYmFja1xuXHR2YXIgbW9kdWxlSWQsIGNodW5rSWQsIGkgPSAwO1xuXHRpZihjaHVua0lkcy5zb21lKChpZCkgPT4gKGluc3RhbGxlZENodW5rc1tpZF0gIT09IDApKSkge1xuXHRcdGZvcihtb2R1bGVJZCBpbiBtb3JlTW9kdWxlcykge1xuXHRcdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKG1vcmVNb2R1bGVzLCBtb2R1bGVJZCkpIHtcblx0XHRcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tW21vZHVsZUlkXSA9IG1vcmVNb2R1bGVzW21vZHVsZUlkXTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYocnVudGltZSkgdmFyIHJlc3VsdCA9IHJ1bnRpbWUoX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cdH1cblx0aWYocGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24pIHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uKGRhdGEpO1xuXHRmb3IoO2kgPCBjaHVua0lkcy5sZW5ndGg7IGkrKykge1xuXHRcdGNodW5rSWQgPSBjaHVua0lkc1tpXTtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oaW5zdGFsbGVkQ2h1bmtzLCBjaHVua0lkKSAmJiBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0pIHtcblx0XHRcdGluc3RhbGxlZENodW5rc1tjaHVua0lkXVswXSgpO1xuXHRcdH1cblx0XHRpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gPSAwO1xuXHR9XG5cdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fLk8ocmVzdWx0KTtcbn1cblxudmFyIGNodW5rTG9hZGluZ0dsb2JhbCA9IHNlbGZbXCJ3ZWJwYWNrQ2h1bmt1cmJhbmRvY3Nfd2ViYXBwXCJdID0gc2VsZltcIndlYnBhY2tDaHVua3VyYmFuZG9jc193ZWJhcHBcIl0gfHwgW107XG5jaHVua0xvYWRpbmdHbG9iYWwuZm9yRWFjaCh3ZWJwYWNrSnNvbnBDYWxsYmFjay5iaW5kKG51bGwsIDApKTtcbmNodW5rTG9hZGluZ0dsb2JhbC5wdXNoID0gd2VicGFja0pzb25wQ2FsbGJhY2suYmluZChudWxsLCBjaHVua0xvYWRpbmdHbG9iYWwucHVzaC5iaW5kKGNodW5rTG9hZGluZ0dsb2JhbCkpOyIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgZGVwZW5kcyBvbiBvdGhlciBsb2FkZWQgY2h1bmtzIGFuZCBleGVjdXRpb24gbmVlZCB0byBiZSBkZWxheWVkXG52YXIgX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18uTyh1bmRlZmluZWQsIFszMDNdLCAoKSA9PiAoX193ZWJwYWNrX3JlcXVpcmVfXyg3OTcpKSlcbl9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fLk8oX193ZWJwYWNrX2V4cG9ydHNfXyk7XG4iXSwibmFtZXMiOlsiZGVmZXJyZWQiLCJsZWFmUHJvdG90eXBlcyIsImdldFByb3RvIiwiaW5Qcm9ncmVzcyIsImRhdGFXZWJwYWNrUHJlZml4Iiwic3VwYWJhc2UiLCJzaG93RXJyb3IiLCJtZXNzYWdlIiwiZWxlbWVudElkIiwiZXJyb3JFbGVtZW50IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImlubmVySFRNTCIsImNsYXNzTGlzdCIsInJlbW92ZSIsImNvbnNvbGUiLCJlcnJvciIsInNob3dMb2FkaW5nIiwiYnV0dG9uSWQiLCJzcGlubmVySWQiLCJidXR0b24iLCJzcGlubmVyIiwiZGlzYWJsZWQiLCJoaWRlTG9hZGluZyIsImFkZCIsImNhcHRjaGFUb2tlbiIsInR1cm5zdGlsZVdpZGdldElkIiwiaW5pdFNpZ251cFBhZ2UiLCJsb2ciLCJzaWdudXBGb3JtIiwiZ29vZ2xlU2lnblVwQnRuIiwiYWRkRXZlbnRMaXN0ZW5lciIsImFzeW5jIiwiZSIsInByZXZlbnREZWZhdWx0IiwiZW1haWwiLCJ2YWx1ZSIsInRyaW0iLCJwYXNzd29yZCIsImNvbmZpcm1QYXNzd29yZCIsInBob25lIiwidmFsaWRhdGlvbkVycm9ycyIsInRlc3QiLCJwdXNoIiwibGVuZ3RoIiwiam9pbiIsImUxNjRQaG9uZSIsInN0YXJ0c1dpdGgiLCJzdWJzdHJpbmciLCJkYXRhIiwic2lnblVwRXJyb3IiLCJhdXRoIiwic2lnblVwIiwib3B0aW9ucyIsInVzZXIiLCJFcnJvciIsImlkIiwiZnJvbSIsInVwZGF0ZSIsImVxIiwidHlwZSIsInN0YXR1c0VsZW1lbnQiLCJ0ZXh0Q29udGVudCIsImZvckVhY2giLCJjbGFzc05hbWUiLCJzaG93U3RhdHVzIiwicmVzZXQiLCJkaXNwbGF5RXJyb3IiLCJpbmNsdWRlcyIsInRvTG93ZXJDYXNlIiwid2luZG93IiwidHVybnN0aWxlIiwic2lnbkluV2l0aE9BdXRoIiwicHJvdmlkZXIiLCJyZWRpcmVjdFRvIiwibG9jYXRpb24iLCJvcmlnaW4iLCJ3YXJuIiwib25sb2FkVHVybnN0aWxlQ2FsbGJhY2siLCJ0dXJuc3RpbGVDb250YWluZXIiLCJyZW5kZXIiLCJzaXRla2V5IiwiY2FsbGJhY2siLCJ0b2tlbiIsImVyciIsInVuZGVmaW5lZCIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiY2FsbCIsIm0iLCJPIiwicmVzdWx0IiwiY2h1bmtJZHMiLCJmbiIsInByaW9yaXR5Iiwibm90RnVsZmlsbGVkIiwiSW5maW5pdHkiLCJpIiwiZnVsZmlsbGVkIiwiaiIsIk9iamVjdCIsImtleXMiLCJldmVyeSIsImtleSIsInNwbGljZSIsInIiLCJnZXRQcm90b3R5cGVPZiIsIm9iaiIsInQiLCJtb2RlIiwidGhpcyIsIl9fZXNNb2R1bGUiLCJ0aGVuIiwibnMiLCJjcmVhdGUiLCJkZWYiLCJjdXJyZW50IiwiaW5kZXhPZiIsImdldE93blByb3BlcnR5TmFtZXMiLCJkIiwiZGVmaW5pdGlvbiIsIm8iLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJmIiwiY2h1bmtJZCIsIlByb21pc2UiLCJhbGwiLCJyZWR1Y2UiLCJwcm9taXNlcyIsInUiLCJnIiwiZ2xvYmFsVGhpcyIsIkZ1bmN0aW9uIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwibCIsInVybCIsImRvbmUiLCJzY3JpcHQiLCJuZWVkQXR0YWNoIiwic2NyaXB0cyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwicyIsImdldEF0dHJpYnV0ZSIsImNyZWF0ZUVsZW1lbnQiLCJjaGFyc2V0IiwidGltZW91dCIsIm5jIiwic2V0QXR0cmlidXRlIiwic3JjIiwib25TY3JpcHRDb21wbGV0ZSIsInByZXYiLCJldmVudCIsIm9uZXJyb3IiLCJvbmxvYWQiLCJjbGVhclRpbWVvdXQiLCJkb25lRm5zIiwicGFyZW50Tm9kZSIsInJlbW92ZUNoaWxkIiwic2V0VGltZW91dCIsImJpbmQiLCJ0YXJnZXQiLCJoZWFkIiwiYXBwZW5kQ2hpbGQiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInNjcmlwdFVybCIsImltcG9ydFNjcmlwdHMiLCJjdXJyZW50U2NyaXB0IiwidGFnTmFtZSIsInRvVXBwZXJDYXNlIiwicmVwbGFjZSIsInAiLCJpbnN0YWxsZWRDaHVua3MiLCJpbnN0YWxsZWRDaHVua0RhdGEiLCJwcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImVycm9yVHlwZSIsInJlYWxTcmMiLCJuYW1lIiwicmVxdWVzdCIsIndlYnBhY2tKc29ucENhbGxiYWNrIiwicGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24iLCJtb3JlTW9kdWxlcyIsInJ1bnRpbWUiLCJzb21lIiwiY2h1bmtMb2FkaW5nR2xvYmFsIiwic2VsZiIsIl9fd2VicGFja19leHBvcnRzX18iXSwic291cmNlUm9vdCI6IiJ9