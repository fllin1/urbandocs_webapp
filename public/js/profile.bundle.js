(()=>{"use strict";var e,t,o,r,n,a={923:(e,t,o)=>{const r=(0,o(303).UU)("https://ofeyssipibktmbfebibo.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9mZXlzc2lwaWJrdG1iZmViaWJvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM5MjUwOTQsImV4cCI6MjA1OTUwMTA5NH0.w71CAKfolktzRl-TmLVhHYaEbhCfVk4A7YraEUCglrU");let n=null,a=!1;function i(e){n=e,e?localStorage.setItem("currentUser",JSON.stringify(e)):localStorage.removeItem("currentUser")}async function s(e="/login"){return!!await async function(){try{const{data:{session:e},error:t}=await r.auth.getSession();if(t||!e)return console.log("No valid session found"),i(null),a=!1,!1;const{error:o}=await r.auth.refreshSession();return o?(console.warn("Session validation failed:",o),await r.auth.signOut(),i(null),a=!1,!1):(i(e.user),a=!0,!0)}catch(e){return console.error("Session validation error:",e),i(null),a=!1,!1}}()||(window.location.href=e,!1)}function c(e,t){const o=document.getElementById(e),r=document.getElementById(t);o&&(o.disabled=!0),r&&r.classList.remove("hidden")}function l(e,t){const o=document.getElementById(e),r=document.getElementById(t);o&&(o.disabled=!1),r&&r.classList.add("hidden")}function d(e,t,o){const r=document.getElementById(o);r&&(r.textContent=e,r.className="status-message margin-top-sm",r.classList.add(t),r.classList.remove("hidden"))}async function u(){if(!await s())return;const e=document.getElementById("userEmail"),t=document.getElementById("logoutBtn"),o=document.getElementById("profileForm"),n=document.getElementById("deleteAccountBtn"),a=document.getElementById("memberSince");try{const{data:{session:i}}=await r.auth.getSession();if(!i||!i.user)return console.log("No active session or user. Redirecting to login."),void(window.location.href="/login.html");const s=i.user;e&&(e.textContent=s.email),a&&s.created_at&&(a.textContent=new Date(s.created_at).toLocaleDateString()),c("saveProfileBtn");const u=await async function(e){const{data:t,error:o}=await r.from("users").select("nom, prenom, adresse, ville, code_postal, occupation, updated_at").eq("id",e).single();if(o&&"PGRST116"!==o.code)throw console.error("Error fetching profile:",o),o;return t}(s.id);u?function(e){if(!e)return;document.getElementById("nom").value=e.nom||"",document.getElementById("prenom").value=e.prenom||"",document.getElementById("adresse").value=e.adresse||"",document.getElementById("ville").value=e.ville||"",document.getElementById("codePostal").value=e.code_postal||"",document.getElementById("occupation").value=e.occupation||"";const t=document.getElementById("memberSince");t&&e.updated_at&&(t.textContent=new Date(e.updated_at).toLocaleDateString())}(u):console.log("No profile data found for user, form will be empty."),l("saveProfileBtn"),t&&t.addEventListener("click",(async()=>{c("logoutBtn");try{const{error:e}=await r.auth.signOut();if(e)throw e;d("Déconnexion réussie. Redirection...","success","profileFormStatus"),setTimeout((()=>{window.location.href="/"}),200)}catch(e){console.error("Error signing out:",e),d(`Erreur de déconnexion: ${e.message}`,"error","profileFormStatus")}finally{l("logoutBtn")}})),o&&o.addEventListener("submit",(async e=>{e.preventDefault(),c("saveProfileBtn");const t="profileFormStatus";document.getElementById(t).classList.add("hidden");const o={id:s.id,nom:document.getElementById("nom").value,prenom:document.getElementById("prenom").value,adresse:document.getElementById("adresse").value,ville:document.getElementById("ville").value,code_postal:document.getElementById("codePostal").value,occupation:document.getElementById("occupation").value,updated_at:new Date};try{const{error:e}=await r.from("profiles").upsert(o);if(e)throw e;d("Profil mis à jour avec succès !","success",t)}catch(e){console.error("Error updating profile:",e),d(`Erreur lors de la mise à jour: ${e.message}`,"error",t)}finally{l("saveProfileBtn")}})),n&&n.addEventListener("click",(async()=>{const e="deleteStatusMessage";if(document.getElementById(e).classList.add("hidden"),confirm("Êtes-vous sûr de vouloir supprimer votre compte ? Cette action est irréversible et toutes vos données seront perdues.")){c("deleteAccountBtn");try{const{error:t}=await r.rpc("delete_user_account");if(t)throw t;d("Compte supprimé avec succès. Vous allez être déconnecté et redirigé.","success",e),await r.auth.signOut(),setTimeout((()=>{window.location.href="/"}),3e3)}catch(t){console.error("Error deleting account:",t),d(`Erreur lors de la suppression du compte: ${t.message}`,"error",e)}finally{l("deleteAccountBtn")}}else console.log("User cancelled account deletion.")}))}catch(e){console.error("Profile page initialization error:",e);const t=document.getElementById("profileDetails");t&&(t.innerHTML='<p class="error-message">Impossible de charger les informations du profil. Veuillez réessayer plus tard.</p>')}}document.addEventListener("DOMContentLoaded",u),document.addEventListener("DOMContentLoaded",(()=>{u(),console.log("Profile page initialized")}))}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var o=i[e]={exports:{}};return a[e].call(o.exports,o,o.exports,s),o.exports}s.m=a,e=[],s.O=(t,o,r,n)=>{if(!o){var a=1/0;for(d=0;d<e.length;d++){for(var[o,r,n]=e[d],i=!0,c=0;c<o.length;c++)(!1&n||a>=n)&&Object.keys(s.O).every((e=>s.O[e](o[c])))?o.splice(c--,1):(i=!1,n<a&&(a=n));if(i){e.splice(d--,1);var l=r();void 0!==l&&(t=l)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[o,r,n]},o=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,s.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var n=Object.create(null);s.r(n);var a={};t=t||[null,o({}),o([]),o(o)];for(var i=2&r&&e;"object"==typeof i&&!~t.indexOf(i);i=o(i))Object.getOwnPropertyNames(i).forEach((t=>a[t]=()=>e[t]));return a.default=()=>e,s.d(n,a),n},s.d=(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,o)=>(s.f[o](e,t),t)),[])),s.u=e=>"js/"+e+".bundle.js",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r={},n="urbandocs_webapp:",s.l=(e,t,o,a)=>{if(r[e])r[e].push(t);else{var i,c;if(void 0!==o)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var u=l[d];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==n+o){i=u;break}}i||(c=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,s.nc&&i.setAttribute("nonce",s.nc),i.setAttribute("data-webpack",n+o),i.src=e),r[e]=[t];var m=(t,o)=>{i.onerror=i.onload=null,clearTimeout(p);var n=r[e];if(delete r[e],i.parentNode&&i.parentNode.removeChild(i),n&&n.forEach((e=>e(o))),t)return t(o)},p=setTimeout(m.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=m.bind(null,i.onerror),i.onload=m.bind(null,i.onload),c&&document.head.appendChild(i)}},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");if(o.length)for(var r=o.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=o[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e+"../"})(),(()=>{var e={138:0};s.f.j=(t,o)=>{var r=s.o(e,t)?e[t]:void 0;if(0!==r)if(r)o.push(r[2]);else{var n=new Promise(((o,n)=>r=e[t]=[o,n]));o.push(r[2]=n);var a=s.p+s.u(t),i=new Error;s.l(a,(o=>{if(s.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var n=o&&("load"===o.type?"missing":o.type),a=o&&o.target&&o.target.src;i.message="Loading chunk "+t+" failed.\n("+n+": "+a+")",i.name="ChunkLoadError",i.type=n,i.request=a,r[1](i)}}),"chunk-"+t,t)}},s.O.j=t=>0===e[t];var t=(t,o)=>{var r,n,[a,i,c]=o,l=0;if(a.some((t=>0!==e[t]))){for(r in i)s.o(i,r)&&(s.m[r]=i[r]);if(c)var d=c(s)}for(t&&t(o);l<a.length;l++)n=a[l],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(d)},o=self.webpackChunkurbandocs_webapp=self.webpackChunkurbandocs_webapp||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var c=s.O(void 0,[303],(()=>s(923)));c=s.O(c)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RSxRQUFRcUUsRUFBcUJ4QixLQUFLLEtBQU0sSUFDM0Q2QixFQUFtQm5ELEtBQU84QyxFQUFxQnhCLEtBQUssS0FBTTZCLEVBQW1CbkQsS0FBS3NCLEtBQUs2QixHLEtDbEZ2RixJQUFJRSxFQUFzQm5ILEVBQW9CUyxPQUFFTixFQUFXLENBQUMsTUFBTSxJQUFPSCxFQUFvQixPQUM3Rm1ILEVBQXNCbkgsRUFBb0JTLEVBQUUwRyxFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvY2h1bmsgbG9hZGVkIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2NyZWF0ZSBmYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvbG9hZCBzY3JpcHQiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC8uL3NyYy9qcy9zdXBhYmFzZS1jbGllbnQuanMiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC8uL3NyYy9qcy9hdXRoL2F1dGguanMiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC8uL3NyYy9qcy9hdXRoL3Byb2ZpbGUuanMiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC8uL3NyYy9qcy9lbnRyaWVzL3Byb2ZpbGUuanMiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9lbnN1cmUgY2h1bmsiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvZ2V0IGphdmFzY3JpcHQgY2h1bmsgZmlsZW5hbWUiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvZ2xvYmFsIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvcHVibGljUGF0aCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9qc29ucCBjaHVuayBsb2FkaW5nIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9zdGFydHVwIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBkZWZlcnJlZCA9IFtdO1xuX193ZWJwYWNrX3JlcXVpcmVfXy5PID0gKHJlc3VsdCwgY2h1bmtJZHMsIGZuLCBwcmlvcml0eSkgPT4ge1xuXHRpZihjaHVua0lkcykge1xuXHRcdHByaW9yaXR5ID0gcHJpb3JpdHkgfHwgMDtcblx0XHRmb3IodmFyIGkgPSBkZWZlcnJlZC5sZW5ndGg7IGkgPiAwICYmIGRlZmVycmVkW2kgLSAxXVsyXSA+IHByaW9yaXR5OyBpLS0pIGRlZmVycmVkW2ldID0gZGVmZXJyZWRbaSAtIDFdO1xuXHRcdGRlZmVycmVkW2ldID0gW2NodW5rSWRzLCBmbiwgcHJpb3JpdHldO1xuXHRcdHJldHVybjtcblx0fVxuXHR2YXIgbm90RnVsZmlsbGVkID0gSW5maW5pdHk7XG5cdGZvciAodmFyIGkgPSAwOyBpIDwgZGVmZXJyZWQubGVuZ3RoOyBpKyspIHtcblx0XHR2YXIgW2NodW5rSWRzLCBmbiwgcHJpb3JpdHldID0gZGVmZXJyZWRbaV07XG5cdFx0dmFyIGZ1bGZpbGxlZCA9IHRydWU7XG5cdFx0Zm9yICh2YXIgaiA9IDA7IGogPCBjaHVua0lkcy5sZW5ndGg7IGorKykge1xuXHRcdFx0aWYgKChwcmlvcml0eSAmIDEgPT09IDAgfHwgbm90RnVsZmlsbGVkID49IHByaW9yaXR5KSAmJiBPYmplY3Qua2V5cyhfX3dlYnBhY2tfcmVxdWlyZV9fLk8pLmV2ZXJ5KChrZXkpID0+IChfX3dlYnBhY2tfcmVxdWlyZV9fLk9ba2V5XShjaHVua0lkc1tqXSkpKSkge1xuXHRcdFx0XHRjaHVua0lkcy5zcGxpY2Uoai0tLCAxKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGZ1bGZpbGxlZCA9IGZhbHNlO1xuXHRcdFx0XHRpZihwcmlvcml0eSA8IG5vdEZ1bGZpbGxlZCkgbm90RnVsZmlsbGVkID0gcHJpb3JpdHk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmKGZ1bGZpbGxlZCkge1xuXHRcdFx0ZGVmZXJyZWQuc3BsaWNlKGktLSwgMSlcblx0XHRcdHZhciByID0gZm4oKTtcblx0XHRcdGlmIChyICE9PSB1bmRlZmluZWQpIHJlc3VsdCA9IHI7XG5cdFx0fVxuXHR9XG5cdHJldHVybiByZXN1bHQ7XG59OyIsInZhciBnZXRQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiA/IChvYmopID0+IChPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqKSkgOiAob2JqKSA9PiAob2JqLl9fcHJvdG9fXyk7XG52YXIgbGVhZlByb3RvdHlwZXM7XG4vLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3Rcbi8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuLy8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4vLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3Rcbi8vIG1vZGUgJiAxNjogcmV0dXJuIHZhbHVlIHdoZW4gaXQncyBQcm9taXNlLWxpa2Vcbi8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbl9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG5cdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IHRoaXModmFsdWUpO1xuXHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuXHRpZih0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlKSB7XG5cdFx0aWYoKG1vZGUgJiA0KSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG5cdFx0aWYoKG1vZGUgJiAxNikgJiYgdHlwZW9mIHZhbHVlLnRoZW4gPT09ICdmdW5jdGlvbicpIHJldHVybiB2YWx1ZTtcblx0fVxuXHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuXHR2YXIgZGVmID0ge307XG5cdGxlYWZQcm90b3R5cGVzID0gbGVhZlByb3RvdHlwZXMgfHwgW251bGwsIGdldFByb3RvKHt9KSwgZ2V0UHJvdG8oW10pLCBnZXRQcm90byhnZXRQcm90byldO1xuXHRmb3IodmFyIGN1cnJlbnQgPSBtb2RlICYgMiAmJiB2YWx1ZTsgdHlwZW9mIGN1cnJlbnQgPT0gJ29iamVjdCcgJiYgIX5sZWFmUHJvdG90eXBlcy5pbmRleE9mKGN1cnJlbnQpOyBjdXJyZW50ID0gZ2V0UHJvdG8oY3VycmVudCkpIHtcblx0XHRPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhjdXJyZW50KS5mb3JFYWNoKChrZXkpID0+IChkZWZba2V5XSA9ICgpID0+ICh2YWx1ZVtrZXldKSkpO1xuXHR9XG5cdGRlZlsnZGVmYXVsdCddID0gKCkgPT4gKHZhbHVlKTtcblx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBkZWYpO1xuXHRyZXR1cm4gbnM7XG59OyIsInZhciBpblByb2dyZXNzID0ge307XG52YXIgZGF0YVdlYnBhY2tQcmVmaXggPSBcInVyYmFuZG9jc193ZWJhcHA6XCI7XG4vLyBsb2FkU2NyaXB0IGZ1bmN0aW9uIHRvIGxvYWQgYSBzY3JpcHQgdmlhIHNjcmlwdCB0YWdcbl9fd2VicGFja19yZXF1aXJlX18ubCA9ICh1cmwsIGRvbmUsIGtleSwgY2h1bmtJZCkgPT4ge1xuXHRpZihpblByb2dyZXNzW3VybF0pIHsgaW5Qcm9ncmVzc1t1cmxdLnB1c2goZG9uZSk7IHJldHVybjsgfVxuXHR2YXIgc2NyaXB0LCBuZWVkQXR0YWNoO1xuXHRpZihrZXkgIT09IHVuZGVmaW5lZCkge1xuXHRcdHZhciBzY3JpcHRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIik7XG5cdFx0Zm9yKHZhciBpID0gMDsgaSA8IHNjcmlwdHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdHZhciBzID0gc2NyaXB0c1tpXTtcblx0XHRcdGlmKHMuZ2V0QXR0cmlidXRlKFwic3JjXCIpID09IHVybCB8fCBzLmdldEF0dHJpYnV0ZShcImRhdGEtd2VicGFja1wiKSA9PSBkYXRhV2VicGFja1ByZWZpeCArIGtleSkgeyBzY3JpcHQgPSBzOyBicmVhazsgfVxuXHRcdH1cblx0fVxuXHRpZighc2NyaXB0KSB7XG5cdFx0bmVlZEF0dGFjaCA9IHRydWU7XG5cdFx0c2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG5cblx0XHRzY3JpcHQuY2hhcnNldCA9ICd1dGYtOCc7XG5cdFx0c2NyaXB0LnRpbWVvdXQgPSAxMjA7XG5cdFx0aWYgKF9fd2VicGFja19yZXF1aXJlX18ubmMpIHtcblx0XHRcdHNjcmlwdC5zZXRBdHRyaWJ1dGUoXCJub25jZVwiLCBfX3dlYnBhY2tfcmVxdWlyZV9fLm5jKTtcblx0XHR9XG5cdFx0c2NyaXB0LnNldEF0dHJpYnV0ZShcImRhdGEtd2VicGFja1wiLCBkYXRhV2VicGFja1ByZWZpeCArIGtleSk7XG5cblx0XHRzY3JpcHQuc3JjID0gdXJsO1xuXHR9XG5cdGluUHJvZ3Jlc3NbdXJsXSA9IFtkb25lXTtcblx0dmFyIG9uU2NyaXB0Q29tcGxldGUgPSAocHJldiwgZXZlbnQpID0+IHtcblx0XHQvLyBhdm9pZCBtZW0gbGVha3MgaW4gSUUuXG5cdFx0c2NyaXB0Lm9uZXJyb3IgPSBzY3JpcHQub25sb2FkID0gbnVsbDtcblx0XHRjbGVhclRpbWVvdXQodGltZW91dCk7XG5cdFx0dmFyIGRvbmVGbnMgPSBpblByb2dyZXNzW3VybF07XG5cdFx0ZGVsZXRlIGluUHJvZ3Jlc3NbdXJsXTtcblx0XHRzY3JpcHQucGFyZW50Tm9kZSAmJiBzY3JpcHQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChzY3JpcHQpO1xuXHRcdGRvbmVGbnMgJiYgZG9uZUZucy5mb3JFYWNoKChmbikgPT4gKGZuKGV2ZW50KSkpO1xuXHRcdGlmKHByZXYpIHJldHVybiBwcmV2KGV2ZW50KTtcblx0fVxuXHR2YXIgdGltZW91dCA9IHNldFRpbWVvdXQob25TY3JpcHRDb21wbGV0ZS5iaW5kKG51bGwsIHVuZGVmaW5lZCwgeyB0eXBlOiAndGltZW91dCcsIHRhcmdldDogc2NyaXB0IH0pLCAxMjAwMDApO1xuXHRzY3JpcHQub25lcnJvciA9IG9uU2NyaXB0Q29tcGxldGUuYmluZChudWxsLCBzY3JpcHQub25lcnJvcik7XG5cdHNjcmlwdC5vbmxvYWQgPSBvblNjcmlwdENvbXBsZXRlLmJpbmQobnVsbCwgc2NyaXB0Lm9ubG9hZCk7XG5cdG5lZWRBdHRhY2ggJiYgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpO1xufTsiLCIvLyBzcmMvanMvc3VwYWJhc2UtY2xpZW50LmpzXG4vKipcbiAqIFN1cGFiYXNlIENsaWVudFxuICogQG1vZHVsZSBzdXBhYmFzZS1jbGllbnRcbiAqIEBkZXNjcmlwdGlvbiBUaGlzIG1vZHVsZSBoYW5kbGVzIHRoZSBTdXBhYmFzZSBjbGllbnQgaW5pdGlhbGl6YXRpb24gYW5kIGNvbmZpZ3VyYXRpb24uXG4gKiBAdmVyc2lvbiAwLjAuMVxuICogQGF1dGhvciBHcmV5UGFuZGFcbiAqXG4gKiBAY2hhbmdlbG9nXG4gKiAtIDAuMC4xICgyMDI1LTA1LTA5KTogSW5pdGlhbCB2ZXJzaW9uIHdpdGggYmFzaWMgU3VwYWJhc2UgY2xpZW50IGluaXRpYWxpemF0aW9uLlxuICovXG5cbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCJAc3VwYWJhc2Uvc3VwYWJhc2UtanNcIjtcblxuY29uc3Qgc3VwYWJhc2VVcmwgPSBcImh0dHBzOi8vb2ZleXNzaXBpYmt0bWJmZWJpYm8uc3VwYWJhc2UuY29cIjtcbmNvbnN0IHN1cGFiYXNlQW5vbktleSA9XG4gIFwiZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKemRYQmhZbUZ6WlNJc0luSmxaaUk2SW05bVpYbHpjMmx3YVdKcmRHMWlabVZpYVdKdklpd2ljbTlzWlNJNkltRnViMjRpTENKcFlYUWlPakUzTkRNNU1qVXdPVFFzSW1WNGNDSTZNakExT1RVd01UQTVOSDAudzcxQ0FLZm9sa3R6UmwtVG1MVmhIWWFFYmhDZlZrNEE3WXJhRVVDZ2xyVVwiO1xuXG5jb25zdCBjbGllbnQgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSk7XG5cbmV4cG9ydCBjb25zdCBzdXBhYmFzZSA9IGNsaWVudDtcbiIsIi8vIHNyYy9hdXRoL2F1dGguanNcbi8qKlxuICogQXV0aGVudGljYXRpb24gTW9kdWxlIC0gQmFzZVxuICogQG1vZHVsZSBhdXRoXG4gKiBAZGVzY3JpcHRpb24gQmFzZSBtb2R1bGUgZm9yIGF1dGhlbnRpY2F0aW9uIHdpdGggY29tbW9uIGZ1bmN0aW9ucyBhbmQgY29uZmlndXJhdGlvblxuICogQHZlcnNpb24gMC4wLjVcbiAqXG4gKiBAY2hhbmdlbG9nXG4gKiAtIDAuMC41ICgyMDI1LTA1LTE1KTogQWRkZWQgc2Vzc2lvbiB2YWxpZGF0aW9uIGFuZCBwcm90ZWN0aW9uIGFnYWluc3Qgc3RhbGUgc2Vzc2lvbnMuXG4gKiAtIDAuMC40ICgyMDI1LTA1LTE1KTogUmVtb3ZhbCBvZiBGaXJlYmFzZSBDbG91ZCBGdW5jdGlvbnMgY29uc3RhbnRzLlxuICogLSAwLjAuMyAoMjAyNS0wNS0xMyk6IE1vZGlmaWVkIHRoZSBhdXRoZW50aWNhdGlvbiBzdGF0ZSBtYW5hZ2VtZW50IHRvIHVzZSBTdXBhYmFzZSBBdXRoIHN5c3RlbS5cbiAqIC0gMC4wLjIgKDIwMjUtMDUtMTMpOiBSZW9yZ2FuaXphdGlvbiBpbnRvIHNlcGFyYXRlIG1vZHVsZXNcbiAqIC0gMC4wLjEgKDIwMjUtMDUtMDMpOiBJbml0aWFsIGNyZWF0aW9uXG4gKi9cblxuaW1wb3J0IHsgc3VwYWJhc2UgfSBmcm9tIFwiLi4vc3VwYWJhc2UtY2xpZW50LmpzXCI7XG5cbi8vIEdsb2JhbCBhdXRoZW50aWNhdGlvbiBzdGF0ZVxubGV0IGN1cnJlbnRVc2VyID0gbnVsbDtcbmxldCBzZXNzaW9uVmFsaWRhdGVkID0gZmFsc2U7XG5cbi8qKlxuICogU2V0cyB0aGUgY3VycmVudCB1c2VyXG4gKiBAcGFyYW0ge09iamVjdH0gdXNlciAtIFVzZXIgZGF0YVxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0Q3VycmVudFVzZXIodXNlcikge1xuICBjdXJyZW50VXNlciA9IHVzZXI7XG4gIC8vIFBvc3NpYmxlIHN0b3JhZ2UgaW4gbG9jYWxTdG9yYWdlL3Nlc3Npb25TdG9yYWdlXG4gIGlmICh1c2VyKSB7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJjdXJyZW50VXNlclwiLCBKU09OLnN0cmluZ2lmeSh1c2VyKSk7XG4gIH0gZWxzZSB7XG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJjdXJyZW50VXNlclwiKTtcbiAgfVxufVxuXG4vKipcbiAqIFZhbGlkYXRlcyBpZiB0aGUgY3VycmVudCBzZXNzaW9uIGlzIGFjdGl2ZSB3aXRoIFN1cGFiYXNlXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxib29sZWFuPn0gVHJ1ZSBpZiBzZXNzaW9uIGlzIHZhbGlkLCBmYWxzZSBvdGhlcndpc2VcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZhbGlkYXRlU2Vzc2lvbigpIHtcbiAgdHJ5IHtcbiAgICAvLyBHZXQgY3VycmVudCBzZXNzaW9uIGZyb20gU3VwYWJhc2VcbiAgICBjb25zdCB7XG4gICAgICBkYXRhOiB7IHNlc3Npb24gfSxcbiAgICAgIGVycm9yOiBzZXNzaW9uRXJyb3IsXG4gICAgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0U2Vzc2lvbigpO1xuXG4gICAgLy8gTm8gc2Vzc2lvbiBvciBlcnJvciByZXRyaWV2aW5nIHNlc3Npb25cbiAgICBpZiAoc2Vzc2lvbkVycm9yIHx8ICFzZXNzaW9uKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIk5vIHZhbGlkIHNlc3Npb24gZm91bmRcIik7XG4gICAgICBzZXRDdXJyZW50VXNlcihudWxsKTtcbiAgICAgIHNlc3Npb25WYWxpZGF0ZWQgPSBmYWxzZTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBUcnkgdG8gcmVmcmVzaCB0aGUgdG9rZW4gdG8gdmFsaWRhdGUgaXQgd2l0aCB0aGUgc2VydmVyXG4gICAgY29uc3QgeyBlcnJvcjogcmVmcmVzaEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLnJlZnJlc2hTZXNzaW9uKCk7XG5cbiAgICBpZiAocmVmcmVzaEVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJTZXNzaW9uIHZhbGlkYXRpb24gZmFpbGVkOlwiLCByZWZyZXNoRXJyb3IpO1xuICAgICAgLy8gRm9yY2UgY2xlYXIgdGhlIGludmFsaWQgc2Vzc2lvblxuICAgICAgYXdhaXQgc3VwYWJhc2UuYXV0aC5zaWduT3V0KCk7XG4gICAgICBzZXRDdXJyZW50VXNlcihudWxsKTtcbiAgICAgIHNlc3Npb25WYWxpZGF0ZWQgPSBmYWxzZTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBTZXNzaW9uIGlzIHZhbGlkLCB1cGRhdGUgdGhlIGN1cnJlbnQgdXNlclxuICAgIHNldEN1cnJlbnRVc2VyKHNlc3Npb24udXNlcik7XG4gICAgc2Vzc2lvblZhbGlkYXRlZCA9IHRydWU7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiU2Vzc2lvbiB2YWxpZGF0aW9uIGVycm9yOlwiLCBlKTtcbiAgICBzZXRDdXJyZW50VXNlcihudWxsKTtcbiAgICBzZXNzaW9uVmFsaWRhdGVkID0gZmFsc2U7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbi8qKlxuICogUmV0cmlldmVzIHRoZSBjdXJyZW50IHVzZXJcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsaWRhdGUgLSBXaGV0aGVyIHRvIHZhbGlkYXRlIHRoZSBzZXNzaW9uIHdpdGggU3VwYWJhc2VcbiAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdHxudWxsPn0gVGhlIGN1cnJlbnQgdXNlciBvciBudWxsXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDdXJyZW50VXNlcih2YWxpZGF0ZSA9IHRydWUpIHtcbiAgLy8gSWYgd2UgbmVlZCB0byB2YWxpZGF0ZSBhbmQgaGF2ZW4ndCBkb25lIHNvIHlldFxuICBpZiAodmFsaWRhdGUgJiYgIXNlc3Npb25WYWxpZGF0ZWQpIHtcbiAgICBhd2FpdCB2YWxpZGF0ZVNlc3Npb24oKTtcbiAgfVxuXG4gIC8vIElmIG5vIHZhbGlkYXRpb24gbmVlZGVkIG9yIGFscmVhZHkgdmFsaWRhdGVkXG4gIGlmICghdmFsaWRhdGUgJiYgIWN1cnJlbnRVc2VyKSB7XG4gICAgLy8gVHJ5IHRvIHJldHJpZXZlIGZyb20gc3RvcmFnZSBpZiBub3QgaW4gbWVtb3J5XG4gICAgY29uc3Qgc3RvcmVkVXNlciA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiY3VycmVudFVzZXJcIik7XG4gICAgaWYgKHN0b3JlZFVzZXIpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGN1cnJlbnRVc2VyID0gSlNPTi5wYXJzZShzdG9yZWRVc2VyKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHJldHJpZXZpbmcgdXNlcjpcIiwgZSk7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFwiY3VycmVudFVzZXJcIik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGN1cnJlbnRVc2VyO1xufVxuXG4vKipcbiAqIFN5bmNocm9ub3VzIHZlcnNpb24gb2YgZ2V0Q3VycmVudFVzZXIgZm9yIG5vbi1hc3luYyBjb250ZXh0c1xuICogV0FSTklORzogVGhpcyBtYXkgcmV0dXJuIHN0YWxlIGRhdGEgaWYgc2Vzc2lvbiBpcyBpbnZhbGlkXG4gKiBAcmV0dXJucyB7T2JqZWN0fG51bGx9IFRoZSBjdXJyZW50IHVzZXIgb3IgbnVsbFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q3VycmVudFVzZXJTeW5jKCkge1xuICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgY29uc3Qgc3RvcmVkVXNlciA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiY3VycmVudFVzZXJcIik7XG4gICAgaWYgKHN0b3JlZFVzZXIpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGN1cnJlbnRVc2VyID0gSlNPTi5wYXJzZShzdG9yZWRVc2VyKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHJldHJpZXZpbmcgdXNlcjpcIiwgZSk7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFwiY3VycmVudFVzZXJcIik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGN1cnJlbnRVc2VyO1xufVxuXG4vKipcbiAqIExvZ3Mgb3V0IHRoZSB1c2VyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx2b2lkPn1cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvZ291dCgpIHtcbiAgdHJ5IHtcbiAgICAvLyBTaWduIG91dCBmcm9tIFN1cGFiYXNlXG4gICAgYXdhaXQgc3VwYWJhc2UuYXV0aC5zaWduT3V0KCk7XG5cbiAgICAvLyBDbGVhciBsb2NhbCBzdGF0ZVxuICAgIGN1cnJlbnRVc2VyID0gbnVsbDtcbiAgICBzZXNzaW9uVmFsaWRhdGVkID0gZmFsc2U7XG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJjdXJyZW50VXNlclwiKTtcblxuICAgIC8vIFJlZGlyZWN0IHRvIHRoZSBob21lIHBhZ2UgYWZ0ZXIgbG9nb3V0XG4gICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcIi9cIjtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZHVyaW5nIGxvZ291dDpcIiwgZXJyb3IpO1xuICAgIC8vIFN0aWxsIGNsZWFyIGxvY2FsIHN0YXRlIGV2ZW4gaWYgU3VwYWJhc2Ugc2lnbk91dCBmYWlsc1xuICAgIGN1cnJlbnRVc2VyID0gbnVsbDtcbiAgICBzZXNzaW9uVmFsaWRhdGVkID0gZmFsc2U7XG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJjdXJyZW50VXNlclwiKTtcbiAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IFwiL1wiO1xuICB9XG59XG5cbi8qKlxuICogQ2hlY2tzIGlmIHRoZSB1c2VyIGlzIGxvZ2dlZCBpbiB3aXRoIHZhbGlkIHNlc3Npb25cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsaWRhdGUgLSBXaGV0aGVyIHRvIHZhbGlkYXRlIHdpdGggU3VwYWJhc2UgZmlyc3RcbiAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fSBUcnVlIGlmIHRoZSB1c2VyIGlzIGxvZ2dlZCBpbiB3aXRoIHZhbGlkIHNlc3Npb25cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGlzTG9nZ2VkSW4odmFsaWRhdGUgPSB0cnVlKSB7XG4gIGNvbnN0IHVzZXIgPSBhd2FpdCBnZXRDdXJyZW50VXNlcih2YWxpZGF0ZSk7XG4gIHJldHVybiB1c2VyICE9PSBudWxsO1xufVxuXG4vKipcbiAqIFN5bmNocm9ub3VzIHZlcnNpb24gb2YgaXNMb2dnZWRJblxuICogV0FSTklORzogVGhpcyBtYXkgcmV0dXJuIGluY29ycmVjdCByZXN1bHRzIGlmIHNlc3Npb24gaXMgaW52YWxpZFxuICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdXNlciBhcHBlYXJzIHRvIGJlIGxvZ2dlZCBpbiBsb2NhbGx5XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc0xvZ2dlZEluU3luYygpIHtcbiAgcmV0dXJuIGdldEN1cnJlbnRVc2VyU3luYygpICE9PSBudWxsO1xufVxuXG4vKipcbiAqIFByb3RlY3RzIGEgcGFnZSB0aGF0IHJlcXVpcmVzIGF1dGhlbnRpY2F0aW9uXG4gKiBAcGFyYW0ge3N0cmluZ30gcmVkaXJlY3RVcmwgLSBVUkwgdG8gcmVkaXJlY3QgaWYgbm90IGF1dGhlbnRpY2F0ZWRcbiAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fSBUcnVlIGlmIGF1dGhlbnRpY2F0ZWQsIGZhbHNlIG90aGVyd2lzZVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJvdGVjdFBhZ2UocmVkaXJlY3RVcmwgPSBcIi9sb2dpblwiKSB7XG4gIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCB2YWxpZGF0ZVNlc3Npb24oKTtcblxuICBpZiAoIWlzVmFsaWQpIHtcbiAgICAvLyBSZWRpcmVjdCB0byBsb2dpbiBwYWdlXG4gICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSByZWRpcmVjdFVybDtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn1cblxuLyoqXG4gKiBJbml0aWFsaXplcyBhdXRoIG9uIHBhZ2UgbG9hZFxuICogQ2FsbCB0aGlzIGF0IHRoZSBiZWdpbm5pbmcgb2YgeW91ciBhcHAgaW5pdGlhbGl6YXRpb25cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGluaXRBdXRoKCkge1xuICAvLyBWYWxpZGF0ZSBzZXNzaW9uIG9uIHBhZ2UgbG9hZFxuICBhd2FpdCB2YWxpZGF0ZVNlc3Npb24oKTtcblxuICAvLyBTZXQgdXAgYXV0aCBzdGF0ZSBjaGFuZ2UgbGlzdGVuZXJcbiAgc3VwYWJhc2UuYXV0aC5vbkF1dGhTdGF0ZUNoYW5nZShhc3luYyAoZXZlbnQsIHNlc3Npb24pID0+IHtcbiAgICBjb25zb2xlLmxvZyhcIkF1dGggc3RhdGUgY2hhbmdlZDpcIiwgZXZlbnQpO1xuXG4gICAgaWYgKGV2ZW50ID09PSBcIlNJR05FRF9JTlwiICYmIHNlc3Npb24pIHtcbiAgICAgIHNldEN1cnJlbnRVc2VyKHNlc3Npb24udXNlcik7XG4gICAgICBzZXNzaW9uVmFsaWRhdGVkID0gdHJ1ZTtcbiAgICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcIlNJR05FRF9PVVRcIikge1xuICAgICAgc2V0Q3VycmVudFVzZXIobnVsbCk7XG4gICAgICBzZXNzaW9uVmFsaWRhdGVkID0gZmFsc2U7XG4gICAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJUT0tFTl9SRUZSRVNIRURcIikge1xuICAgICAgc2V0Q3VycmVudFVzZXIoc2Vzc2lvbi51c2VyKTtcbiAgICAgIHNlc3Npb25WYWxpZGF0ZWQgPSB0cnVlO1xuICAgIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwiVVNFUl9VUERBVEVEXCIpIHtcbiAgICAgIHNldEN1cnJlbnRVc2VyKHNlc3Npb24udXNlcik7XG4gICAgICBzZXNzaW9uVmFsaWRhdGVkID0gdHJ1ZTtcbiAgICB9XG4gIH0pO1xufVxuXG4vKipcbiAqIERpc3BsYXlzIGFuIGVycm9yIG1lc3NhZ2VcbiAqIEBwYXJhbSB7c3RyaW5nfSBtZXNzYWdlIC0gRXJyb3IgbWVzc2FnZSB0byBkaXNwbGF5XG4gKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudElkIC0gSUQgb2YgdGhlIGVsZW1lbnQgd2hlcmUgdG8gZGlzcGxheSB0aGUgZXJyb3JcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNob3dFcnJvcihtZXNzYWdlLCBlbGVtZW50SWQgPSBcImVycm9yTWVzc2FnZVwiKSB7XG4gIGNvbnN0IGVycm9yRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRJZCk7XG4gIGlmIChlcnJvckVsZW1lbnQpIHtcbiAgICBlcnJvckVsZW1lbnQuaW5uZXJIVE1MID0gbWVzc2FnZTtcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZWxlbWVudCBub3QgZm91bmQ6XCIsIGVsZW1lbnRJZCk7XG4gIH1cbn1cblxuLyoqXG4gKiBEaXNwbGF5cyBhIHN0YXR1cyBtZXNzYWdlXG4gKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIE1lc3NhZ2UgdG8gZGlzcGxheVxuICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBNZXNzYWdlIHR5cGUgKHN1Y2Nlc3MsIGluZm8sIHdhcm5pbmcsIGRhbmdlcilcbiAqIEBwYXJhbSB7c3RyaW5nfSBlbGVtZW50SWQgLSBJRCBvZiB0aGUgZWxlbWVudCB3aGVyZSB0byBkaXNwbGF5IHRoZSBtZXNzYWdlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzaG93U3RhdHVzKFxuICBtZXNzYWdlLFxuICB0eXBlID0gXCJpbmZvXCIsXG4gIGVsZW1lbnRJZCA9IFwic3RhdHVzTWVzc2FnZVwiXG4pIHtcbiAgY29uc3Qgc3RhdHVzRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRJZCk7XG4gIGlmIChzdGF0dXNFbGVtZW50KSB7XG4gICAgc3RhdHVzRWxlbWVudC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG5cbiAgICAvLyBSZW1vdmUgYWxsIGFsZXJ0LSogY2xhc3Nlc1xuICAgIHN0YXR1c0VsZW1lbnQuY2xhc3NMaXN0LmZvckVhY2goKGNsYXNzTmFtZSkgPT4ge1xuICAgICAgaWYgKGNsYXNzTmFtZS5zdGFydHNXaXRoKFwiYWxlcnQtXCIpKSB7XG4gICAgICAgIHN0YXR1c0VsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gQWRkIHRoZSBjbGFzcyBjb3JyZXNwb25kaW5nIHRvIHRoZSB0eXBlXG4gICAgc3RhdHVzRWxlbWVudC5jbGFzc0xpc3QuYWRkKGBhbGVydC0ke3R5cGV9YCk7XG4gICAgc3RhdHVzRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJTdGF0dXMgZWxlbWVudCBub3QgZm91bmQ6XCIsIGVsZW1lbnRJZCk7XG4gIH1cbn1cblxuLyoqXG4gKiBIaWRlcyBhbiBlbGVtZW50XG4gKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudElkIC0gSUQgb2YgdGhlIGVsZW1lbnQgdG8gaGlkZVxuICovXG5leHBvcnQgZnVuY3Rpb24gaGlkZUVsZW1lbnQoZWxlbWVudElkKSB7XG4gIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50SWQpO1xuICBpZiAoZWxlbWVudCkge1xuICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgfVxufVxuXG4vKipcbiAqIFNob3dzIGFuIGVsZW1lbnRcbiAqIEBwYXJhbSB7c3RyaW5nfSBlbGVtZW50SWQgLSBJRCBvZiB0aGUgZWxlbWVudCB0byBzaG93XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzaG93RWxlbWVudChlbGVtZW50SWQpIHtcbiAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRJZCk7XG4gIGlmIChlbGVtZW50KSB7XG4gICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICB9XG59XG5cbi8qKlxuICogU2hvd3MgdGhlIGxvYWRpbmcgaW5kaWNhdG9yXG4gKiBAcGFyYW0ge3N0cmluZ30gYnV0dG9uSWQgLSBJRCBvZiB0aGUgYnV0dG9uXG4gKiBAcGFyYW0ge3N0cmluZ30gc3Bpbm5lcklkIC0gSUQgb2YgdGhlIHNwaW5uZXJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNob3dMb2FkaW5nKGJ1dHRvbklkLCBzcGlubmVySWQpIHtcbiAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYnV0dG9uSWQpO1xuICBjb25zdCBzcGlubmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc3Bpbm5lcklkKTtcblxuICBpZiAoYnV0dG9uKSBidXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICBpZiAoc3Bpbm5lcikgc3Bpbm5lci5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xufVxuXG4vKipcbiAqIEhpZGVzIHRoZSBsb2FkaW5nIGluZGljYXRvclxuICogQHBhcmFtIHtzdHJpbmd9IGJ1dHRvbklkIC0gSUQgb2YgdGhlIGJ1dHRvblxuICogQHBhcmFtIHtzdHJpbmd9IHNwaW5uZXJJZCAtIElEIG9mIHRoZSBzcGlubmVyXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBoaWRlTG9hZGluZyhidXR0b25JZCwgc3Bpbm5lcklkKSB7XG4gIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGJ1dHRvbklkKTtcbiAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNwaW5uZXJJZCk7XG5cbiAgaWYgKGJ1dHRvbikgYnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gIGlmIChzcGlubmVyKSBzcGlubmVyLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG59XG5cbi8vIEV4cG9ydCB0aGUgbmVjZXNzYXJ5IGZ1bmN0aW9ucyBhbmQgdmFyaWFibGVzXG5leHBvcnQgZGVmYXVsdCB7XG4gIGdldEN1cnJlbnRVc2VyLFxuICBnZXRDdXJyZW50VXNlclN5bmMsXG4gIHNldEN1cnJlbnRVc2VyLFxuICBsb2dvdXQsXG4gIGlzTG9nZ2VkSW4sXG4gIGlzTG9nZ2VkSW5TeW5jLFxuICB2YWxpZGF0ZVNlc3Npb24sXG4gIHByb3RlY3RQYWdlLFxuICBpbml0QXV0aCxcbiAgc2hvd0Vycm9yLFxuICBzaG93U3RhdHVzLFxuICBoaWRlRWxlbWVudCxcbiAgc2hvd0VsZW1lbnQsXG4gIHNob3dMb2FkaW5nLFxuICBoaWRlTG9hZGluZyxcbn07XG4iLCIvLyBzcmMvYXV0aC9wcm9maWxlLmpzXG4vKipcbiAqIFByb2ZpbGUgTW9kdWxlXG4gKiBAbW9kdWxlIHByb2ZpbGVcbiAqIEBkZXNjcmlwdGlvbiBIYW5kbGVzIHVzZXIgcHJvZmlsZSBtYW5hZ2VtZW50LCBpbmNsdWRpbmcgZGF0YSBmZXRjaGluZywgdXBkYXRlcywgYW5kIGFjY291bnQgZGVsZXRpb24uXG4gKiBAdmVyc2lvbiAwLjEuMFxuICpcbiAqIEBjaGFuZ2Vsb2dcbiAqIC0gMC4xLjAgKDIwMjQtMDUtMTYpOiBBZGRlZCBwcm9maWxlIGRhdGEgZmV0Y2hpbmcsIHVwZGF0aW5nLCBhbmQgYWNjb3VudCBkZWxldGlvbiBmdW5jdGlvbmFsaXR5LlxuICogLSAwLjAuMiAoMjAyNS0wNS0xNSk6IEltcHJvdmVkIGVycm9yIGhhbmRsaW5nIGFuZCBhZGRlZCBsb2FkaW5nIHN0YXRlcyAocHJldmlvdXMgdmVyc2lvbmluZyB3YXMgZnV0dXJlLWRhdGVkKVxuICogLSAwLjAuMSAoMjAyNS0wNS0xNCk6IEluaXRpYWwgdmVyc2lvbiB3aXRoIGJhc2ljIHByb2ZpbGUgZGlzcGxheSBhbmQgbG9nb3V0LlxuICovXG5cbmltcG9ydCB7XG4gIHByb3RlY3RQYWdlLFxuICBzaG93U3RhdHVzLCAvLyBBc3N1bWluZyB0aGlzIGNhbiB0YXJnZXQgc3BlY2lmaWMgZWxlbWVudHNcbiAgLy8gc2hvd0Vycm9yLCAvLyBXZSBjYW4gdXNlIHNob3dTdGF0dXMgd2l0aCB0eXBlICdlcnJvcidcbiAgc2hvd0xvYWRpbmcsXG4gIGhpZGVMb2FkaW5nLFxufSBmcm9tIFwiLi9hdXRoLmpzXCI7IC8vIEFzc3VtaW5nIGF1dGguanMgZXhwb3J0cyBzaG93U3RhdHVzIHRoYXQgY2FuIHRha2UgYW4gZWxlbWVudCBJRFxuaW1wb3J0IHsgc3VwYWJhc2UgfSBmcm9tIFwiLi4vc3VwYWJhc2UtY2xpZW50LmpzXCI7XG5cbi8vIEhlbHBlciB0byBzaG93IHN0YXR1cyBtZXNzYWdlcyBmb3IgcHJvZmlsZSBmb3JtIGFuZCBkZWxldGUgc2VjdGlvblxuZnVuY3Rpb24gc2hvd1Byb2ZpbGVTdGF0dXMobWVzc2FnZSwgdHlwZSwgZWxlbWVudElkKSB7XG4gIGNvbnN0IHN0YXR1c0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50SWQpO1xuICBpZiAoc3RhdHVzRWxlbWVudCkge1xuICAgIHN0YXR1c0VsZW1lbnQudGV4dENvbnRlbnQgPSBtZXNzYWdlO1xuICAgIHN0YXR1c0VsZW1lbnQuY2xhc3NOYW1lID0gXCJzdGF0dXMtbWVzc2FnZSBtYXJnaW4tdG9wLXNtXCI7IC8vIFJlc2V0IGNsYXNzZXNcbiAgICBzdGF0dXNFbGVtZW50LmNsYXNzTGlzdC5hZGQodHlwZSk7IC8vICdzdWNjZXNzJywgJ2Vycm9yJywgJ2luZm8nXG4gICAgc3RhdHVzRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGZldGNoVXNlclByb2ZpbGUodXNlcklkKSB7XG4gIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oXCJ1c2Vyc1wiKVxuICAgIC5zZWxlY3QoXCJub20sIHByZW5vbSwgYWRyZXNzZSwgdmlsbGUsIGNvZGVfcG9zdGFsLCBvY2N1cGF0aW9uLCB1cGRhdGVkX2F0XCIpXG4gICAgLmVxKFwiaWRcIiwgdXNlcklkKVxuICAgIC5zaW5nbGUoKTtcblxuICBpZiAoZXJyb3IgJiYgZXJyb3IuY29kZSAhPT0gXCJQR1JTVDExNlwiKSB7XG4gICAgLy8gUEdSU1QxMTY6IFwiIOCkteCliOCkpuCljeCkr+ClgeCkpCByb3cgbm90IGZvdW5kXCIgKHJvdyBub3QgZm91bmQpXG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIHByb2ZpbGU6XCIsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxuICByZXR1cm4gZGF0YTtcbn1cblxuZnVuY3Rpb24gcG9wdWxhdGVQcm9maWxlRm9ybShwcm9maWxlKSB7XG4gIGlmICghcHJvZmlsZSkgcmV0dXJuO1xuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm5vbVwiKS52YWx1ZSA9IHByb2ZpbGUubm9tIHx8IFwiXCI7XG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicHJlbm9tXCIpLnZhbHVlID0gcHJvZmlsZS5wcmVub20gfHwgXCJcIjtcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhZHJlc3NlXCIpLnZhbHVlID0gcHJvZmlsZS5hZHJlc3NlIHx8IFwiXCI7XG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidmlsbGVcIikudmFsdWUgPSBwcm9maWxlLnZpbGxlIHx8IFwiXCI7XG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29kZVBvc3RhbFwiKS52YWx1ZSA9IHByb2ZpbGUuY29kZV9wb3N0YWwgfHwgXCJcIjtcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJvY2N1cGF0aW9uXCIpLnZhbHVlID0gcHJvZmlsZS5vY2N1cGF0aW9uIHx8IFwiXCI7XG5cbiAgY29uc3QgbWVtYmVyU2luY2VFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWVtYmVyU2luY2VcIik7XG4gIGlmIChtZW1iZXJTaW5jZUVsICYmIHByb2ZpbGUudXBkYXRlZF9hdCkge1xuICAgIC8vIFVzaW5nIHVwZGF0ZWRfYXQgYXMgYSBwcm94eSBpZiBjcmVhdGVkX2F0IGlzbid0IGRpcmVjdGx5IG9uIHByb2ZpbGVzXG4gICAgbWVtYmVyU2luY2VFbC50ZXh0Q29udGVudCA9IG5ldyBEYXRlKFxuICAgICAgcHJvZmlsZS51cGRhdGVkX2F0XG4gICAgKS50b0xvY2FsZURhdGVTdHJpbmcoKTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5pdFByb2ZpbGVQYWdlKCkge1xuICBpZiAoIShhd2FpdCBwcm90ZWN0UGFnZSgpKSkgcmV0dXJuO1xuXG4gIGNvbnN0IHVzZXJFbWFpbEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ1c2VyRW1haWxcIik7XG4gIGNvbnN0IGxvZ291dEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibG9nb3V0QnRuXCIpO1xuICBjb25zdCBwcm9maWxlRm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicHJvZmlsZUZvcm1cIik7XG4gIGNvbnN0IGRlbGV0ZUFjY291bnRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImRlbGV0ZUFjY291bnRCdG5cIik7XG4gIGNvbnN0IG1lbWJlclNpbmNlRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1lbWJlclNpbmNlXCIpO1xuXG4gIHRyeSB7XG4gICAgY29uc3Qge1xuICAgICAgZGF0YTogeyBzZXNzaW9uIH0sXG4gICAgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0U2Vzc2lvbigpO1xuICAgIGlmICghc2Vzc2lvbiB8fCAhc2Vzc2lvbi51c2VyKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIk5vIGFjdGl2ZSBzZXNzaW9uIG9yIHVzZXIuIFJlZGlyZWN0aW5nIHRvIGxvZ2luLlwiKTtcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCIvbG9naW4uaHRtbFwiOyAvLyBPciB5b3VyIGRlc2lnbmF0ZWQgbG9naW4gcGFnZVxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB1c2VyID0gc2Vzc2lvbi51c2VyO1xuXG4gICAgaWYgKHVzZXJFbWFpbEVsKSB7XG4gICAgICB1c2VyRW1haWxFbC50ZXh0Q29udGVudCA9IHVzZXIuZW1haWw7XG4gICAgfVxuICAgIGlmIChtZW1iZXJTaW5jZUVsICYmIHVzZXIuY3JlYXRlZF9hdCkge1xuICAgICAgbWVtYmVyU2luY2VFbC50ZXh0Q29udGVudCA9IG5ldyBEYXRlKFxuICAgICAgICB1c2VyLmNyZWF0ZWRfYXRcbiAgICAgICkudG9Mb2NhbGVEYXRlU3RyaW5nKCk7XG4gICAgfVxuXG4gICAgLy8gRmV0Y2ggYW5kIHBvcHVsYXRlIHByb2ZpbGVcbiAgICBzaG93TG9hZGluZyhcInNhdmVQcm9maWxlQnRuXCIpOyAvLyBTaG93IGxvYWRpbmcgb24gZm9ybSBpbml0aWFsbHlcbiAgICBjb25zdCBwcm9maWxlID0gYXdhaXQgZmV0Y2hVc2VyUHJvZmlsZSh1c2VyLmlkKTtcbiAgICBpZiAocHJvZmlsZSkge1xuICAgICAgcG9wdWxhdGVQcm9maWxlRm9ybShwcm9maWxlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gSWYgbm8gcHJvZmlsZSwgaXQgbWlnaHQgYmUgY3JlYXRlZCBieSB0aGUgdHJpZ2dlciwgb3Igd2UgY2FuIHByZS1maWxsIHNvbWUgdGhpbmdzXG4gICAgICAvLyBGb3Igbm93LCBmb3JtIHdpbGwgYmUgZW1wdHksIHVzZXIgY2FuIGZpbGwgYW5kIHNhdmUgdG8gY3JlYXRlL3VwZGF0ZS5cbiAgICAgIGNvbnNvbGUubG9nKFwiTm8gcHJvZmlsZSBkYXRhIGZvdW5kIGZvciB1c2VyLCBmb3JtIHdpbGwgYmUgZW1wdHkuXCIpO1xuICAgIH1cbiAgICBoaWRlTG9hZGluZyhcInNhdmVQcm9maWxlQnRuXCIpO1xuXG4gICAgaWYgKGxvZ291dEJ0bikge1xuICAgICAgbG9nb3V0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIHNob3dMb2FkaW5nKFwibG9nb3V0QnRuXCIpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnbk91dCgpO1xuICAgICAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgc2hvd1Byb2ZpbGVTdGF0dXMoXG4gICAgICAgICAgICBcIkTDqWNvbm5leGlvbiByw6l1c3NpZS4gUmVkaXJlY3Rpb24uLi5cIixcbiAgICAgICAgICAgIFwic3VjY2Vzc1wiLFxuICAgICAgICAgICAgXCJwcm9maWxlRm9ybVN0YXR1c1wiXG4gICAgICAgICAgKTsgLy8gT3IgYSBnbG9iYWwgc3RhdHVzXG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IFwiL1wiO1xuICAgICAgICAgIH0sIDIwMCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHNpZ25pbmcgb3V0OlwiLCBlcnJvcik7XG4gICAgICAgICAgc2hvd1Byb2ZpbGVTdGF0dXMoXG4gICAgICAgICAgICBgRXJyZXVyIGRlIGTDqWNvbm5leGlvbjogJHtlcnJvci5tZXNzYWdlfWAsXG4gICAgICAgICAgICBcImVycm9yXCIsXG4gICAgICAgICAgICBcInByb2ZpbGVGb3JtU3RhdHVzXCJcbiAgICAgICAgICApO1xuICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgIGhpZGVMb2FkaW5nKFwibG9nb3V0QnRuXCIpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAocHJvZmlsZUZvcm0pIHtcbiAgICAgIHByb2ZpbGVGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgYXN5bmMgKGUpID0+IHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBzaG93TG9hZGluZyhcInNhdmVQcm9maWxlQnRuXCIpO1xuICAgICAgICBjb25zdCBwcm9maWxlU3RhdHVzRWwgPSBcInByb2ZpbGVGb3JtU3RhdHVzXCI7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHByb2ZpbGVTdGF0dXNFbCkuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcblxuICAgICAgICBjb25zdCB1cGRhdGVzID0ge1xuICAgICAgICAgIGlkOiB1c2VyLmlkLCAvLyBSZXF1aXJlZCBmb3IgUkxTIGFuZCBpZGVudGlmeWluZyB0aGUgcm93XG4gICAgICAgICAgbm9tOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm5vbVwiKS52YWx1ZSxcbiAgICAgICAgICBwcmVub206IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicHJlbm9tXCIpLnZhbHVlLFxuICAgICAgICAgIGFkcmVzc2U6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYWRyZXNzZVwiKS52YWx1ZSxcbiAgICAgICAgICB2aWxsZTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ2aWxsZVwiKS52YWx1ZSxcbiAgICAgICAgICBjb2RlX3Bvc3RhbDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjb2RlUG9zdGFsXCIpLnZhbHVlLFxuICAgICAgICAgIG9jY3VwYXRpb246IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwib2NjdXBhdGlvblwiKS52YWx1ZSxcbiAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLCAvLyBTdXBhYmFzZSBiZXN0IHByYWN0aWNlXG4gICAgICAgIH07XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKFwicHJvZmlsZXNcIikudXBzZXJ0KHVwZGF0ZXMpO1xuICAgICAgICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgc2hvd1Byb2ZpbGVTdGF0dXMoXG4gICAgICAgICAgICBcIlByb2ZpbCBtaXMgw6Agam91ciBhdmVjIHN1Y2PDqHMgIVwiLFxuICAgICAgICAgICAgXCJzdWNjZXNzXCIsXG4gICAgICAgICAgICBwcm9maWxlU3RhdHVzRWxcbiAgICAgICAgICApO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciB1cGRhdGluZyBwcm9maWxlOlwiLCBlcnJvcik7XG4gICAgICAgICAgc2hvd1Byb2ZpbGVTdGF0dXMoXG4gICAgICAgICAgICBgRXJyZXVyIGxvcnMgZGUgbGEgbWlzZSDDoCBqb3VyOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgICAgIFwiZXJyb3JcIixcbiAgICAgICAgICAgIHByb2ZpbGVTdGF0dXNFbFxuICAgICAgICAgICk7XG4gICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgaGlkZUxvYWRpbmcoXCJzYXZlUHJvZmlsZUJ0blwiKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKGRlbGV0ZUFjY291bnRCdG4pIHtcbiAgICAgIGRlbGV0ZUFjY291bnRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgZGVsZXRlU3RhdHVzRWwgPSBcImRlbGV0ZVN0YXR1c01lc3NhZ2VcIjtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZGVsZXRlU3RhdHVzRWwpLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIGNvbmZpcm0oXG4gICAgICAgICAgICBcIsOKdGVzLXZvdXMgc8O7ciBkZSB2b3Vsb2lyIHN1cHByaW1lciB2b3RyZSBjb21wdGUgPyBDZXR0ZSBhY3Rpb24gZXN0IGlycsOpdmVyc2libGUgZXQgdG91dGVzIHZvcyBkb25uw6llcyBzZXJvbnQgcGVyZHVlcy5cIlxuICAgICAgICAgIClcbiAgICAgICAgKSB7XG4gICAgICAgICAgc2hvd0xvYWRpbmcoXCJkZWxldGVBY2NvdW50QnRuXCIpO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5ycGMoXCJkZWxldGVfdXNlcl9hY2NvdW50XCIpO1xuICAgICAgICAgICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcblxuICAgICAgICAgICAgc2hvd1Byb2ZpbGVTdGF0dXMoXG4gICAgICAgICAgICAgIFwiQ29tcHRlIHN1cHByaW3DqSBhdmVjIHN1Y2PDqHMuIFZvdXMgYWxsZXogw6p0cmUgZMOpY29ubmVjdMOpIGV0IHJlZGlyaWfDqS5cIixcbiAgICAgICAgICAgICAgXCJzdWNjZXNzXCIsXG4gICAgICAgICAgICAgIGRlbGV0ZVN0YXR1c0VsXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgLy8gQXR0ZW1wdCB0byBzaWduIG91dCwgdGhlbiByZWRpcmVjdC5cbiAgICAgICAgICAgIGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnbk91dCgpO1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCIvXCI7XG4gICAgICAgICAgICB9LCAzMDAwKTtcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGRlbGV0aW5nIGFjY291bnQ6XCIsIGVycm9yKTtcbiAgICAgICAgICAgIHNob3dQcm9maWxlU3RhdHVzKFxuICAgICAgICAgICAgICBgRXJyZXVyIGxvcnMgZGUgbGEgc3VwcHJlc3Npb24gZHUgY29tcHRlOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgICAgICAgXCJlcnJvclwiLFxuICAgICAgICAgICAgICBkZWxldGVTdGF0dXNFbFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgICAgaGlkZUxvYWRpbmcoXCJkZWxldGVBY2NvdW50QnRuXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIlVzZXIgY2FuY2VsbGVkIGFjY291bnQgZGVsZXRpb24uXCIpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIlByb2ZpbGUgcGFnZSBpbml0aWFsaXphdGlvbiBlcnJvcjpcIiwgZXJyb3IpO1xuICAgIC8vIFNob3cgYSBnZW5lcmFsIGVycm9yIG9uIHRoZSBwYWdlIGlmIGNyaXRpY2FsIGVsZW1lbnRzIGFyZSBtaXNzaW5nIG9yIG1haW4gdHJ5IGZhaWxzXG4gICAgY29uc3QgbWFpbkVycm9yQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwcm9maWxlRGV0YWlsc1wiKTsgLy8gT3IgYW5vdGhlciBzdWl0YWJsZSBjb250YWluZXJcbiAgICBpZiAobWFpbkVycm9yQ29udGFpbmVyKSB7XG4gICAgICBtYWluRXJyb3JDb250YWluZXIuaW5uZXJIVE1MID1cbiAgICAgICAgJzxwIGNsYXNzPVwiZXJyb3ItbWVzc2FnZVwiPkltcG9zc2libGUgZGUgY2hhcmdlciBsZXMgaW5mb3JtYXRpb25zIGR1IHByb2ZpbC4gVmV1aWxsZXogcsOpZXNzYXllciBwbHVzIHRhcmQuPC9wPic7XG4gICAgfVxuICB9XG59XG5cbi8vIEluaXRpYWxpemUgdGhlIHBhZ2Ugd2hlbiBET00gaXMgcmVhZHlcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGluaXRQcm9maWxlUGFnZSk7XG4iLCJpbXBvcnQgeyBpbml0UHJvZmlsZVBhZ2UgfSBmcm9tIFwiLi4vYXV0aC9wcm9maWxlLmpzXCI7XG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+IHtcbiAgaW5pdFByb2ZpbGVQYWdlKCk7XG4gIGNvbnNvbGUubG9nKFwiUHJvZmlsZSBwYWdlIGluaXRpYWxpemVkXCIpO1xufSk7XG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuLy8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbl9fd2VicGFja19yZXF1aXJlX18ubSA9IF9fd2VicGFja19tb2R1bGVzX187XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18uZiA9IHt9O1xuLy8gVGhpcyBmaWxlIGNvbnRhaW5zIG9ubHkgdGhlIGVudHJ5IGNodW5rLlxuLy8gVGhlIGNodW5rIGxvYWRpbmcgZnVuY3Rpb24gZm9yIGFkZGl0aW9uYWwgY2h1bmtzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmUgPSAoY2h1bmtJZCkgPT4ge1xuXHRyZXR1cm4gUHJvbWlzZS5hbGwoT2JqZWN0LmtleXMoX193ZWJwYWNrX3JlcXVpcmVfXy5mKS5yZWR1Y2UoKHByb21pc2VzLCBrZXkpID0+IHtcblx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmZba2V5XShjaHVua0lkLCBwcm9taXNlcyk7XG5cdFx0cmV0dXJuIHByb21pc2VzO1xuXHR9LCBbXSkpO1xufTsiLCIvLyBUaGlzIGZ1bmN0aW9uIGFsbG93IHRvIHJlZmVyZW5jZSBhc3luYyBjaHVua3Ncbl9fd2VicGFja19yZXF1aXJlX18udSA9IChjaHVua0lkKSA9PiB7XG5cdC8vIHJldHVybiB1cmwgZm9yIGZpbGVuYW1lcyBiYXNlZCBvbiB0ZW1wbGF0ZVxuXHRyZXR1cm4gXCJqcy9cIiArIGNodW5rSWQgKyBcIi5idW5kbGUuanNcIjtcbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5nID0gKGZ1bmN0aW9uKCkge1xuXHRpZiAodHlwZW9mIGdsb2JhbFRoaXMgPT09ICdvYmplY3QnKSByZXR1cm4gZ2xvYmFsVGhpcztcblx0dHJ5IHtcblx0XHRyZXR1cm4gdGhpcyB8fCBuZXcgRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKTtcblx0fSBjYXRjaCAoZSkge1xuXHRcdGlmICh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JykgcmV0dXJuIHdpbmRvdztcblx0fVxufSkoKTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwidmFyIHNjcmlwdFVybDtcbmlmIChfX3dlYnBhY2tfcmVxdWlyZV9fLmcuaW1wb3J0U2NyaXB0cykgc2NyaXB0VXJsID0gX193ZWJwYWNrX3JlcXVpcmVfXy5nLmxvY2F0aW9uICsgXCJcIjtcbnZhciBkb2N1bWVudCA9IF9fd2VicGFja19yZXF1aXJlX18uZy5kb2N1bWVudDtcbmlmICghc2NyaXB0VXJsICYmIGRvY3VtZW50KSB7XG5cdGlmIChkb2N1bWVudC5jdXJyZW50U2NyaXB0ICYmIGRvY3VtZW50LmN1cnJlbnRTY3JpcHQudGFnTmFtZS50b1VwcGVyQ2FzZSgpID09PSAnU0NSSVBUJylcblx0XHRzY3JpcHRVcmwgPSBkb2N1bWVudC5jdXJyZW50U2NyaXB0LnNyYztcblx0aWYgKCFzY3JpcHRVcmwpIHtcblx0XHR2YXIgc2NyaXB0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpO1xuXHRcdGlmKHNjcmlwdHMubGVuZ3RoKSB7XG5cdFx0XHR2YXIgaSA9IHNjcmlwdHMubGVuZ3RoIC0gMTtcblx0XHRcdHdoaWxlIChpID4gLTEgJiYgKCFzY3JpcHRVcmwgfHwgIS9eaHR0cChzPyk6Ly50ZXN0KHNjcmlwdFVybCkpKSBzY3JpcHRVcmwgPSBzY3JpcHRzW2ktLV0uc3JjO1xuXHRcdH1cblx0fVxufVxuLy8gV2hlbiBzdXBwb3J0aW5nIGJyb3dzZXJzIHdoZXJlIGFuIGF1dG9tYXRpYyBwdWJsaWNQYXRoIGlzIG5vdCBzdXBwb3J0ZWQgeW91IG11c3Qgc3BlY2lmeSBhbiBvdXRwdXQucHVibGljUGF0aCBtYW51YWxseSB2aWEgY29uZmlndXJhdGlvblxuLy8gb3IgcGFzcyBhbiBlbXB0eSBzdHJpbmcgKFwiXCIpIGFuZCBzZXQgdGhlIF9fd2VicGFja19wdWJsaWNfcGF0aF9fIHZhcmlhYmxlIGZyb20geW91ciBjb2RlIHRvIHVzZSB5b3VyIG93biBsb2dpYy5cbmlmICghc2NyaXB0VXJsKSB0aHJvdyBuZXcgRXJyb3IoXCJBdXRvbWF0aWMgcHVibGljUGF0aCBpcyBub3Qgc3VwcG9ydGVkIGluIHRoaXMgYnJvd3NlclwiKTtcbnNjcmlwdFVybCA9IHNjcmlwdFVybC5yZXBsYWNlKC9eYmxvYjovLCBcIlwiKS5yZXBsYWNlKC8jLiokLywgXCJcIikucmVwbGFjZSgvXFw/LiokLywgXCJcIikucmVwbGFjZSgvXFwvW15cXC9dKyQvLCBcIi9cIik7XG5fX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBzY3JpcHRVcmwgKyBcIi4uL1wiOyIsIi8vIG5vIGJhc2VVUklcblxuLy8gb2JqZWN0IHRvIHN0b3JlIGxvYWRlZCBhbmQgbG9hZGluZyBjaHVua3Ncbi8vIHVuZGVmaW5lZCA9IGNodW5rIG5vdCBsb2FkZWQsIG51bGwgPSBjaHVuayBwcmVsb2FkZWQvcHJlZmV0Y2hlZFxuLy8gW3Jlc29sdmUsIHJlamVjdCwgUHJvbWlzZV0gPSBjaHVuayBsb2FkaW5nLCAwID0gY2h1bmsgbG9hZGVkXG52YXIgaW5zdGFsbGVkQ2h1bmtzID0ge1xuXHQxMzg6IDBcbn07XG5cbl9fd2VicGFja19yZXF1aXJlX18uZi5qID0gKGNodW5rSWQsIHByb21pc2VzKSA9PiB7XG5cdFx0Ly8gSlNPTlAgY2h1bmsgbG9hZGluZyBmb3IgamF2YXNjcmlwdFxuXHRcdHZhciBpbnN0YWxsZWRDaHVua0RhdGEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLm8oaW5zdGFsbGVkQ2h1bmtzLCBjaHVua0lkKSA/IGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA6IHVuZGVmaW5lZDtcblx0XHRpZihpbnN0YWxsZWRDaHVua0RhdGEgIT09IDApIHsgLy8gMCBtZWFucyBcImFscmVhZHkgaW5zdGFsbGVkXCIuXG5cblx0XHRcdC8vIGEgUHJvbWlzZSBtZWFucyBcImN1cnJlbnRseSBsb2FkaW5nXCIuXG5cdFx0XHRpZihpbnN0YWxsZWRDaHVua0RhdGEpIHtcblx0XHRcdFx0cHJvbWlzZXMucHVzaChpbnN0YWxsZWRDaHVua0RhdGFbMl0pO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYodHJ1ZSkgeyAvLyBhbGwgY2h1bmtzIGhhdmUgSlNcblx0XHRcdFx0XHQvLyBzZXR1cCBQcm9taXNlIGluIGNodW5rIGNhY2hlXG5cdFx0XHRcdFx0dmFyIHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiAoaW5zdGFsbGVkQ2h1bmtEYXRhID0gaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdID0gW3Jlc29sdmUsIHJlamVjdF0pKTtcblx0XHRcdFx0XHRwcm9taXNlcy5wdXNoKGluc3RhbGxlZENodW5rRGF0YVsyXSA9IHByb21pc2UpO1xuXG5cdFx0XHRcdFx0Ly8gc3RhcnQgY2h1bmsgbG9hZGluZ1xuXHRcdFx0XHRcdHZhciB1cmwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLnAgKyBfX3dlYnBhY2tfcmVxdWlyZV9fLnUoY2h1bmtJZCk7XG5cdFx0XHRcdFx0Ly8gY3JlYXRlIGVycm9yIGJlZm9yZSBzdGFjayB1bndvdW5kIHRvIGdldCB1c2VmdWwgc3RhY2t0cmFjZSBsYXRlclxuXHRcdFx0XHRcdHZhciBlcnJvciA9IG5ldyBFcnJvcigpO1xuXHRcdFx0XHRcdHZhciBsb2FkaW5nRW5kZWQgPSAoZXZlbnQpID0+IHtcblx0XHRcdFx0XHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhpbnN0YWxsZWRDaHVua3MsIGNodW5rSWQpKSB7XG5cdFx0XHRcdFx0XHRcdGluc3RhbGxlZENodW5rRGF0YSA9IGluc3RhbGxlZENodW5rc1tjaHVua0lkXTtcblx0XHRcdFx0XHRcdFx0aWYoaW5zdGFsbGVkQ2h1bmtEYXRhICE9PSAwKSBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gPSB1bmRlZmluZWQ7XG5cdFx0XHRcdFx0XHRcdGlmKGluc3RhbGxlZENodW5rRGF0YSkge1xuXHRcdFx0XHRcdFx0XHRcdHZhciBlcnJvclR5cGUgPSBldmVudCAmJiAoZXZlbnQudHlwZSA9PT0gJ2xvYWQnID8gJ21pc3NpbmcnIDogZXZlbnQudHlwZSk7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIHJlYWxTcmMgPSBldmVudCAmJiBldmVudC50YXJnZXQgJiYgZXZlbnQudGFyZ2V0LnNyYztcblx0XHRcdFx0XHRcdFx0XHRlcnJvci5tZXNzYWdlID0gJ0xvYWRpbmcgY2h1bmsgJyArIGNodW5rSWQgKyAnIGZhaWxlZC5cXG4oJyArIGVycm9yVHlwZSArICc6ICcgKyByZWFsU3JjICsgJyknO1xuXHRcdFx0XHRcdFx0XHRcdGVycm9yLm5hbWUgPSAnQ2h1bmtMb2FkRXJyb3InO1xuXHRcdFx0XHRcdFx0XHRcdGVycm9yLnR5cGUgPSBlcnJvclR5cGU7XG5cdFx0XHRcdFx0XHRcdFx0ZXJyb3IucmVxdWVzdCA9IHJlYWxTcmM7XG5cdFx0XHRcdFx0XHRcdFx0aW5zdGFsbGVkQ2h1bmtEYXRhWzFdKGVycm9yKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5sKHVybCwgbG9hZGluZ0VuZGVkLCBcImNodW5rLVwiICsgY2h1bmtJZCwgY2h1bmtJZCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG59O1xuXG4vLyBubyBwcmVmZXRjaGluZ1xuXG4vLyBubyBwcmVsb2FkZWRcblxuLy8gbm8gSE1SXG5cbi8vIG5vIEhNUiBtYW5pZmVzdFxuXG5fX3dlYnBhY2tfcmVxdWlyZV9fLk8uaiA9IChjaHVua0lkKSA9PiAoaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdID09PSAwKTtcblxuLy8gaW5zdGFsbCBhIEpTT05QIGNhbGxiYWNrIGZvciBjaHVuayBsb2FkaW5nXG52YXIgd2VicGFja0pzb25wQ2FsbGJhY2sgPSAocGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24sIGRhdGEpID0+IHtcblx0dmFyIFtjaHVua0lkcywgbW9yZU1vZHVsZXMsIHJ1bnRpbWVdID0gZGF0YTtcblx0Ly8gYWRkIFwibW9yZU1vZHVsZXNcIiB0byB0aGUgbW9kdWxlcyBvYmplY3QsXG5cdC8vIHRoZW4gZmxhZyBhbGwgXCJjaHVua0lkc1wiIGFzIGxvYWRlZCBhbmQgZmlyZSBjYWxsYmFja1xuXHR2YXIgbW9kdWxlSWQsIGNodW5rSWQsIGkgPSAwO1xuXHRpZihjaHVua0lkcy5zb21lKChpZCkgPT4gKGluc3RhbGxlZENodW5rc1tpZF0gIT09IDApKSkge1xuXHRcdGZvcihtb2R1bGVJZCBpbiBtb3JlTW9kdWxlcykge1xuXHRcdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKG1vcmVNb2R1bGVzLCBtb2R1bGVJZCkpIHtcblx0XHRcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tW21vZHVsZUlkXSA9IG1vcmVNb2R1bGVzW21vZHVsZUlkXTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYocnVudGltZSkgdmFyIHJlc3VsdCA9IHJ1bnRpbWUoX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cdH1cblx0aWYocGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24pIHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uKGRhdGEpO1xuXHRmb3IoO2kgPCBjaHVua0lkcy5sZW5ndGg7IGkrKykge1xuXHRcdGNodW5rSWQgPSBjaHVua0lkc1tpXTtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oaW5zdGFsbGVkQ2h1bmtzLCBjaHVua0lkKSAmJiBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0pIHtcblx0XHRcdGluc3RhbGxlZENodW5rc1tjaHVua0lkXVswXSgpO1xuXHRcdH1cblx0XHRpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gPSAwO1xuXHR9XG5cdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fLk8ocmVzdWx0KTtcbn1cblxudmFyIGNodW5rTG9hZGluZ0dsb2JhbCA9IHNlbGZbXCJ3ZWJwYWNrQ2h1bmt1cmJhbmRvY3Nfd2ViYXBwXCJdID0gc2VsZltcIndlYnBhY2tDaHVua3VyYmFuZG9jc193ZWJhcHBcIl0gfHwgW107XG5jaHVua0xvYWRpbmdHbG9iYWwuZm9yRWFjaCh3ZWJwYWNrSnNvbnBDYWxsYmFjay5iaW5kKG51bGwsIDApKTtcbmNodW5rTG9hZGluZ0dsb2JhbC5wdXNoID0gd2VicGFja0pzb25wQ2FsbGJhY2suYmluZChudWxsLCBjaHVua0xvYWRpbmdHbG9iYWwucHVzaC5iaW5kKGNodW5rTG9hZGluZ0dsb2JhbCkpOyIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgZGVwZW5kcyBvbiBvdGhlciBsb2FkZWQgY2h1bmtzIGFuZCBleGVjdXRpb24gbmVlZCB0byBiZSBkZWxheWVkXG52YXIgX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18uTyh1bmRlZmluZWQsIFszMDNdLCAoKSA9PiAoX193ZWJwYWNrX3JlcXVpcmVfXyg5MjMpKSlcbl9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fLk8oX193ZWJwYWNrX2V4cG9ydHNfXyk7XG4iXSwibmFtZXMiOlsiZGVmZXJyZWQiLCJsZWFmUHJvdG90eXBlcyIsImdldFByb3RvIiwiaW5Qcm9ncmVzcyIsImRhdGFXZWJwYWNrUHJlZml4Iiwic3VwYWJhc2UiLCJjdXJyZW50VXNlciIsInNlc3Npb25WYWxpZGF0ZWQiLCJzZXRDdXJyZW50VXNlciIsInVzZXIiLCJsb2NhbFN0b3JhZ2UiLCJzZXRJdGVtIiwiSlNPTiIsInN0cmluZ2lmeSIsInJlbW92ZUl0ZW0iLCJhc3luYyIsInByb3RlY3RQYWdlIiwicmVkaXJlY3RVcmwiLCJkYXRhIiwic2Vzc2lvbiIsImVycm9yIiwic2Vzc2lvbkVycm9yIiwiYXV0aCIsImdldFNlc3Npb24iLCJjb25zb2xlIiwibG9nIiwicmVmcmVzaEVycm9yIiwicmVmcmVzaFNlc3Npb24iLCJ3YXJuIiwic2lnbk91dCIsImUiLCJ2YWxpZGF0ZVNlc3Npb24iLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImhyZWYiLCJzaG93TG9hZGluZyIsImJ1dHRvbklkIiwic3Bpbm5lcklkIiwiYnV0dG9uIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInNwaW5uZXIiLCJkaXNhYmxlZCIsImNsYXNzTGlzdCIsInJlbW92ZSIsImhpZGVMb2FkaW5nIiwiYWRkIiwic2hvd1Byb2ZpbGVTdGF0dXMiLCJtZXNzYWdlIiwidHlwZSIsImVsZW1lbnRJZCIsInN0YXR1c0VsZW1lbnQiLCJ0ZXh0Q29udGVudCIsImNsYXNzTmFtZSIsImluaXRQcm9maWxlUGFnZSIsInVzZXJFbWFpbEVsIiwibG9nb3V0QnRuIiwicHJvZmlsZUZvcm0iLCJkZWxldGVBY2NvdW50QnRuIiwibWVtYmVyU2luY2VFbCIsImVtYWlsIiwiY3JlYXRlZF9hdCIsIkRhdGUiLCJ0b0xvY2FsZURhdGVTdHJpbmciLCJwcm9maWxlIiwidXNlcklkIiwiZnJvbSIsInNlbGVjdCIsImVxIiwic2luZ2xlIiwiY29kZSIsImZldGNoVXNlclByb2ZpbGUiLCJpZCIsInZhbHVlIiwibm9tIiwicHJlbm9tIiwiYWRyZXNzZSIsInZpbGxlIiwiY29kZV9wb3N0YWwiLCJvY2N1cGF0aW9uIiwidXBkYXRlZF9hdCIsInBvcHVsYXRlUHJvZmlsZUZvcm0iLCJhZGRFdmVudExpc3RlbmVyIiwic2V0VGltZW91dCIsInByZXZlbnREZWZhdWx0IiwicHJvZmlsZVN0YXR1c0VsIiwidXBkYXRlcyIsInVwc2VydCIsImRlbGV0ZVN0YXR1c0VsIiwiY29uZmlybSIsInJwYyIsIm1haW5FcnJvckNvbnRhaW5lciIsImlubmVySFRNTCIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsInVuZGVmaW5lZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiY2FsbCIsIm0iLCJPIiwicmVzdWx0IiwiY2h1bmtJZHMiLCJmbiIsInByaW9yaXR5Iiwibm90RnVsZmlsbGVkIiwiSW5maW5pdHkiLCJpIiwibGVuZ3RoIiwiZnVsZmlsbGVkIiwiaiIsIk9iamVjdCIsImtleXMiLCJldmVyeSIsImtleSIsInNwbGljZSIsInIiLCJnZXRQcm90b3R5cGVPZiIsIm9iaiIsInQiLCJtb2RlIiwidGhpcyIsIl9fZXNNb2R1bGUiLCJ0aGVuIiwibnMiLCJjcmVhdGUiLCJkZWYiLCJjdXJyZW50IiwiaW5kZXhPZiIsImdldE93blByb3BlcnR5TmFtZXMiLCJmb3JFYWNoIiwiZCIsImRlZmluaXRpb24iLCJvIiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiZiIsImNodW5rSWQiLCJQcm9taXNlIiwiYWxsIiwicmVkdWNlIiwicHJvbWlzZXMiLCJ1IiwiZyIsImdsb2JhbFRoaXMiLCJGdW5jdGlvbiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImwiLCJ1cmwiLCJkb25lIiwicHVzaCIsInNjcmlwdCIsIm5lZWRBdHRhY2giLCJzY3JpcHRzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJzIiwiZ2V0QXR0cmlidXRlIiwiY3JlYXRlRWxlbWVudCIsImNoYXJzZXQiLCJ0aW1lb3V0IiwibmMiLCJzZXRBdHRyaWJ1dGUiLCJzcmMiLCJvblNjcmlwdENvbXBsZXRlIiwicHJldiIsImV2ZW50Iiwib25lcnJvciIsIm9ubG9hZCIsImNsZWFyVGltZW91dCIsImRvbmVGbnMiLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJiaW5kIiwidGFyZ2V0IiwiaGVhZCIsImFwcGVuZENoaWxkIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJzY3JpcHRVcmwiLCJpbXBvcnRTY3JpcHRzIiwiY3VycmVudFNjcmlwdCIsInRhZ05hbWUiLCJ0b1VwcGVyQ2FzZSIsInRlc3QiLCJFcnJvciIsInJlcGxhY2UiLCJwIiwiaW5zdGFsbGVkQ2h1bmtzIiwiaW5zdGFsbGVkQ2h1bmtEYXRhIiwicHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJlcnJvclR5cGUiLCJyZWFsU3JjIiwibmFtZSIsInJlcXVlc3QiLCJ3ZWJwYWNrSnNvbnBDYWxsYmFjayIsInBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uIiwibW9yZU1vZHVsZXMiLCJydW50aW1lIiwic29tZSIsImNodW5rTG9hZGluZ0dsb2JhbCIsInNlbGYiLCJfX3dlYnBhY2tfZXhwb3J0c19fIl0sInNvdXJjZVJvb3QiOiIifQ==