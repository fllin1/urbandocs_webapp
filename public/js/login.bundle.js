(()=>{"use strict";var e,n,o,t,r,i={6542:(e,n,o)=>{var t=o(3715),r=o(9660);let i=null,s=null;function l(){const e=document.getElementById("loginForm"),n=document.getElementById("errorMessage"),o=document.getElementById("togglePassword"),l=document.getElementById("password"),a=document.getElementById("googleSignInBtn");o&&l&&o.addEventListener("click",(()=>{const e="password"===l.getAttribute("type")?"text":"password";l.setAttribute("type",e);const n=o.querySelector("i");"password"===e?(n.classList.remove("bi-eye"),n.classList.add("bi-eye-slash")):(n.classList.remove("bi-eye-slash"),n.classList.add("bi-eye"))})),e&&e.addEventListener("submit",(async e=>{e.preventDefault(),n&&(n.classList.add("hidden"),n.textContent="");const o=document.getElementById("statusMessage");o&&(o.classList.add("hidden"),o.textContent="");const l=document.getElementById("email").value,a=document.getElementById("password").value;if(l&&a)if(i){(0,t.Cs)("loginBtn","loginSpinner");try{await async function(e,n){try{const{data:o,error:s}=await r.N.auth.signInWithPassword({email:e,password:n,options:{captchaToken:i}});if(s)throw s.message.toLowerCase().includes("email not confirmed")?new Error("Votre email n'a pas été confirmé. Veuillez vérifier votre boîte de réception."):s.message.toLowerCase().includes("invalid login credentials")?new Error("Email ou mot de passe incorrect."):new Error(s.message);if(!o.session)throw console.error("Login error: Missing session data from Supabase response",o),new Error("Données de session manquantes après la connexion.");o.user&&((0,t.lt)(o.user),console.log("[login.js] User data saved locally"));try{const e=await fetch(`${r.N.supabaseUrl}/functions/v1/account-management`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.session.access_token}`},body:JSON.stringify({action:"status"})}),n=await e.json();if(n.success&&n.data.deletion_scheduled)return(0,t.wc)("Connexion réussie! Redirection vers le statut de suppression...","info"),setTimeout((()=>{window.location.href="/user/account-deletion-status"}),1e3),o.user}catch(e){console.warn("Could not check deletion status:",e)}return(0,t.wc)("Connexion réussie! Redirection...","success"),setTimeout((()=>{window.location.href="/"}),500),o.user}catch(e){throw console.error("Login error:",e),e}}(l,a)}catch(e){console.error("Login error:",e),(0,t.Qg)(e.message||"La connexion a échoué. Vérifiez vos identifiants.")}finally{(0,t.RZ)("loginBtn","loginSpinner"),window.turnstile&&s&&(window.turnstile.reset(s),console.log("Turnstile login widget has been reset.")),i=null}}else(0,t.Qg)("Veuillez compléter le CAPTCHA.");else(0,t.Qg)("Veuillez remplir tous les champs.")})),a?a.addEventListener("click",(async()=>{(0,t.Cs)("googleSignInBtn","googleSignInSpinner");try{const{error:e}=await r.N.auth.signInWithOAuth({provider:"google",options:{}});e&&(console.error("Error signing in with Google:",e),(0,t.Qg)(e.message||"Erreur lors de la connexion avec Google."))}catch(e){console.error("Exception during Google sign-in:",e),(0,t.Qg)("Une exception est survenue lors de la connexion avec Google.")}finally{(0,t.RZ)("googleSignInBtn","googleSignInSpinner")}})):console.warn("Google Sign-In button (googleSignInBtn) not found.")}window.onloadTurnstileLoginCallback=function(){console.log("Turnstile Login API ready (onloadTurnstileLoginCallback executed).");const e=document.getElementById("turnstile-login-container");if(e&&window.turnstile&&!s){console.log("Rendering Turnstile widget for login...");try{s=window.turnstile.render(e,{sitekey:"0x4AAAAAABdzY3InOU2_In99",callback:function(e){i=e,console.log("Turnstile login token obtained:",e)},"expired-callback":()=>{console.log("Turnstile login token expired. Resetting widget. ID:",s),window.turnstile&&s&&window.turnstile.reset(s),i=null},"error-callback":e=>{i=null,console.error("Turnstile login error callback:",e),(0,t.Qg)(`Erreur CAPTCHA (login): ${e}. Veuillez réessayer.`)}}),void 0===s?(console.error("Turnstile.render (login) did not return a widgetId. Sitekey or container issue?"),(0,t.Qg)("Erreur initialisation CAPTCHA (login, ID widget non retourné).")):console.log("Turnstile login widget rendered. ID:",s)}catch(e){console.error("Error rendering Turnstile for login:",e),(0,t.Qg)("Impossible d'afficher le CAPTCHA (login).")}}else e?window.turnstile?s&&console.log("onloadTurnstileLoginCallback: Login widget already seems rendered."):console.error("onloadTurnstileLoginCallback: window.turnstile API not found."):console.error("onloadTurnstileLoginCallback: #turnstile-login-container not found.")},document.addEventListener("DOMContentLoaded",(()=>{l(),console.log("Login page initialized")}))}},s={};function l(e){var n=s[e];if(void 0!==n)return n.exports;var o=s[e]={exports:{}};return i[e].call(o.exports,o,o.exports,l),o.exports}l.m=i,e=[],l.O=(n,o,t,r)=>{if(!o){var i=1/0;for(d=0;d<e.length;d++){for(var[o,t,r]=e[d],s=!0,a=0;a<o.length;a++)(!1&r||i>=r)&&Object.keys(l.O).every((e=>l.O[e](o[a])))?o.splice(a--,1):(s=!1,r<i&&(i=r));if(s){e.splice(d--,1);var c=t();void 0!==c&&(n=c)}}return n}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[o,t,r]},o=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,l.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var r=Object.create(null);l.r(r);var i={};n=n||[null,o({}),o([]),o(o)];for(var s=2&t&&e;"object"==typeof s&&!~n.indexOf(s);s=o(s))Object.getOwnPropertyNames(s).forEach((n=>i[n]=()=>e[n]));return i.default=()=>e,l.d(r,i),r},l.d=(e,n)=>{for(var o in n)l.o(n,o)&&!l.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},l.f={},l.e=e=>Promise.all(Object.keys(l.f).reduce(((n,o)=>(l.f[o](e,n),n)),[])),l.u=e=>"js/"+e+".chunk.js",l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t={},r="urbandocs_webapp:",l.l=(e,n,o,i)=>{if(t[e])t[e].push(n);else{var s,a;if(void 0!==o)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==r+o){s=u;break}}s||(a=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,l.nc&&s.setAttribute("nonce",l.nc),s.setAttribute("data-webpack",r+o),s.src=e),t[e]=[n];var g=(n,o)=>{s.onerror=s.onload=null,clearTimeout(p);var r=t[e];if(delete t[e],s.parentNode&&s.parentNode.removeChild(s),r&&r.forEach((e=>e(o))),n)return n(o)},p=setTimeout(g.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=g.bind(null,s.onerror),s.onload=g.bind(null,s.onload),a&&document.head.appendChild(s)}},l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.j=966,l.p="/",(()=>{var e={966:0};l.f.j=(n,o)=>{var t=l.o(e,n)?e[n]:void 0;if(0!==t)if(t)o.push(t[2]);else{var r=new Promise(((o,r)=>t=e[n]=[o,r]));o.push(t[2]=r);var i=l.p+l.u(n),s=new Error;l.l(i,(o=>{if(l.o(e,n)&&(0!==(t=e[n])&&(e[n]=void 0),t)){var r=o&&("load"===o.type?"missing":o.type),i=o&&o.target&&o.target.src;s.message="Loading chunk "+n+" failed.\n("+r+": "+i+")",s.name="ChunkLoadError",s.type=r,s.request=i,t[1](s)}}),"chunk-"+n,n)}},l.O.j=n=>0===e[n];var n=(n,o)=>{var t,r,[i,s,a]=o,c=0;if(i.some((n=>0!==e[n]))){for(t in s)l.o(s,t)&&(l.m[t]=s[t]);if(a)var d=a(l)}for(n&&n(o);c<i.length;c++)r=i[c],l.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return l.O(d)},o=self.webpackChunkurbandocs_webapp=self.webpackChunkurbandocs_webapp||[];o.forEach(n.bind(null,0)),o.push=n.bind(null,o.push.bind(o))})();var a=l.O(void 0,[76],(()=>l(6542)));a=l.O(a)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFTMkYsTUFBTUMsR0FBZ0MsSUFBeEJkLEVBQWdCYyxLQUFhLENBQ3RELElBQUlwRyxLQUFZaUcsRUFDWmxHLEVBQW9Cd0MsRUFBRTBELEVBQWFqRyxLQUNyQ0QsRUFBb0JPLEVBQUVOLEdBQVlpRyxFQUFZakcsSUFHaEQsR0FBR2tHLEVBQVMsSUFBSTNILEVBQVMySCxFQUFRbkcsRUFDbEMsQ0FFQSxJQURHaUcsR0FBNEJBLEVBQTJCbEosR0FDckQrRCxFQUFJTCxFQUFTTSxPQUFRRCxJQUN6QitCLEVBQVVwQyxFQUFTSyxHQUNoQmQsRUFBb0J3QyxFQUFFK0MsRUFBaUIxQyxJQUFZMEMsRUFBZ0IxQyxJQUNyRTBDLEVBQWdCMUMsR0FBUyxLQUUxQjBDLEVBQWdCMUMsR0FBVyxFQUU1QixPQUFPN0MsRUFBb0JRLEVBQUVoQyxJQUcxQjhILEVBQXFCQyxLQUFtQyw2QkFBSUEsS0FBbUMsOEJBQUssR0FDeEdELEVBQW1CakUsUUFBUTJELEVBQXFCaEIsS0FBSyxLQUFNLElBQzNEc0IsRUFBbUIxQyxLQUFPb0MsRUFBcUJoQixLQUFLLEtBQU1zQixFQUFtQjFDLEtBQUtvQixLQUFLc0IsRyxLQ2xGdkYsSUFBSUUsRUFBc0J4RyxFQUFvQlEsT0FBRVYsRUFBVyxDQUFDLEtBQUssSUFBT0UsRUFBb0IsUUFDNUZ3RyxFQUFzQnhHLEVBQW9CUSxFQUFFZ0csRSIsInNvdXJjZXMiOlsid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2NodW5rIGxvYWRlZCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9jcmVhdGUgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0Iiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2xvYWQgc2NyaXB0Iiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvLi9zcmMvanMvYXV0aC9sb2dpbi5qcyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwLy4vc3JjL2pzL2VudHJpZXMvbG9naW4uanMiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9lbnN1cmUgY2h1bmsiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvZ2V0IGphdmFzY3JpcHQgY2h1bmsgZmlsZW5hbWUiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvZ2xvYmFsIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvcnVudGltZUlkIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL3B1YmxpY1BhdGgiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvanNvbnAgY2h1bmsgbG9hZGluZyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZGVmZXJyZWQgPSBbXTtcbl9fd2VicGFja19yZXF1aXJlX18uTyA9IChyZXN1bHQsIGNodW5rSWRzLCBmbiwgcHJpb3JpdHkpID0+IHtcblx0aWYoY2h1bmtJZHMpIHtcblx0XHRwcmlvcml0eSA9IHByaW9yaXR5IHx8IDA7XG5cdFx0Zm9yKHZhciBpID0gZGVmZXJyZWQubGVuZ3RoOyBpID4gMCAmJiBkZWZlcnJlZFtpIC0gMV1bMl0gPiBwcmlvcml0eTsgaS0tKSBkZWZlcnJlZFtpXSA9IGRlZmVycmVkW2kgLSAxXTtcblx0XHRkZWZlcnJlZFtpXSA9IFtjaHVua0lkcywgZm4sIHByaW9yaXR5XTtcblx0XHRyZXR1cm47XG5cdH1cblx0dmFyIG5vdEZ1bGZpbGxlZCA9IEluZmluaXR5O1xuXHRmb3IgKHZhciBpID0gMDsgaSA8IGRlZmVycmVkLmxlbmd0aDsgaSsrKSB7XG5cdFx0dmFyIFtjaHVua0lkcywgZm4sIHByaW9yaXR5XSA9IGRlZmVycmVkW2ldO1xuXHRcdHZhciBmdWxmaWxsZWQgPSB0cnVlO1xuXHRcdGZvciAodmFyIGogPSAwOyBqIDwgY2h1bmtJZHMubGVuZ3RoOyBqKyspIHtcblx0XHRcdGlmICgocHJpb3JpdHkgJiAxID09PSAwIHx8IG5vdEZ1bGZpbGxlZCA+PSBwcmlvcml0eSkgJiYgT2JqZWN0LmtleXMoX193ZWJwYWNrX3JlcXVpcmVfXy5PKS5ldmVyeSgoa2V5KSA9PiAoX193ZWJwYWNrX3JlcXVpcmVfXy5PW2tleV0oY2h1bmtJZHNbal0pKSkpIHtcblx0XHRcdFx0Y2h1bmtJZHMuc3BsaWNlKGotLSwgMSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRmdWxmaWxsZWQgPSBmYWxzZTtcblx0XHRcdFx0aWYocHJpb3JpdHkgPCBub3RGdWxmaWxsZWQpIG5vdEZ1bGZpbGxlZCA9IHByaW9yaXR5O1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZihmdWxmaWxsZWQpIHtcblx0XHRcdGRlZmVycmVkLnNwbGljZShpLS0sIDEpXG5cdFx0XHR2YXIgciA9IGZuKCk7XG5cdFx0XHRpZiAociAhPT0gdW5kZWZpbmVkKSByZXN1bHQgPSByO1xuXHRcdH1cblx0fVxuXHRyZXR1cm4gcmVzdWx0O1xufTsiLCJ2YXIgZ2V0UHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YgPyAob2JqKSA9PiAoT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iaikpIDogKG9iaikgPT4gKG9iai5fX3Byb3RvX18pO1xudmFyIGxlYWZQcm90b3R5cGVzO1xuLy8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4vLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbi8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuLy8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4vLyBtb2RlICYgMTY6IHJldHVybiB2YWx1ZSB3aGVuIGl0J3MgUHJvbWlzZS1saWtlXG4vLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuXHRpZihtb2RlICYgMSkgdmFsdWUgPSB0aGlzKHZhbHVlKTtcblx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcblx0aWYodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSkge1xuXHRcdGlmKChtb2RlICYgNCkgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuXHRcdGlmKChtb2RlICYgMTYpICYmIHR5cGVvZiB2YWx1ZS50aGVuID09PSAnZnVuY3Rpb24nKSByZXR1cm4gdmFsdWU7XG5cdH1cblx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcblx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcblx0dmFyIGRlZiA9IHt9O1xuXHRsZWFmUHJvdG90eXBlcyA9IGxlYWZQcm90b3R5cGVzIHx8IFtudWxsLCBnZXRQcm90byh7fSksIGdldFByb3RvKFtdKSwgZ2V0UHJvdG8oZ2V0UHJvdG8pXTtcblx0Zm9yKHZhciBjdXJyZW50ID0gbW9kZSAmIDIgJiYgdmFsdWU7IHR5cGVvZiBjdXJyZW50ID09ICdvYmplY3QnICYmICF+bGVhZlByb3RvdHlwZXMuaW5kZXhPZihjdXJyZW50KTsgY3VycmVudCA9IGdldFByb3RvKGN1cnJlbnQpKSB7XG5cdFx0T2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoY3VycmVudCkuZm9yRWFjaCgoa2V5KSA9PiAoZGVmW2tleV0gPSAoKSA9PiAodmFsdWVba2V5XSkpKTtcblx0fVxuXHRkZWZbJ2RlZmF1bHQnXSA9ICgpID0+ICh2YWx1ZSk7XG5cdF9fd2VicGFja19yZXF1aXJlX18uZChucywgZGVmKTtcblx0cmV0dXJuIG5zO1xufTsiLCJ2YXIgaW5Qcm9ncmVzcyA9IHt9O1xudmFyIGRhdGFXZWJwYWNrUHJlZml4ID0gXCJ1cmJhbmRvY3Nfd2ViYXBwOlwiO1xuLy8gbG9hZFNjcmlwdCBmdW5jdGlvbiB0byBsb2FkIGEgc2NyaXB0IHZpYSBzY3JpcHQgdGFnXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmwgPSAodXJsLCBkb25lLCBrZXksIGNodW5rSWQpID0+IHtcblx0aWYoaW5Qcm9ncmVzc1t1cmxdKSB7IGluUHJvZ3Jlc3NbdXJsXS5wdXNoKGRvbmUpOyByZXR1cm47IH1cblx0dmFyIHNjcmlwdCwgbmVlZEF0dGFjaDtcblx0aWYoa2V5ICE9PSB1bmRlZmluZWQpIHtcblx0XHR2YXIgc2NyaXB0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpO1xuXHRcdGZvcih2YXIgaSA9IDA7IGkgPCBzY3JpcHRzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHR2YXIgcyA9IHNjcmlwdHNbaV07XG5cdFx0XHRpZihzLmdldEF0dHJpYnV0ZShcInNyY1wiKSA9PSB1cmwgfHwgcy5nZXRBdHRyaWJ1dGUoXCJkYXRhLXdlYnBhY2tcIikgPT0gZGF0YVdlYnBhY2tQcmVmaXggKyBrZXkpIHsgc2NyaXB0ID0gczsgYnJlYWs7IH1cblx0XHR9XG5cdH1cblx0aWYoIXNjcmlwdCkge1xuXHRcdG5lZWRBdHRhY2ggPSB0cnVlO1xuXHRcdHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuXG5cdFx0c2NyaXB0LmNoYXJzZXQgPSAndXRmLTgnO1xuXHRcdHNjcmlwdC50aW1lb3V0ID0gMTIwO1xuXHRcdGlmIChfX3dlYnBhY2tfcmVxdWlyZV9fLm5jKSB7XG5cdFx0XHRzY3JpcHQuc2V0QXR0cmlidXRlKFwibm9uY2VcIiwgX193ZWJwYWNrX3JlcXVpcmVfXy5uYyk7XG5cdFx0fVxuXHRcdHNjcmlwdC5zZXRBdHRyaWJ1dGUoXCJkYXRhLXdlYnBhY2tcIiwgZGF0YVdlYnBhY2tQcmVmaXggKyBrZXkpO1xuXG5cdFx0c2NyaXB0LnNyYyA9IHVybDtcblx0fVxuXHRpblByb2dyZXNzW3VybF0gPSBbZG9uZV07XG5cdHZhciBvblNjcmlwdENvbXBsZXRlID0gKHByZXYsIGV2ZW50KSA9PiB7XG5cdFx0Ly8gYXZvaWQgbWVtIGxlYWtzIGluIElFLlxuXHRcdHNjcmlwdC5vbmVycm9yID0gc2NyaXB0Lm9ubG9hZCA9IG51bGw7XG5cdFx0Y2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuXHRcdHZhciBkb25lRm5zID0gaW5Qcm9ncmVzc1t1cmxdO1xuXHRcdGRlbGV0ZSBpblByb2dyZXNzW3VybF07XG5cdFx0c2NyaXB0LnBhcmVudE5vZGUgJiYgc2NyaXB0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoc2NyaXB0KTtcblx0XHRkb25lRm5zICYmIGRvbmVGbnMuZm9yRWFjaCgoZm4pID0+IChmbihldmVudCkpKTtcblx0XHRpZihwcmV2KSByZXR1cm4gcHJldihldmVudCk7XG5cdH1cblx0dmFyIHRpbWVvdXQgPSBzZXRUaW1lb3V0KG9uU2NyaXB0Q29tcGxldGUuYmluZChudWxsLCB1bmRlZmluZWQsIHsgdHlwZTogJ3RpbWVvdXQnLCB0YXJnZXQ6IHNjcmlwdCB9KSwgMTIwMDAwKTtcblx0c2NyaXB0Lm9uZXJyb3IgPSBvblNjcmlwdENvbXBsZXRlLmJpbmQobnVsbCwgc2NyaXB0Lm9uZXJyb3IpO1xuXHRzY3JpcHQub25sb2FkID0gb25TY3JpcHRDb21wbGV0ZS5iaW5kKG51bGwsIHNjcmlwdC5vbmxvYWQpO1xuXHRuZWVkQXR0YWNoICYmIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTtcbn07IiwiLy8gc3JjL2pzL2xvZ2luLmpzXHJcbi8qKlxyXG4gKiBMb2dpbiBNb2R1bGVcclxuICogQG1vZHVsZSBsb2dpblxyXG4gKiBAZGVzY3JpcHRpb24gVGhpcyBtb2R1bGUgaGFuZGxlcyB1c2VyIGxvZ2luIGZ1bmN0aW9uYWxpdHkgdXNpbmcgU3VwYWJhc2UgQXV0aGVudGljYXRpb24uXHJcbiAqIEB2ZXJzaW9uIDAuMS4wXHJcbiAqIEBhdXRob3IgR3JleVBhbmRhXHJcbiAqIEB0b2RvIEFkZCBwaG9uZSBudW1iZXIgYXV0aGVudGljYXRpb24gJiBwYXNzd29yZCByZXNldCBmdW5jdGlvbmFsaXR5LlxyXG4gKlxyXG4gKiBAY2hhbmdlbG9nXHJcbiAqIC0gMC4xLjAgKDIwMjUtMDUtMTUpOiBNaWdyYXRlZCB0byBTdXBhYmFzZSBjbGllbnQtc2lkZSBhdXRoXHJcbiAqIC0gMC4wLjQgKDIwMjUtMDUtMTMpOiBFbnN1cmUgc3RhdHVzIG1lc3NhZ2UgaXMgYWxzbyBoaWRkZW4gb24gbmV3IHN1Ym1pdC5cclxuICogLSAwLjAuMyAoMjAyNS0wNS0wOCk6IEltcGxlbWVudGVkIGFjdHVhbCBsb2dpbiB3aXRoIEZpcmViYXNlIGZ1bmN0aW9uLCBhZGRlZCBwYXNzd29yZCB2aXNpYmlsaXR5IHRvZ2dsZS5cclxuICogLSAwLjAuMiAoMjAyNS0wNS0wOCk6IFJlZmFjdG9yZWQgdG8gaGFuZGxlIFN1cGFiYXNlIGF1dGhlbnRpZmljYXRpb24uXHJcbiAqIC0gMC4wLjEgKDIwMjUtMDQtMjcpOiBMb2dpbiBmdW5jdGlvbmFsaXR5IGltcGxlbWVudGVkIHVzaW5nIEZpcmViYXNlIEF1dGhlbnRpY2F0aW9uLlxyXG4gKi9cclxuXHJcbmltcG9ydCB7XHJcbiAgc2V0Q3VycmVudFVzZXIsXHJcbiAgc2hvd0Vycm9yLFxyXG4gIHNob3dTdGF0dXMsXHJcbiAgc2hvd0xvYWRpbmcsXHJcbiAgaGlkZUxvYWRpbmcsXHJcbn0gZnJvbSBcIi4vYXV0aC5qc1wiO1xyXG5pbXBvcnQgeyBzdXBhYmFzZSB9IGZyb20gXCIuLi9zdXBhYmFzZS1jbGllbnQuanNcIjtcclxuXHJcbmxldCBjYXB0Y2hhTG9naW5Ub2tlbiA9IG51bGw7IC8vIFRvIHN0b3JlIHRoZSBjYXB0Y2hhIHRva2VuIGZvciBsb2dpblxyXG5sZXQgdHVybnN0aWxlTG9naW5XaWRnZXRJZCA9IG51bGw7IC8vIFRvIHN0b3JlIFR1cm5zdGlsZSB3aWRnZXQgSUQgZm9yIGxvZ2luXHJcblxyXG4vLyBUaGlzIGZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIGJ5IHRoZSBDbG91ZGZsYXJlIFR1cm5zdGlsZSBzY3JpcHQgb25jZSBpdCdzIGxvYWRlZFxyXG4vLyAoZHVlIHRvICZvbmxvYWQ9b25sb2FkVHVybnN0aWxlTG9naW5DYWxsYmFjayBpbiB0aGUgc2NyaXB0IHRhZyBpbiBsb2dpbi5odG1sKVxyXG53aW5kb3cub25sb2FkVHVybnN0aWxlTG9naW5DYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtcclxuICBjb25zb2xlLmxvZyhcclxuICAgIFwiVHVybnN0aWxlIExvZ2luIEFQSSByZWFkeSAob25sb2FkVHVybnN0aWxlTG9naW5DYWxsYmFjayBleGVjdXRlZCkuXCJcclxuICApO1xyXG4gIGNvbnN0IHR1cm5zdGlsZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxyXG4gICAgXCJ0dXJuc3RpbGUtbG9naW4tY29udGFpbmVyXCJcclxuICApO1xyXG5cclxuICBpZiAodHVybnN0aWxlQ29udGFpbmVyICYmIHdpbmRvdy50dXJuc3RpbGUgJiYgIXR1cm5zdGlsZUxvZ2luV2lkZ2V0SWQpIHtcclxuICAgIGNvbnNvbGUubG9nKFwiUmVuZGVyaW5nIFR1cm5zdGlsZSB3aWRnZXQgZm9yIGxvZ2luLi4uXCIpO1xyXG4gICAgdHJ5IHtcclxuICAgICAgdHVybnN0aWxlTG9naW5XaWRnZXRJZCA9IHdpbmRvdy50dXJuc3RpbGUucmVuZGVyKHR1cm5zdGlsZUNvbnRhaW5lciwge1xyXG4gICAgICAgIHNpdGVrZXk6IFwiMHg0QUFBQUFBQmR6WTNJbk9VMl9Jbjk5XCIsXHJcbiAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uICh0b2tlbikge1xyXG4gICAgICAgICAgY2FwdGNoYUxvZ2luVG9rZW4gPSB0b2tlbjtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKFwiVHVybnN0aWxlIGxvZ2luIHRva2VuIG9idGFpbmVkOlwiLCB0b2tlbik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBcImV4cGlyZWQtY2FsbGJhY2tcIjogKCkgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coXHJcbiAgICAgICAgICAgIFwiVHVybnN0aWxlIGxvZ2luIHRva2VuIGV4cGlyZWQuIFJlc2V0dGluZyB3aWRnZXQuIElEOlwiLFxyXG4gICAgICAgICAgICB0dXJuc3RpbGVMb2dpbldpZGdldElkXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgICAgaWYgKHdpbmRvdy50dXJuc3RpbGUgJiYgdHVybnN0aWxlTG9naW5XaWRnZXRJZCkge1xyXG4gICAgICAgICAgICB3aW5kb3cudHVybnN0aWxlLnJlc2V0KHR1cm5zdGlsZUxvZ2luV2lkZ2V0SWQpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgY2FwdGNoYUxvZ2luVG9rZW4gPSBudWxsOyAvLyBDbGVhciB0aGUgdG9rZW5cclxuICAgICAgICB9LFxyXG4gICAgICAgIFwiZXJyb3ItY2FsbGJhY2tcIjogKGVycikgPT4ge1xyXG4gICAgICAgICAgY2FwdGNoYUxvZ2luVG9rZW4gPSBudWxsO1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIlR1cm5zdGlsZSBsb2dpbiBlcnJvciBjYWxsYmFjazpcIiwgZXJyKTtcclxuICAgICAgICAgIHNob3dFcnJvcihgRXJyZXVyIENBUFRDSEEgKGxvZ2luKTogJHtlcnJ9LiBWZXVpbGxleiByw6llc3NheWVyLmApO1xyXG4gICAgICAgIH0sXHJcbiAgICAgIH0pO1xyXG4gICAgICBpZiAodHVybnN0aWxlTG9naW5XaWRnZXRJZCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcclxuICAgICAgICAgIFwiVHVybnN0aWxlLnJlbmRlciAobG9naW4pIGRpZCBub3QgcmV0dXJuIGEgd2lkZ2V0SWQuIFNpdGVrZXkgb3IgY29udGFpbmVyIGlzc3VlP1wiXHJcbiAgICAgICAgKTtcclxuICAgICAgICBzaG93RXJyb3IoXHJcbiAgICAgICAgICBcIkVycmV1ciBpbml0aWFsaXNhdGlvbiBDQVBUQ0hBIChsb2dpbiwgSUQgd2lkZ2V0IG5vbiByZXRvdXJuw6kpLlwiXHJcbiAgICAgICAgKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcclxuICAgICAgICAgIFwiVHVybnN0aWxlIGxvZ2luIHdpZGdldCByZW5kZXJlZC4gSUQ6XCIsXHJcbiAgICAgICAgICB0dXJuc3RpbGVMb2dpbldpZGdldElkXHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmVuZGVyaW5nIFR1cm5zdGlsZSBmb3IgbG9naW46XCIsIGUpO1xyXG4gICAgICBzaG93RXJyb3IoXCJJbXBvc3NpYmxlIGQnYWZmaWNoZXIgbGUgQ0FQVENIQSAobG9naW4pLlwiKTtcclxuICAgIH1cclxuICB9IGVsc2UgaWYgKCF0dXJuc3RpbGVDb250YWluZXIpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXHJcbiAgICAgIFwib25sb2FkVHVybnN0aWxlTG9naW5DYWxsYmFjazogI3R1cm5zdGlsZS1sb2dpbi1jb250YWluZXIgbm90IGZvdW5kLlwiXHJcbiAgICApO1xyXG4gIH0gZWxzZSBpZiAoIXdpbmRvdy50dXJuc3RpbGUpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXHJcbiAgICAgIFwib25sb2FkVHVybnN0aWxlTG9naW5DYWxsYmFjazogd2luZG93LnR1cm5zdGlsZSBBUEkgbm90IGZvdW5kLlwiXHJcbiAgICApO1xyXG4gIH0gZWxzZSBpZiAodHVybnN0aWxlTG9naW5XaWRnZXRJZCkge1xyXG4gICAgY29uc29sZS5sb2coXHJcbiAgICAgIFwib25sb2FkVHVybnN0aWxlTG9naW5DYWxsYmFjazogTG9naW4gd2lkZ2V0IGFscmVhZHkgc2VlbXMgcmVuZGVyZWQuXCJcclxuICAgICk7XHJcbiAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIEluaXRpYWxpemVzIHRoZSBsb2dpbiBwYWdlXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gaW5pdExvZ2luUGFnZSgpIHtcclxuICBjb25zdCBsb2dpbkZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImxvZ2luRm9ybVwiKTtcclxuICBjb25zdCBlcnJvck1lc3NhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImVycm9yTWVzc2FnZVwiKTtcclxuICBjb25zdCB0b2dnbGVQYXNzd29yZEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidG9nZ2xlUGFzc3dvcmRcIik7XHJcbiAgY29uc3QgcGFzc3dvcmRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGFzc3dvcmRcIik7XHJcbiAgY29uc3QgZ29vZ2xlU2lnbkluQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJnb29nbGVTaWduSW5CdG5cIik7XHJcblxyXG4gIC8vIFNldCB1cCBwYXNzd29yZCB2aXNpYmlsaXR5IHRvZ2dsZVxyXG4gIGlmICh0b2dnbGVQYXNzd29yZEJ0biAmJiBwYXNzd29yZElucHV0KSB7XHJcbiAgICB0b2dnbGVQYXNzd29yZEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gICAgICBjb25zdCB0eXBlID1cclxuICAgICAgICBwYXNzd29yZElucHV0LmdldEF0dHJpYnV0ZShcInR5cGVcIikgPT09IFwicGFzc3dvcmRcIiA/IFwidGV4dFwiIDogXCJwYXNzd29yZFwiO1xyXG4gICAgICBwYXNzd29yZElucHV0LnNldEF0dHJpYnV0ZShcInR5cGVcIiwgdHlwZSk7XHJcblxyXG4gICAgICAvLyBUb2dnbGUgaWNvblxyXG4gICAgICBjb25zdCBpY29uRWxlbWVudCA9IHRvZ2dsZVBhc3N3b3JkQnRuLnF1ZXJ5U2VsZWN0b3IoXCJpXCIpO1xyXG4gICAgICBpZiAodHlwZSA9PT0gXCJwYXNzd29yZFwiKSB7XHJcbiAgICAgICAgaWNvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImJpLWV5ZVwiKTtcclxuICAgICAgICBpY29uRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiYmktZXllLXNsYXNoXCIpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGljb25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJiaS1leWUtc2xhc2hcIik7XHJcbiAgICAgICAgaWNvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImJpLWV5ZVwiKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBpZiAobG9naW5Gb3JtKSB7XHJcbiAgICBsb2dpbkZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBhc3luYyAoZSkgPT4ge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICAvLyBSZXNldCBtZXNzYWdlc1xyXG4gICAgICBpZiAoZXJyb3JNZXNzYWdlKSB7XHJcbiAgICAgICAgZXJyb3JNZXNzYWdlLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XHJcbiAgICAgICAgZXJyb3JNZXNzYWdlLnRleHRDb250ZW50ID0gXCJcIjtcclxuICAgICAgfVxyXG4gICAgICAvLyBFbnN1cmUgc3RhdHVzIG1lc3NhZ2UgaXMgYWxzbyBoaWRkZW4gb24gbmV3IHN1Ym1pdFxyXG4gICAgICBjb25zdCBzdGF0dXNNZXNzYWdlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3RhdHVzTWVzc2FnZVwiKTtcclxuICAgICAgaWYgKHN0YXR1c01lc3NhZ2VFbGVtZW50KSB7XHJcbiAgICAgICAgc3RhdHVzTWVzc2FnZUVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcclxuICAgICAgICBzdGF0dXNNZXNzYWdlRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEdldCBmb3JtIHZhbHVlc1xyXG4gICAgICBjb25zdCBlbWFpbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZW1haWxcIikudmFsdWU7XHJcbiAgICAgIGNvbnN0IHBhc3N3b3JkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwYXNzd29yZFwiKS52YWx1ZTtcclxuXHJcbiAgICAgIC8vIEJhc2ljIHZhbGlkYXRpb25cclxuICAgICAgaWYgKCFlbWFpbCB8fCAhcGFzc3dvcmQpIHtcclxuICAgICAgICBzaG93RXJyb3IoXCJWZXVpbGxleiByZW1wbGlyIHRvdXMgbGVzIGNoYW1wcy5cIik7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIWNhcHRjaGFMb2dpblRva2VuKSB7XHJcbiAgICAgICAgc2hvd0Vycm9yKFwiVmV1aWxsZXogY29tcGzDqXRlciBsZSBDQVBUQ0hBLlwiKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFNob3cgbG9hZGluZyBzdGF0ZVxyXG4gICAgICBzaG93TG9hZGluZyhcImxvZ2luQnRuXCIsIFwibG9naW5TcGlubmVyXCIpO1xyXG5cclxuICAgICAgdHJ5IHtcclxuICAgICAgICAvLyBDYWxsIGxvZ2luIGZ1bmN0aW9uXHJcbiAgICAgICAgYXdhaXQgbG9naW4oZW1haWwsIHBhc3N3b3JkKTtcclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiTG9naW4gZXJyb3I6XCIsIGVycm9yKTtcclxuICAgICAgICBzaG93RXJyb3IoXHJcbiAgICAgICAgICBlcnJvci5tZXNzYWdlIHx8IFwiTGEgY29ubmV4aW9uIGEgw6ljaG91w6kuIFbDqXJpZmlleiB2b3MgaWRlbnRpZmlhbnRzLlwiXHJcbiAgICAgICAgKTtcclxuICAgICAgfSBmaW5hbGx5IHtcclxuICAgICAgICAvLyBSZXNldCBidXR0b24gc3RhdGVcclxuICAgICAgICBoaWRlTG9hZGluZyhcImxvZ2luQnRuXCIsIFwibG9naW5TcGlubmVyXCIpO1xyXG4gICAgICAgIGlmICh3aW5kb3cudHVybnN0aWxlICYmIHR1cm5zdGlsZUxvZ2luV2lkZ2V0SWQpIHtcclxuICAgICAgICAgIHdpbmRvdy50dXJuc3RpbGUucmVzZXQodHVybnN0aWxlTG9naW5XaWRnZXRJZCk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIlR1cm5zdGlsZSBsb2dpbiB3aWRnZXQgaGFzIGJlZW4gcmVzZXQuXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXB0Y2hhTG9naW5Ub2tlbiA9IG51bGw7IC8vIENsZWFyIHRva2VuIGFmdGVyIHVzZVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8vIEV2ZW50IGxpc3RlbmVyIGZvciBHb29nbGUgU2lnbi1JbiBidXR0b25cclxuICBpZiAoZ29vZ2xlU2lnbkluQnRuKSB7XHJcbiAgICBnb29nbGVTaWduSW5CdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcclxuICAgICAgc2hvd0xvYWRpbmcoXCJnb29nbGVTaWduSW5CdG5cIiwgXCJnb29nbGVTaWduSW5TcGlubmVyXCIpO1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnbkluV2l0aE9BdXRoKHtcclxuICAgICAgICAgIHByb3ZpZGVyOiBcImdvb2dsZVwiLFxyXG4gICAgICAgICAgb3B0aW9uczoge1xyXG4gICAgICAgICAgICAvLyBPcHRpb25hbDogcmVkaXJlY3RUbyBjYW4gYmUgdXNlZCB0byBzcGVjaWZ5IHdoZXJlIHVzZXJzIGFyZSBzZW50IGFmdGVyIHNpZ24taW4uXHJcbiAgICAgICAgICAgIC8vIHJlZGlyZWN0VG86IGAke3dpbmRvdy5sb2NhdGlvbi5vcmlnaW59L3Byb2ZpbGUuaHRtbGBcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2lnbmluZyBpbiB3aXRoIEdvb2dsZTpcIiwgZXJyb3IpO1xyXG4gICAgICAgICAgc2hvd0Vycm9yKFxyXG4gICAgICAgICAgICBlcnJvci5tZXNzYWdlIHx8IFwiRXJyZXVyIGxvcnMgZGUgbGEgY29ubmV4aW9uIGF2ZWMgR29vZ2xlLlwiXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBPbiBzdWNjZXNzLCBTdXBhYmFzZSBoYW5kbGVzIHRoZSByZWRpcmVjdC5cclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXhjZXB0aW9uIGR1cmluZyBHb29nbGUgc2lnbi1pbjpcIiwgZXJyb3IpO1xyXG4gICAgICAgIHNob3dFcnJvcihcclxuICAgICAgICAgIFwiVW5lIGV4Y2VwdGlvbiBlc3Qgc3VydmVudWUgbG9ycyBkZSBsYSBjb25uZXhpb24gYXZlYyBHb29nbGUuXCJcclxuICAgICAgICApO1xyXG4gICAgICB9IGZpbmFsbHkge1xyXG4gICAgICAgIGhpZGVMb2FkaW5nKFwiZ29vZ2xlU2lnbkluQnRuXCIsIFwiZ29vZ2xlU2lnbkluU3Bpbm5lclwiKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGNvbnNvbGUud2FybihcIkdvb2dsZSBTaWduLUluIGJ1dHRvbiAoZ29vZ2xlU2lnbkluQnRuKSBub3QgZm91bmQuXCIpO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIExvZ3MgaW4gYSB1c2VyIHdpdGggZW1haWwgYW5kIHBhc3N3b3JkIGRpcmVjdGx5IHdpdGggU3VwYWJhc2VcclxuICogQHBhcmFtIHtzdHJpbmd9IGVtYWlsIC0gVXNlcidzIGVtYWlsXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXNzd29yZCAtIFVzZXIncyBwYXNzd29yZFxyXG4gKiBAcmV0dXJucyB7UHJvbWlzZX0gLSBQcm9taXNlIHJlc29sdmVkIHdpdGggdGhlIHVzZXIgZGF0YSBvbiBzdWNjZXNzXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9naW4oZW1haWwsIHBhc3N3b3JkKSB7XHJcbiAgdHJ5IHtcclxuICAgIC8vIENhbGwgU3VwYWJhc2UgYXV0aGVudGljYXRpb24gZGlyZWN0bHlcclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnbkluV2l0aFBhc3N3b3JkKHtcclxuICAgICAgZW1haWwsXHJcbiAgICAgIHBhc3N3b3JkLFxyXG4gICAgICBvcHRpb25zOiB7IGNhcHRjaGFUb2tlbjogY2FwdGNoYUxvZ2luVG9rZW4gfSwgLy8gUGFzcyBjYXB0Y2hhIHRva2VuXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBDaGVjayBmb3IgZXJyb3JzXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgLy8gSGFuZGxlIHNwZWNpZmljIGVycm9yIGNhc2VzXHJcbiAgICAgIGlmIChlcnJvci5tZXNzYWdlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJlbWFpbCBub3QgY29uZmlybWVkXCIpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxyXG4gICAgICAgICAgXCJWb3RyZSBlbWFpbCBuJ2EgcGFzIMOpdMOpIGNvbmZpcm3DqS4gVmV1aWxsZXogdsOpcmlmaWVyIHZvdHJlIGJvw650ZSBkZSByw6ljZXB0aW9uLlwiXHJcbiAgICAgICAgKTtcclxuICAgICAgfSBlbHNlIGlmIChcclxuICAgICAgICBlcnJvci5tZXNzYWdlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJpbnZhbGlkIGxvZ2luIGNyZWRlbnRpYWxzXCIpXHJcbiAgICAgICkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkVtYWlsIG91IG1vdCBkZSBwYXNzZSBpbmNvcnJlY3QuXCIpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvci5tZXNzYWdlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIE5vIHNlc3Npb24gZGF0YVxyXG4gICAgaWYgKCFkYXRhLnNlc3Npb24pIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcclxuICAgICAgICBcIkxvZ2luIGVycm9yOiBNaXNzaW5nIHNlc3Npb24gZGF0YSBmcm9tIFN1cGFiYXNlIHJlc3BvbnNlXCIsXHJcbiAgICAgICAgZGF0YVxyXG4gICAgICApO1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEb25uw6llcyBkZSBzZXNzaW9uIG1hbnF1YW50ZXMgYXByw6hzIGxhIGNvbm5leGlvbi5cIik7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gU2F2ZSB1c2VyIGRhdGEgbG9jYWxseSBpZiBuZWVkZWRcclxuICAgIGlmIChkYXRhLnVzZXIpIHtcclxuICAgICAgc2V0Q3VycmVudFVzZXIoZGF0YS51c2VyKTtcclxuICAgICAgY29uc29sZS5sb2coXCJbbG9naW4uanNdIFVzZXIgZGF0YSBzYXZlZCBsb2NhbGx5XCIpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENoZWNrIGlmIGFjY291bnQgaXMgc2NoZWR1bGVkIGZvciBkZWxldGlvblxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcclxuICAgICAgICBgJHtzdXBhYmFzZS5zdXBhYmFzZVVybH0vZnVuY3Rpb25zL3YxL2FjY291bnQtbWFuYWdlbWVudGAsXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtkYXRhLnNlc3Npb24uYWNjZXNzX3Rva2VufWAsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgICBhY3Rpb246IFwic3RhdHVzXCIsXHJcbiAgICAgICAgICB9KSxcclxuICAgICAgICB9XHJcbiAgICAgICk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XHJcblxyXG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MgJiYgcmVzdWx0LmRhdGEuZGVsZXRpb25fc2NoZWR1bGVkKSB7XHJcbiAgICAgICAgLy8gQWNjb3VudCBpcyBzY2hlZHVsZWQgZm9yIGRlbGV0aW9uLCByZWRpcmVjdCB0byBkZWxldGlvbiBzdGF0dXMgcGFnZVxyXG4gICAgICAgIHNob3dTdGF0dXMoXHJcbiAgICAgICAgICBcIkNvbm5leGlvbiByw6l1c3NpZSEgUmVkaXJlY3Rpb24gdmVycyBsZSBzdGF0dXQgZGUgc3VwcHJlc3Npb24uLi5cIixcclxuICAgICAgICAgIFwiaW5mb1wiXHJcbiAgICAgICAgKTtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCIvdXNlci9hY2NvdW50LWRlbGV0aW9uLXN0YXR1c1wiO1xyXG4gICAgICAgIH0sIDEwMDApO1xyXG4gICAgICAgIHJldHVybiBkYXRhLnVzZXI7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGRlbGV0aW9uQ2hlY2tFcnJvcikge1xyXG4gICAgICAvLyBJZiBkZWxldGlvbiBjaGVjayBmYWlscywgY29udGludWUgd2l0aCBub3JtYWwgbG9naW4gZmxvd1xyXG4gICAgICBjb25zb2xlLndhcm4oXCJDb3VsZCBub3QgY2hlY2sgZGVsZXRpb24gc3RhdHVzOlwiLCBkZWxldGlvbkNoZWNrRXJyb3IpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFNob3cgc3VjY2VzcyBtZXNzYWdlIGJlZm9yZSByZWRpcmVjdFxyXG4gICAgc2hvd1N0YXR1cyhcIkNvbm5leGlvbiByw6l1c3NpZSEgUmVkaXJlY3Rpb24uLi5cIiwgXCJzdWNjZXNzXCIpO1xyXG5cclxuICAgIC8vIFJlZGlyZWN0IHRvIGhvbWUgcGFnZSBhZnRlciBhIHNob3J0IGRlbGF5XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcIi9cIjtcclxuICAgIH0sIDUwMCk7XHJcblxyXG4gICAgcmV0dXJuIGRhdGEudXNlcjtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgLy8gTG9nIGFuZCByZS10aHJvdyB0aGUgZXJyb3IgdG8gYmUgaGFuZGxlZCBieSB0aGUgY2FsbGVyXHJcbiAgICBjb25zb2xlLmVycm9yKFwiTG9naW4gZXJyb3I6XCIsIGVycm9yKTtcclxuICAgIHRocm93IGVycm9yO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQge1xyXG4gIGluaXRMb2dpblBhZ2UsXHJcbiAgbG9naW4sXHJcbn07XHJcbiIsIi8vIHNyYy9lbnRyaWVzL3NpZ251cC5qc1xyXG4vKipcclxuICogTG9naW4gRW50cnkgUG9pbnRcclxuICpcclxuICogVGhpcyBtb2R1bGUgc2VydmVzIGFzIHRoZSBlbnRyeSBwb2ludCBmb3IgdGhlIGxvZ2luIHBhZ2UuXHJcbiAqL1xyXG5cclxuLy8gSW1wb3J0IG91ciBsb2dpbiBtb2R1bGVcclxuaW1wb3J0IHsgaW5pdExvZ2luUGFnZSB9IGZyb20gXCIuLi9hdXRoL2xvZ2luLmpzXCI7XHJcblxyXG4vLyBJbml0aWFsaXplIGxvZ2luIHBhZ2Ugd2hlbiBET00gaXMgbG9hZGVkXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+IHtcclxuICAvLyBJbml0aWFsaXplIGxvZ2luIHBhZ2VcclxuICBpbml0TG9naW5QYWdlKCk7XHJcblxyXG4gIGNvbnNvbGUubG9nKFwiTG9naW4gcGFnZSBpbml0aWFsaXplZFwiKTtcclxufSk7XHJcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4vLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuX193ZWJwYWNrX3JlcXVpcmVfXy5tID0gX193ZWJwYWNrX21vZHVsZXNfXztcblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5mID0ge307XG4vLyBUaGlzIGZpbGUgY29udGFpbnMgb25seSB0aGUgZW50cnkgY2h1bmsuXG4vLyBUaGUgY2h1bmsgbG9hZGluZyBmdW5jdGlvbiBmb3IgYWRkaXRpb25hbCBjaHVua3Ncbl9fd2VicGFja19yZXF1aXJlX18uZSA9IChjaHVua0lkKSA9PiB7XG5cdHJldHVybiBQcm9taXNlLmFsbChPYmplY3Qua2V5cyhfX3dlYnBhY2tfcmVxdWlyZV9fLmYpLnJlZHVjZSgocHJvbWlzZXMsIGtleSkgPT4ge1xuXHRcdF9fd2VicGFja19yZXF1aXJlX18uZltrZXldKGNodW5rSWQsIHByb21pc2VzKTtcblx0XHRyZXR1cm4gcHJvbWlzZXM7XG5cdH0sIFtdKSk7XG59OyIsIi8vIFRoaXMgZnVuY3Rpb24gYWxsb3cgdG8gcmVmZXJlbmNlIGFzeW5jIGNodW5rc1xuX193ZWJwYWNrX3JlcXVpcmVfXy51ID0gKGNodW5rSWQpID0+IHtcblx0Ly8gcmV0dXJuIHVybCBmb3IgZmlsZW5hbWVzIGJhc2VkIG9uIHRlbXBsYXRlXG5cdHJldHVybiBcImpzL1wiICsgY2h1bmtJZCArIFwiLmNodW5rLmpzXCI7XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18uZyA9IChmdW5jdGlvbigpIHtcblx0aWYgKHR5cGVvZiBnbG9iYWxUaGlzID09PSAnb2JqZWN0JykgcmV0dXJuIGdsb2JhbFRoaXM7XG5cdHRyeSB7XG5cdFx0cmV0dXJuIHRoaXMgfHwgbmV3IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7XG5cdH0gY2F0Y2ggKGUpIHtcblx0XHRpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcpIHJldHVybiB3aW5kb3c7XG5cdH1cbn0pKCk7IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18uaiA9IDk2NjsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIi9cIjsiLCIvLyBubyBiYXNlVVJJXG5cbi8vIG9iamVjdCB0byBzdG9yZSBsb2FkZWQgYW5kIGxvYWRpbmcgY2h1bmtzXG4vLyB1bmRlZmluZWQgPSBjaHVuayBub3QgbG9hZGVkLCBudWxsID0gY2h1bmsgcHJlbG9hZGVkL3ByZWZldGNoZWRcbi8vIFtyZXNvbHZlLCByZWplY3QsIFByb21pc2VdID0gY2h1bmsgbG9hZGluZywgMCA9IGNodW5rIGxvYWRlZFxudmFyIGluc3RhbGxlZENodW5rcyA9IHtcblx0OTY2OiAwXG59O1xuXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmYuaiA9IChjaHVua0lkLCBwcm9taXNlcykgPT4ge1xuXHRcdC8vIEpTT05QIGNodW5rIGxvYWRpbmcgZm9yIGphdmFzY3JpcHRcblx0XHR2YXIgaW5zdGFsbGVkQ2h1bmtEYXRhID0gX193ZWJwYWNrX3JlcXVpcmVfXy5vKGluc3RhbGxlZENodW5rcywgY2h1bmtJZCkgPyBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gOiB1bmRlZmluZWQ7XG5cdFx0aWYoaW5zdGFsbGVkQ2h1bmtEYXRhICE9PSAwKSB7IC8vIDAgbWVhbnMgXCJhbHJlYWR5IGluc3RhbGxlZFwiLlxuXG5cdFx0XHQvLyBhIFByb21pc2UgbWVhbnMgXCJjdXJyZW50bHkgbG9hZGluZ1wiLlxuXHRcdFx0aWYoaW5zdGFsbGVkQ2h1bmtEYXRhKSB7XG5cdFx0XHRcdHByb21pc2VzLnB1c2goaW5zdGFsbGVkQ2h1bmtEYXRhWzJdKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmKHRydWUpIHsgLy8gYWxsIGNodW5rcyBoYXZlIEpTXG5cdFx0XHRcdFx0Ly8gc2V0dXAgUHJvbWlzZSBpbiBjaHVuayBjYWNoZVxuXHRcdFx0XHRcdHZhciBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gKGluc3RhbGxlZENodW5rRGF0YSA9IGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA9IFtyZXNvbHZlLCByZWplY3RdKSk7XG5cdFx0XHRcdFx0cHJvbWlzZXMucHVzaChpbnN0YWxsZWRDaHVua0RhdGFbMl0gPSBwcm9taXNlKTtcblxuXHRcdFx0XHRcdC8vIHN0YXJ0IGNodW5rIGxvYWRpbmdcblx0XHRcdFx0XHR2YXIgdXJsID0gX193ZWJwYWNrX3JlcXVpcmVfXy5wICsgX193ZWJwYWNrX3JlcXVpcmVfXy51KGNodW5rSWQpO1xuXHRcdFx0XHRcdC8vIGNyZWF0ZSBlcnJvciBiZWZvcmUgc3RhY2sgdW53b3VuZCB0byBnZXQgdXNlZnVsIHN0YWNrdHJhY2UgbGF0ZXJcblx0XHRcdFx0XHR2YXIgZXJyb3IgPSBuZXcgRXJyb3IoKTtcblx0XHRcdFx0XHR2YXIgbG9hZGluZ0VuZGVkID0gKGV2ZW50KSA9PiB7XG5cdFx0XHRcdFx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oaW5zdGFsbGVkQ2h1bmtzLCBjaHVua0lkKSkge1xuXHRcdFx0XHRcdFx0XHRpbnN0YWxsZWRDaHVua0RhdGEgPSBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF07XG5cdFx0XHRcdFx0XHRcdGlmKGluc3RhbGxlZENodW5rRGF0YSAhPT0gMCkgaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdID0gdW5kZWZpbmVkO1xuXHRcdFx0XHRcdFx0XHRpZihpbnN0YWxsZWRDaHVua0RhdGEpIHtcblx0XHRcdFx0XHRcdFx0XHR2YXIgZXJyb3JUeXBlID0gZXZlbnQgJiYgKGV2ZW50LnR5cGUgPT09ICdsb2FkJyA/ICdtaXNzaW5nJyA6IGV2ZW50LnR5cGUpO1xuXHRcdFx0XHRcdFx0XHRcdHZhciByZWFsU3JjID0gZXZlbnQgJiYgZXZlbnQudGFyZ2V0ICYmIGV2ZW50LnRhcmdldC5zcmM7XG5cdFx0XHRcdFx0XHRcdFx0ZXJyb3IubWVzc2FnZSA9ICdMb2FkaW5nIGNodW5rICcgKyBjaHVua0lkICsgJyBmYWlsZWQuXFxuKCcgKyBlcnJvclR5cGUgKyAnOiAnICsgcmVhbFNyYyArICcpJztcblx0XHRcdFx0XHRcdFx0XHRlcnJvci5uYW1lID0gJ0NodW5rTG9hZEVycm9yJztcblx0XHRcdFx0XHRcdFx0XHRlcnJvci50eXBlID0gZXJyb3JUeXBlO1xuXHRcdFx0XHRcdFx0XHRcdGVycm9yLnJlcXVlc3QgPSByZWFsU3JjO1xuXHRcdFx0XHRcdFx0XHRcdGluc3RhbGxlZENodW5rRGF0YVsxXShlcnJvcik7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdF9fd2VicGFja19yZXF1aXJlX18ubCh1cmwsIGxvYWRpbmdFbmRlZCwgXCJjaHVuay1cIiArIGNodW5rSWQsIGNodW5rSWQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxufTtcblxuLy8gbm8gcHJlZmV0Y2hpbmdcblxuLy8gbm8gcHJlbG9hZGVkXG5cbi8vIG5vIEhNUlxuXG4vLyBubyBITVIgbWFuaWZlc3RcblxuX193ZWJwYWNrX3JlcXVpcmVfXy5PLmogPSAoY2h1bmtJZCkgPT4gKGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA9PT0gMCk7XG5cbi8vIGluc3RhbGwgYSBKU09OUCBjYWxsYmFjayBmb3IgY2h1bmsgbG9hZGluZ1xudmFyIHdlYnBhY2tKc29ucENhbGxiYWNrID0gKHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uLCBkYXRhKSA9PiB7XG5cdHZhciBbY2h1bmtJZHMsIG1vcmVNb2R1bGVzLCBydW50aW1lXSA9IGRhdGE7XG5cdC8vIGFkZCBcIm1vcmVNb2R1bGVzXCIgdG8gdGhlIG1vZHVsZXMgb2JqZWN0LFxuXHQvLyB0aGVuIGZsYWcgYWxsIFwiY2h1bmtJZHNcIiBhcyBsb2FkZWQgYW5kIGZpcmUgY2FsbGJhY2tcblx0dmFyIG1vZHVsZUlkLCBjaHVua0lkLCBpID0gMDtcblx0aWYoY2h1bmtJZHMuc29tZSgoaWQpID0+IChpbnN0YWxsZWRDaHVua3NbaWRdICE9PSAwKSkpIHtcblx0XHRmb3IobW9kdWxlSWQgaW4gbW9yZU1vZHVsZXMpIHtcblx0XHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhtb3JlTW9kdWxlcywgbW9kdWxlSWQpKSB7XG5cdFx0XHRcdF9fd2VicGFja19yZXF1aXJlX18ubVttb2R1bGVJZF0gPSBtb3JlTW9kdWxlc1ttb2R1bGVJZF07XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmKHJ1bnRpbWUpIHZhciByZXN1bHQgPSBydW50aW1lKF9fd2VicGFja19yZXF1aXJlX18pO1xuXHR9XG5cdGlmKHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uKSBwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbihkYXRhKTtcblx0Zm9yKDtpIDwgY2h1bmtJZHMubGVuZ3RoOyBpKyspIHtcblx0XHRjaHVua0lkID0gY2h1bmtJZHNbaV07XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGluc3RhbGxlZENodW5rcywgY2h1bmtJZCkgJiYgaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdKSB7XG5cdFx0XHRpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF1bMF0oKTtcblx0XHR9XG5cdFx0aW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdID0gMDtcblx0fVxuXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXy5PKHJlc3VsdCk7XG59XG5cbnZhciBjaHVua0xvYWRpbmdHbG9iYWwgPSBzZWxmW1wid2VicGFja0NodW5rdXJiYW5kb2NzX3dlYmFwcFwiXSA9IHNlbGZbXCJ3ZWJwYWNrQ2h1bmt1cmJhbmRvY3Nfd2ViYXBwXCJdIHx8IFtdO1xuY2h1bmtMb2FkaW5nR2xvYmFsLmZvckVhY2god2VicGFja0pzb25wQ2FsbGJhY2suYmluZChudWxsLCAwKSk7XG5jaHVua0xvYWRpbmdHbG9iYWwucHVzaCA9IHdlYnBhY2tKc29ucENhbGxiYWNrLmJpbmQobnVsbCwgY2h1bmtMb2FkaW5nR2xvYmFsLnB1c2guYmluZChjaHVua0xvYWRpbmdHbG9iYWwpKTsiLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGRlcGVuZHMgb24gb3RoZXIgbG9hZGVkIGNodW5rcyBhbmQgZXhlY3V0aW9uIG5lZWQgdG8gYmUgZGVsYXllZFxudmFyIF9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fLk8odW5kZWZpbmVkLCBbNzZdLCAoKSA9PiAoX193ZWJwYWNrX3JlcXVpcmVfXyg2NTQyKSkpXG5fX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXy5PKF9fd2VicGFja19leHBvcnRzX18pO1xuIl0sIm5hbWVzIjpbImRlZmVycmVkIiwibGVhZlByb3RvdHlwZXMiLCJnZXRQcm90byIsImluUHJvZ3Jlc3MiLCJkYXRhV2VicGFja1ByZWZpeCIsImNhcHRjaGFMb2dpblRva2VuIiwidHVybnN0aWxlTG9naW5XaWRnZXRJZCIsImluaXRMb2dpblBhZ2UiLCJsb2dpbkZvcm0iLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZXJyb3JNZXNzYWdlIiwidG9nZ2xlUGFzc3dvcmRCdG4iLCJwYXNzd29yZElucHV0IiwiZ29vZ2xlU2lnbkluQnRuIiwiYWRkRXZlbnRMaXN0ZW5lciIsInR5cGUiLCJnZXRBdHRyaWJ1dGUiLCJzZXRBdHRyaWJ1dGUiLCJpY29uRWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJhZGQiLCJhc3luYyIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInRleHRDb250ZW50Iiwic3RhdHVzTWVzc2FnZUVsZW1lbnQiLCJlbWFpbCIsInZhbHVlIiwicGFzc3dvcmQiLCJkYXRhIiwiZXJyb3IiLCJhdXRoIiwic2lnbkluV2l0aFBhc3N3b3JkIiwib3B0aW9ucyIsImNhcHRjaGFUb2tlbiIsIm1lc3NhZ2UiLCJ0b0xvd2VyQ2FzZSIsImluY2x1ZGVzIiwiRXJyb3IiLCJzZXNzaW9uIiwiY29uc29sZSIsInVzZXIiLCJsb2ciLCJyZXNwb25zZSIsImZldGNoIiwic3VwYWJhc2VVcmwiLCJtZXRob2QiLCJoZWFkZXJzIiwiQXV0aG9yaXphdGlvbiIsImFjY2Vzc190b2tlbiIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiYWN0aW9uIiwicmVzdWx0IiwianNvbiIsInN1Y2Nlc3MiLCJkZWxldGlvbl9zY2hlZHVsZWQiLCJzZXRUaW1lb3V0Iiwid2luZG93IiwibG9jYXRpb24iLCJocmVmIiwiZGVsZXRpb25DaGVja0Vycm9yIiwid2FybiIsImxvZ2luIiwidHVybnN0aWxlIiwicmVzZXQiLCJzaWduSW5XaXRoT0F1dGgiLCJwcm92aWRlciIsIm9ubG9hZFR1cm5zdGlsZUxvZ2luQ2FsbGJhY2siLCJ0dXJuc3RpbGVDb250YWluZXIiLCJyZW5kZXIiLCJzaXRla2V5IiwiY2FsbGJhY2siLCJ0b2tlbiIsImVyciIsInVuZGVmaW5lZCIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiY2FsbCIsIm0iLCJPIiwiY2h1bmtJZHMiLCJmbiIsInByaW9yaXR5Iiwibm90RnVsZmlsbGVkIiwiSW5maW5pdHkiLCJpIiwibGVuZ3RoIiwiZnVsZmlsbGVkIiwiaiIsIk9iamVjdCIsImtleXMiLCJldmVyeSIsImtleSIsInNwbGljZSIsInIiLCJnZXRQcm90b3R5cGVPZiIsIm9iaiIsInQiLCJtb2RlIiwidGhpcyIsIl9fZXNNb2R1bGUiLCJ0aGVuIiwibnMiLCJjcmVhdGUiLCJkZWYiLCJjdXJyZW50IiwiaW5kZXhPZiIsImdldE93blByb3BlcnR5TmFtZXMiLCJmb3JFYWNoIiwiZCIsImRlZmluaXRpb24iLCJvIiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiZiIsImNodW5rSWQiLCJQcm9taXNlIiwiYWxsIiwicmVkdWNlIiwicHJvbWlzZXMiLCJ1IiwiZyIsImdsb2JhbFRoaXMiLCJGdW5jdGlvbiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImwiLCJ1cmwiLCJkb25lIiwicHVzaCIsInNjcmlwdCIsIm5lZWRBdHRhY2giLCJzY3JpcHRzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJzIiwiY3JlYXRlRWxlbWVudCIsImNoYXJzZXQiLCJ0aW1lb3V0IiwibmMiLCJzcmMiLCJvblNjcmlwdENvbXBsZXRlIiwicHJldiIsImV2ZW50Iiwib25lcnJvciIsIm9ubG9hZCIsImNsZWFyVGltZW91dCIsImRvbmVGbnMiLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJiaW5kIiwidGFyZ2V0IiwiaGVhZCIsImFwcGVuZENoaWxkIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJwIiwiaW5zdGFsbGVkQ2h1bmtzIiwiaW5zdGFsbGVkQ2h1bmtEYXRhIiwicHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJlcnJvclR5cGUiLCJyZWFsU3JjIiwibmFtZSIsInJlcXVlc3QiLCJ3ZWJwYWNrSnNvbnBDYWxsYmFjayIsInBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uIiwibW9yZU1vZHVsZXMiLCJydW50aW1lIiwic29tZSIsImlkIiwiY2h1bmtMb2FkaW5nR2xvYmFsIiwic2VsZiIsIl9fd2VicGFja19leHBvcnRzX18iXSwic291cmNlUm9vdCI6IiJ9