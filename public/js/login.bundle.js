(()=>{"use strict";var e,n,o,t,r,i={6542:(e,n,o)=>{var t=o(3715),r=o(9660);let i=null,s=null;function l(){const e=document.getElementById("loginForm"),n=document.getElementById("errorMessage"),o=document.getElementById("togglePassword"),l=document.getElementById("password"),a=document.getElementById("googleSignInBtn");o&&l&&o.addEventListener("click",(()=>{const e="password"===l.getAttribute("type")?"text":"password";l.setAttribute("type",e);const n=o.querySelector("i");"password"===e?(n.classList.remove("bi-eye"),n.classList.add("bi-eye-slash")):(n.classList.remove("bi-eye-slash"),n.classList.add("bi-eye"))})),e&&e.addEventListener("submit",(async e=>{e.preventDefault(),n&&(n.classList.add("hidden"),n.textContent="");const o=document.getElementById("statusMessage");o&&(o.classList.add("hidden"),o.textContent="");const l=document.getElementById("email").value,a=document.getElementById("password").value;if(l&&a)if(i){(0,t.Cs)("loginBtn","loginSpinner");try{await async function(e,n){try{const{data:o,error:s}=await r.N.auth.signInWithPassword({email:e,password:n,options:{captchaToken:i}});if(s)throw s.message.toLowerCase().includes("email not confirmed")?new Error("Votre email n'a pas été confirmé. Veuillez vérifier votre boîte de réception."):s.message.toLowerCase().includes("invalid login credentials")?new Error("Email ou mot de passe incorrect."):new Error(s.message);if(!o.session)throw console.error("Login error: Missing session data from Supabase response",o),new Error("Données de session manquantes après la connexion.");o.user&&((0,t.lt)(o.user),console.log("[login.js] User data saved locally"));try{const e=await fetch(`${r.N.supabaseUrl}/functions/v1/account-management`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o.session.access_token}`},body:JSON.stringify({action:"status"})}),n=await e.json();if(n.success&&n.data.deletion_scheduled)return(0,t.wc)("Connexion réussie! Redirection vers le statut de suppression...","info"),setTimeout((()=>{window.location.href="/user/account-deletion-status"}),1e3),o.user}catch(e){console.warn("Could not check deletion status:",e)}return(0,t.wc)("Connexion réussie! Redirection...","success"),setTimeout((()=>{window.location.href="/"}),500),o.user}catch(e){throw console.error("Login error:",e),e}}(l,a)}catch(e){console.error("Login error:",e),(0,t.Qg)(e.message||"La connexion a échoué. Vérifiez vos identifiants.")}finally{(0,t.RZ)("loginBtn","loginSpinner"),window.turnstile&&s&&(window.turnstile.reset(s),console.log("Turnstile login widget has been reset.")),i=null}}else(0,t.Qg)("Veuillez compléter le CAPTCHA.");else(0,t.Qg)("Veuillez remplir tous les champs.")})),a?a.addEventListener("click",(async()=>{(0,t.Cs)("googleSignInBtn","googleSignInSpinner");try{const{error:e}=await r.N.auth.signInWithOAuth({provider:"google",options:{}});e&&(console.error("Error signing in with Google:",e),(0,t.Qg)(e.message||"Erreur lors de la connexion avec Google."))}catch(e){console.error("Exception during Google sign-in:",e),(0,t.Qg)("Une exception est survenue lors de la connexion avec Google.")}finally{(0,t.RZ)("googleSignInBtn","googleSignInSpinner")}})):console.warn("Google Sign-In button (googleSignInBtn) not found.")}window.onloadTurnstileLoginCallback=function(){console.log("Turnstile Login API ready (onloadTurnstileLoginCallback executed).");const e=document.getElementById("turnstile-login-container");if(e&&window.turnstile&&!s){console.log("Rendering Turnstile widget for login...");try{s=window.turnstile.render(e,{sitekey:"0x4AAAAAABdzY3InOU2_In99",callback:function(e){i=e,console.log("Turnstile login token obtained:",e)},"expired-callback":()=>{console.log("Turnstile login token expired. Resetting widget. ID:",s),window.turnstile&&s&&window.turnstile.reset(s),i=null},"error-callback":e=>{i=null,console.error("Turnstile login error callback:",e),(0,t.Qg)(`Erreur CAPTCHA (login): ${e}. Veuillez réessayer.`)}}),void 0===s?(console.error("Turnstile.render (login) did not return a widgetId. Sitekey or container issue?"),(0,t.Qg)("Erreur initialisation CAPTCHA (login, ID widget non retourné).")):console.log("Turnstile login widget rendered. ID:",s)}catch(e){console.error("Error rendering Turnstile for login:",e),(0,t.Qg)("Impossible d'afficher le CAPTCHA (login).")}}else e?window.turnstile?s&&console.log("onloadTurnstileLoginCallback: Login widget already seems rendered."):console.error("onloadTurnstileLoginCallback: window.turnstile API not found."):console.error("onloadTurnstileLoginCallback: #turnstile-login-container not found.")},document.addEventListener("DOMContentLoaded",(()=>{l(),console.log("Login page initialized")}))}},s={};function l(e){var n=s[e];if(void 0!==n)return n.exports;var o=s[e]={exports:{}};return i[e].call(o.exports,o,o.exports,l),o.exports}l.m=i,e=[],l.O=(n,o,t,r)=>{if(!o){var i=1/0;for(d=0;d<e.length;d++){for(var[o,t,r]=e[d],s=!0,a=0;a<o.length;a++)(!1&r||i>=r)&&Object.keys(l.O).every((e=>l.O[e](o[a])))?o.splice(a--,1):(s=!1,r<i&&(i=r));if(s){e.splice(d--,1);var c=t();void 0!==c&&(n=c)}}return n}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[o,t,r]},o=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,l.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var r=Object.create(null);l.r(r);var i={};n=n||[null,o({}),o([]),o(o)];for(var s=2&t&&e;"object"==typeof s&&!~n.indexOf(s);s=o(s))Object.getOwnPropertyNames(s).forEach((n=>i[n]=()=>e[n]));return i.default=()=>e,l.d(r,i),r},l.d=(e,n)=>{for(var o in n)l.o(n,o)&&!l.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},l.f={},l.e=e=>Promise.all(Object.keys(l.f).reduce(((n,o)=>(l.f[o](e,n),n)),[])),l.u=e=>"js/"+e+".bundle.js",l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t={},r="urbandocs_webapp:",l.l=(e,n,o,i)=>{if(t[e])t[e].push(n);else{var s,a;if(void 0!==o)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==r+o){s=u;break}}s||(a=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,l.nc&&s.setAttribute("nonce",l.nc),s.setAttribute("data-webpack",r+o),s.src=e),t[e]=[n];var g=(n,o)=>{s.onerror=s.onload=null,clearTimeout(p);var r=t[e];if(delete t[e],s.parentNode&&s.parentNode.removeChild(s),r&&r.forEach((e=>e(o))),n)return n(o)},p=setTimeout(g.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=g.bind(null,s.onerror),s.onload=g.bind(null,s.onload),a&&document.head.appendChild(s)}},l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.j=966,(()=>{var e;l.g.importScripts&&(e=l.g.location+"");var n=l.g.document;if(!e&&n&&(n.currentScript&&"SCRIPT"===n.currentScript.tagName.toUpperCase()&&(e=n.currentScript.src),!e)){var o=n.getElementsByTagName("script");if(o.length)for(var t=o.length-1;t>-1&&(!e||!/^http(s?):/.test(e));)e=o[t--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),l.p=e+"../"})(),(()=>{var e={966:0};l.f.j=(n,o)=>{var t=l.o(e,n)?e[n]:void 0;if(0!==t)if(t)o.push(t[2]);else{var r=new Promise(((o,r)=>t=e[n]=[o,r]));o.push(t[2]=r);var i=l.p+l.u(n),s=new Error;l.l(i,(o=>{if(l.o(e,n)&&(0!==(t=e[n])&&(e[n]=void 0),t)){var r=o&&("load"===o.type?"missing":o.type),i=o&&o.target&&o.target.src;s.message="Loading chunk "+n+" failed.\n("+r+": "+i+")",s.name="ChunkLoadError",s.type=r,s.request=i,t[1](s)}}),"chunk-"+n,n)}},l.O.j=n=>0===e[n];var n=(n,o)=>{var t,r,[i,s,a]=o,c=0;if(i.some((n=>0!==e[n]))){for(t in s)l.o(s,t)&&(l.m[t]=s[t]);if(a)var d=a(l)}for(n&&n(o);c<i.length;c++)r=i[c],l.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return l.O(d)},o=self.webpackChunkurbandocs_webapp=self.webpackChunkurbandocs_webapp||[];o.forEach(n.bind(null,0)),o.push=n.bind(null,o.push.bind(o))})();var a=l.O(void 0,[76],(()=>l(6542)));a=l.O(a)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UWtFLEVBQXFCdkIsS0FBSyxLQUFNLElBQzNENkIsRUFBbUJqRCxLQUFPMkMsRUFBcUJ2QixLQUFLLEtBQU02QixFQUFtQmpELEtBQUtvQixLQUFLNkIsRyxLQ2xGdkYsSUFBSUUsRUFBc0IvRyxFQUFvQlEsT0FBRVYsRUFBVyxDQUFDLEtBQUssSUFBT0UsRUFBb0IsUUFDNUYrRyxFQUFzQi9HLEVBQW9CUSxFQUFFdUcsRSIsInNvdXJjZXMiOlsid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2NodW5rIGxvYWRlZCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9jcmVhdGUgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0Iiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2xvYWQgc2NyaXB0Iiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvLi9zcmMvanMvYXV0aC9sb2dpbi5qcyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwLy4vc3JjL2pzL2VudHJpZXMvbG9naW4uanMiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9lbnN1cmUgY2h1bmsiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvZ2V0IGphdmFzY3JpcHQgY2h1bmsgZmlsZW5hbWUiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvZ2xvYmFsIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvcnVudGltZUlkIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL3B1YmxpY1BhdGgiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvanNvbnAgY2h1bmsgbG9hZGluZyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZGVmZXJyZWQgPSBbXTtcbl9fd2VicGFja19yZXF1aXJlX18uTyA9IChyZXN1bHQsIGNodW5rSWRzLCBmbiwgcHJpb3JpdHkpID0+IHtcblx0aWYoY2h1bmtJZHMpIHtcblx0XHRwcmlvcml0eSA9IHByaW9yaXR5IHx8IDA7XG5cdFx0Zm9yKHZhciBpID0gZGVmZXJyZWQubGVuZ3RoOyBpID4gMCAmJiBkZWZlcnJlZFtpIC0gMV1bMl0gPiBwcmlvcml0eTsgaS0tKSBkZWZlcnJlZFtpXSA9IGRlZmVycmVkW2kgLSAxXTtcblx0XHRkZWZlcnJlZFtpXSA9IFtjaHVua0lkcywgZm4sIHByaW9yaXR5XTtcblx0XHRyZXR1cm47XG5cdH1cblx0dmFyIG5vdEZ1bGZpbGxlZCA9IEluZmluaXR5O1xuXHRmb3IgKHZhciBpID0gMDsgaSA8IGRlZmVycmVkLmxlbmd0aDsgaSsrKSB7XG5cdFx0dmFyIFtjaHVua0lkcywgZm4sIHByaW9yaXR5XSA9IGRlZmVycmVkW2ldO1xuXHRcdHZhciBmdWxmaWxsZWQgPSB0cnVlO1xuXHRcdGZvciAodmFyIGogPSAwOyBqIDwgY2h1bmtJZHMubGVuZ3RoOyBqKyspIHtcblx0XHRcdGlmICgocHJpb3JpdHkgJiAxID09PSAwIHx8IG5vdEZ1bGZpbGxlZCA+PSBwcmlvcml0eSkgJiYgT2JqZWN0LmtleXMoX193ZWJwYWNrX3JlcXVpcmVfXy5PKS5ldmVyeSgoa2V5KSA9PiAoX193ZWJwYWNrX3JlcXVpcmVfXy5PW2tleV0oY2h1bmtJZHNbal0pKSkpIHtcblx0XHRcdFx0Y2h1bmtJZHMuc3BsaWNlKGotLSwgMSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRmdWxmaWxsZWQgPSBmYWxzZTtcblx0XHRcdFx0aWYocHJpb3JpdHkgPCBub3RGdWxmaWxsZWQpIG5vdEZ1bGZpbGxlZCA9IHByaW9yaXR5O1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZihmdWxmaWxsZWQpIHtcblx0XHRcdGRlZmVycmVkLnNwbGljZShpLS0sIDEpXG5cdFx0XHR2YXIgciA9IGZuKCk7XG5cdFx0XHRpZiAociAhPT0gdW5kZWZpbmVkKSByZXN1bHQgPSByO1xuXHRcdH1cblx0fVxuXHRyZXR1cm4gcmVzdWx0O1xufTsiLCJ2YXIgZ2V0UHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YgPyAob2JqKSA9PiAoT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iaikpIDogKG9iaikgPT4gKG9iai5fX3Byb3RvX18pO1xudmFyIGxlYWZQcm90b3R5cGVzO1xuLy8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4vLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbi8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuLy8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4vLyBtb2RlICYgMTY6IHJldHVybiB2YWx1ZSB3aGVuIGl0J3MgUHJvbWlzZS1saWtlXG4vLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuXHRpZihtb2RlICYgMSkgdmFsdWUgPSB0aGlzKHZhbHVlKTtcblx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcblx0aWYodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSkge1xuXHRcdGlmKChtb2RlICYgNCkgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuXHRcdGlmKChtb2RlICYgMTYpICYmIHR5cGVvZiB2YWx1ZS50aGVuID09PSAnZnVuY3Rpb24nKSByZXR1cm4gdmFsdWU7XG5cdH1cblx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcblx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcblx0dmFyIGRlZiA9IHt9O1xuXHRsZWFmUHJvdG90eXBlcyA9IGxlYWZQcm90b3R5cGVzIHx8IFtudWxsLCBnZXRQcm90byh7fSksIGdldFByb3RvKFtdKSwgZ2V0UHJvdG8oZ2V0UHJvdG8pXTtcblx0Zm9yKHZhciBjdXJyZW50ID0gbW9kZSAmIDIgJiYgdmFsdWU7IHR5cGVvZiBjdXJyZW50ID09ICdvYmplY3QnICYmICF+bGVhZlByb3RvdHlwZXMuaW5kZXhPZihjdXJyZW50KTsgY3VycmVudCA9IGdldFByb3RvKGN1cnJlbnQpKSB7XG5cdFx0T2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoY3VycmVudCkuZm9yRWFjaCgoa2V5KSA9PiAoZGVmW2tleV0gPSAoKSA9PiAodmFsdWVba2V5XSkpKTtcblx0fVxuXHRkZWZbJ2RlZmF1bHQnXSA9ICgpID0+ICh2YWx1ZSk7XG5cdF9fd2VicGFja19yZXF1aXJlX18uZChucywgZGVmKTtcblx0cmV0dXJuIG5zO1xufTsiLCJ2YXIgaW5Qcm9ncmVzcyA9IHt9O1xudmFyIGRhdGFXZWJwYWNrUHJlZml4ID0gXCJ1cmJhbmRvY3Nfd2ViYXBwOlwiO1xuLy8gbG9hZFNjcmlwdCBmdW5jdGlvbiB0byBsb2FkIGEgc2NyaXB0IHZpYSBzY3JpcHQgdGFnXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmwgPSAodXJsLCBkb25lLCBrZXksIGNodW5rSWQpID0+IHtcblx0aWYoaW5Qcm9ncmVzc1t1cmxdKSB7IGluUHJvZ3Jlc3NbdXJsXS5wdXNoKGRvbmUpOyByZXR1cm47IH1cblx0dmFyIHNjcmlwdCwgbmVlZEF0dGFjaDtcblx0aWYoa2V5ICE9PSB1bmRlZmluZWQpIHtcblx0XHR2YXIgc2NyaXB0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpO1xuXHRcdGZvcih2YXIgaSA9IDA7IGkgPCBzY3JpcHRzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHR2YXIgcyA9IHNjcmlwdHNbaV07XG5cdFx0XHRpZihzLmdldEF0dHJpYnV0ZShcInNyY1wiKSA9PSB1cmwgfHwgcy5nZXRBdHRyaWJ1dGUoXCJkYXRhLXdlYnBhY2tcIikgPT0gZGF0YVdlYnBhY2tQcmVmaXggKyBrZXkpIHsgc2NyaXB0ID0gczsgYnJlYWs7IH1cblx0XHR9XG5cdH1cblx0aWYoIXNjcmlwdCkge1xuXHRcdG5lZWRBdHRhY2ggPSB0cnVlO1xuXHRcdHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuXG5cdFx0c2NyaXB0LmNoYXJzZXQgPSAndXRmLTgnO1xuXHRcdHNjcmlwdC50aW1lb3V0ID0gMTIwO1xuXHRcdGlmIChfX3dlYnBhY2tfcmVxdWlyZV9fLm5jKSB7XG5cdFx0XHRzY3JpcHQuc2V0QXR0cmlidXRlKFwibm9uY2VcIiwgX193ZWJwYWNrX3JlcXVpcmVfXy5uYyk7XG5cdFx0fVxuXHRcdHNjcmlwdC5zZXRBdHRyaWJ1dGUoXCJkYXRhLXdlYnBhY2tcIiwgZGF0YVdlYnBhY2tQcmVmaXggKyBrZXkpO1xuXG5cdFx0c2NyaXB0LnNyYyA9IHVybDtcblx0fVxuXHRpblByb2dyZXNzW3VybF0gPSBbZG9uZV07XG5cdHZhciBvblNjcmlwdENvbXBsZXRlID0gKHByZXYsIGV2ZW50KSA9PiB7XG5cdFx0Ly8gYXZvaWQgbWVtIGxlYWtzIGluIElFLlxuXHRcdHNjcmlwdC5vbmVycm9yID0gc2NyaXB0Lm9ubG9hZCA9IG51bGw7XG5cdFx0Y2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuXHRcdHZhciBkb25lRm5zID0gaW5Qcm9ncmVzc1t1cmxdO1xuXHRcdGRlbGV0ZSBpblByb2dyZXNzW3VybF07XG5cdFx0c2NyaXB0LnBhcmVudE5vZGUgJiYgc2NyaXB0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoc2NyaXB0KTtcblx0XHRkb25lRm5zICYmIGRvbmVGbnMuZm9yRWFjaCgoZm4pID0+IChmbihldmVudCkpKTtcblx0XHRpZihwcmV2KSByZXR1cm4gcHJldihldmVudCk7XG5cdH1cblx0dmFyIHRpbWVvdXQgPSBzZXRUaW1lb3V0KG9uU2NyaXB0Q29tcGxldGUuYmluZChudWxsLCB1bmRlZmluZWQsIHsgdHlwZTogJ3RpbWVvdXQnLCB0YXJnZXQ6IHNjcmlwdCB9KSwgMTIwMDAwKTtcblx0c2NyaXB0Lm9uZXJyb3IgPSBvblNjcmlwdENvbXBsZXRlLmJpbmQobnVsbCwgc2NyaXB0Lm9uZXJyb3IpO1xuXHRzY3JpcHQub25sb2FkID0gb25TY3JpcHRDb21wbGV0ZS5iaW5kKG51bGwsIHNjcmlwdC5vbmxvYWQpO1xuXHRuZWVkQXR0YWNoICYmIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTtcbn07IiwiLy8gc3JjL2pzL2xvZ2luLmpzXG4vKipcbiAqIExvZ2luIE1vZHVsZVxuICogQG1vZHVsZSBsb2dpblxuICogQGRlc2NyaXB0aW9uIFRoaXMgbW9kdWxlIGhhbmRsZXMgdXNlciBsb2dpbiBmdW5jdGlvbmFsaXR5IHVzaW5nIFN1cGFiYXNlIEF1dGhlbnRpY2F0aW9uLlxuICogQHZlcnNpb24gMC4xLjBcbiAqIEBhdXRob3IgR3JleVBhbmRhXG4gKiBAdG9kbyBBZGQgcGhvbmUgbnVtYmVyIGF1dGhlbnRpY2F0aW9uICYgcGFzc3dvcmQgcmVzZXQgZnVuY3Rpb25hbGl0eS5cbiAqXG4gKiBAY2hhbmdlbG9nXG4gKiAtIDAuMS4wICgyMDI1LTA1LTE1KTogTWlncmF0ZWQgdG8gU3VwYWJhc2UgY2xpZW50LXNpZGUgYXV0aFxuICogLSAwLjAuNCAoMjAyNS0wNS0xMyk6IEVuc3VyZSBzdGF0dXMgbWVzc2FnZSBpcyBhbHNvIGhpZGRlbiBvbiBuZXcgc3VibWl0LlxuICogLSAwLjAuMyAoMjAyNS0wNS0wOCk6IEltcGxlbWVudGVkIGFjdHVhbCBsb2dpbiB3aXRoIEZpcmViYXNlIGZ1bmN0aW9uLCBhZGRlZCBwYXNzd29yZCB2aXNpYmlsaXR5IHRvZ2dsZS5cbiAqIC0gMC4wLjIgKDIwMjUtMDUtMDgpOiBSZWZhY3RvcmVkIHRvIGhhbmRsZSBTdXBhYmFzZSBhdXRoZW50aWZpY2F0aW9uLlxuICogLSAwLjAuMSAoMjAyNS0wNC0yNyk6IExvZ2luIGZ1bmN0aW9uYWxpdHkgaW1wbGVtZW50ZWQgdXNpbmcgRmlyZWJhc2UgQXV0aGVudGljYXRpb24uXG4gKi9cblxuaW1wb3J0IHtcbiAgc2V0Q3VycmVudFVzZXIsXG4gIHNob3dFcnJvcixcbiAgc2hvd1N0YXR1cyxcbiAgc2hvd0xvYWRpbmcsXG4gIGhpZGVMb2FkaW5nLFxufSBmcm9tIFwiLi9hdXRoLmpzXCI7XG5pbXBvcnQgeyBzdXBhYmFzZSB9IGZyb20gXCIuLi9zdXBhYmFzZS1jbGllbnQuanNcIjtcblxubGV0IGNhcHRjaGFMb2dpblRva2VuID0gbnVsbDsgLy8gVG8gc3RvcmUgdGhlIGNhcHRjaGEgdG9rZW4gZm9yIGxvZ2luXG5sZXQgdHVybnN0aWxlTG9naW5XaWRnZXRJZCA9IG51bGw7IC8vIFRvIHN0b3JlIFR1cm5zdGlsZSB3aWRnZXQgSUQgZm9yIGxvZ2luXG5cbi8vIFRoaXMgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgYnkgdGhlIENsb3VkZmxhcmUgVHVybnN0aWxlIHNjcmlwdCBvbmNlIGl0J3MgbG9hZGVkXG4vLyAoZHVlIHRvICZvbmxvYWQ9b25sb2FkVHVybnN0aWxlTG9naW5DYWxsYmFjayBpbiB0aGUgc2NyaXB0IHRhZyBpbiBsb2dpbi5odG1sKVxud2luZG93Lm9ubG9hZFR1cm5zdGlsZUxvZ2luQ2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7XG4gIGNvbnNvbGUubG9nKFxuICAgIFwiVHVybnN0aWxlIExvZ2luIEFQSSByZWFkeSAob25sb2FkVHVybnN0aWxlTG9naW5DYWxsYmFjayBleGVjdXRlZCkuXCJcbiAgKTtcbiAgY29uc3QgdHVybnN0aWxlQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXG4gICAgXCJ0dXJuc3RpbGUtbG9naW4tY29udGFpbmVyXCJcbiAgKTtcblxuICBpZiAodHVybnN0aWxlQ29udGFpbmVyICYmIHdpbmRvdy50dXJuc3RpbGUgJiYgIXR1cm5zdGlsZUxvZ2luV2lkZ2V0SWQpIHtcbiAgICBjb25zb2xlLmxvZyhcIlJlbmRlcmluZyBUdXJuc3RpbGUgd2lkZ2V0IGZvciBsb2dpbi4uLlwiKTtcbiAgICB0cnkge1xuICAgICAgdHVybnN0aWxlTG9naW5XaWRnZXRJZCA9IHdpbmRvdy50dXJuc3RpbGUucmVuZGVyKHR1cm5zdGlsZUNvbnRhaW5lciwge1xuICAgICAgICBzaXRla2V5OiBcIjB4NEFBQUFBQUJkelkzSW5PVTJfSW45OVwiLFxuICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24gKHRva2VuKSB7XG4gICAgICAgICAgY2FwdGNoYUxvZ2luVG9rZW4gPSB0b2tlbjtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIlR1cm5zdGlsZSBsb2dpbiB0b2tlbiBvYnRhaW5lZDpcIiwgdG9rZW4pO1xuICAgICAgICB9LFxuICAgICAgICBcImV4cGlyZWQtY2FsbGJhY2tcIjogKCkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgXCJUdXJuc3RpbGUgbG9naW4gdG9rZW4gZXhwaXJlZC4gUmVzZXR0aW5nIHdpZGdldC4gSUQ6XCIsXG4gICAgICAgICAgICB0dXJuc3RpbGVMb2dpbldpZGdldElkXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAod2luZG93LnR1cm5zdGlsZSAmJiB0dXJuc3RpbGVMb2dpbldpZGdldElkKSB7XG4gICAgICAgICAgICB3aW5kb3cudHVybnN0aWxlLnJlc2V0KHR1cm5zdGlsZUxvZ2luV2lkZ2V0SWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjYXB0Y2hhTG9naW5Ub2tlbiA9IG51bGw7IC8vIENsZWFyIHRoZSB0b2tlblxuICAgICAgICB9LFxuICAgICAgICBcImVycm9yLWNhbGxiYWNrXCI6IChlcnIpID0+IHtcbiAgICAgICAgICBjYXB0Y2hhTG9naW5Ub2tlbiA9IG51bGw7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIlR1cm5zdGlsZSBsb2dpbiBlcnJvciBjYWxsYmFjazpcIiwgZXJyKTtcbiAgICAgICAgICBzaG93RXJyb3IoYEVycmV1ciBDQVBUQ0hBIChsb2dpbik6ICR7ZXJyfS4gVmV1aWxsZXogcsOpZXNzYXllci5gKTtcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgICAgaWYgKHR1cm5zdGlsZUxvZ2luV2lkZ2V0SWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICAgIFwiVHVybnN0aWxlLnJlbmRlciAobG9naW4pIGRpZCBub3QgcmV0dXJuIGEgd2lkZ2V0SWQuIFNpdGVrZXkgb3IgY29udGFpbmVyIGlzc3VlP1wiXG4gICAgICAgICk7XG4gICAgICAgIHNob3dFcnJvcihcbiAgICAgICAgICBcIkVycmV1ciBpbml0aWFsaXNhdGlvbiBDQVBUQ0hBIChsb2dpbiwgSUQgd2lkZ2V0IG5vbiByZXRvdXJuw6kpLlwiXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICBcIlR1cm5zdGlsZSBsb2dpbiB3aWRnZXQgcmVuZGVyZWQuIElEOlwiLFxuICAgICAgICAgIHR1cm5zdGlsZUxvZ2luV2lkZ2V0SWRcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmVuZGVyaW5nIFR1cm5zdGlsZSBmb3IgbG9naW46XCIsIGUpO1xuICAgICAgc2hvd0Vycm9yKFwiSW1wb3NzaWJsZSBkJ2FmZmljaGVyIGxlIENBUFRDSEEgKGxvZ2luKS5cIik7XG4gICAgfVxuICB9IGVsc2UgaWYgKCF0dXJuc3RpbGVDb250YWluZXIpIHtcbiAgICBjb25zb2xlLmVycm9yKFxuICAgICAgXCJvbmxvYWRUdXJuc3RpbGVMb2dpbkNhbGxiYWNrOiAjdHVybnN0aWxlLWxvZ2luLWNvbnRhaW5lciBub3QgZm91bmQuXCJcbiAgICApO1xuICB9IGVsc2UgaWYgKCF3aW5kb3cudHVybnN0aWxlKSB7XG4gICAgY29uc29sZS5lcnJvcihcbiAgICAgIFwib25sb2FkVHVybnN0aWxlTG9naW5DYWxsYmFjazogd2luZG93LnR1cm5zdGlsZSBBUEkgbm90IGZvdW5kLlwiXG4gICAgKTtcbiAgfSBlbHNlIGlmICh0dXJuc3RpbGVMb2dpbldpZGdldElkKSB7XG4gICAgY29uc29sZS5sb2coXG4gICAgICBcIm9ubG9hZFR1cm5zdGlsZUxvZ2luQ2FsbGJhY2s6IExvZ2luIHdpZGdldCBhbHJlYWR5IHNlZW1zIHJlbmRlcmVkLlwiXG4gICAgKTtcbiAgfVxufTtcblxuLyoqXG4gKiBJbml0aWFsaXplcyB0aGUgbG9naW4gcGFnZVxuICovXG5leHBvcnQgZnVuY3Rpb24gaW5pdExvZ2luUGFnZSgpIHtcbiAgY29uc3QgbG9naW5Gb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJsb2dpbkZvcm1cIik7XG4gIGNvbnN0IGVycm9yTWVzc2FnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZXJyb3JNZXNzYWdlXCIpO1xuICBjb25zdCB0b2dnbGVQYXNzd29yZEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidG9nZ2xlUGFzc3dvcmRcIik7XG4gIGNvbnN0IHBhc3N3b3JkSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInBhc3N3b3JkXCIpO1xuICBjb25zdCBnb29nbGVTaWduSW5CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImdvb2dsZVNpZ25JbkJ0blwiKTtcblxuICAvLyBTZXQgdXAgcGFzc3dvcmQgdmlzaWJpbGl0eSB0b2dnbGVcbiAgaWYgKHRvZ2dsZVBhc3N3b3JkQnRuICYmIHBhc3N3b3JkSW5wdXQpIHtcbiAgICB0b2dnbGVQYXNzd29yZEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgdHlwZSA9XG4gICAgICAgIHBhc3N3b3JkSW5wdXQuZ2V0QXR0cmlidXRlKFwidHlwZVwiKSA9PT0gXCJwYXNzd29yZFwiID8gXCJ0ZXh0XCIgOiBcInBhc3N3b3JkXCI7XG4gICAgICBwYXNzd29yZElucHV0LnNldEF0dHJpYnV0ZShcInR5cGVcIiwgdHlwZSk7XG5cbiAgICAgIC8vIFRvZ2dsZSBpY29uXG4gICAgICBjb25zdCBpY29uRWxlbWVudCA9IHRvZ2dsZVBhc3N3b3JkQnRuLnF1ZXJ5U2VsZWN0b3IoXCJpXCIpO1xuICAgICAgaWYgKHR5cGUgPT09IFwicGFzc3dvcmRcIikge1xuICAgICAgICBpY29uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiYmktZXllXCIpO1xuICAgICAgICBpY29uRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiYmktZXllLXNsYXNoXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWNvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImJpLWV5ZS1zbGFzaFwiKTtcbiAgICAgICAgaWNvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImJpLWV5ZVwiKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGlmIChsb2dpbkZvcm0pIHtcbiAgICBsb2dpbkZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBhc3luYyAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAvLyBSZXNldCBtZXNzYWdlc1xuICAgICAgaWYgKGVycm9yTWVzc2FnZSkge1xuICAgICAgICBlcnJvck1lc3NhZ2UuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgICAgZXJyb3JNZXNzYWdlLnRleHRDb250ZW50ID0gXCJcIjtcbiAgICAgIH1cbiAgICAgIC8vIEVuc3VyZSBzdGF0dXMgbWVzc2FnZSBpcyBhbHNvIGhpZGRlbiBvbiBuZXcgc3VibWl0XG4gICAgICBjb25zdCBzdGF0dXNNZXNzYWdlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3RhdHVzTWVzc2FnZVwiKTtcbiAgICAgIGlmIChzdGF0dXNNZXNzYWdlRWxlbWVudCkge1xuICAgICAgICBzdGF0dXNNZXNzYWdlRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICAgICAgICBzdGF0dXNNZXNzYWdlRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XG4gICAgICB9XG5cbiAgICAgIC8vIEdldCBmb3JtIHZhbHVlc1xuICAgICAgY29uc3QgZW1haWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImVtYWlsXCIpLnZhbHVlO1xuICAgICAgY29uc3QgcGFzc3dvcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInBhc3N3b3JkXCIpLnZhbHVlO1xuXG4gICAgICAvLyBCYXNpYyB2YWxpZGF0aW9uXG4gICAgICBpZiAoIWVtYWlsIHx8ICFwYXNzd29yZCkge1xuICAgICAgICBzaG93RXJyb3IoXCJWZXVpbGxleiByZW1wbGlyIHRvdXMgbGVzIGNoYW1wcy5cIik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKCFjYXB0Y2hhTG9naW5Ub2tlbikge1xuICAgICAgICBzaG93RXJyb3IoXCJWZXVpbGxleiBjb21wbMOpdGVyIGxlIENBUFRDSEEuXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIFNob3cgbG9hZGluZyBzdGF0ZVxuICAgICAgc2hvd0xvYWRpbmcoXCJsb2dpbkJ0blwiLCBcImxvZ2luU3Bpbm5lclwiKTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gQ2FsbCBsb2dpbiBmdW5jdGlvblxuICAgICAgICBhd2FpdCBsb2dpbihlbWFpbCwgcGFzc3dvcmQpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkxvZ2luIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHNob3dFcnJvcihcbiAgICAgICAgICBlcnJvci5tZXNzYWdlIHx8IFwiTGEgY29ubmV4aW9uIGEgw6ljaG91w6kuIFbDqXJpZmlleiB2b3MgaWRlbnRpZmlhbnRzLlwiXG4gICAgICAgICk7XG4gICAgICB9IGZpbmFsbHkge1xuICAgICAgICAvLyBSZXNldCBidXR0b24gc3RhdGVcbiAgICAgICAgaGlkZUxvYWRpbmcoXCJsb2dpbkJ0blwiLCBcImxvZ2luU3Bpbm5lclwiKTtcbiAgICAgICAgaWYgKHdpbmRvdy50dXJuc3RpbGUgJiYgdHVybnN0aWxlTG9naW5XaWRnZXRJZCkge1xuICAgICAgICAgIHdpbmRvdy50dXJuc3RpbGUucmVzZXQodHVybnN0aWxlTG9naW5XaWRnZXRJZCk7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJUdXJuc3RpbGUgbG9naW4gd2lkZ2V0IGhhcyBiZWVuIHJlc2V0LlwiKTtcbiAgICAgICAgfVxuICAgICAgICBjYXB0Y2hhTG9naW5Ub2tlbiA9IG51bGw7IC8vIENsZWFyIHRva2VuIGFmdGVyIHVzZVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLy8gRXZlbnQgbGlzdGVuZXIgZm9yIEdvb2dsZSBTaWduLUluIGJ1dHRvblxuICBpZiAoZ29vZ2xlU2lnbkluQnRuKSB7XG4gICAgZ29vZ2xlU2lnbkluQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBzaG93TG9hZGluZyhcImdvb2dsZVNpZ25JbkJ0blwiLCBcImdvb2dsZVNpZ25JblNwaW5uZXJcIik7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLnNpZ25JbldpdGhPQXV0aCh7XG4gICAgICAgICAgcHJvdmlkZXI6IFwiZ29vZ2xlXCIsXG4gICAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgLy8gT3B0aW9uYWw6IHJlZGlyZWN0VG8gY2FuIGJlIHVzZWQgdG8gc3BlY2lmeSB3aGVyZSB1c2VycyBhcmUgc2VudCBhZnRlciBzaWduLWluLlxuICAgICAgICAgICAgLy8gcmVkaXJlY3RUbzogYCR7d2luZG93LmxvY2F0aW9uLm9yaWdpbn0vcHJvZmlsZS5odG1sYFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2lnbmluZyBpbiB3aXRoIEdvb2dsZTpcIiwgZXJyb3IpO1xuICAgICAgICAgIHNob3dFcnJvcihcbiAgICAgICAgICAgIGVycm9yLm1lc3NhZ2UgfHwgXCJFcnJldXIgbG9ycyBkZSBsYSBjb25uZXhpb24gYXZlYyBHb29nbGUuXCJcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIC8vIE9uIHN1Y2Nlc3MsIFN1cGFiYXNlIGhhbmRsZXMgdGhlIHJlZGlyZWN0LlxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkV4Y2VwdGlvbiBkdXJpbmcgR29vZ2xlIHNpZ24taW46XCIsIGVycm9yKTtcbiAgICAgICAgc2hvd0Vycm9yKFxuICAgICAgICAgIFwiVW5lIGV4Y2VwdGlvbiBlc3Qgc3VydmVudWUgbG9ycyBkZSBsYSBjb25uZXhpb24gYXZlYyBHb29nbGUuXCJcbiAgICAgICAgKTtcbiAgICAgIH0gZmluYWxseSB7XG4gICAgICAgIGhpZGVMb2FkaW5nKFwiZ29vZ2xlU2lnbkluQnRuXCIsIFwiZ29vZ2xlU2lnbkluU3Bpbm5lclwiKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLndhcm4oXCJHb29nbGUgU2lnbi1JbiBidXR0b24gKGdvb2dsZVNpZ25JbkJ0bikgbm90IGZvdW5kLlwiKTtcbiAgfVxufVxuXG4vKipcbiAqIExvZ3MgaW4gYSB1c2VyIHdpdGggZW1haWwgYW5kIHBhc3N3b3JkIGRpcmVjdGx5IHdpdGggU3VwYWJhc2VcbiAqIEBwYXJhbSB7c3RyaW5nfSBlbWFpbCAtIFVzZXIncyBlbWFpbFxuICogQHBhcmFtIHtzdHJpbmd9IHBhc3N3b3JkIC0gVXNlcidzIHBhc3N3b3JkXG4gKiBAcmV0dXJucyB7UHJvbWlzZX0gLSBQcm9taXNlIHJlc29sdmVkIHdpdGggdGhlIHVzZXIgZGF0YSBvbiBzdWNjZXNzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dpbihlbWFpbCwgcGFzc3dvcmQpIHtcbiAgdHJ5IHtcbiAgICAvLyBDYWxsIFN1cGFiYXNlIGF1dGhlbnRpY2F0aW9uIGRpcmVjdGx5XG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5zaWduSW5XaXRoUGFzc3dvcmQoe1xuICAgICAgZW1haWwsXG4gICAgICBwYXNzd29yZCxcbiAgICAgIG9wdGlvbnM6IHsgY2FwdGNoYVRva2VuOiBjYXB0Y2hhTG9naW5Ub2tlbiB9LCAvLyBQYXNzIGNhcHRjaGEgdG9rZW5cbiAgICB9KTtcblxuICAgIC8vIENoZWNrIGZvciBlcnJvcnNcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIC8vIEhhbmRsZSBzcGVjaWZpYyBlcnJvciBjYXNlc1xuICAgICAgaWYgKGVycm9yLm1lc3NhZ2UudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhcImVtYWlsIG5vdCBjb25maXJtZWRcIikpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIFwiVm90cmUgZW1haWwgbidhIHBhcyDDqXTDqSBjb25maXJtw6kuIFZldWlsbGV6IHbDqXJpZmllciB2b3RyZSBib8OudGUgZGUgcsOpY2VwdGlvbi5cIlxuICAgICAgICApO1xuICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgZXJyb3IubWVzc2FnZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwiaW52YWxpZCBsb2dpbiBjcmVkZW50aWFsc1wiKVxuICAgICAgKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkVtYWlsIG91IG1vdCBkZSBwYXNzZSBpbmNvcnJlY3QuXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yLm1lc3NhZ2UpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIE5vIHNlc3Npb24gZGF0YVxuICAgIGlmICghZGF0YS5zZXNzaW9uKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICBcIkxvZ2luIGVycm9yOiBNaXNzaW5nIHNlc3Npb24gZGF0YSBmcm9tIFN1cGFiYXNlIHJlc3BvbnNlXCIsXG4gICAgICAgIGRhdGFcbiAgICAgICk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEb25uw6llcyBkZSBzZXNzaW9uIG1hbnF1YW50ZXMgYXByw6hzIGxhIGNvbm5leGlvbi5cIik7XG4gICAgfVxuXG4gICAgLy8gU2F2ZSB1c2VyIGRhdGEgbG9jYWxseSBpZiBuZWVkZWRcbiAgICBpZiAoZGF0YS51c2VyKSB7XG4gICAgICBzZXRDdXJyZW50VXNlcihkYXRhLnVzZXIpO1xuICAgICAgY29uc29sZS5sb2coXCJbbG9naW4uanNdIFVzZXIgZGF0YSBzYXZlZCBsb2NhbGx5XCIpO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGlmIGFjY291bnQgaXMgc2NoZWR1bGVkIGZvciBkZWxldGlvblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFxuICAgICAgICBgJHtzdXBhYmFzZS5zdXBhYmFzZVVybH0vZnVuY3Rpb25zL3YxL2FjY291bnQtbWFuYWdlbWVudGAsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2RhdGEuc2Vzc2lvbi5hY2Nlc3NfdG9rZW59YCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgIGFjdGlvbjogXCJzdGF0dXNcIixcbiAgICAgICAgICB9KSxcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MgJiYgcmVzdWx0LmRhdGEuZGVsZXRpb25fc2NoZWR1bGVkKSB7XG4gICAgICAgIC8vIEFjY291bnQgaXMgc2NoZWR1bGVkIGZvciBkZWxldGlvbiwgcmVkaXJlY3QgdG8gZGVsZXRpb24gc3RhdHVzIHBhZ2VcbiAgICAgICAgc2hvd1N0YXR1cyhcbiAgICAgICAgICBcIkNvbm5leGlvbiByw6l1c3NpZSEgUmVkaXJlY3Rpb24gdmVycyBsZSBzdGF0dXQgZGUgc3VwcHJlc3Npb24uLi5cIixcbiAgICAgICAgICBcImluZm9cIlxuICAgICAgICApO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IFwiL3VzZXIvYWNjb3VudC1kZWxldGlvbi1zdGF0dXNcIjtcbiAgICAgICAgfSwgMTAwMCk7XG4gICAgICAgIHJldHVybiBkYXRhLnVzZXI7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZGVsZXRpb25DaGVja0Vycm9yKSB7XG4gICAgICAvLyBJZiBkZWxldGlvbiBjaGVjayBmYWlscywgY29udGludWUgd2l0aCBub3JtYWwgbG9naW4gZmxvd1xuICAgICAgY29uc29sZS53YXJuKFwiQ291bGQgbm90IGNoZWNrIGRlbGV0aW9uIHN0YXR1czpcIiwgZGVsZXRpb25DaGVja0Vycm9yKTtcbiAgICB9XG5cbiAgICAvLyBTaG93IHN1Y2Nlc3MgbWVzc2FnZSBiZWZvcmUgcmVkaXJlY3RcbiAgICBzaG93U3RhdHVzKFwiQ29ubmV4aW9uIHLDqXVzc2llISBSZWRpcmVjdGlvbi4uLlwiLCBcInN1Y2Nlc3NcIik7XG5cbiAgICAvLyBSZWRpcmVjdCB0byBob21lIHBhZ2UgYWZ0ZXIgYSBzaG9ydCBkZWxheVxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcIi9cIjtcbiAgICB9LCA1MDApO1xuXG4gICAgcmV0dXJuIGRhdGEudXNlcjtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAvLyBMb2cgYW5kIHJlLXRocm93IHRoZSBlcnJvciB0byBiZSBoYW5kbGVkIGJ5IHRoZSBjYWxsZXJcbiAgICBjb25zb2xlLmVycm9yKFwiTG9naW4gZXJyb3I6XCIsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCB7XG4gIGluaXRMb2dpblBhZ2UsXG4gIGxvZ2luLFxufTtcbiIsIi8vIHNyYy9lbnRyaWVzL3NpZ251cC5qc1xuLyoqXG4gKiBMb2dpbiBFbnRyeSBQb2ludFxuICpcbiAqIFRoaXMgbW9kdWxlIHNlcnZlcyBhcyB0aGUgZW50cnkgcG9pbnQgZm9yIHRoZSBsb2dpbiBwYWdlLlxuICovXG5cbi8vIEltcG9ydCBvdXIgbG9naW4gbW9kdWxlXG5pbXBvcnQgeyBpbml0TG9naW5QYWdlIH0gZnJvbSBcIi4uL2F1dGgvbG9naW4uanNcIjtcblxuLy8gSW5pdGlhbGl6ZSBsb2dpbiBwYWdlIHdoZW4gRE9NIGlzIGxvYWRlZFxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgKCkgPT4ge1xuICAvLyBJbml0aWFsaXplIGxvZ2luIHBhZ2VcbiAgaW5pdExvZ2luUGFnZSgpO1xuXG4gIGNvbnNvbGUubG9nKFwiTG9naW4gcGFnZSBpbml0aWFsaXplZFwiKTtcbn0pO1xuIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbi8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG5fX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBfX3dlYnBhY2tfbW9kdWxlc19fO1xuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLmYgPSB7fTtcbi8vIFRoaXMgZmlsZSBjb250YWlucyBvbmx5IHRoZSBlbnRyeSBjaHVuay5cbi8vIFRoZSBjaHVuayBsb2FkaW5nIGZ1bmN0aW9uIGZvciBhZGRpdGlvbmFsIGNodW5rc1xuX193ZWJwYWNrX3JlcXVpcmVfXy5lID0gKGNodW5rSWQpID0+IHtcblx0cmV0dXJuIFByb21pc2UuYWxsKE9iamVjdC5rZXlzKF9fd2VicGFja19yZXF1aXJlX18uZikucmVkdWNlKChwcm9taXNlcywga2V5KSA9PiB7XG5cdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5mW2tleV0oY2h1bmtJZCwgcHJvbWlzZXMpO1xuXHRcdHJldHVybiBwcm9taXNlcztcblx0fSwgW10pKTtcbn07IiwiLy8gVGhpcyBmdW5jdGlvbiBhbGxvdyB0byByZWZlcmVuY2UgYXN5bmMgY2h1bmtzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnUgPSAoY2h1bmtJZCkgPT4ge1xuXHQvLyByZXR1cm4gdXJsIGZvciBmaWxlbmFtZXMgYmFzZWQgb24gdGVtcGxhdGVcblx0cmV0dXJuIFwianMvXCIgKyBjaHVua0lkICsgXCIuYnVuZGxlLmpzXCI7XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18uZyA9IChmdW5jdGlvbigpIHtcblx0aWYgKHR5cGVvZiBnbG9iYWxUaGlzID09PSAnb2JqZWN0JykgcmV0dXJuIGdsb2JhbFRoaXM7XG5cdHRyeSB7XG5cdFx0cmV0dXJuIHRoaXMgfHwgbmV3IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7XG5cdH0gY2F0Y2ggKGUpIHtcblx0XHRpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcpIHJldHVybiB3aW5kb3c7XG5cdH1cbn0pKCk7IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18uaiA9IDk2NjsiLCJ2YXIgc2NyaXB0VXJsO1xuaWYgKF9fd2VicGFja19yZXF1aXJlX18uZy5pbXBvcnRTY3JpcHRzKSBzY3JpcHRVcmwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLmcubG9jYXRpb24gKyBcIlwiO1xudmFyIGRvY3VtZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXy5nLmRvY3VtZW50O1xuaWYgKCFzY3JpcHRVcmwgJiYgZG9jdW1lbnQpIHtcblx0aWYgKGRvY3VtZW50LmN1cnJlbnRTY3JpcHQgJiYgZG9jdW1lbnQuY3VycmVudFNjcmlwdC50YWdOYW1lLnRvVXBwZXJDYXNlKCkgPT09ICdTQ1JJUFQnKVxuXHRcdHNjcmlwdFVybCA9IGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuc3JjO1xuXHRpZiAoIXNjcmlwdFVybCkge1xuXHRcdHZhciBzY3JpcHRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIik7XG5cdFx0aWYoc2NyaXB0cy5sZW5ndGgpIHtcblx0XHRcdHZhciBpID0gc2NyaXB0cy5sZW5ndGggLSAxO1xuXHRcdFx0d2hpbGUgKGkgPiAtMSAmJiAoIXNjcmlwdFVybCB8fCAhL15odHRwKHM/KTovLnRlc3Qoc2NyaXB0VXJsKSkpIHNjcmlwdFVybCA9IHNjcmlwdHNbaS0tXS5zcmM7XG5cdFx0fVxuXHR9XG59XG4vLyBXaGVuIHN1cHBvcnRpbmcgYnJvd3NlcnMgd2hlcmUgYW4gYXV0b21hdGljIHB1YmxpY1BhdGggaXMgbm90IHN1cHBvcnRlZCB5b3UgbXVzdCBzcGVjaWZ5IGFuIG91dHB1dC5wdWJsaWNQYXRoIG1hbnVhbGx5IHZpYSBjb25maWd1cmF0aW9uXG4vLyBvciBwYXNzIGFuIGVtcHR5IHN0cmluZyAoXCJcIikgYW5kIHNldCB0aGUgX193ZWJwYWNrX3B1YmxpY19wYXRoX18gdmFyaWFibGUgZnJvbSB5b3VyIGNvZGUgdG8gdXNlIHlvdXIgb3duIGxvZ2ljLlxuaWYgKCFzY3JpcHRVcmwpIHRocm93IG5ldyBFcnJvcihcIkF1dG9tYXRpYyBwdWJsaWNQYXRoIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhpcyBicm93c2VyXCIpO1xuc2NyaXB0VXJsID0gc2NyaXB0VXJsLnJlcGxhY2UoL15ibG9iOi8sIFwiXCIpLnJlcGxhY2UoLyMuKiQvLCBcIlwiKS5yZXBsYWNlKC9cXD8uKiQvLCBcIlwiKS5yZXBsYWNlKC9cXC9bXlxcL10rJC8sIFwiL1wiKTtcbl9fd2VicGFja19yZXF1aXJlX18ucCA9IHNjcmlwdFVybCArIFwiLi4vXCI7IiwiLy8gbm8gYmFzZVVSSVxuXG4vLyBvYmplY3QgdG8gc3RvcmUgbG9hZGVkIGFuZCBsb2FkaW5nIGNodW5rc1xuLy8gdW5kZWZpbmVkID0gY2h1bmsgbm90IGxvYWRlZCwgbnVsbCA9IGNodW5rIHByZWxvYWRlZC9wcmVmZXRjaGVkXG4vLyBbcmVzb2x2ZSwgcmVqZWN0LCBQcm9taXNlXSA9IGNodW5rIGxvYWRpbmcsIDAgPSBjaHVuayBsb2FkZWRcbnZhciBpbnN0YWxsZWRDaHVua3MgPSB7XG5cdDk2NjogMFxufTtcblxuX193ZWJwYWNrX3JlcXVpcmVfXy5mLmogPSAoY2h1bmtJZCwgcHJvbWlzZXMpID0+IHtcblx0XHQvLyBKU09OUCBjaHVuayBsb2FkaW5nIGZvciBqYXZhc2NyaXB0XG5cdFx0dmFyIGluc3RhbGxlZENodW5rRGF0YSA9IF9fd2VicGFja19yZXF1aXJlX18ubyhpbnN0YWxsZWRDaHVua3MsIGNodW5rSWQpID8gaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdIDogdW5kZWZpbmVkO1xuXHRcdGlmKGluc3RhbGxlZENodW5rRGF0YSAhPT0gMCkgeyAvLyAwIG1lYW5zIFwiYWxyZWFkeSBpbnN0YWxsZWRcIi5cblxuXHRcdFx0Ly8gYSBQcm9taXNlIG1lYW5zIFwiY3VycmVudGx5IGxvYWRpbmdcIi5cblx0XHRcdGlmKGluc3RhbGxlZENodW5rRGF0YSkge1xuXHRcdFx0XHRwcm9taXNlcy5wdXNoKGluc3RhbGxlZENodW5rRGF0YVsyXSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZih0cnVlKSB7IC8vIGFsbCBjaHVua3MgaGF2ZSBKU1xuXHRcdFx0XHRcdC8vIHNldHVwIFByb21pc2UgaW4gY2h1bmsgY2FjaGVcblx0XHRcdFx0XHR2YXIgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IChpbnN0YWxsZWRDaHVua0RhdGEgPSBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gPSBbcmVzb2x2ZSwgcmVqZWN0XSkpO1xuXHRcdFx0XHRcdHByb21pc2VzLnB1c2goaW5zdGFsbGVkQ2h1bmtEYXRhWzJdID0gcHJvbWlzZSk7XG5cblx0XHRcdFx0XHQvLyBzdGFydCBjaHVuayBsb2FkaW5nXG5cdFx0XHRcdFx0dmFyIHVybCA9IF9fd2VicGFja19yZXF1aXJlX18ucCArIF9fd2VicGFja19yZXF1aXJlX18udShjaHVua0lkKTtcblx0XHRcdFx0XHQvLyBjcmVhdGUgZXJyb3IgYmVmb3JlIHN0YWNrIHVud291bmQgdG8gZ2V0IHVzZWZ1bCBzdGFja3RyYWNlIGxhdGVyXG5cdFx0XHRcdFx0dmFyIGVycm9yID0gbmV3IEVycm9yKCk7XG5cdFx0XHRcdFx0dmFyIGxvYWRpbmdFbmRlZCA9IChldmVudCkgPT4ge1xuXHRcdFx0XHRcdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGluc3RhbGxlZENodW5rcywgY2h1bmtJZCkpIHtcblx0XHRcdFx0XHRcdFx0aW5zdGFsbGVkQ2h1bmtEYXRhID0gaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdO1xuXHRcdFx0XHRcdFx0XHRpZihpbnN0YWxsZWRDaHVua0RhdGEgIT09IDApIGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA9IHVuZGVmaW5lZDtcblx0XHRcdFx0XHRcdFx0aWYoaW5zdGFsbGVkQ2h1bmtEYXRhKSB7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIGVycm9yVHlwZSA9IGV2ZW50ICYmIChldmVudC50eXBlID09PSAnbG9hZCcgPyAnbWlzc2luZycgOiBldmVudC50eXBlKTtcblx0XHRcdFx0XHRcdFx0XHR2YXIgcmVhbFNyYyA9IGV2ZW50ICYmIGV2ZW50LnRhcmdldCAmJiBldmVudC50YXJnZXQuc3JjO1xuXHRcdFx0XHRcdFx0XHRcdGVycm9yLm1lc3NhZ2UgPSAnTG9hZGluZyBjaHVuayAnICsgY2h1bmtJZCArICcgZmFpbGVkLlxcbignICsgZXJyb3JUeXBlICsgJzogJyArIHJlYWxTcmMgKyAnKSc7XG5cdFx0XHRcdFx0XHRcdFx0ZXJyb3IubmFtZSA9ICdDaHVua0xvYWRFcnJvcic7XG5cdFx0XHRcdFx0XHRcdFx0ZXJyb3IudHlwZSA9IGVycm9yVHlwZTtcblx0XHRcdFx0XHRcdFx0XHRlcnJvci5yZXF1ZXN0ID0gcmVhbFNyYztcblx0XHRcdFx0XHRcdFx0XHRpbnN0YWxsZWRDaHVua0RhdGFbMV0oZXJyb3IpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmwodXJsLCBsb2FkaW5nRW5kZWQsIFwiY2h1bmstXCIgKyBjaHVua0lkLCBjaHVua0lkKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cbn07XG5cbi8vIG5vIHByZWZldGNoaW5nXG5cbi8vIG5vIHByZWxvYWRlZFxuXG4vLyBubyBITVJcblxuLy8gbm8gSE1SIG1hbmlmZXN0XG5cbl9fd2VicGFja19yZXF1aXJlX18uTy5qID0gKGNodW5rSWQpID0+IChpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gPT09IDApO1xuXG4vLyBpbnN0YWxsIGEgSlNPTlAgY2FsbGJhY2sgZm9yIGNodW5rIGxvYWRpbmdcbnZhciB3ZWJwYWNrSnNvbnBDYWxsYmFjayA9IChwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbiwgZGF0YSkgPT4ge1xuXHR2YXIgW2NodW5rSWRzLCBtb3JlTW9kdWxlcywgcnVudGltZV0gPSBkYXRhO1xuXHQvLyBhZGQgXCJtb3JlTW9kdWxlc1wiIHRvIHRoZSBtb2R1bGVzIG9iamVjdCxcblx0Ly8gdGhlbiBmbGFnIGFsbCBcImNodW5rSWRzXCIgYXMgbG9hZGVkIGFuZCBmaXJlIGNhbGxiYWNrXG5cdHZhciBtb2R1bGVJZCwgY2h1bmtJZCwgaSA9IDA7XG5cdGlmKGNodW5rSWRzLnNvbWUoKGlkKSA9PiAoaW5zdGFsbGVkQ2h1bmtzW2lkXSAhPT0gMCkpKSB7XG5cdFx0Zm9yKG1vZHVsZUlkIGluIG1vcmVNb2R1bGVzKSB7XG5cdFx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8obW9yZU1vZHVsZXMsIG1vZHVsZUlkKSkge1xuXHRcdFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLm1bbW9kdWxlSWRdID0gbW9yZU1vZHVsZXNbbW9kdWxlSWRdO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZihydW50aW1lKSB2YXIgcmVzdWx0ID0gcnVudGltZShfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblx0fVxuXHRpZihwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbikgcGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24oZGF0YSk7XG5cdGZvcig7aSA8IGNodW5rSWRzLmxlbmd0aDsgaSsrKSB7XG5cdFx0Y2h1bmtJZCA9IGNodW5rSWRzW2ldO1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhpbnN0YWxsZWRDaHVua3MsIGNodW5rSWQpICYmIGluc3RhbGxlZENodW5rc1tjaHVua0lkXSkge1xuXHRcdFx0aW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdWzBdKCk7XG5cdFx0fVxuXHRcdGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA9IDA7XG5cdH1cblx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18uTyhyZXN1bHQpO1xufVxuXG52YXIgY2h1bmtMb2FkaW5nR2xvYmFsID0gc2VsZltcIndlYnBhY2tDaHVua3VyYmFuZG9jc193ZWJhcHBcIl0gPSBzZWxmW1wid2VicGFja0NodW5rdXJiYW5kb2NzX3dlYmFwcFwiXSB8fCBbXTtcbmNodW5rTG9hZGluZ0dsb2JhbC5mb3JFYWNoKHdlYnBhY2tKc29ucENhbGxiYWNrLmJpbmQobnVsbCwgMCkpO1xuY2h1bmtMb2FkaW5nR2xvYmFsLnB1c2ggPSB3ZWJwYWNrSnNvbnBDYWxsYmFjay5iaW5kKG51bGwsIGNodW5rTG9hZGluZ0dsb2JhbC5wdXNoLmJpbmQoY2h1bmtMb2FkaW5nR2xvYmFsKSk7IiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vLyBUaGlzIGVudHJ5IG1vZHVsZSBkZXBlbmRzIG9uIG90aGVyIGxvYWRlZCBjaHVua3MgYW5kIGV4ZWN1dGlvbiBuZWVkIHRvIGJlIGRlbGF5ZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXy5PKHVuZGVmaW5lZCwgWzc2XSwgKCkgPT4gKF9fd2VicGFja19yZXF1aXJlX18oNjU0MikpKVxuX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18uTyhfX3dlYnBhY2tfZXhwb3J0c19fKTtcbiJdLCJuYW1lcyI6WyJkZWZlcnJlZCIsImxlYWZQcm90b3R5cGVzIiwiZ2V0UHJvdG8iLCJpblByb2dyZXNzIiwiZGF0YVdlYnBhY2tQcmVmaXgiLCJjYXB0Y2hhTG9naW5Ub2tlbiIsInR1cm5zdGlsZUxvZ2luV2lkZ2V0SWQiLCJpbml0TG9naW5QYWdlIiwibG9naW5Gb3JtIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImVycm9yTWVzc2FnZSIsInRvZ2dsZVBhc3N3b3JkQnRuIiwicGFzc3dvcmRJbnB1dCIsImdvb2dsZVNpZ25JbkJ0biIsImFkZEV2ZW50TGlzdGVuZXIiLCJ0eXBlIiwiZ2V0QXR0cmlidXRlIiwic2V0QXR0cmlidXRlIiwiaWNvbkVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwiYWRkIiwiYXN5bmMiLCJlIiwicHJldmVudERlZmF1bHQiLCJ0ZXh0Q29udGVudCIsInN0YXR1c01lc3NhZ2VFbGVtZW50IiwiZW1haWwiLCJ2YWx1ZSIsInBhc3N3b3JkIiwiZGF0YSIsImVycm9yIiwiYXV0aCIsInNpZ25JbldpdGhQYXNzd29yZCIsIm9wdGlvbnMiLCJjYXB0Y2hhVG9rZW4iLCJtZXNzYWdlIiwidG9Mb3dlckNhc2UiLCJpbmNsdWRlcyIsIkVycm9yIiwic2Vzc2lvbiIsImNvbnNvbGUiLCJ1c2VyIiwibG9nIiwicmVzcG9uc2UiLCJmZXRjaCIsInN1cGFiYXNlVXJsIiwibWV0aG9kIiwiaGVhZGVycyIsIkF1dGhvcml6YXRpb24iLCJhY2Nlc3NfdG9rZW4iLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFjdGlvbiIsInJlc3VsdCIsImpzb24iLCJzdWNjZXNzIiwiZGVsZXRpb25fc2NoZWR1bGVkIiwic2V0VGltZW91dCIsIndpbmRvdyIsImxvY2F0aW9uIiwiaHJlZiIsImRlbGV0aW9uQ2hlY2tFcnJvciIsIndhcm4iLCJsb2dpbiIsInR1cm5zdGlsZSIsInJlc2V0Iiwic2lnbkluV2l0aE9BdXRoIiwicHJvdmlkZXIiLCJvbmxvYWRUdXJuc3RpbGVMb2dpbkNhbGxiYWNrIiwidHVybnN0aWxlQ29udGFpbmVyIiwicmVuZGVyIiwic2l0ZWtleSIsImNhbGxiYWNrIiwidG9rZW4iLCJlcnIiLCJ1bmRlZmluZWQiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsImNhbGwiLCJtIiwiTyIsImNodW5rSWRzIiwiZm4iLCJwcmlvcml0eSIsIm5vdEZ1bGZpbGxlZCIsIkluZmluaXR5IiwiaSIsImxlbmd0aCIsImZ1bGZpbGxlZCIsImoiLCJPYmplY3QiLCJrZXlzIiwiZXZlcnkiLCJrZXkiLCJzcGxpY2UiLCJyIiwiZ2V0UHJvdG90eXBlT2YiLCJvYmoiLCJ0IiwibW9kZSIsInRoaXMiLCJfX2VzTW9kdWxlIiwidGhlbiIsIm5zIiwiY3JlYXRlIiwiZGVmIiwiY3VycmVudCIsImluZGV4T2YiLCJnZXRPd25Qcm9wZXJ0eU5hbWVzIiwiZm9yRWFjaCIsImQiLCJkZWZpbml0aW9uIiwibyIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsImYiLCJjaHVua0lkIiwiUHJvbWlzZSIsImFsbCIsInJlZHVjZSIsInByb21pc2VzIiwidSIsImciLCJnbG9iYWxUaGlzIiwiRnVuY3Rpb24iLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJsIiwidXJsIiwiZG9uZSIsInB1c2giLCJzY3JpcHQiLCJuZWVkQXR0YWNoIiwic2NyaXB0cyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwicyIsImNyZWF0ZUVsZW1lbnQiLCJjaGFyc2V0IiwidGltZW91dCIsIm5jIiwic3JjIiwib25TY3JpcHRDb21wbGV0ZSIsInByZXYiLCJldmVudCIsIm9uZXJyb3IiLCJvbmxvYWQiLCJjbGVhclRpbWVvdXQiLCJkb25lRm5zIiwicGFyZW50Tm9kZSIsInJlbW92ZUNoaWxkIiwiYmluZCIsInRhcmdldCIsImhlYWQiLCJhcHBlbmRDaGlsZCIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwic2NyaXB0VXJsIiwiaW1wb3J0U2NyaXB0cyIsImN1cnJlbnRTY3JpcHQiLCJ0YWdOYW1lIiwidG9VcHBlckNhc2UiLCJ0ZXN0IiwicmVwbGFjZSIsInAiLCJpbnN0YWxsZWRDaHVua3MiLCJpbnN0YWxsZWRDaHVua0RhdGEiLCJwcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImVycm9yVHlwZSIsInJlYWxTcmMiLCJuYW1lIiwicmVxdWVzdCIsIndlYnBhY2tKc29ucENhbGxiYWNrIiwicGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24iLCJtb3JlTW9kdWxlcyIsInJ1bnRpbWUiLCJzb21lIiwiaWQiLCJjaHVua0xvYWRpbmdHbG9iYWwiLCJzZWxmIiwiX193ZWJwYWNrX2V4cG9ydHNfXyJdLCJzb3VyY2VSb290IjoiIn0=