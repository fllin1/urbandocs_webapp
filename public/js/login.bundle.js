(()=>{"use strict";var e,n,t,o,r,i={418:(e,n,t)=>{const o=(0,t(303).UU)("https://ofeyssipibktmbfebibo.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9mZXlzc2lwaWJrdG1iZmViaWJvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM5MjUwOTQsImV4cCI6MjA1OTUwMTA5NH0.w71CAKfolktzRl-TmLVhHYaEbhCfVk4A7YraEUCglrU");let r=null;function i(e,n="errorMessage"){const t=document.getElementById(n);t?(t.innerHTML=e,t.classList.remove("hidden")):console.error("Error element not found:",n)}function s(e,n){const t=document.getElementById(e),o=document.getElementById(n);t&&(t.disabled=!0),o&&o.classList.remove("hidden")}function l(e,n){const t=document.getElementById(e),o=document.getElementById(n);t&&(t.disabled=!1),o&&o.classList.add("hidden")}let a=null,c=null;function d(){const e=document.getElementById("loginForm"),n=document.getElementById("errorMessage"),t=document.getElementById("togglePassword"),d=document.getElementById("password"),u=document.getElementById("googleSignInBtn");t&&d&&t.addEventListener("click",(()=>{const e="password"===d.getAttribute("type")?"text":"password";d.setAttribute("type",e);const n=t.querySelector("i");"password"===e?(n.classList.remove("bi-eye"),n.classList.add("bi-eye-slash")):(n.classList.remove("bi-eye-slash"),n.classList.add("bi-eye"))})),e&&e.addEventListener("submit",(async e=>{e.preventDefault(),n&&(n.classList.add("hidden"),n.textContent="");const t=document.getElementById("statusMessage");t&&(t.classList.add("hidden"),t.textContent="");const d=document.getElementById("email").value,u=document.getElementById("password").value;if(d&&u)if(a){s("loginBtn","loginSpinner");try{await async function(e,n){try{const{data:i,error:s}=await o.auth.signInWithPassword({email:e,password:n,options:{captchaToken:a}});if(s)throw s.message.toLowerCase().includes("email not confirmed")?new Error("Votre email n'a pas été confirmé. Veuillez vérifier votre boîte de réception."):s.message.toLowerCase().includes("invalid login credentials")?new Error("Email ou mot de passe incorrect."):new Error(s.message);if(!i.session)throw console.error("Login error: Missing session data from Supabase response",i),new Error("Données de session manquantes après la connexion.");return i.user&&(t=i.user,r=t,t?localStorage.setItem("currentUser",JSON.stringify(t)):localStorage.removeItem("currentUser"),console.log("[login.js] User data saved locally")),function(e,n="info",t="statusMessage"){const o=document.getElementById(t);o?(o.textContent=e,o.classList.forEach((e=>{e.startsWith("alert-")&&o.classList.remove(e)})),o.classList.add(`alert-${n}`),o.classList.remove("hidden")):console.error("Status element not found:",t)}("Connexion réussie! Redirection...","success"),setTimeout((()=>{window.location.href="/"}),500),i.user}catch(e){throw console.error("Login error:",e),e}var t}(d,u)}catch(e){console.error("Login error:",e),i(e.message||"La connexion a échoué. Vérifiez vos identifiants.")}finally{l("loginBtn","loginSpinner"),window.turnstile&&c&&(window.turnstile.reset(c),console.log("Turnstile login widget has been reset.")),a=null}}else i("Veuillez compléter le CAPTCHA.");else i("Veuillez remplir tous les champs.")})),u?u.addEventListener("click",(async()=>{s("googleSignInBtn","googleSignInSpinner");try{const{error:e}=await o.auth.signInWithOAuth({provider:"google",options:{}});e&&(console.error("Error signing in with Google:",e),i(e.message||"Erreur lors de la connexion avec Google."))}catch(e){console.error("Exception during Google sign-in:",e),i("Une exception est survenue lors de la connexion avec Google.")}finally{l("googleSignInBtn","googleSignInSpinner")}})):console.warn("Google Sign-In button (googleSignInBtn) not found.")}window.onloadTurnstileLoginCallback=function(){console.log("Turnstile Login API ready (onloadTurnstileLoginCallback executed).");const e=document.getElementById("turnstile-login-container");if(e&&window.turnstile&&!c){console.log("Rendering Turnstile widget for login...");try{c=window.turnstile.render(e,{sitekey:"0x4AAAAAABdzY3InOU2_In99",callback:function(e){a=e,console.log("Turnstile login token obtained:",e)},"expired-callback":()=>{console.log("Turnstile login token expired. Resetting widget. ID:",c),window.turnstile&&c&&window.turnstile.reset(c),a=null},"error-callback":e=>{a=null,console.error("Turnstile login error callback:",e),i(`Erreur CAPTCHA (login): ${e}. Veuillez réessayer.`)}}),void 0===c?(console.error("Turnstile.render (login) did not return a widgetId. Sitekey or container issue?"),i("Erreur initialisation CAPTCHA (login, ID widget non retourné).")):console.log("Turnstile login widget rendered. ID:",c)}catch(e){console.error("Error rendering Turnstile for login:",e),i("Impossible d'afficher le CAPTCHA (login).")}}else e?window.turnstile?c&&console.log("onloadTurnstileLoginCallback: Login widget already seems rendered."):console.error("onloadTurnstileLoginCallback: window.turnstile API not found."):console.error("onloadTurnstileLoginCallback: #turnstile-login-container not found.")},document.addEventListener("DOMContentLoaded",(()=>{d(),console.log("Login page initialized")}))}},s={};function l(e){var n=s[e];if(void 0!==n)return n.exports;var t=s[e]={exports:{}};return i[e].call(t.exports,t,t.exports,l),t.exports}l.m=i,e=[],l.O=(n,t,o,r)=>{if(!t){var i=1/0;for(d=0;d<e.length;d++){for(var[t,o,r]=e[d],s=!0,a=0;a<t.length;a++)(!1&r||i>=r)&&Object.keys(l.O).every((e=>l.O[e](t[a])))?t.splice(a--,1):(s=!1,r<i&&(i=r));if(s){e.splice(d--,1);var c=o();void 0!==c&&(n=c)}}return n}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[t,o,r]},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,l.t=function(e,o){if(1&o&&(e=this(e)),8&o)return e;if("object"==typeof e&&e){if(4&o&&e.__esModule)return e;if(16&o&&"function"==typeof e.then)return e}var r=Object.create(null);l.r(r);var i={};n=n||[null,t({}),t([]),t(t)];for(var s=2&o&&e;"object"==typeof s&&!~n.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((n=>i[n]=()=>e[n]));return i.default=()=>e,l.d(r,i),r},l.d=(e,n)=>{for(var t in n)l.o(n,t)&&!l.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},l.f={},l.e=e=>Promise.all(Object.keys(l.f).reduce(((n,t)=>(l.f[t](e,n),n)),[])),l.u=e=>"js/"+e+".bundle.js",l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),o={},r="urbandocs_webapp:",l.l=(e,n,t,i)=>{if(o[e])o[e].push(n);else{var s,a;if(void 0!==t)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==r+t){s=u;break}}s||(a=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,l.nc&&s.setAttribute("nonce",l.nc),s.setAttribute("data-webpack",r+t),s.src=e),o[e]=[n];var g=(n,t)=>{s.onerror=s.onload=null,clearTimeout(m);var r=o[e];if(delete o[e],s.parentNode&&s.parentNode.removeChild(s),r&&r.forEach((e=>e(t))),n)return n(t)},m=setTimeout(g.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=g.bind(null,s.onerror),s.onload=g.bind(null,s.onload),a&&document.head.appendChild(s)}},l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;l.g.importScripts&&(e=l.g.location+"");var n=l.g.document;if(!e&&n&&(n.currentScript&&"SCRIPT"===n.currentScript.tagName.toUpperCase()&&(e=n.currentScript.src),!e)){var t=n.getElementsByTagName("script");if(t.length)for(var o=t.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=t[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),l.p=e+"../"})(),(()=>{var e={966:0};l.f.j=(n,t)=>{var o=l.o(e,n)?e[n]:void 0;if(0!==o)if(o)t.push(o[2]);else{var r=new Promise(((t,r)=>o=e[n]=[t,r]));t.push(o[2]=r);var i=l.p+l.u(n),s=new Error;l.l(i,(t=>{if(l.o(e,n)&&(0!==(o=e[n])&&(e[n]=void 0),o)){var r=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;s.message="Loading chunk "+n+" failed.\n("+r+": "+i+")",s.name="ChunkLoadError",s.type=r,s.request=i,o[1](s)}}),"chunk-"+n,n)}},l.O.j=n=>0===e[n];var n=(n,t)=>{var o,r,[i,s,a]=t,c=0;if(i.some((n=>0!==e[n]))){for(o in s)l.o(s,o)&&(l.m[o]=s[o]);if(a)var d=a(l)}for(n&&n(t);c<i.length;c++)r=i[c],l.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return l.O(d)},t=self.webpackChunkurbandocs_webapp=self.webpackChunkurbandocs_webapp||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))})();var a=l.O(void 0,[303],(()=>l(418)));a=l.O(a)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dEssRUFDdkIsQ0FDRCxHQUV3QyxTQUFXb0gsRUFBU0EsRUFFL0QsQ0FDRCxFQVdGN0MsRUFBb0JRLEVBQUVVLEVBQUsyQixHQUEwQyxJQUE3QmlELEVBQWdCakQsR0FHeEQsSUFBSTBELEVBQXVCLENBQUNDLEVBQTRCaEosS0FDdkQsSUFHSXlDLEVBQVU0QyxHQUhUbkMsRUFBVStGLEVBQWFDLEdBQVdsSixFQUdoQnVELEVBQUksRUFDM0IsR0FBR0wsRUFBU2lHLE1BQU1DLEdBQWdDLElBQXhCZCxFQUFnQmMsS0FBYSxDQUN0RCxJQUFJM0csS0FBWXdHLEVBQ1p6RyxFQUFvQndDLEVBQUVpRSxFQUFheEcsS0FDckNELEVBQW9CTyxFQUFFTixHQUFZd0csRUFBWXhHLElBR2hELEdBQUd5RyxFQUFTLElBQUlqRyxFQUFTaUcsRUFBUTFHLEVBQ2xDLENBRUEsSUFER3dHLEdBQTRCQSxFQUEyQmhKLEdBQ3JEdUQsRUFBSUwsRUFBU00sT0FBUUQsSUFDekI4QixFQUFVbkMsRUFBU0ssR0FDaEJmLEVBQW9Cd0MsRUFBRXNELEVBQWlCakQsSUFBWWlELEVBQWdCakQsSUFDckVpRCxFQUFnQmpELEdBQVMsS0FFMUJpRCxFQUFnQmpELEdBQVcsRUFFNUIsT0FBTzdDLEVBQW9CUSxFQUFFQyxFQUFPLEVBR2pDb0csRUFBcUJDLEtBQW1DLDZCQUFJQSxLQUFtQyw4QkFBSyxHQUN4R0QsRUFBbUJwSSxRQUFROEgsRUFBcUJ2QixLQUFLLEtBQU0sSUFDM0Q2QixFQUFtQmpELEtBQU8yQyxFQUFxQnZCLEtBQUssS0FBTTZCLEVBQW1CakQsS0FBS29CLEtBQUs2QixHLEtDbEZ2RixJQUFJRSxFQUFzQi9HLEVBQW9CUSxPQUFFVixFQUFXLENBQUMsTUFBTSxJQUFPRSxFQUFvQixPQUM3RitHLEVBQXNCL0csRUFBb0JRLEVBQUV1RyxFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvY2h1bmsgbG9hZGVkIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2NyZWF0ZSBmYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvbG9hZCBzY3JpcHQiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC8uL3NyYy9qcy9zdXBhYmFzZS1jbGllbnQuanMiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC8uL3NyYy9qcy9hdXRoL2F1dGguanMiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC8uL3NyYy9qcy9hdXRoL2xvZ2luLmpzIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvLi9zcmMvanMvZW50cmllcy9sb2dpbi5qcyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2Vuc3VyZSBjaHVuayIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9nZXQgamF2YXNjcmlwdCBjaHVuayBmaWxlbmFtZSIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9nbG9iYWwiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL21ha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9wdWJsaWNQYXRoIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2pzb25wIGNodW5rIGxvYWRpbmciLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3N0YXJ0dXAiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGRlZmVycmVkID0gW107XG5fX3dlYnBhY2tfcmVxdWlyZV9fLk8gPSAocmVzdWx0LCBjaHVua0lkcywgZm4sIHByaW9yaXR5KSA9PiB7XG5cdGlmKGNodW5rSWRzKSB7XG5cdFx0cHJpb3JpdHkgPSBwcmlvcml0eSB8fCAwO1xuXHRcdGZvcih2YXIgaSA9IGRlZmVycmVkLmxlbmd0aDsgaSA+IDAgJiYgZGVmZXJyZWRbaSAtIDFdWzJdID4gcHJpb3JpdHk7IGktLSkgZGVmZXJyZWRbaV0gPSBkZWZlcnJlZFtpIC0gMV07XG5cdFx0ZGVmZXJyZWRbaV0gPSBbY2h1bmtJZHMsIGZuLCBwcmlvcml0eV07XG5cdFx0cmV0dXJuO1xuXHR9XG5cdHZhciBub3RGdWxmaWxsZWQgPSBJbmZpbml0eTtcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCBkZWZlcnJlZC5sZW5ndGg7IGkrKykge1xuXHRcdHZhciBbY2h1bmtJZHMsIGZuLCBwcmlvcml0eV0gPSBkZWZlcnJlZFtpXTtcblx0XHR2YXIgZnVsZmlsbGVkID0gdHJ1ZTtcblx0XHRmb3IgKHZhciBqID0gMDsgaiA8IGNodW5rSWRzLmxlbmd0aDsgaisrKSB7XG5cdFx0XHRpZiAoKHByaW9yaXR5ICYgMSA9PT0gMCB8fCBub3RGdWxmaWxsZWQgPj0gcHJpb3JpdHkpICYmIE9iamVjdC5rZXlzKF9fd2VicGFja19yZXF1aXJlX18uTykuZXZlcnkoKGtleSkgPT4gKF9fd2VicGFja19yZXF1aXJlX18uT1trZXldKGNodW5rSWRzW2pdKSkpKSB7XG5cdFx0XHRcdGNodW5rSWRzLnNwbGljZShqLS0sIDEpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZnVsZmlsbGVkID0gZmFsc2U7XG5cdFx0XHRcdGlmKHByaW9yaXR5IDwgbm90RnVsZmlsbGVkKSBub3RGdWxmaWxsZWQgPSBwcmlvcml0eTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYoZnVsZmlsbGVkKSB7XG5cdFx0XHRkZWZlcnJlZC5zcGxpY2UoaS0tLCAxKVxuXHRcdFx0dmFyIHIgPSBmbigpO1xuXHRcdFx0aWYgKHIgIT09IHVuZGVmaW5lZCkgcmVzdWx0ID0gcjtcblx0XHR9XG5cdH1cblx0cmV0dXJuIHJlc3VsdDtcbn07IiwidmFyIGdldFByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mID8gKG9iaikgPT4gKE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmopKSA6IChvYmopID0+IChvYmouX19wcm90b19fKTtcbnZhciBsZWFmUHJvdG90eXBlcztcbi8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuLy8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4vLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbi8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuLy8gbW9kZSAmIDE2OiByZXR1cm4gdmFsdWUgd2hlbiBpdCdzIFByb21pc2UtbGlrZVxuLy8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuX193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcblx0aWYobW9kZSAmIDEpIHZhbHVlID0gdGhpcyh2YWx1ZSk7XG5cdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG5cdGlmKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUpIHtcblx0XHRpZigobW9kZSAmIDQpICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcblx0XHRpZigobW9kZSAmIDE2KSAmJiB0eXBlb2YgdmFsdWUudGhlbiA9PT0gJ2Z1bmN0aW9uJykgcmV0dXJuIHZhbHVlO1xuXHR9XG5cdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG5cdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG5cdHZhciBkZWYgPSB7fTtcblx0bGVhZlByb3RvdHlwZXMgPSBsZWFmUHJvdG90eXBlcyB8fCBbbnVsbCwgZ2V0UHJvdG8oe30pLCBnZXRQcm90byhbXSksIGdldFByb3RvKGdldFByb3RvKV07XG5cdGZvcih2YXIgY3VycmVudCA9IG1vZGUgJiAyICYmIHZhbHVlOyB0eXBlb2YgY3VycmVudCA9PSAnb2JqZWN0JyAmJiAhfmxlYWZQcm90b3R5cGVzLmluZGV4T2YoY3VycmVudCk7IGN1cnJlbnQgPSBnZXRQcm90byhjdXJyZW50KSkge1xuXHRcdE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGN1cnJlbnQpLmZvckVhY2goKGtleSkgPT4gKGRlZltrZXldID0gKCkgPT4gKHZhbHVlW2tleV0pKSk7XG5cdH1cblx0ZGVmWydkZWZhdWx0J10gPSAoKSA9PiAodmFsdWUpO1xuXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGRlZik7XG5cdHJldHVybiBucztcbn07IiwidmFyIGluUHJvZ3Jlc3MgPSB7fTtcbnZhciBkYXRhV2VicGFja1ByZWZpeCA9IFwidXJiYW5kb2NzX3dlYmFwcDpcIjtcbi8vIGxvYWRTY3JpcHQgZnVuY3Rpb24gdG8gbG9hZCBhIHNjcmlwdCB2aWEgc2NyaXB0IHRhZ1xuX193ZWJwYWNrX3JlcXVpcmVfXy5sID0gKHVybCwgZG9uZSwga2V5LCBjaHVua0lkKSA9PiB7XG5cdGlmKGluUHJvZ3Jlc3NbdXJsXSkgeyBpblByb2dyZXNzW3VybF0ucHVzaChkb25lKTsgcmV0dXJuOyB9XG5cdHZhciBzY3JpcHQsIG5lZWRBdHRhY2g7XG5cdGlmKGtleSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0dmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNjcmlwdFwiKTtcblx0XHRmb3IodmFyIGkgPSAwOyBpIDwgc2NyaXB0cy5sZW5ndGg7IGkrKykge1xuXHRcdFx0dmFyIHMgPSBzY3JpcHRzW2ldO1xuXHRcdFx0aWYocy5nZXRBdHRyaWJ1dGUoXCJzcmNcIikgPT0gdXJsIHx8IHMuZ2V0QXR0cmlidXRlKFwiZGF0YS13ZWJwYWNrXCIpID09IGRhdGFXZWJwYWNrUHJlZml4ICsga2V5KSB7IHNjcmlwdCA9IHM7IGJyZWFrOyB9XG5cdFx0fVxuXHR9XG5cdGlmKCFzY3JpcHQpIHtcblx0XHRuZWVkQXR0YWNoID0gdHJ1ZTtcblx0XHRzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcblxuXHRcdHNjcmlwdC5jaGFyc2V0ID0gJ3V0Zi04Jztcblx0XHRzY3JpcHQudGltZW91dCA9IDEyMDtcblx0XHRpZiAoX193ZWJwYWNrX3JlcXVpcmVfXy5uYykge1xuXHRcdFx0c2NyaXB0LnNldEF0dHJpYnV0ZShcIm5vbmNlXCIsIF9fd2VicGFja19yZXF1aXJlX18ubmMpO1xuXHRcdH1cblx0XHRzY3JpcHQuc2V0QXR0cmlidXRlKFwiZGF0YS13ZWJwYWNrXCIsIGRhdGFXZWJwYWNrUHJlZml4ICsga2V5KTtcblxuXHRcdHNjcmlwdC5zcmMgPSB1cmw7XG5cdH1cblx0aW5Qcm9ncmVzc1t1cmxdID0gW2RvbmVdO1xuXHR2YXIgb25TY3JpcHRDb21wbGV0ZSA9IChwcmV2LCBldmVudCkgPT4ge1xuXHRcdC8vIGF2b2lkIG1lbSBsZWFrcyBpbiBJRS5cblx0XHRzY3JpcHQub25lcnJvciA9IHNjcmlwdC5vbmxvYWQgPSBudWxsO1xuXHRcdGNsZWFyVGltZW91dCh0aW1lb3V0KTtcblx0XHR2YXIgZG9uZUZucyA9IGluUHJvZ3Jlc3NbdXJsXTtcblx0XHRkZWxldGUgaW5Qcm9ncmVzc1t1cmxdO1xuXHRcdHNjcmlwdC5wYXJlbnROb2RlICYmIHNjcmlwdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHNjcmlwdCk7XG5cdFx0ZG9uZUZucyAmJiBkb25lRm5zLmZvckVhY2goKGZuKSA9PiAoZm4oZXZlbnQpKSk7XG5cdFx0aWYocHJldikgcmV0dXJuIHByZXYoZXZlbnQpO1xuXHR9XG5cdHZhciB0aW1lb3V0ID0gc2V0VGltZW91dChvblNjcmlwdENvbXBsZXRlLmJpbmQobnVsbCwgdW5kZWZpbmVkLCB7IHR5cGU6ICd0aW1lb3V0JywgdGFyZ2V0OiBzY3JpcHQgfSksIDEyMDAwMCk7XG5cdHNjcmlwdC5vbmVycm9yID0gb25TY3JpcHRDb21wbGV0ZS5iaW5kKG51bGwsIHNjcmlwdC5vbmVycm9yKTtcblx0c2NyaXB0Lm9ubG9hZCA9IG9uU2NyaXB0Q29tcGxldGUuYmluZChudWxsLCBzY3JpcHQub25sb2FkKTtcblx0bmVlZEF0dGFjaCAmJiBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHNjcmlwdCk7XG59OyIsIi8vIHNyYy9qcy9zdXBhYmFzZS1jbGllbnQuanNcbi8qKlxuICogU3VwYWJhc2UgQ2xpZW50XG4gKiBAbW9kdWxlIHN1cGFiYXNlLWNsaWVudFxuICogQGRlc2NyaXB0aW9uIFRoaXMgbW9kdWxlIGhhbmRsZXMgdGhlIFN1cGFiYXNlIGNsaWVudCBpbml0aWFsaXphdGlvbiBhbmQgY29uZmlndXJhdGlvbi5cbiAqIEB2ZXJzaW9uIDAuMC4xXG4gKiBAYXV0aG9yIEdyZXlQYW5kYVxuICpcbiAqIEBjaGFuZ2Vsb2dcbiAqIC0gMC4wLjEgKDIwMjUtMDUtMDkpOiBJbml0aWFsIHZlcnNpb24gd2l0aCBiYXNpYyBTdXBhYmFzZSBjbGllbnQgaW5pdGlhbGl6YXRpb24uXG4gKi9cblxuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSBcIkBzdXBhYmFzZS9zdXBhYmFzZS1qc1wiO1xuXG5jb25zdCBzdXBhYmFzZVVybCA9IFwiaHR0cHM6Ly9vZmV5c3NpcGlia3RtYmZlYmliby5zdXBhYmFzZS5jb1wiO1xuY29uc3Qgc3VwYWJhc2VBbm9uS2V5ID1cbiAgXCJleUpoYkdjaU9pSklVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKcGMzTWlPaUp6ZFhCaFltRnpaU0lzSW5KbFppSTZJbTltWlhsemMybHdhV0pyZEcxaVptVmlhV0p2SWl3aWNtOXNaU0k2SW1GdWIyNGlMQ0pwWVhRaU9qRTNORE01TWpVd09UUXNJbVY0Y0NJNk1qQTFPVFV3TVRBNU5IMC53NzFDQUtmb2xrdHpSbC1UbUxWaEhZYUViaENmVms0QTdZcmFFVUNnbHJVXCI7XG5cbmNvbnN0IGNsaWVudCA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5KTtcblxuZXhwb3J0IGNvbnN0IHN1cGFiYXNlID0gY2xpZW50O1xuIiwiLy8gc3JjL2F1dGgvYXV0aC5qc1xuLyoqXG4gKiBBdXRoZW50aWNhdGlvbiBNb2R1bGUgLSBCYXNlXG4gKiBAbW9kdWxlIGF1dGhcbiAqIEBkZXNjcmlwdGlvbiBCYXNlIG1vZHVsZSBmb3IgYXV0aGVudGljYXRpb24gd2l0aCBjb21tb24gZnVuY3Rpb25zIGFuZCBjb25maWd1cmF0aW9uXG4gKiBAdmVyc2lvbiAwLjAuNVxuICpcbiAqIEBjaGFuZ2Vsb2dcbiAqIC0gMC4wLjUgKDIwMjUtMDUtMTUpOiBBZGRlZCBzZXNzaW9uIHZhbGlkYXRpb24gYW5kIHByb3RlY3Rpb24gYWdhaW5zdCBzdGFsZSBzZXNzaW9ucy5cbiAqIC0gMC4wLjQgKDIwMjUtMDUtMTUpOiBSZW1vdmFsIG9mIEZpcmViYXNlIENsb3VkIEZ1bmN0aW9ucyBjb25zdGFudHMuXG4gKiAtIDAuMC4zICgyMDI1LTA1LTEzKTogTW9kaWZpZWQgdGhlIGF1dGhlbnRpY2F0aW9uIHN0YXRlIG1hbmFnZW1lbnQgdG8gdXNlIFN1cGFiYXNlIEF1dGggc3lzdGVtLlxuICogLSAwLjAuMiAoMjAyNS0wNS0xMyk6IFJlb3JnYW5pemF0aW9uIGludG8gc2VwYXJhdGUgbW9kdWxlc1xuICogLSAwLjAuMSAoMjAyNS0wNS0wMyk6IEluaXRpYWwgY3JlYXRpb25cbiAqL1xuXG5pbXBvcnQgeyBzdXBhYmFzZSB9IGZyb20gXCIuLi9zdXBhYmFzZS1jbGllbnQuanNcIjtcblxuLy8gR2xvYmFsIGF1dGhlbnRpY2F0aW9uIHN0YXRlXG5sZXQgY3VycmVudFVzZXIgPSBudWxsO1xubGV0IHNlc3Npb25WYWxpZGF0ZWQgPSBmYWxzZTtcblxuLyoqXG4gKiBTZXRzIHRoZSBjdXJyZW50IHVzZXJcbiAqIEBwYXJhbSB7T2JqZWN0fSB1c2VyIC0gVXNlciBkYXRhXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXRDdXJyZW50VXNlcih1c2VyKSB7XG4gIGN1cnJlbnRVc2VyID0gdXNlcjtcbiAgLy8gUG9zc2libGUgc3RvcmFnZSBpbiBsb2NhbFN0b3JhZ2Uvc2Vzc2lvblN0b3JhZ2VcbiAgaWYgKHVzZXIpIHtcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcImN1cnJlbnRVc2VyXCIsIEpTT04uc3RyaW5naWZ5KHVzZXIpKTtcbiAgfSBlbHNlIHtcbiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShcImN1cnJlbnRVc2VyXCIpO1xuICB9XG59XG5cbi8qKlxuICogVmFsaWRhdGVzIGlmIHRoZSBjdXJyZW50IHNlc3Npb24gaXMgYWN0aXZlIHdpdGggU3VwYWJhc2VcbiAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fSBUcnVlIGlmIHNlc3Npb24gaXMgdmFsaWQsIGZhbHNlIG90aGVyd2lzZVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdmFsaWRhdGVTZXNzaW9uKCkge1xuICB0cnkge1xuICAgIC8vIEdldCBjdXJyZW50IHNlc3Npb24gZnJvbSBTdXBhYmFzZVxuICAgIGNvbnN0IHtcbiAgICAgIGRhdGE6IHsgc2Vzc2lvbiB9LFxuICAgICAgZXJyb3I6IHNlc3Npb25FcnJvcixcbiAgICB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRTZXNzaW9uKCk7XG5cbiAgICAvLyBObyBzZXNzaW9uIG9yIGVycm9yIHJldHJpZXZpbmcgc2Vzc2lvblxuICAgIGlmIChzZXNzaW9uRXJyb3IgfHwgIXNlc3Npb24pIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiTm8gdmFsaWQgc2Vzc2lvbiBmb3VuZFwiKTtcbiAgICAgIHNldEN1cnJlbnRVc2VyKG51bGwpO1xuICAgICAgc2Vzc2lvblZhbGlkYXRlZCA9IGZhbHNlO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIFRyeSB0byByZWZyZXNoIHRoZSB0b2tlbiB0byB2YWxpZGF0ZSBpdCB3aXRoIHRoZSBzZXJ2ZXJcbiAgICBjb25zdCB7IGVycm9yOiByZWZyZXNoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGgucmVmcmVzaFNlc3Npb24oKTtcblxuICAgIGlmIChyZWZyZXNoRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybihcIlNlc3Npb24gdmFsaWRhdGlvbiBmYWlsZWQ6XCIsIHJlZnJlc2hFcnJvcik7XG4gICAgICAvLyBGb3JjZSBjbGVhciB0aGUgaW52YWxpZCBzZXNzaW9uXG4gICAgICBhd2FpdCBzdXBhYmFzZS5hdXRoLnNpZ25PdXQoKTtcbiAgICAgIHNldEN1cnJlbnRVc2VyKG51bGwpO1xuICAgICAgc2Vzc2lvblZhbGlkYXRlZCA9IGZhbHNlO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIFNlc3Npb24gaXMgdmFsaWQsIHVwZGF0ZSB0aGUgY3VycmVudCB1c2VyXG4gICAgc2V0Q3VycmVudFVzZXIoc2Vzc2lvbi51c2VyKTtcbiAgICBzZXNzaW9uVmFsaWRhdGVkID0gdHJ1ZTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJTZXNzaW9uIHZhbGlkYXRpb24gZXJyb3I6XCIsIGUpO1xuICAgIHNldEN1cnJlbnRVc2VyKG51bGwpO1xuICAgIHNlc3Npb25WYWxpZGF0ZWQgPSBmYWxzZTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxuLyoqXG4gKiBSZXRyaWV2ZXMgdGhlIGN1cnJlbnQgdXNlclxuICogQHBhcmFtIHtib29sZWFufSB2YWxpZGF0ZSAtIFdoZXRoZXIgdG8gdmFsaWRhdGUgdGhlIHNlc3Npb24gd2l0aCBTdXBhYmFzZVxuICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0fG51bGw+fSBUaGUgY3VycmVudCB1c2VyIG9yIG51bGxcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1cnJlbnRVc2VyKHZhbGlkYXRlID0gdHJ1ZSkge1xuICAvLyBJZiB3ZSBuZWVkIHRvIHZhbGlkYXRlIGFuZCBoYXZlbid0IGRvbmUgc28geWV0XG4gIGlmICh2YWxpZGF0ZSAmJiAhc2Vzc2lvblZhbGlkYXRlZCkge1xuICAgIGF3YWl0IHZhbGlkYXRlU2Vzc2lvbigpO1xuICB9XG5cbiAgLy8gSWYgbm8gdmFsaWRhdGlvbiBuZWVkZWQgb3IgYWxyZWFkeSB2YWxpZGF0ZWRcbiAgaWYgKCF2YWxpZGF0ZSAmJiAhY3VycmVudFVzZXIpIHtcbiAgICAvLyBUcnkgdG8gcmV0cmlldmUgZnJvbSBzdG9yYWdlIGlmIG5vdCBpbiBtZW1vcnlcbiAgICBjb25zdCBzdG9yZWRVc2VyID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJjdXJyZW50VXNlclwiKTtcbiAgICBpZiAoc3RvcmVkVXNlcikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY3VycmVudFVzZXIgPSBKU09OLnBhcnNlKHN0b3JlZFVzZXIpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmV0cmlldmluZyB1c2VyOlwiLCBlKTtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJjdXJyZW50VXNlclwiKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gY3VycmVudFVzZXI7XG59XG5cbi8qKlxuICogU3luY2hyb25vdXMgdmVyc2lvbiBvZiBnZXRDdXJyZW50VXNlciBmb3Igbm9uLWFzeW5jIGNvbnRleHRzXG4gKiBXQVJOSU5HOiBUaGlzIG1heSByZXR1cm4gc3RhbGUgZGF0YSBpZiBzZXNzaW9uIGlzIGludmFsaWRcbiAqIEByZXR1cm5zIHtPYmplY3R8bnVsbH0gVGhlIGN1cnJlbnQgdXNlciBvciBudWxsXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRDdXJyZW50VXNlclN5bmMoKSB7XG4gIGlmICghY3VycmVudFVzZXIpIHtcbiAgICBjb25zdCBzdG9yZWRVc2VyID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJjdXJyZW50VXNlclwiKTtcbiAgICBpZiAoc3RvcmVkVXNlcikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY3VycmVudFVzZXIgPSBKU09OLnBhcnNlKHN0b3JlZFVzZXIpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmV0cmlldmluZyB1c2VyOlwiLCBlKTtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJjdXJyZW50VXNlclwiKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gY3VycmVudFVzZXI7XG59XG5cbi8qKlxuICogTG9ncyBvdXQgdGhlIHVzZXJcbiAqIEByZXR1cm5zIHtQcm9taXNlPHZvaWQ+fVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9nb3V0KCkge1xuICB0cnkge1xuICAgIC8vIFNpZ24gb3V0IGZyb20gU3VwYWJhc2VcbiAgICBhd2FpdCBzdXBhYmFzZS5hdXRoLnNpZ25PdXQoKTtcblxuICAgIC8vIENsZWFyIGxvY2FsIHN0YXRlXG4gICAgY3VycmVudFVzZXIgPSBudWxsO1xuICAgIHNlc3Npb25WYWxpZGF0ZWQgPSBmYWxzZTtcbiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShcImN1cnJlbnRVc2VyXCIpO1xuXG4gICAgLy8gUmVkaXJlY3QgdG8gdGhlIGhvbWUgcGFnZSBhZnRlciBsb2dvdXRcbiAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IFwiL1wiO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkdXJpbmcgbG9nb3V0OlwiLCBlcnJvcik7XG4gICAgLy8gU3RpbGwgY2xlYXIgbG9jYWwgc3RhdGUgZXZlbiBpZiBTdXBhYmFzZSBzaWduT3V0IGZhaWxzXG4gICAgY3VycmVudFVzZXIgPSBudWxsO1xuICAgIHNlc3Npb25WYWxpZGF0ZWQgPSBmYWxzZTtcbiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShcImN1cnJlbnRVc2VyXCIpO1xuICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCIvXCI7XG4gIH1cbn1cblxuLyoqXG4gKiBDaGVja3MgaWYgdGhlIHVzZXIgaXMgbG9nZ2VkIGluIHdpdGggdmFsaWQgc2Vzc2lvblxuICogQHBhcmFtIHtib29sZWFufSB2YWxpZGF0ZSAtIFdoZXRoZXIgdG8gdmFsaWRhdGUgd2l0aCBTdXBhYmFzZSBmaXJzdFxuICogQHJldHVybnMge1Byb21pc2U8Ym9vbGVhbj59IFRydWUgaWYgdGhlIHVzZXIgaXMgbG9nZ2VkIGluIHdpdGggdmFsaWQgc2Vzc2lvblxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaXNMb2dnZWRJbih2YWxpZGF0ZSA9IHRydWUpIHtcbiAgY29uc3QgdXNlciA9IGF3YWl0IGdldEN1cnJlbnRVc2VyKHZhbGlkYXRlKTtcbiAgcmV0dXJuIHVzZXIgIT09IG51bGw7XG59XG5cbi8qKlxuICogU3luY2hyb25vdXMgdmVyc2lvbiBvZiBpc0xvZ2dlZEluXG4gKiBXQVJOSU5HOiBUaGlzIG1heSByZXR1cm4gaW5jb3JyZWN0IHJlc3VsdHMgaWYgc2Vzc2lvbiBpcyBpbnZhbGlkXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiB1c2VyIGFwcGVhcnMgdG8gYmUgbG9nZ2VkIGluIGxvY2FsbHlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzTG9nZ2VkSW5TeW5jKCkge1xuICByZXR1cm4gZ2V0Q3VycmVudFVzZXJTeW5jKCkgIT09IG51bGw7XG59XG5cbi8qKlxuICogUHJvdGVjdHMgYSBwYWdlIHRoYXQgcmVxdWlyZXMgYXV0aGVudGljYXRpb25cbiAqIEBwYXJhbSB7c3RyaW5nfSByZWRpcmVjdFVybCAtIFVSTCB0byByZWRpcmVjdCBpZiBub3QgYXV0aGVudGljYXRlZFxuICogQHJldHVybnMge1Byb21pc2U8Ym9vbGVhbj59IFRydWUgaWYgYXV0aGVudGljYXRlZCwgZmFsc2Ugb3RoZXJ3aXNlXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBwcm90ZWN0UGFnZShyZWRpcmVjdFVybCA9IFwiL2xvZ2luXCIpIHtcbiAgY29uc3QgaXNWYWxpZCA9IGF3YWl0IHZhbGlkYXRlU2Vzc2lvbigpO1xuXG4gIGlmICghaXNWYWxpZCkge1xuICAgIC8vIFJlZGlyZWN0IHRvIGxvZ2luIHBhZ2VcbiAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHJlZGlyZWN0VXJsO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHJldHVybiB0cnVlO1xufVxuXG4vKipcbiAqIEluaXRpYWxpemVzIGF1dGggb24gcGFnZSBsb2FkXG4gKiBDYWxsIHRoaXMgYXQgdGhlIGJlZ2lubmluZyBvZiB5b3VyIGFwcCBpbml0aWFsaXphdGlvblxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaW5pdEF1dGgoKSB7XG4gIC8vIFZhbGlkYXRlIHNlc3Npb24gb24gcGFnZSBsb2FkXG4gIGF3YWl0IHZhbGlkYXRlU2Vzc2lvbigpO1xuXG4gIC8vIFNldCB1cCBhdXRoIHN0YXRlIGNoYW5nZSBsaXN0ZW5lclxuICBzdXBhYmFzZS5hdXRoLm9uQXV0aFN0YXRlQ2hhbmdlKGFzeW5jIChldmVudCwgc2Vzc2lvbikgPT4ge1xuICAgIGNvbnNvbGUubG9nKFwiQXV0aCBzdGF0ZSBjaGFuZ2VkOlwiLCBldmVudCk7XG5cbiAgICBpZiAoZXZlbnQgPT09IFwiU0lHTkVEX0lOXCIgJiYgc2Vzc2lvbikge1xuICAgICAgc2V0Q3VycmVudFVzZXIoc2Vzc2lvbi51c2VyKTtcbiAgICAgIHNlc3Npb25WYWxpZGF0ZWQgPSB0cnVlO1xuICAgIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwiU0lHTkVEX09VVFwiKSB7XG4gICAgICBzZXRDdXJyZW50VXNlcihudWxsKTtcbiAgICAgIHNlc3Npb25WYWxpZGF0ZWQgPSBmYWxzZTtcbiAgICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcIlRPS0VOX1JFRlJFU0hFRFwiKSB7XG4gICAgICBzZXRDdXJyZW50VXNlcihzZXNzaW9uLnVzZXIpO1xuICAgICAgc2Vzc2lvblZhbGlkYXRlZCA9IHRydWU7XG4gICAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJVU0VSX1VQREFURURcIikge1xuICAgICAgc2V0Q3VycmVudFVzZXIoc2Vzc2lvbi51c2VyKTtcbiAgICAgIHNlc3Npb25WYWxpZGF0ZWQgPSB0cnVlO1xuICAgIH1cbiAgfSk7XG59XG5cbi8qKlxuICogRGlzcGxheXMgYW4gZXJyb3IgbWVzc2FnZVxuICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2UgLSBFcnJvciBtZXNzYWdlIHRvIGRpc3BsYXlcbiAqIEBwYXJhbSB7c3RyaW5nfSBlbGVtZW50SWQgLSBJRCBvZiB0aGUgZWxlbWVudCB3aGVyZSB0byBkaXNwbGF5IHRoZSBlcnJvclxuICovXG5leHBvcnQgZnVuY3Rpb24gc2hvd0Vycm9yKG1lc3NhZ2UsIGVsZW1lbnRJZCA9IFwiZXJyb3JNZXNzYWdlXCIpIHtcbiAgY29uc3QgZXJyb3JFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudElkKTtcbiAgaWYgKGVycm9yRWxlbWVudCkge1xuICAgIGVycm9yRWxlbWVudC5pbm5lckhUTUwgPSBtZXNzYWdlO1xuICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBlbGVtZW50IG5vdCBmb3VuZDpcIiwgZWxlbWVudElkKTtcbiAgfVxufVxuXG4vKipcbiAqIERpc3BsYXlzIGEgc3RhdHVzIG1lc3NhZ2VcbiAqIEBwYXJhbSB7c3RyaW5nfSBtZXNzYWdlIC0gTWVzc2FnZSB0byBkaXNwbGF5XG4gKiBAcGFyYW0ge3N0cmluZ30gdHlwZSAtIE1lc3NhZ2UgdHlwZSAoc3VjY2VzcywgaW5mbywgd2FybmluZywgZGFuZ2VyKVxuICogQHBhcmFtIHtzdHJpbmd9IGVsZW1lbnRJZCAtIElEIG9mIHRoZSBlbGVtZW50IHdoZXJlIHRvIGRpc3BsYXkgdGhlIG1lc3NhZ2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNob3dTdGF0dXMoXG4gIG1lc3NhZ2UsXG4gIHR5cGUgPSBcImluZm9cIixcbiAgZWxlbWVudElkID0gXCJzdGF0dXNNZXNzYWdlXCJcbikge1xuICBjb25zdCBzdGF0dXNFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudElkKTtcbiAgaWYgKHN0YXR1c0VsZW1lbnQpIHtcbiAgICBzdGF0dXNFbGVtZW50LnRleHRDb250ZW50ID0gbWVzc2FnZTtcblxuICAgIC8vIFJlbW92ZSBhbGwgYWxlcnQtKiBjbGFzc2VzXG4gICAgc3RhdHVzRWxlbWVudC5jbGFzc0xpc3QuZm9yRWFjaCgoY2xhc3NOYW1lKSA9PiB7XG4gICAgICBpZiAoY2xhc3NOYW1lLnN0YXJ0c1dpdGgoXCJhbGVydC1cIikpIHtcbiAgICAgICAgc3RhdHVzRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzTmFtZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBBZGQgdGhlIGNsYXNzIGNvcnJlc3BvbmRpbmcgdG8gdGhlIHR5cGVcbiAgICBzdGF0dXNFbGVtZW50LmNsYXNzTGlzdC5hZGQoYGFsZXJ0LSR7dHlwZX1gKTtcbiAgICBzdGF0dXNFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS5lcnJvcihcIlN0YXR1cyBlbGVtZW50IG5vdCBmb3VuZDpcIiwgZWxlbWVudElkKTtcbiAgfVxufVxuXG4vKipcbiAqIEhpZGVzIGFuIGVsZW1lbnRcbiAqIEBwYXJhbSB7c3RyaW5nfSBlbGVtZW50SWQgLSBJRCBvZiB0aGUgZWxlbWVudCB0byBoaWRlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBoaWRlRWxlbWVudChlbGVtZW50SWQpIHtcbiAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRJZCk7XG4gIGlmIChlbGVtZW50KSB7XG4gICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICB9XG59XG5cbi8qKlxuICogU2hvd3MgYW4gZWxlbWVudFxuICogQHBhcmFtIHtzdHJpbmd9IGVsZW1lbnRJZCAtIElEIG9mIHRoZSBlbGVtZW50IHRvIHNob3dcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNob3dFbGVtZW50KGVsZW1lbnRJZCkge1xuICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWxlbWVudElkKTtcbiAgaWYgKGVsZW1lbnQpIHtcbiAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XG4gIH1cbn1cblxuLyoqXG4gKiBTaG93cyB0aGUgbG9hZGluZyBpbmRpY2F0b3JcbiAqIEBwYXJhbSB7c3RyaW5nfSBidXR0b25JZCAtIElEIG9mIHRoZSBidXR0b25cbiAqIEBwYXJhbSB7c3RyaW5nfSBzcGlubmVySWQgLSBJRCBvZiB0aGUgc3Bpbm5lclxuICovXG5leHBvcnQgZnVuY3Rpb24gc2hvd0xvYWRpbmcoYnV0dG9uSWQsIHNwaW5uZXJJZCkge1xuICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChidXR0b25JZCk7XG4gIGNvbnN0IHNwaW5uZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzcGlubmVySWQpO1xuXG4gIGlmIChidXR0b24pIGJ1dHRvbi5kaXNhYmxlZCA9IHRydWU7XG4gIGlmIChzcGlubmVyKSBzcGlubmVyLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XG59XG5cbi8qKlxuICogSGlkZXMgdGhlIGxvYWRpbmcgaW5kaWNhdG9yXG4gKiBAcGFyYW0ge3N0cmluZ30gYnV0dG9uSWQgLSBJRCBvZiB0aGUgYnV0dG9uXG4gKiBAcGFyYW0ge3N0cmluZ30gc3Bpbm5lcklkIC0gSUQgb2YgdGhlIHNwaW5uZXJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGhpZGVMb2FkaW5nKGJ1dHRvbklkLCBzcGlubmVySWQpIHtcbiAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYnV0dG9uSWQpO1xuICBjb25zdCBzcGlubmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc3Bpbm5lcklkKTtcblxuICBpZiAoYnV0dG9uKSBidXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgaWYgKHNwaW5uZXIpIHNwaW5uZXIuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbn1cblxuLy8gRXhwb3J0IHRoZSBuZWNlc3NhcnkgZnVuY3Rpb25zIGFuZCB2YXJpYWJsZXNcbmV4cG9ydCBkZWZhdWx0IHtcbiAgZ2V0Q3VycmVudFVzZXIsXG4gIGdldEN1cnJlbnRVc2VyU3luYyxcbiAgc2V0Q3VycmVudFVzZXIsXG4gIGxvZ291dCxcbiAgaXNMb2dnZWRJbixcbiAgaXNMb2dnZWRJblN5bmMsXG4gIHZhbGlkYXRlU2Vzc2lvbixcbiAgcHJvdGVjdFBhZ2UsXG4gIGluaXRBdXRoLFxuICBzaG93RXJyb3IsXG4gIHNob3dTdGF0dXMsXG4gIGhpZGVFbGVtZW50LFxuICBzaG93RWxlbWVudCxcbiAgc2hvd0xvYWRpbmcsXG4gIGhpZGVMb2FkaW5nLFxufTtcbiIsIi8vIHNyYy9qcy9sb2dpbi5qc1xuLyoqXG4gKiBMb2dpbiBNb2R1bGVcbiAqIEBtb2R1bGUgbG9naW5cbiAqIEBkZXNjcmlwdGlvbiBUaGlzIG1vZHVsZSBoYW5kbGVzIHVzZXIgbG9naW4gZnVuY3Rpb25hbGl0eSB1c2luZyBTdXBhYmFzZSBBdXRoZW50aWNhdGlvbi5cbiAqIEB2ZXJzaW9uIDAuMS4wXG4gKiBAYXV0aG9yIEdyZXlQYW5kYVxuICogQHRvZG8gQWRkIHBob25lIG51bWJlciBhdXRoZW50aWNhdGlvbiAmIHBhc3N3b3JkIHJlc2V0IGZ1bmN0aW9uYWxpdHkuXG4gKlxuICogQGNoYW5nZWxvZ1xuICogLSAwLjEuMCAoMjAyNS0wNS0xNSk6IE1pZ3JhdGVkIHRvIFN1cGFiYXNlIGNsaWVudC1zaWRlIGF1dGhcbiAqIC0gMC4wLjQgKDIwMjUtMDUtMTMpOiBFbnN1cmUgc3RhdHVzIG1lc3NhZ2UgaXMgYWxzbyBoaWRkZW4gb24gbmV3IHN1Ym1pdC5cbiAqIC0gMC4wLjMgKDIwMjUtMDUtMDgpOiBJbXBsZW1lbnRlZCBhY3R1YWwgbG9naW4gd2l0aCBGaXJlYmFzZSBmdW5jdGlvbiwgYWRkZWQgcGFzc3dvcmQgdmlzaWJpbGl0eSB0b2dnbGUuXG4gKiAtIDAuMC4yICgyMDI1LTA1LTA4KTogUmVmYWN0b3JlZCB0byBoYW5kbGUgU3VwYWJhc2UgYXV0aGVudGlmaWNhdGlvbi5cbiAqIC0gMC4wLjEgKDIwMjUtMDQtMjcpOiBMb2dpbiBmdW5jdGlvbmFsaXR5IGltcGxlbWVudGVkIHVzaW5nIEZpcmViYXNlIEF1dGhlbnRpY2F0aW9uLlxuICovXG5cbmltcG9ydCB7XG4gIHNldEN1cnJlbnRVc2VyLFxuICBzaG93RXJyb3IsXG4gIHNob3dTdGF0dXMsXG4gIHNob3dMb2FkaW5nLFxuICBoaWRlTG9hZGluZyxcbn0gZnJvbSBcIi4vYXV0aC5qc1wiO1xuaW1wb3J0IHsgc3VwYWJhc2UgfSBmcm9tIFwiLi4vc3VwYWJhc2UtY2xpZW50LmpzXCI7XG5cbmxldCBjYXB0Y2hhTG9naW5Ub2tlbiA9IG51bGw7IC8vIFRvIHN0b3JlIHRoZSBjYXB0Y2hhIHRva2VuIGZvciBsb2dpblxubGV0IHR1cm5zdGlsZUxvZ2luV2lkZ2V0SWQgPSBudWxsOyAvLyBUbyBzdG9yZSBUdXJuc3RpbGUgd2lkZ2V0IElEIGZvciBsb2dpblxuXG4vLyBUaGlzIGZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIGJ5IHRoZSBDbG91ZGZsYXJlIFR1cm5zdGlsZSBzY3JpcHQgb25jZSBpdCdzIGxvYWRlZFxuLy8gKGR1ZSB0byAmb25sb2FkPW9ubG9hZFR1cm5zdGlsZUxvZ2luQ2FsbGJhY2sgaW4gdGhlIHNjcmlwdCB0YWcgaW4gbG9naW4uaHRtbClcbndpbmRvdy5vbmxvYWRUdXJuc3RpbGVMb2dpbkNhbGxiYWNrID0gZnVuY3Rpb24gKCkge1xuICBjb25zb2xlLmxvZyhcbiAgICBcIlR1cm5zdGlsZSBMb2dpbiBBUEkgcmVhZHkgKG9ubG9hZFR1cm5zdGlsZUxvZ2luQ2FsbGJhY2sgZXhlY3V0ZWQpLlwiXG4gICk7XG4gIGNvbnN0IHR1cm5zdGlsZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxuICAgIFwidHVybnN0aWxlLWxvZ2luLWNvbnRhaW5lclwiXG4gICk7XG5cbiAgaWYgKHR1cm5zdGlsZUNvbnRhaW5lciAmJiB3aW5kb3cudHVybnN0aWxlICYmICF0dXJuc3RpbGVMb2dpbldpZGdldElkKSB7XG4gICAgY29uc29sZS5sb2coXCJSZW5kZXJpbmcgVHVybnN0aWxlIHdpZGdldCBmb3IgbG9naW4uLi5cIik7XG4gICAgdHJ5IHtcbiAgICAgIHR1cm5zdGlsZUxvZ2luV2lkZ2V0SWQgPSB3aW5kb3cudHVybnN0aWxlLnJlbmRlcih0dXJuc3RpbGVDb250YWluZXIsIHtcbiAgICAgICAgc2l0ZWtleTogXCIweDRBQUFBQUFCZHpZM0luT1UyX0luOTlcIixcbiAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uICh0b2tlbikge1xuICAgICAgICAgIGNhcHRjaGFMb2dpblRva2VuID0gdG9rZW47XG4gICAgICAgICAgY29uc29sZS5sb2coXCJUdXJuc3RpbGUgbG9naW4gdG9rZW4gb2J0YWluZWQ6XCIsIHRva2VuKTtcbiAgICAgICAgfSxcbiAgICAgICAgXCJleHBpcmVkLWNhbGxiYWNrXCI6ICgpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgIFwiVHVybnN0aWxlIGxvZ2luIHRva2VuIGV4cGlyZWQuIFJlc2V0dGluZyB3aWRnZXQuIElEOlwiLFxuICAgICAgICAgICAgdHVybnN0aWxlTG9naW5XaWRnZXRJZFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKHdpbmRvdy50dXJuc3RpbGUgJiYgdHVybnN0aWxlTG9naW5XaWRnZXRJZCkge1xuICAgICAgICAgICAgd2luZG93LnR1cm5zdGlsZS5yZXNldCh0dXJuc3RpbGVMb2dpbldpZGdldElkKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FwdGNoYUxvZ2luVG9rZW4gPSBudWxsOyAvLyBDbGVhciB0aGUgdG9rZW5cbiAgICAgICAgfSxcbiAgICAgICAgXCJlcnJvci1jYWxsYmFja1wiOiAoZXJyKSA9PiB7XG4gICAgICAgICAgY2FwdGNoYUxvZ2luVG9rZW4gPSBudWxsO1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJUdXJuc3RpbGUgbG9naW4gZXJyb3IgY2FsbGJhY2s6XCIsIGVycik7XG4gICAgICAgICAgc2hvd0Vycm9yKGBFcnJldXIgQ0FQVENIQSAobG9naW4pOiAke2Vycn0uIFZldWlsbGV6IHLDqWVzc2F5ZXIuYCk7XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICAgIGlmICh0dXJuc3RpbGVMb2dpbldpZGdldElkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcbiAgICAgICAgICBcIlR1cm5zdGlsZS5yZW5kZXIgKGxvZ2luKSBkaWQgbm90IHJldHVybiBhIHdpZGdldElkLiBTaXRla2V5IG9yIGNvbnRhaW5lciBpc3N1ZT9cIlxuICAgICAgICApO1xuICAgICAgICBzaG93RXJyb3IoXG4gICAgICAgICAgXCJFcnJldXIgaW5pdGlhbGlzYXRpb24gQ0FQVENIQSAobG9naW4sIElEIHdpZGdldCBub24gcmV0b3VybsOpKS5cIlxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgXCJUdXJuc3RpbGUgbG9naW4gd2lkZ2V0IHJlbmRlcmVkLiBJRDpcIixcbiAgICAgICAgICB0dXJuc3RpbGVMb2dpbldpZGdldElkXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHJlbmRlcmluZyBUdXJuc3RpbGUgZm9yIGxvZ2luOlwiLCBlKTtcbiAgICAgIHNob3dFcnJvcihcIkltcG9zc2libGUgZCdhZmZpY2hlciBsZSBDQVBUQ0hBIChsb2dpbikuXCIpO1xuICAgIH1cbiAgfSBlbHNlIGlmICghdHVybnN0aWxlQ29udGFpbmVyKSB7XG4gICAgY29uc29sZS5lcnJvcihcbiAgICAgIFwib25sb2FkVHVybnN0aWxlTG9naW5DYWxsYmFjazogI3R1cm5zdGlsZS1sb2dpbi1jb250YWluZXIgbm90IGZvdW5kLlwiXG4gICAgKTtcbiAgfSBlbHNlIGlmICghd2luZG93LnR1cm5zdGlsZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICBcIm9ubG9hZFR1cm5zdGlsZUxvZ2luQ2FsbGJhY2s6IHdpbmRvdy50dXJuc3RpbGUgQVBJIG5vdCBmb3VuZC5cIlxuICAgICk7XG4gIH0gZWxzZSBpZiAodHVybnN0aWxlTG9naW5XaWRnZXRJZCkge1xuICAgIGNvbnNvbGUubG9nKFxuICAgICAgXCJvbmxvYWRUdXJuc3RpbGVMb2dpbkNhbGxiYWNrOiBMb2dpbiB3aWRnZXQgYWxyZWFkeSBzZWVtcyByZW5kZXJlZC5cIlxuICAgICk7XG4gIH1cbn07XG5cbi8qKlxuICogSW5pdGlhbGl6ZXMgdGhlIGxvZ2luIHBhZ2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGluaXRMb2dpblBhZ2UoKSB7XG4gIGNvbnN0IGxvZ2luRm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibG9naW5Gb3JtXCIpO1xuICBjb25zdCBlcnJvck1lc3NhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImVycm9yTWVzc2FnZVwiKTtcbiAgY29uc3QgdG9nZ2xlUGFzc3dvcmRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInRvZ2dsZVBhc3N3b3JkXCIpO1xuICBjb25zdCBwYXNzd29yZElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwYXNzd29yZFwiKTtcbiAgY29uc3QgZ29vZ2xlU2lnbkluQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJnb29nbGVTaWduSW5CdG5cIik7XG5cbiAgLy8gU2V0IHVwIHBhc3N3b3JkIHZpc2liaWxpdHkgdG9nZ2xlXG4gIGlmICh0b2dnbGVQYXNzd29yZEJ0biAmJiBwYXNzd29yZElucHV0KSB7XG4gICAgdG9nZ2xlUGFzc3dvcmRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHR5cGUgPVxuICAgICAgICBwYXNzd29yZElucHV0LmdldEF0dHJpYnV0ZShcInR5cGVcIikgPT09IFwicGFzc3dvcmRcIiA/IFwidGV4dFwiIDogXCJwYXNzd29yZFwiO1xuICAgICAgcGFzc3dvcmRJbnB1dC5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIHR5cGUpO1xuXG4gICAgICAvLyBUb2dnbGUgaWNvblxuICAgICAgY29uc3QgaWNvbkVsZW1lbnQgPSB0b2dnbGVQYXNzd29yZEJ0bi5xdWVyeVNlbGVjdG9yKFwiaVwiKTtcbiAgICAgIGlmICh0eXBlID09PSBcInBhc3N3b3JkXCIpIHtcbiAgICAgICAgaWNvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImJpLWV5ZVwiKTtcbiAgICAgICAgaWNvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImJpLWV5ZS1zbGFzaFwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGljb25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJiaS1leWUtc2xhc2hcIik7XG4gICAgICAgIGljb25FbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJiaS1leWVcIik7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBpZiAobG9naW5Gb3JtKSB7XG4gICAgbG9naW5Gb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgYXN5bmMgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgLy8gUmVzZXQgbWVzc2FnZXNcbiAgICAgIGlmIChlcnJvck1lc3NhZ2UpIHtcbiAgICAgICAgZXJyb3JNZXNzYWdlLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gICAgICAgIGVycm9yTWVzc2FnZS50ZXh0Q29udGVudCA9IFwiXCI7XG4gICAgICB9XG4gICAgICAvLyBFbnN1cmUgc3RhdHVzIG1lc3NhZ2UgaXMgYWxzbyBoaWRkZW4gb24gbmV3IHN1Ym1pdFxuICAgICAgY29uc3Qgc3RhdHVzTWVzc2FnZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN0YXR1c01lc3NhZ2VcIik7XG4gICAgICBpZiAoc3RhdHVzTWVzc2FnZUVsZW1lbnQpIHtcbiAgICAgICAgc3RhdHVzTWVzc2FnZUVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICAgICAgc3RhdHVzTWVzc2FnZUVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgZm9ybSB2YWx1ZXNcbiAgICAgIGNvbnN0IGVtYWlsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJlbWFpbFwiKS52YWx1ZTtcbiAgICAgIGNvbnN0IHBhc3N3b3JkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwYXNzd29yZFwiKS52YWx1ZTtcblxuICAgICAgLy8gQmFzaWMgdmFsaWRhdGlvblxuICAgICAgaWYgKCFlbWFpbCB8fCAhcGFzc3dvcmQpIHtcbiAgICAgICAgc2hvd0Vycm9yKFwiVmV1aWxsZXogcmVtcGxpciB0b3VzIGxlcyBjaGFtcHMuXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICghY2FwdGNoYUxvZ2luVG9rZW4pIHtcbiAgICAgICAgc2hvd0Vycm9yKFwiVmV1aWxsZXogY29tcGzDqXRlciBsZSBDQVBUQ0hBLlwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBTaG93IGxvYWRpbmcgc3RhdGVcbiAgICAgIHNob3dMb2FkaW5nKFwibG9naW5CdG5cIiwgXCJsb2dpblNwaW5uZXJcIik7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIENhbGwgbG9naW4gZnVuY3Rpb25cbiAgICAgICAgYXdhaXQgbG9naW4oZW1haWwsIHBhc3N3b3JkKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJMb2dpbiBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICBzaG93RXJyb3IoXG4gICAgICAgICAgZXJyb3IubWVzc2FnZSB8fCBcIkxhIGNvbm5leGlvbiBhIMOpY2hvdcOpLiBWw6lyaWZpZXogdm9zIGlkZW50aWZpYW50cy5cIlxuICAgICAgICApO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgLy8gUmVzZXQgYnV0dG9uIHN0YXRlXG4gICAgICAgIGhpZGVMb2FkaW5nKFwibG9naW5CdG5cIiwgXCJsb2dpblNwaW5uZXJcIik7XG4gICAgICAgIGlmICh3aW5kb3cudHVybnN0aWxlICYmIHR1cm5zdGlsZUxvZ2luV2lkZ2V0SWQpIHtcbiAgICAgICAgICB3aW5kb3cudHVybnN0aWxlLnJlc2V0KHR1cm5zdGlsZUxvZ2luV2lkZ2V0SWQpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiVHVybnN0aWxlIGxvZ2luIHdpZGdldCBoYXMgYmVlbiByZXNldC5cIik7XG4gICAgICAgIH1cbiAgICAgICAgY2FwdGNoYUxvZ2luVG9rZW4gPSBudWxsOyAvLyBDbGVhciB0b2tlbiBhZnRlciB1c2VcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8vIEV2ZW50IGxpc3RlbmVyIGZvciBHb29nbGUgU2lnbi1JbiBidXR0b25cbiAgaWYgKGdvb2dsZVNpZ25JbkJ0bikge1xuICAgIGdvb2dsZVNpZ25JbkJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgc2hvd0xvYWRpbmcoXCJnb29nbGVTaWduSW5CdG5cIiwgXCJnb29nbGVTaWduSW5TcGlubmVyXCIpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5zaWduSW5XaXRoT0F1dGgoe1xuICAgICAgICAgIHByb3ZpZGVyOiBcImdvb2dsZVwiLFxuICAgICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgIC8vIE9wdGlvbmFsOiByZWRpcmVjdFRvIGNhbiBiZSB1c2VkIHRvIHNwZWNpZnkgd2hlcmUgdXNlcnMgYXJlIHNlbnQgYWZ0ZXIgc2lnbi1pbi5cbiAgICAgICAgICAgIC8vIHJlZGlyZWN0VG86IGAke3dpbmRvdy5sb2NhdGlvbi5vcmlnaW59L3Byb2ZpbGUuaHRtbGBcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHNpZ25pbmcgaW4gd2l0aCBHb29nbGU6XCIsIGVycm9yKTtcbiAgICAgICAgICBzaG93RXJyb3IoXG4gICAgICAgICAgICBlcnJvci5tZXNzYWdlIHx8IFwiRXJyZXVyIGxvcnMgZGUgbGEgY29ubmV4aW9uIGF2ZWMgR29vZ2xlLlwiXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBPbiBzdWNjZXNzLCBTdXBhYmFzZSBoYW5kbGVzIHRoZSByZWRpcmVjdC5cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFeGNlcHRpb24gZHVyaW5nIEdvb2dsZSBzaWduLWluOlwiLCBlcnJvcik7XG4gICAgICAgIHNob3dFcnJvcihcbiAgICAgICAgICBcIlVuZSBleGNlcHRpb24gZXN0IHN1cnZlbnVlIGxvcnMgZGUgbGEgY29ubmV4aW9uIGF2ZWMgR29vZ2xlLlwiXG4gICAgICAgICk7XG4gICAgICB9IGZpbmFsbHkge1xuICAgICAgICBoaWRlTG9hZGluZyhcImdvb2dsZVNpZ25JbkJ0blwiLCBcImdvb2dsZVNpZ25JblNwaW5uZXJcIik7XG4gICAgICB9XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS53YXJuKFwiR29vZ2xlIFNpZ24tSW4gYnV0dG9uIChnb29nbGVTaWduSW5CdG4pIG5vdCBmb3VuZC5cIik7XG4gIH1cbn1cblxuLyoqXG4gKiBMb2dzIGluIGEgdXNlciB3aXRoIGVtYWlsIGFuZCBwYXNzd29yZCBkaXJlY3RseSB3aXRoIFN1cGFiYXNlXG4gKiBAcGFyYW0ge3N0cmluZ30gZW1haWwgLSBVc2VyJ3MgZW1haWxcbiAqIEBwYXJhbSB7c3RyaW5nfSBwYXNzd29yZCAtIFVzZXIncyBwYXNzd29yZFxuICogQHJldHVybnMge1Byb21pc2V9IC0gUHJvbWlzZSByZXNvbHZlZCB3aXRoIHRoZSB1c2VyIGRhdGEgb24gc3VjY2Vzc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9naW4oZW1haWwsIHBhc3N3b3JkKSB7XG4gIHRyeSB7XG4gICAgLy8gQ2FsbCBTdXBhYmFzZSBhdXRoZW50aWNhdGlvbiBkaXJlY3RseVxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnbkluV2l0aFBhc3N3b3JkKHtcbiAgICAgIGVtYWlsLFxuICAgICAgcGFzc3dvcmQsXG4gICAgICBvcHRpb25zOiB7IGNhcHRjaGFUb2tlbjogY2FwdGNoYUxvZ2luVG9rZW4gfSwgLy8gUGFzcyBjYXB0Y2hhIHRva2VuXG4gICAgfSk7XG5cbiAgICAvLyBDaGVjayBmb3IgZXJyb3JzXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICAvLyBIYW5kbGUgc3BlY2lmaWMgZXJyb3IgY2FzZXNcbiAgICAgIGlmIChlcnJvci5tZXNzYWdlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJlbWFpbCBub3QgY29uZmlybWVkXCIpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBcIlZvdHJlIGVtYWlsIG4nYSBwYXMgw6l0w6kgY29uZmlybcOpLiBWZXVpbGxleiB2w6lyaWZpZXIgdm90cmUgYm/DrnRlIGRlIHLDqWNlcHRpb24uXCJcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIGVycm9yLm1lc3NhZ2UudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhcImludmFsaWQgbG9naW4gY3JlZGVudGlhbHNcIilcbiAgICAgICkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJFbWFpbCBvdSBtb3QgZGUgcGFzc2UgaW5jb3JyZWN0LlwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvci5tZXNzYWdlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBObyBzZXNzaW9uIGRhdGFcbiAgICBpZiAoIWRhdGEuc2Vzc2lvbikge1xuICAgICAgY29uc29sZS5lcnJvcihcbiAgICAgICAgXCJMb2dpbiBlcnJvcjogTWlzc2luZyBzZXNzaW9uIGRhdGEgZnJvbSBTdXBhYmFzZSByZXNwb25zZVwiLFxuICAgICAgICBkYXRhXG4gICAgICApO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRG9ubsOpZXMgZGUgc2Vzc2lvbiBtYW5xdWFudGVzIGFwcsOocyBsYSBjb25uZXhpb24uXCIpO1xuICAgIH1cblxuICAgIC8vIFNhdmUgdXNlciBkYXRhIGxvY2FsbHkgaWYgbmVlZGVkXG4gICAgaWYgKGRhdGEudXNlcikge1xuICAgICAgc2V0Q3VycmVudFVzZXIoZGF0YS51c2VyKTtcbiAgICAgIGNvbnNvbGUubG9nKFwiW2xvZ2luLmpzXSBVc2VyIGRhdGEgc2F2ZWQgbG9jYWxseVwiKTtcbiAgICB9XG5cbiAgICAvLyBTaG93IHN1Y2Nlc3MgbWVzc2FnZSBiZWZvcmUgcmVkaXJlY3RcbiAgICBzaG93U3RhdHVzKFwiQ29ubmV4aW9uIHLDqXVzc2llISBSZWRpcmVjdGlvbi4uLlwiLCBcInN1Y2Nlc3NcIik7XG5cbiAgICAvLyBSZWRpcmVjdCB0byBob21lIHBhZ2UgYWZ0ZXIgYSBzaG9ydCBkZWxheVxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcIi9cIjtcbiAgICB9LCA1MDApO1xuXG4gICAgcmV0dXJuIGRhdGEudXNlcjtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAvLyBMb2cgYW5kIHJlLXRocm93IHRoZSBlcnJvciB0byBiZSBoYW5kbGVkIGJ5IHRoZSBjYWxsZXJcbiAgICBjb25zb2xlLmVycm9yKFwiTG9naW4gZXJyb3I6XCIsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCB7XG4gIGluaXRMb2dpblBhZ2UsXG4gIGxvZ2luLFxufTtcbiIsIi8vIHNyYy9lbnRyaWVzL3NpZ251cC5qc1xuLyoqXG4gKiBMb2dpbiBFbnRyeSBQb2ludFxuICpcbiAqIFRoaXMgbW9kdWxlIHNlcnZlcyBhcyB0aGUgZW50cnkgcG9pbnQgZm9yIHRoZSBsb2dpbiBwYWdlLlxuICovXG5cbi8vIEltcG9ydCBvdXIgbG9naW4gbW9kdWxlXG5pbXBvcnQgeyBpbml0TG9naW5QYWdlIH0gZnJvbSBcIi4uL2F1dGgvbG9naW4uanNcIjtcblxuLy8gSW5pdGlhbGl6ZSBsb2dpbiBwYWdlIHdoZW4gRE9NIGlzIGxvYWRlZFxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgKCkgPT4ge1xuICAvLyBJbml0aWFsaXplIGxvZ2luIHBhZ2VcbiAgaW5pdExvZ2luUGFnZSgpO1xuXG4gIGNvbnNvbGUubG9nKFwiTG9naW4gcGFnZSBpbml0aWFsaXplZFwiKTtcbn0pO1xuIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbi8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG5fX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBfX3dlYnBhY2tfbW9kdWxlc19fO1xuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLmYgPSB7fTtcbi8vIFRoaXMgZmlsZSBjb250YWlucyBvbmx5IHRoZSBlbnRyeSBjaHVuay5cbi8vIFRoZSBjaHVuayBsb2FkaW5nIGZ1bmN0aW9uIGZvciBhZGRpdGlvbmFsIGNodW5rc1xuX193ZWJwYWNrX3JlcXVpcmVfXy5lID0gKGNodW5rSWQpID0+IHtcblx0cmV0dXJuIFByb21pc2UuYWxsKE9iamVjdC5rZXlzKF9fd2VicGFja19yZXF1aXJlX18uZikucmVkdWNlKChwcm9taXNlcywga2V5KSA9PiB7XG5cdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5mW2tleV0oY2h1bmtJZCwgcHJvbWlzZXMpO1xuXHRcdHJldHVybiBwcm9taXNlcztcblx0fSwgW10pKTtcbn07IiwiLy8gVGhpcyBmdW5jdGlvbiBhbGxvdyB0byByZWZlcmVuY2UgYXN5bmMgY2h1bmtzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnUgPSAoY2h1bmtJZCkgPT4ge1xuXHQvLyByZXR1cm4gdXJsIGZvciBmaWxlbmFtZXMgYmFzZWQgb24gdGVtcGxhdGVcblx0cmV0dXJuIFwianMvXCIgKyBjaHVua0lkICsgXCIuYnVuZGxlLmpzXCI7XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18uZyA9IChmdW5jdGlvbigpIHtcblx0aWYgKHR5cGVvZiBnbG9iYWxUaGlzID09PSAnb2JqZWN0JykgcmV0dXJuIGdsb2JhbFRoaXM7XG5cdHRyeSB7XG5cdFx0cmV0dXJuIHRoaXMgfHwgbmV3IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7XG5cdH0gY2F0Y2ggKGUpIHtcblx0XHRpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcpIHJldHVybiB3aW5kb3c7XG5cdH1cbn0pKCk7IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsInZhciBzY3JpcHRVcmw7XG5pZiAoX193ZWJwYWNrX3JlcXVpcmVfXy5nLmltcG9ydFNjcmlwdHMpIHNjcmlwdFVybCA9IF9fd2VicGFja19yZXF1aXJlX18uZy5sb2NhdGlvbiArIFwiXCI7XG52YXIgZG9jdW1lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLmcuZG9jdW1lbnQ7XG5pZiAoIXNjcmlwdFVybCAmJiBkb2N1bWVudCkge1xuXHRpZiAoZG9jdW1lbnQuY3VycmVudFNjcmlwdCAmJiBkb2N1bWVudC5jdXJyZW50U2NyaXB0LnRhZ05hbWUudG9VcHBlckNhc2UoKSA9PT0gJ1NDUklQVCcpXG5cdFx0c2NyaXB0VXJsID0gZG9jdW1lbnQuY3VycmVudFNjcmlwdC5zcmM7XG5cdGlmICghc2NyaXB0VXJsKSB7XG5cdFx0dmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNjcmlwdFwiKTtcblx0XHRpZihzY3JpcHRzLmxlbmd0aCkge1xuXHRcdFx0dmFyIGkgPSBzY3JpcHRzLmxlbmd0aCAtIDE7XG5cdFx0XHR3aGlsZSAoaSA+IC0xICYmICghc2NyaXB0VXJsIHx8ICEvXmh0dHAocz8pOi8udGVzdChzY3JpcHRVcmwpKSkgc2NyaXB0VXJsID0gc2NyaXB0c1tpLS1dLnNyYztcblx0XHR9XG5cdH1cbn1cbi8vIFdoZW4gc3VwcG9ydGluZyBicm93c2VycyB3aGVyZSBhbiBhdXRvbWF0aWMgcHVibGljUGF0aCBpcyBub3Qgc3VwcG9ydGVkIHlvdSBtdXN0IHNwZWNpZnkgYW4gb3V0cHV0LnB1YmxpY1BhdGggbWFudWFsbHkgdmlhIGNvbmZpZ3VyYXRpb25cbi8vIG9yIHBhc3MgYW4gZW1wdHkgc3RyaW5nIChcIlwiKSBhbmQgc2V0IHRoZSBfX3dlYnBhY2tfcHVibGljX3BhdGhfXyB2YXJpYWJsZSBmcm9tIHlvdXIgY29kZSB0byB1c2UgeW91ciBvd24gbG9naWMuXG5pZiAoIXNjcmlwdFVybCkgdGhyb3cgbmV3IEVycm9yKFwiQXV0b21hdGljIHB1YmxpY1BhdGggaXMgbm90IHN1cHBvcnRlZCBpbiB0aGlzIGJyb3dzZXJcIik7XG5zY3JpcHRVcmwgPSBzY3JpcHRVcmwucmVwbGFjZSgvXmJsb2I6LywgXCJcIikucmVwbGFjZSgvIy4qJC8sIFwiXCIpLnJlcGxhY2UoL1xcPy4qJC8sIFwiXCIpLnJlcGxhY2UoL1xcL1teXFwvXSskLywgXCIvXCIpO1xuX193ZWJwYWNrX3JlcXVpcmVfXy5wID0gc2NyaXB0VXJsICsgXCIuLi9cIjsiLCIvLyBubyBiYXNlVVJJXG5cbi8vIG9iamVjdCB0byBzdG9yZSBsb2FkZWQgYW5kIGxvYWRpbmcgY2h1bmtzXG4vLyB1bmRlZmluZWQgPSBjaHVuayBub3QgbG9hZGVkLCBudWxsID0gY2h1bmsgcHJlbG9hZGVkL3ByZWZldGNoZWRcbi8vIFtyZXNvbHZlLCByZWplY3QsIFByb21pc2VdID0gY2h1bmsgbG9hZGluZywgMCA9IGNodW5rIGxvYWRlZFxudmFyIGluc3RhbGxlZENodW5rcyA9IHtcblx0OTY2OiAwXG59O1xuXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmYuaiA9IChjaHVua0lkLCBwcm9taXNlcykgPT4ge1xuXHRcdC8vIEpTT05QIGNodW5rIGxvYWRpbmcgZm9yIGphdmFzY3JpcHRcblx0XHR2YXIgaW5zdGFsbGVkQ2h1bmtEYXRhID0gX193ZWJwYWNrX3JlcXVpcmVfXy5vKGluc3RhbGxlZENodW5rcywgY2h1bmtJZCkgPyBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gOiB1bmRlZmluZWQ7XG5cdFx0aWYoaW5zdGFsbGVkQ2h1bmtEYXRhICE9PSAwKSB7IC8vIDAgbWVhbnMgXCJhbHJlYWR5IGluc3RhbGxlZFwiLlxuXG5cdFx0XHQvLyBhIFByb21pc2UgbWVhbnMgXCJjdXJyZW50bHkgbG9hZGluZ1wiLlxuXHRcdFx0aWYoaW5zdGFsbGVkQ2h1bmtEYXRhKSB7XG5cdFx0XHRcdHByb21pc2VzLnB1c2goaW5zdGFsbGVkQ2h1bmtEYXRhWzJdKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmKHRydWUpIHsgLy8gYWxsIGNodW5rcyBoYXZlIEpTXG5cdFx0XHRcdFx0Ly8gc2V0dXAgUHJvbWlzZSBpbiBjaHVuayBjYWNoZVxuXHRcdFx0XHRcdHZhciBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gKGluc3RhbGxlZENodW5rRGF0YSA9IGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA9IFtyZXNvbHZlLCByZWplY3RdKSk7XG5cdFx0XHRcdFx0cHJvbWlzZXMucHVzaChpbnN0YWxsZWRDaHVua0RhdGFbMl0gPSBwcm9taXNlKTtcblxuXHRcdFx0XHRcdC8vIHN0YXJ0IGNodW5rIGxvYWRpbmdcblx0XHRcdFx0XHR2YXIgdXJsID0gX193ZWJwYWNrX3JlcXVpcmVfXy5wICsgX193ZWJwYWNrX3JlcXVpcmVfXy51KGNodW5rSWQpO1xuXHRcdFx0XHRcdC8vIGNyZWF0ZSBlcnJvciBiZWZvcmUgc3RhY2sgdW53b3VuZCB0byBnZXQgdXNlZnVsIHN0YWNrdHJhY2UgbGF0ZXJcblx0XHRcdFx0XHR2YXIgZXJyb3IgPSBuZXcgRXJyb3IoKTtcblx0XHRcdFx0XHR2YXIgbG9hZGluZ0VuZGVkID0gKGV2ZW50KSA9PiB7XG5cdFx0XHRcdFx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oaW5zdGFsbGVkQ2h1bmtzLCBjaHVua0lkKSkge1xuXHRcdFx0XHRcdFx0XHRpbnN0YWxsZWRDaHVua0RhdGEgPSBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF07XG5cdFx0XHRcdFx0XHRcdGlmKGluc3RhbGxlZENodW5rRGF0YSAhPT0gMCkgaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdID0gdW5kZWZpbmVkO1xuXHRcdFx0XHRcdFx0XHRpZihpbnN0YWxsZWRDaHVua0RhdGEpIHtcblx0XHRcdFx0XHRcdFx0XHR2YXIgZXJyb3JUeXBlID0gZXZlbnQgJiYgKGV2ZW50LnR5cGUgPT09ICdsb2FkJyA/ICdtaXNzaW5nJyA6IGV2ZW50LnR5cGUpO1xuXHRcdFx0XHRcdFx0XHRcdHZhciByZWFsU3JjID0gZXZlbnQgJiYgZXZlbnQudGFyZ2V0ICYmIGV2ZW50LnRhcmdldC5zcmM7XG5cdFx0XHRcdFx0XHRcdFx0ZXJyb3IubWVzc2FnZSA9ICdMb2FkaW5nIGNodW5rICcgKyBjaHVua0lkICsgJyBmYWlsZWQuXFxuKCcgKyBlcnJvclR5cGUgKyAnOiAnICsgcmVhbFNyYyArICcpJztcblx0XHRcdFx0XHRcdFx0XHRlcnJvci5uYW1lID0gJ0NodW5rTG9hZEVycm9yJztcblx0XHRcdFx0XHRcdFx0XHRlcnJvci50eXBlID0gZXJyb3JUeXBlO1xuXHRcdFx0XHRcdFx0XHRcdGVycm9yLnJlcXVlc3QgPSByZWFsU3JjO1xuXHRcdFx0XHRcdFx0XHRcdGluc3RhbGxlZENodW5rRGF0YVsxXShlcnJvcik7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdF9fd2VicGFja19yZXF1aXJlX18ubCh1cmwsIGxvYWRpbmdFbmRlZCwgXCJjaHVuay1cIiArIGNodW5rSWQsIGNodW5rSWQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxufTtcblxuLy8gbm8gcHJlZmV0Y2hpbmdcblxuLy8gbm8gcHJlbG9hZGVkXG5cbi8vIG5vIEhNUlxuXG4vLyBubyBITVIgbWFuaWZlc3RcblxuX193ZWJwYWNrX3JlcXVpcmVfXy5PLmogPSAoY2h1bmtJZCkgPT4gKGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA9PT0gMCk7XG5cbi8vIGluc3RhbGwgYSBKU09OUCBjYWxsYmFjayBmb3IgY2h1bmsgbG9hZGluZ1xudmFyIHdlYnBhY2tKc29ucENhbGxiYWNrID0gKHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uLCBkYXRhKSA9PiB7XG5cdHZhciBbY2h1bmtJZHMsIG1vcmVNb2R1bGVzLCBydW50aW1lXSA9IGRhdGE7XG5cdC8vIGFkZCBcIm1vcmVNb2R1bGVzXCIgdG8gdGhlIG1vZHVsZXMgb2JqZWN0LFxuXHQvLyB0aGVuIGZsYWcgYWxsIFwiY2h1bmtJZHNcIiBhcyBsb2FkZWQgYW5kIGZpcmUgY2FsbGJhY2tcblx0dmFyIG1vZHVsZUlkLCBjaHVua0lkLCBpID0gMDtcblx0aWYoY2h1bmtJZHMuc29tZSgoaWQpID0+IChpbnN0YWxsZWRDaHVua3NbaWRdICE9PSAwKSkpIHtcblx0XHRmb3IobW9kdWxlSWQgaW4gbW9yZU1vZHVsZXMpIHtcblx0XHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhtb3JlTW9kdWxlcywgbW9kdWxlSWQpKSB7XG5cdFx0XHRcdF9fd2VicGFja19yZXF1aXJlX18ubVttb2R1bGVJZF0gPSBtb3JlTW9kdWxlc1ttb2R1bGVJZF07XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmKHJ1bnRpbWUpIHZhciByZXN1bHQgPSBydW50aW1lKF9fd2VicGFja19yZXF1aXJlX18pO1xuXHR9XG5cdGlmKHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uKSBwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbihkYXRhKTtcblx0Zm9yKDtpIDwgY2h1bmtJZHMubGVuZ3RoOyBpKyspIHtcblx0XHRjaHVua0lkID0gY2h1bmtJZHNbaV07XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGluc3RhbGxlZENodW5rcywgY2h1bmtJZCkgJiYgaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdKSB7XG5cdFx0XHRpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF1bMF0oKTtcblx0XHR9XG5cdFx0aW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdID0gMDtcblx0fVxuXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXy5PKHJlc3VsdCk7XG59XG5cbnZhciBjaHVua0xvYWRpbmdHbG9iYWwgPSBzZWxmW1wid2VicGFja0NodW5rdXJiYW5kb2NzX3dlYmFwcFwiXSA9IHNlbGZbXCJ3ZWJwYWNrQ2h1bmt1cmJhbmRvY3Nfd2ViYXBwXCJdIHx8IFtdO1xuY2h1bmtMb2FkaW5nR2xvYmFsLmZvckVhY2god2VicGFja0pzb25wQ2FsbGJhY2suYmluZChudWxsLCAwKSk7XG5jaHVua0xvYWRpbmdHbG9iYWwucHVzaCA9IHdlYnBhY2tKc29ucENhbGxiYWNrLmJpbmQobnVsbCwgY2h1bmtMb2FkaW5nR2xvYmFsLnB1c2guYmluZChjaHVua0xvYWRpbmdHbG9iYWwpKTsiLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGRlcGVuZHMgb24gb3RoZXIgbG9hZGVkIGNodW5rcyBhbmQgZXhlY3V0aW9uIG5lZWQgdG8gYmUgZGVsYXllZFxudmFyIF9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fLk8odW5kZWZpbmVkLCBbMzAzXSwgKCkgPT4gKF9fd2VicGFja19yZXF1aXJlX18oNDE4KSkpXG5fX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXy5PKF9fd2VicGFja19leHBvcnRzX18pO1xuIl0sIm5hbWVzIjpbImRlZmVycmVkIiwibGVhZlByb3RvdHlwZXMiLCJnZXRQcm90byIsImluUHJvZ3Jlc3MiLCJkYXRhV2VicGFja1ByZWZpeCIsInN1cGFiYXNlIiwiY3VycmVudFVzZXIiLCJzaG93RXJyb3IiLCJtZXNzYWdlIiwiZWxlbWVudElkIiwiZXJyb3JFbGVtZW50IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImlubmVySFRNTCIsImNsYXNzTGlzdCIsInJlbW92ZSIsImNvbnNvbGUiLCJlcnJvciIsInNob3dMb2FkaW5nIiwiYnV0dG9uSWQiLCJzcGlubmVySWQiLCJidXR0b24iLCJzcGlubmVyIiwiZGlzYWJsZWQiLCJoaWRlTG9hZGluZyIsImFkZCIsImNhcHRjaGFMb2dpblRva2VuIiwidHVybnN0aWxlTG9naW5XaWRnZXRJZCIsImluaXRMb2dpblBhZ2UiLCJsb2dpbkZvcm0iLCJlcnJvck1lc3NhZ2UiLCJ0b2dnbGVQYXNzd29yZEJ0biIsInBhc3N3b3JkSW5wdXQiLCJnb29nbGVTaWduSW5CdG4iLCJhZGRFdmVudExpc3RlbmVyIiwidHlwZSIsImdldEF0dHJpYnV0ZSIsInNldEF0dHJpYnV0ZSIsImljb25FbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImFzeW5jIiwiZSIsInByZXZlbnREZWZhdWx0IiwidGV4dENvbnRlbnQiLCJzdGF0dXNNZXNzYWdlRWxlbWVudCIsImVtYWlsIiwidmFsdWUiLCJwYXNzd29yZCIsImRhdGEiLCJhdXRoIiwic2lnbkluV2l0aFBhc3N3b3JkIiwib3B0aW9ucyIsImNhcHRjaGFUb2tlbiIsInRvTG93ZXJDYXNlIiwiaW5jbHVkZXMiLCJFcnJvciIsInNlc3Npb24iLCJ1c2VyIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsIkpTT04iLCJzdHJpbmdpZnkiLCJyZW1vdmVJdGVtIiwibG9nIiwic3RhdHVzRWxlbWVudCIsImZvckVhY2giLCJjbGFzc05hbWUiLCJzdGFydHNXaXRoIiwic2hvd1N0YXR1cyIsInNldFRpbWVvdXQiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsImhyZWYiLCJsb2dpbiIsInR1cm5zdGlsZSIsInJlc2V0Iiwic2lnbkluV2l0aE9BdXRoIiwicHJvdmlkZXIiLCJ3YXJuIiwib25sb2FkVHVybnN0aWxlTG9naW5DYWxsYmFjayIsInR1cm5zdGlsZUNvbnRhaW5lciIsInJlbmRlciIsInNpdGVrZXkiLCJjYWxsYmFjayIsInRva2VuIiwiZXJyIiwidW5kZWZpbmVkIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwiZXhwb3J0cyIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJjYWxsIiwibSIsIk8iLCJyZXN1bHQiLCJjaHVua0lkcyIsImZuIiwicHJpb3JpdHkiLCJub3RGdWxmaWxsZWQiLCJJbmZpbml0eSIsImkiLCJsZW5ndGgiLCJmdWxmaWxsZWQiLCJqIiwiT2JqZWN0Iiwia2V5cyIsImV2ZXJ5Iiwia2V5Iiwic3BsaWNlIiwiciIsImdldFByb3RvdHlwZU9mIiwib2JqIiwidCIsIm1vZGUiLCJ0aGlzIiwiX19lc01vZHVsZSIsInRoZW4iLCJucyIsImNyZWF0ZSIsImRlZiIsImN1cnJlbnQiLCJpbmRleE9mIiwiZ2V0T3duUHJvcGVydHlOYW1lcyIsImQiLCJkZWZpbml0aW9uIiwibyIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsImYiLCJjaHVua0lkIiwiUHJvbWlzZSIsImFsbCIsInJlZHVjZSIsInByb21pc2VzIiwidSIsImciLCJnbG9iYWxUaGlzIiwiRnVuY3Rpb24iLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJsIiwidXJsIiwiZG9uZSIsInB1c2giLCJzY3JpcHQiLCJuZWVkQXR0YWNoIiwic2NyaXB0cyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwicyIsImNyZWF0ZUVsZW1lbnQiLCJjaGFyc2V0IiwidGltZW91dCIsIm5jIiwic3JjIiwib25TY3JpcHRDb21wbGV0ZSIsInByZXYiLCJldmVudCIsIm9uZXJyb3IiLCJvbmxvYWQiLCJjbGVhclRpbWVvdXQiLCJkb25lRm5zIiwicGFyZW50Tm9kZSIsInJlbW92ZUNoaWxkIiwiYmluZCIsInRhcmdldCIsImhlYWQiLCJhcHBlbmRDaGlsZCIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwic2NyaXB0VXJsIiwiaW1wb3J0U2NyaXB0cyIsImN1cnJlbnRTY3JpcHQiLCJ0YWdOYW1lIiwidG9VcHBlckNhc2UiLCJ0ZXN0IiwicmVwbGFjZSIsInAiLCJpbnN0YWxsZWRDaHVua3MiLCJpbnN0YWxsZWRDaHVua0RhdGEiLCJwcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImVycm9yVHlwZSIsInJlYWxTcmMiLCJuYW1lIiwicmVxdWVzdCIsIndlYnBhY2tKc29ucENhbGxiYWNrIiwicGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24iLCJtb3JlTW9kdWxlcyIsInJ1bnRpbWUiLCJzb21lIiwiaWQiLCJjaHVua0xvYWRpbmdHbG9iYWwiLCJzZWxmIiwiX193ZWJwYWNrX2V4cG9ydHNfXyJdLCJzb3VyY2VSb290IjoiIn0=