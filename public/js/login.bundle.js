(()=>{"use strict";var e,n,t,o,r,i={418:(e,n,t)=>{const o=(0,t(303).UU)("https://ofeyssipibktmbfebibo.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9mZXlzc2lwaWJrdG1iZmViaWJvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM5MjUwOTQsImV4cCI6MjA1OTUwMTA5NH0.w71CAKfolktzRl-TmLVhHYaEbhCfVk4A7YraEUCglrU");let r=null;function i(e,n="errorMessage"){const t=document.getElementById(n);t?(t.innerHTML=e,t.classList.remove("hidden")):console.error("Error element not found:",n)}function s(e,n){const t=document.getElementById(e),o=document.getElementById(n);t&&(t.disabled=!0),o&&o.classList.remove("hidden")}function l(e,n){const t=document.getElementById(e),o=document.getElementById(n);t&&(t.disabled=!1),o&&o.classList.add("hidden")}let a=null,c=null;function d(){const e=document.getElementById("loginForm"),n=document.getElementById("errorMessage"),t=document.getElementById("togglePassword"),d=document.getElementById("password"),u=document.getElementById("googleSignInBtn");t&&d&&t.addEventListener("click",(()=>{const e="password"===d.getAttribute("type")?"text":"password";d.setAttribute("type",e);const n=t.querySelector("i");"password"===e?(n.classList.remove("bi-eye"),n.classList.add("bi-eye-slash")):(n.classList.remove("bi-eye-slash"),n.classList.add("bi-eye"))})),e&&e.addEventListener("submit",(async e=>{e.preventDefault(),n&&(n.classList.add("hidden"),n.textContent="");const t=document.getElementById("statusMessage");t&&(t.classList.add("hidden"),t.textContent="");const d=document.getElementById("email").value,u=document.getElementById("password").value;if(d&&u)if(a){s("loginBtn","loginSpinner");try{await async function(e,n){try{const{data:i,error:s}=await o.auth.signInWithPassword({email:e,password:n,options:{captchaToken:a}});if(s)throw s.message.toLowerCase().includes("email not confirmed")?new Error("Votre email n'a pas été confirmé. Veuillez vérifier votre boîte de réception."):s.message.toLowerCase().includes("invalid login credentials")?new Error("Email ou mot de passe incorrect."):new Error(s.message);if(!i.session)throw console.error("Login error: Missing session data from Supabase response",i),new Error("Données de session manquantes après la connexion.");return i.user&&(t=i.user,r=t,t?localStorage.setItem("currentUser",JSON.stringify(t)):localStorage.removeItem("currentUser"),console.log("[login.js] User data saved locally")),function(e,n="info",t="statusMessage"){const o=document.getElementById(t);o?(o.textContent=e,o.classList.forEach((e=>{e.startsWith("alert-")&&o.classList.remove(e)})),o.classList.add(`alert-${n}`),o.classList.remove("hidden")):console.error("Status element not found:",t)}("Connexion réussie! Redirection...","success"),setTimeout((()=>{window.location.href="/"}),500),i.user}catch(e){throw console.error("Login error:",e),e}var t}(d,u)}catch(e){console.error("Login error:",e),i(e.message||"La connexion a échoué. Vérifiez vos identifiants.")}finally{l("loginBtn","loginSpinner"),window.turnstile&&c&&(window.turnstile.reset(c),console.log("Turnstile login widget has been reset.")),a=null}}else i("Veuillez compléter le CAPTCHA.");else i("Veuillez remplir tous les champs.")})),u?u.addEventListener("click",(async()=>{s("googleSignInBtn","googleSignInSpinner");try{const{error:e}=await o.auth.signInWithOAuth({provider:"google",options:{}});e&&(console.error("Error signing in with Google:",e),i(e.message||"Erreur lors de la connexion avec Google."))}catch(e){console.error("Exception during Google sign-in:",e),i("Une exception est survenue lors de la connexion avec Google.")}finally{l("googleSignInBtn","googleSignInSpinner")}})):console.warn("Google Sign-In button (googleSignInBtn) not found.")}window.onloadTurnstileLoginCallback=function(){console.log("Turnstile Login API ready (onloadTurnstileLoginCallback executed).");const e=document.getElementById("turnstile-login-container");if(e&&window.turnstile&&!c){console.log("Rendering Turnstile widget for login...");try{c=window.turnstile.render(e,{sitekey:"0x4AAAAAABdzY3InOU2_In99",callback:function(e){a=e,console.log("Turnstile login token obtained:",e)},"expired-callback":()=>{console.log("Turnstile login token expired. Resetting widget. ID:",c),window.turnstile&&c&&window.turnstile.reset(c),a=null},"error-callback":e=>{a=null,console.error("Turnstile login error callback:",e),i(`Erreur CAPTCHA (login): ${e}. Veuillez réessayer.`)}}),void 0===c?(console.error("Turnstile.render (login) did not return a widgetId. Sitekey or container issue?"),i("Erreur initialisation CAPTCHA (login, ID widget non retourné).")):console.log("Turnstile login widget rendered. ID:",c)}catch(e){console.error("Error rendering Turnstile for login:",e),i("Impossible d'afficher le CAPTCHA (login).")}}else e?window.turnstile?c&&console.log("onloadTurnstileLoginCallback: Login widget already seems rendered."):console.error("onloadTurnstileLoginCallback: window.turnstile API not found."):console.error("onloadTurnstileLoginCallback: #turnstile-login-container not found.")},document.addEventListener("DOMContentLoaded",(()=>{d(),console.log("Login page initialized")}))}},s={};function l(e){var n=s[e];if(void 0!==n)return n.exports;var t=s[e]={exports:{}};return i[e].call(t.exports,t,t.exports,l),t.exports}l.m=i,e=[],l.O=(n,t,o,r)=>{if(!t){var i=1/0;for(d=0;d<e.length;d++){for(var[t,o,r]=e[d],s=!0,a=0;a<t.length;a++)(!1&r||i>=r)&&Object.keys(l.O).every((e=>l.O[e](t[a])))?t.splice(a--,1):(s=!1,r<i&&(i=r));if(s){e.splice(d--,1);var c=o();void 0!==c&&(n=c)}}return n}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[t,o,r]},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,l.t=function(e,o){if(1&o&&(e=this(e)),8&o)return e;if("object"==typeof e&&e){if(4&o&&e.__esModule)return e;if(16&o&&"function"==typeof e.then)return e}var r=Object.create(null);l.r(r);var i={};n=n||[null,t({}),t([]),t(t)];for(var s=2&o&&e;"object"==typeof s&&!~n.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((n=>i[n]=()=>e[n]));return i.default=()=>e,l.d(r,i),r},l.d=(e,n)=>{for(var t in n)l.o(n,t)&&!l.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},l.f={},l.e=e=>Promise.all(Object.keys(l.f).reduce(((n,t)=>(l.f[t](e,n),n)),[])),l.u=e=>"js/"+e+".bundle.js",l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),o={},r="urbandocs_webapp:",l.l=(e,n,t,i)=>{if(o[e])o[e].push(n);else{var s,a;if(void 0!==t)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==r+t){s=u;break}}s||(a=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,l.nc&&s.setAttribute("nonce",l.nc),s.setAttribute("data-webpack",r+t),s.src=e),o[e]=[n];var g=(n,t)=>{s.onerror=s.onload=null,clearTimeout(m);var r=o[e];if(delete o[e],s.parentNode&&s.parentNode.removeChild(s),r&&r.forEach((e=>e(t))),n)return n(t)},m=setTimeout(g.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=g.bind(null,s.onerror),s.onload=g.bind(null,s.onload),a&&document.head.appendChild(s)}},l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;l.g.importScripts&&(e=l.g.location+"");var n=l.g.document;if(!e&&n&&(n.currentScript&&"SCRIPT"===n.currentScript.tagName.toUpperCase()&&(e=n.currentScript.src),!e)){var t=n.getElementsByTagName("script");if(t.length)for(var o=t.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=t[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),l.p=e+"../"})(),(()=>{var e={966:0};l.f.j=(n,t)=>{var o=l.o(e,n)?e[n]:void 0;if(0!==o)if(o)t.push(o[2]);else{var r=new Promise(((t,r)=>o=e[n]=[t,r]));t.push(o[2]=r);var i=l.p+l.u(n),s=new Error;l.l(i,(t=>{if(l.o(e,n)&&(0!==(o=e[n])&&(e[n]=void 0),o)){var r=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;s.message="Loading chunk "+n+" failed.\n("+r+": "+i+")",s.name="ChunkLoadError",s.type=r,s.request=i,o[1](s)}}),"chunk-"+n,n)}},l.O.j=n=>0===e[n];var n=(n,t)=>{var o,r,[i,s,a]=t,c=0;if(i.some((n=>0!==e[n]))){for(o in s)l.o(s,o)&&(l.m[o]=s[o]);if(a)var d=a(l)}for(n&&n(t);c<i.length;c++)r=i[c],l.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return l.O(d)},t=self.webpackChunkurbandocs_webapp=self.webpackChunkurbandocs_webapp||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))})();var a=l.O(void 0,[303],(()=>l(418)));a=l.O(a)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dEssRUFDdkIsQ0FDRCxHQUV3QyxTQUFXb0gsRUFBU0EsRUFFL0QsQ0FDRCxFQVdGN0MsRUFBb0JRLEVBQUVVLEVBQUsyQixHQUEwQyxJQUE3QmlELEVBQWdCakQsR0FHeEQsSUFBSTBELEVBQXVCLENBQUNDLEVBQTRCaEosS0FDdkQsSUFHSXlDLEVBQVU0QyxHQUhUbkMsRUFBVStGLEVBQWFDLEdBQVdsSixFQUdoQnVELEVBQUksRUFDM0IsR0FBR0wsRUFBU2lHLE1BQU1DLEdBQWdDLElBQXhCZCxFQUFnQmMsS0FBYSxDQUN0RCxJQUFJM0csS0FBWXdHLEVBQ1p6RyxFQUFvQndDLEVBQUVpRSxFQUFheEcsS0FDckNELEVBQW9CTyxFQUFFTixHQUFZd0csRUFBWXhHLElBR2hELEdBQUd5RyxFQUFTLElBQUlqRyxFQUFTaUcsRUFBUTFHLEVBQ2xDLENBRUEsSUFER3dHLEdBQTRCQSxFQUEyQmhKLEdBQ3JEdUQsRUFBSUwsRUFBU00sT0FBUUQsSUFDekI4QixFQUFVbkMsRUFBU0ssR0FDaEJmLEVBQW9Cd0MsRUFBRXNELEVBQWlCakQsSUFBWWlELEVBQWdCakQsSUFDckVpRCxFQUFnQmpELEdBQVMsS0FFMUJpRCxFQUFnQmpELEdBQVcsRUFFNUIsT0FBTzdDLEVBQW9CUSxFQUFFQyxFQUFPLEVBR2pDb0csRUFBcUJDLEtBQW1DLDZCQUFJQSxLQUFtQyw4QkFBSyxHQUN4R0QsRUFBbUJwSSxRQUFROEgsRUFBcUJ2QixLQUFLLEtBQU0sSUFDM0Q2QixFQUFtQmpELEtBQU8yQyxFQUFxQnZCLEtBQUssS0FBTTZCLEVBQW1CakQsS0FBS29CLEtBQUs2QixHLEtDbEZ2RixJQUFJRSxFQUFzQi9HLEVBQW9CUSxPQUFFVixFQUFXLENBQUMsTUFBTSxJQUFPRSxFQUFvQixPQUM3RitHLEVBQXNCL0csRUFBb0JRLEVBQUV1RyxFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvY2h1bmsgbG9hZGVkIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2NyZWF0ZSBmYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvbG9hZCBzY3JpcHQiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC8uL3NyYy9qcy9zdXBhYmFzZS1jbGllbnQuanMiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC8uL3NyYy9qcy9hdXRoL2F1dGguanMiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC8uL3NyYy9qcy9hdXRoL2xvZ2luLmpzIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvLi9zcmMvanMvZW50cmllcy9sb2dpbi5qcyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2Vuc3VyZSBjaHVuayIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9nZXQgamF2YXNjcmlwdCBjaHVuayBmaWxlbmFtZSIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9nbG9iYWwiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL21ha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9wdWJsaWNQYXRoIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2pzb25wIGNodW5rIGxvYWRpbmciLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3N0YXJ0dXAiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIGRlZmVycmVkID0gW107XG5fX3dlYnBhY2tfcmVxdWlyZV9fLk8gPSAocmVzdWx0LCBjaHVua0lkcywgZm4sIHByaW9yaXR5KSA9PiB7XG5cdGlmKGNodW5rSWRzKSB7XG5cdFx0cHJpb3JpdHkgPSBwcmlvcml0eSB8fCAwO1xuXHRcdGZvcih2YXIgaSA9IGRlZmVycmVkLmxlbmd0aDsgaSA+IDAgJiYgZGVmZXJyZWRbaSAtIDFdWzJdID4gcHJpb3JpdHk7IGktLSkgZGVmZXJyZWRbaV0gPSBkZWZlcnJlZFtpIC0gMV07XG5cdFx0ZGVmZXJyZWRbaV0gPSBbY2h1bmtJZHMsIGZuLCBwcmlvcml0eV07XG5cdFx0cmV0dXJuO1xuXHR9XG5cdHZhciBub3RGdWxmaWxsZWQgPSBJbmZpbml0eTtcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCBkZWZlcnJlZC5sZW5ndGg7IGkrKykge1xuXHRcdHZhciBbY2h1bmtJZHMsIGZuLCBwcmlvcml0eV0gPSBkZWZlcnJlZFtpXTtcblx0XHR2YXIgZnVsZmlsbGVkID0gdHJ1ZTtcblx0XHRmb3IgKHZhciBqID0gMDsgaiA8IGNodW5rSWRzLmxlbmd0aDsgaisrKSB7XG5cdFx0XHRpZiAoKHByaW9yaXR5ICYgMSA9PT0gMCB8fCBub3RGdWxmaWxsZWQgPj0gcHJpb3JpdHkpICYmIE9iamVjdC5rZXlzKF9fd2VicGFja19yZXF1aXJlX18uTykuZXZlcnkoKGtleSkgPT4gKF9fd2VicGFja19yZXF1aXJlX18uT1trZXldKGNodW5rSWRzW2pdKSkpKSB7XG5cdFx0XHRcdGNodW5rSWRzLnNwbGljZShqLS0sIDEpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZnVsZmlsbGVkID0gZmFsc2U7XG5cdFx0XHRcdGlmKHByaW9yaXR5IDwgbm90RnVsZmlsbGVkKSBub3RGdWxmaWxsZWQgPSBwcmlvcml0eTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYoZnVsZmlsbGVkKSB7XG5cdFx0XHRkZWZlcnJlZC5zcGxpY2UoaS0tLCAxKVxuXHRcdFx0dmFyIHIgPSBmbigpO1xuXHRcdFx0aWYgKHIgIT09IHVuZGVmaW5lZCkgcmVzdWx0ID0gcjtcblx0XHR9XG5cdH1cblx0cmV0dXJuIHJlc3VsdDtcbn07IiwidmFyIGdldFByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mID8gKG9iaikgPT4gKE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmopKSA6IChvYmopID0+IChvYmouX19wcm90b19fKTtcbnZhciBsZWFmUHJvdG90eXBlcztcbi8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuLy8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4vLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbi8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuLy8gbW9kZSAmIDE2OiByZXR1cm4gdmFsdWUgd2hlbiBpdCdzIFByb21pc2UtbGlrZVxuLy8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuX193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcblx0aWYobW9kZSAmIDEpIHZhbHVlID0gdGhpcyh2YWx1ZSk7XG5cdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG5cdGlmKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUpIHtcblx0XHRpZigobW9kZSAmIDQpICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcblx0XHRpZigobW9kZSAmIDE2KSAmJiB0eXBlb2YgdmFsdWUudGhlbiA9PT0gJ2Z1bmN0aW9uJykgcmV0dXJuIHZhbHVlO1xuXHR9XG5cdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG5cdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG5cdHZhciBkZWYgPSB7fTtcblx0bGVhZlByb3RvdHlwZXMgPSBsZWFmUHJvdG90eXBlcyB8fCBbbnVsbCwgZ2V0UHJvdG8oe30pLCBnZXRQcm90byhbXSksIGdldFByb3RvKGdldFByb3RvKV07XG5cdGZvcih2YXIgY3VycmVudCA9IG1vZGUgJiAyICYmIHZhbHVlOyB0eXBlb2YgY3VycmVudCA9PSAnb2JqZWN0JyAmJiAhfmxlYWZQcm90b3R5cGVzLmluZGV4T2YoY3VycmVudCk7IGN1cnJlbnQgPSBnZXRQcm90byhjdXJyZW50KSkge1xuXHRcdE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGN1cnJlbnQpLmZvckVhY2goKGtleSkgPT4gKGRlZltrZXldID0gKCkgPT4gKHZhbHVlW2tleV0pKSk7XG5cdH1cblx0ZGVmWydkZWZhdWx0J10gPSAoKSA9PiAodmFsdWUpO1xuXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGRlZik7XG5cdHJldHVybiBucztcbn07IiwidmFyIGluUHJvZ3Jlc3MgPSB7fTtcbnZhciBkYXRhV2VicGFja1ByZWZpeCA9IFwidXJiYW5kb2NzX3dlYmFwcDpcIjtcbi8vIGxvYWRTY3JpcHQgZnVuY3Rpb24gdG8gbG9hZCBhIHNjcmlwdCB2aWEgc2NyaXB0IHRhZ1xuX193ZWJwYWNrX3JlcXVpcmVfXy5sID0gKHVybCwgZG9uZSwga2V5LCBjaHVua0lkKSA9PiB7XG5cdGlmKGluUHJvZ3Jlc3NbdXJsXSkgeyBpblByb2dyZXNzW3VybF0ucHVzaChkb25lKTsgcmV0dXJuOyB9XG5cdHZhciBzY3JpcHQsIG5lZWRBdHRhY2g7XG5cdGlmKGtleSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0dmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNjcmlwdFwiKTtcblx0XHRmb3IodmFyIGkgPSAwOyBpIDwgc2NyaXB0cy5sZW5ndGg7IGkrKykge1xuXHRcdFx0dmFyIHMgPSBzY3JpcHRzW2ldO1xuXHRcdFx0aWYocy5nZXRBdHRyaWJ1dGUoXCJzcmNcIikgPT0gdXJsIHx8IHMuZ2V0QXR0cmlidXRlKFwiZGF0YS13ZWJwYWNrXCIpID09IGRhdGFXZWJwYWNrUHJlZml4ICsga2V5KSB7IHNjcmlwdCA9IHM7IGJyZWFrOyB9XG5cdFx0fVxuXHR9XG5cdGlmKCFzY3JpcHQpIHtcblx0XHRuZWVkQXR0YWNoID0gdHJ1ZTtcblx0XHRzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcblxuXHRcdHNjcmlwdC5jaGFyc2V0ID0gJ3V0Zi04Jztcblx0XHRzY3JpcHQudGltZW91dCA9IDEyMDtcblx0XHRpZiAoX193ZWJwYWNrX3JlcXVpcmVfXy5uYykge1xuXHRcdFx0c2NyaXB0LnNldEF0dHJpYnV0ZShcIm5vbmNlXCIsIF9fd2VicGFja19yZXF1aXJlX18ubmMpO1xuXHRcdH1cblx0XHRzY3JpcHQuc2V0QXR0cmlidXRlKFwiZGF0YS13ZWJwYWNrXCIsIGRhdGFXZWJwYWNrUHJlZml4ICsga2V5KTtcblxuXHRcdHNjcmlwdC5zcmMgPSB1cmw7XG5cdH1cblx0aW5Qcm9ncmVzc1t1cmxdID0gW2RvbmVdO1xuXHR2YXIgb25TY3JpcHRDb21wbGV0ZSA9IChwcmV2LCBldmVudCkgPT4ge1xuXHRcdC8vIGF2b2lkIG1lbSBsZWFrcyBpbiBJRS5cblx0XHRzY3JpcHQub25lcnJvciA9IHNjcmlwdC5vbmxvYWQgPSBudWxsO1xuXHRcdGNsZWFyVGltZW91dCh0aW1lb3V0KTtcblx0XHR2YXIgZG9uZUZucyA9IGluUHJvZ3Jlc3NbdXJsXTtcblx0XHRkZWxldGUgaW5Qcm9ncmVzc1t1cmxdO1xuXHRcdHNjcmlwdC5wYXJlbnROb2RlICYmIHNjcmlwdC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHNjcmlwdCk7XG5cdFx0ZG9uZUZucyAmJiBkb25lRm5zLmZvckVhY2goKGZuKSA9PiAoZm4oZXZlbnQpKSk7XG5cdFx0aWYocHJldikgcmV0dXJuIHByZXYoZXZlbnQpO1xuXHR9XG5cdHZhciB0aW1lb3V0ID0gc2V0VGltZW91dChvblNjcmlwdENvbXBsZXRlLmJpbmQobnVsbCwgdW5kZWZpbmVkLCB7IHR5cGU6ICd0aW1lb3V0JywgdGFyZ2V0OiBzY3JpcHQgfSksIDEyMDAwMCk7XG5cdHNjcmlwdC5vbmVycm9yID0gb25TY3JpcHRDb21wbGV0ZS5iaW5kKG51bGwsIHNjcmlwdC5vbmVycm9yKTtcblx0c2NyaXB0Lm9ubG9hZCA9IG9uU2NyaXB0Q29tcGxldGUuYmluZChudWxsLCBzY3JpcHQub25sb2FkKTtcblx0bmVlZEF0dGFjaCAmJiBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHNjcmlwdCk7XG59OyIsIi8vIHNyYy9qcy9zdXBhYmFzZS1jbGllbnQuanNcbi8qKlxuICogU3VwYWJhc2UgQ2xpZW50XG4gKiBAbW9kdWxlIHN1cGFiYXNlLWNsaWVudFxuICogQGRlc2NyaXB0aW9uIFRoaXMgbW9kdWxlIGhhbmRsZXMgdGhlIFN1cGFiYXNlIGNsaWVudCBpbml0aWFsaXphdGlvbiBhbmQgY29uZmlndXJhdGlvbi5cbiAqIEB2ZXJzaW9uIDAuMC4yXG4gKiBAYXV0aG9yIEdyZXlQYW5kYVxuICpcbiAqIEBjaGFuZ2Vsb2dcbiAqIC0gMC4wLjIgKDIwMjUtMDUtMjcpOiBBZGRlZCBlbnZpcm9uZW1lbnQgdmFyaWFibGVzIGVycm9yIGhhbmRsaW5nIGZvciBtaXNzaW5nLlxuICogLSAwLjAuMSAoMjAyNS0wNS0wOSk6IEluaXRpYWwgdmVyc2lvbiB3aXRoIGJhc2ljIFN1cGFiYXNlIGNsaWVudCBpbml0aWFsaXphdGlvbi5cbiAqL1xuXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tIFwiQHN1cGFiYXNlL3N1cGFiYXNlLWpzXCI7XG5cbmNvbnN0IHN1cGFiYXNlVXJsID0gXCJodHRwczovL29mZXlzc2lwaWJrdG1iZmViaWJvLnN1cGFiYXNlLmNvXCI7XG5jb25zdCBzdXBhYmFzZUFub25LZXkgPVxuICBcImV5SmhiR2NpT2lKSVV6STFOaUlzSW5SNWNDSTZJa3BYVkNKOS5leUpwYzNNaU9pSnpkWEJoWW1GelpTSXNJbkpsWmlJNkltOW1aWGx6YzJsd2FXSnJkRzFpWm1WaWFXSnZJaXdpY205c1pTSTZJbUZ1YjI0aUxDSnBZWFFpT2pFM05ETTVNalV3T1RRc0ltVjRjQ0k2TWpBMU9UVXdNVEE1TkgwLnc3MUNBS2ZvbGt0elJsLVRtTFZoSFlhRWJoQ2ZWazRBN1lyYUVVQ2dsclVcIjtcblxuaWYgKCFzdXBhYmFzZVVybCB8fCAhc3VwYWJhc2VBbm9uS2V5KSB7XG4gIHRocm93IG5ldyBFcnJvcihcIk1pc3NpbmcgU3VwYWJhc2UgZW52aXJvbm1lbnQgdmFyaWFibGVzXCIpO1xufVxuXG5jb25zdCBjbGllbnQgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlQW5vbktleSk7XG5cbmV4cG9ydCBjb25zdCBzdXBhYmFzZSA9IGNsaWVudDtcbiIsIi8vIHNyYy9hdXRoL2F1dGguanNcbi8qKlxuICogQXV0aGVudGljYXRpb24gTW9kdWxlIC0gQmFzZVxuICogQG1vZHVsZSBhdXRoXG4gKiBAZGVzY3JpcHRpb24gQmFzZSBtb2R1bGUgZm9yIGF1dGhlbnRpY2F0aW9uIHdpdGggY29tbW9uIGZ1bmN0aW9ucyBhbmQgY29uZmlndXJhdGlvblxuICogQHZlcnNpb24gMC4wLjVcbiAqXG4gKiBAY2hhbmdlbG9nXG4gKiAtIDAuMC41ICgyMDI1LTA1LTE1KTogQWRkZWQgc2Vzc2lvbiB2YWxpZGF0aW9uIGFuZCBwcm90ZWN0aW9uIGFnYWluc3Qgc3RhbGUgc2Vzc2lvbnMuXG4gKiAtIDAuMC40ICgyMDI1LTA1LTE1KTogUmVtb3ZhbCBvZiBGaXJlYmFzZSBDbG91ZCBGdW5jdGlvbnMgY29uc3RhbnRzLlxuICogLSAwLjAuMyAoMjAyNS0wNS0xMyk6IE1vZGlmaWVkIHRoZSBhdXRoZW50aWNhdGlvbiBzdGF0ZSBtYW5hZ2VtZW50IHRvIHVzZSBTdXBhYmFzZSBBdXRoIHN5c3RlbS5cbiAqIC0gMC4wLjIgKDIwMjUtMDUtMTMpOiBSZW9yZ2FuaXphdGlvbiBpbnRvIHNlcGFyYXRlIG1vZHVsZXNcbiAqIC0gMC4wLjEgKDIwMjUtMDUtMDMpOiBJbml0aWFsIGNyZWF0aW9uXG4gKi9cblxuaW1wb3J0IHsgc3VwYWJhc2UgfSBmcm9tIFwiLi4vc3VwYWJhc2UtY2xpZW50LmpzXCI7XG5cbi8vIEdsb2JhbCBhdXRoZW50aWNhdGlvbiBzdGF0ZVxubGV0IGN1cnJlbnRVc2VyID0gbnVsbDtcbmxldCBzZXNzaW9uVmFsaWRhdGVkID0gZmFsc2U7XG5cbi8qKlxuICogU2V0cyB0aGUgY3VycmVudCB1c2VyXG4gKiBAcGFyYW0ge09iamVjdH0gdXNlciAtIFVzZXIgZGF0YVxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0Q3VycmVudFVzZXIodXNlcikge1xuICBjdXJyZW50VXNlciA9IHVzZXI7XG4gIC8vIFBvc3NpYmxlIHN0b3JhZ2UgaW4gbG9jYWxTdG9yYWdlL3Nlc3Npb25TdG9yYWdlXG4gIGlmICh1c2VyKSB7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJjdXJyZW50VXNlclwiLCBKU09OLnN0cmluZ2lmeSh1c2VyKSk7XG4gIH0gZWxzZSB7XG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJjdXJyZW50VXNlclwiKTtcbiAgfVxufVxuXG4vKipcbiAqIFZhbGlkYXRlcyBpZiB0aGUgY3VycmVudCBzZXNzaW9uIGlzIGFjdGl2ZSB3aXRoIFN1cGFiYXNlXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxib29sZWFuPn0gVHJ1ZSBpZiBzZXNzaW9uIGlzIHZhbGlkLCBmYWxzZSBvdGhlcndpc2VcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZhbGlkYXRlU2Vzc2lvbigpIHtcbiAgdHJ5IHtcbiAgICAvLyBHZXQgY3VycmVudCBzZXNzaW9uIGZyb20gU3VwYWJhc2VcbiAgICBjb25zdCB7XG4gICAgICBkYXRhOiB7IHNlc3Npb24gfSxcbiAgICAgIGVycm9yOiBzZXNzaW9uRXJyb3IsXG4gICAgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0U2Vzc2lvbigpO1xuXG4gICAgLy8gTm8gc2Vzc2lvbiBvciBlcnJvciByZXRyaWV2aW5nIHNlc3Npb25cbiAgICBpZiAoc2Vzc2lvbkVycm9yIHx8ICFzZXNzaW9uKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIk5vIHZhbGlkIHNlc3Npb24gZm91bmRcIik7XG4gICAgICBzZXRDdXJyZW50VXNlcihudWxsKTtcbiAgICAgIHNlc3Npb25WYWxpZGF0ZWQgPSBmYWxzZTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBUcnkgdG8gcmVmcmVzaCB0aGUgdG9rZW4gdG8gdmFsaWRhdGUgaXQgd2l0aCB0aGUgc2VydmVyXG4gICAgY29uc3QgeyBlcnJvcjogcmVmcmVzaEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLnJlZnJlc2hTZXNzaW9uKCk7XG5cbiAgICBpZiAocmVmcmVzaEVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJTZXNzaW9uIHZhbGlkYXRpb24gZmFpbGVkOlwiLCByZWZyZXNoRXJyb3IpO1xuICAgICAgLy8gRm9yY2UgY2xlYXIgdGhlIGludmFsaWQgc2Vzc2lvblxuICAgICAgYXdhaXQgc3VwYWJhc2UuYXV0aC5zaWduT3V0KCk7XG4gICAgICBzZXRDdXJyZW50VXNlcihudWxsKTtcbiAgICAgIHNlc3Npb25WYWxpZGF0ZWQgPSBmYWxzZTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBTZXNzaW9uIGlzIHZhbGlkLCB1cGRhdGUgdGhlIGN1cnJlbnQgdXNlclxuICAgIHNldEN1cnJlbnRVc2VyKHNlc3Npb24udXNlcik7XG4gICAgc2Vzc2lvblZhbGlkYXRlZCA9IHRydWU7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiU2Vzc2lvbiB2YWxpZGF0aW9uIGVycm9yOlwiLCBlKTtcbiAgICBzZXRDdXJyZW50VXNlcihudWxsKTtcbiAgICBzZXNzaW9uVmFsaWRhdGVkID0gZmFsc2U7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbi8qKlxuICogUmV0cmlldmVzIHRoZSBjdXJyZW50IHVzZXJcbiAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsaWRhdGUgLSBXaGV0aGVyIHRvIHZhbGlkYXRlIHRoZSBzZXNzaW9uIHdpdGggU3VwYWJhc2VcbiAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdHxudWxsPn0gVGhlIGN1cnJlbnQgdXNlciBvciBudWxsXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDdXJyZW50VXNlcih2YWxpZGF0ZSA9IHRydWUpIHtcbiAgLy8gSWYgd2UgbmVlZCB0byB2YWxpZGF0ZSBhbmQgaGF2ZW4ndCBkb25lIHNvIHlldFxuICBpZiAodmFsaWRhdGUgJiYgIXNlc3Npb25WYWxpZGF0ZWQpIHtcbiAgICBhd2FpdCB2YWxpZGF0ZVNlc3Npb24oKTtcbiAgfVxuXG4gIC8vIElmIG5vIHZhbGlkYXRpb24gbmVlZGVkIG9yIGFscmVhZHkgdmFsaWRhdGVkXG4gIGlmICghdmFsaWRhdGUgJiYgIWN1cnJlbnRVc2VyKSB7XG4gICAgLy8gVHJ5IHRvIHJldHJpZXZlIGZyb20gc3RvcmFnZSBpZiBub3QgaW4gbWVtb3J5XG4gICAgY29uc3Qgc3RvcmVkVXNlciA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiY3VycmVudFVzZXJcIik7XG4gICAgaWYgKHN0b3JlZFVzZXIpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGN1cnJlbnRVc2VyID0gSlNPTi5wYXJzZShzdG9yZWRVc2VyKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHJldHJpZXZpbmcgdXNlcjpcIiwgZSk7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFwiY3VycmVudFVzZXJcIik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGN1cnJlbnRVc2VyO1xufVxuXG4vKipcbiAqIFN5bmNocm9ub3VzIHZlcnNpb24gb2YgZ2V0Q3VycmVudFVzZXIgZm9yIG5vbi1hc3luYyBjb250ZXh0c1xuICogV0FSTklORzogVGhpcyBtYXkgcmV0dXJuIHN0YWxlIGRhdGEgaWYgc2Vzc2lvbiBpcyBpbnZhbGlkXG4gKiBAcmV0dXJucyB7T2JqZWN0fG51bGx9IFRoZSBjdXJyZW50IHVzZXIgb3IgbnVsbFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q3VycmVudFVzZXJTeW5jKCkge1xuICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgY29uc3Qgc3RvcmVkVXNlciA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiY3VycmVudFVzZXJcIik7XG4gICAgaWYgKHN0b3JlZFVzZXIpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGN1cnJlbnRVc2VyID0gSlNPTi5wYXJzZShzdG9yZWRVc2VyKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHJldHJpZXZpbmcgdXNlcjpcIiwgZSk7XG4gICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFwiY3VycmVudFVzZXJcIik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGN1cnJlbnRVc2VyO1xufVxuXG4vKipcbiAqIExvZ3Mgb3V0IHRoZSB1c2VyXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx2b2lkPn1cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvZ291dCgpIHtcbiAgdHJ5IHtcbiAgICAvLyBTaWduIG91dCBmcm9tIFN1cGFiYXNlXG4gICAgYXdhaXQgc3VwYWJhc2UuYXV0aC5zaWduT3V0KCk7XG5cbiAgICAvLyBDbGVhciBsb2NhbCBzdGF0ZVxuICAgIGN1cnJlbnRVc2VyID0gbnVsbDtcbiAgICBzZXNzaW9uVmFsaWRhdGVkID0gZmFsc2U7XG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJjdXJyZW50VXNlclwiKTtcblxuICAgIC8vIFJlZGlyZWN0IHRvIHRoZSBob21lIHBhZ2UgYWZ0ZXIgbG9nb3V0XG4gICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcIi9cIjtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZHVyaW5nIGxvZ291dDpcIiwgZXJyb3IpO1xuICAgIC8vIFN0aWxsIGNsZWFyIGxvY2FsIHN0YXRlIGV2ZW4gaWYgU3VwYWJhc2Ugc2lnbk91dCBmYWlsc1xuICAgIGN1cnJlbnRVc2VyID0gbnVsbDtcbiAgICBzZXNzaW9uVmFsaWRhdGVkID0gZmFsc2U7XG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJjdXJyZW50VXNlclwiKTtcbiAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IFwiL1wiO1xuICB9XG59XG5cbi8qKlxuICogQ2hlY2tzIGlmIHRoZSB1c2VyIGlzIGxvZ2dlZCBpbiB3aXRoIHZhbGlkIHNlc3Npb25cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gdmFsaWRhdGUgLSBXaGV0aGVyIHRvIHZhbGlkYXRlIHdpdGggU3VwYWJhc2UgZmlyc3RcbiAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fSBUcnVlIGlmIHRoZSB1c2VyIGlzIGxvZ2dlZCBpbiB3aXRoIHZhbGlkIHNlc3Npb25cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGlzTG9nZ2VkSW4odmFsaWRhdGUgPSB0cnVlKSB7XG4gIGNvbnN0IHVzZXIgPSBhd2FpdCBnZXRDdXJyZW50VXNlcih2YWxpZGF0ZSk7XG4gIHJldHVybiB1c2VyICE9PSBudWxsO1xufVxuXG4vKipcbiAqIFN5bmNocm9ub3VzIHZlcnNpb24gb2YgaXNMb2dnZWRJblxuICogV0FSTklORzogVGhpcyBtYXkgcmV0dXJuIGluY29ycmVjdCByZXN1bHRzIGlmIHNlc3Npb24gaXMgaW52YWxpZFxuICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdXNlciBhcHBlYXJzIHRvIGJlIGxvZ2dlZCBpbiBsb2NhbGx5XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc0xvZ2dlZEluU3luYygpIHtcbiAgcmV0dXJuIGdldEN1cnJlbnRVc2VyU3luYygpICE9PSBudWxsO1xufVxuXG4vKipcbiAqIFByb3RlY3RzIGEgcGFnZSB0aGF0IHJlcXVpcmVzIGF1dGhlbnRpY2F0aW9uXG4gKiBAcGFyYW0ge3N0cmluZ30gcmVkaXJlY3RVcmwgLSBVUkwgdG8gcmVkaXJlY3QgaWYgbm90IGF1dGhlbnRpY2F0ZWRcbiAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fSBUcnVlIGlmIGF1dGhlbnRpY2F0ZWQsIGZhbHNlIG90aGVyd2lzZVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJvdGVjdFBhZ2UocmVkaXJlY3RVcmwgPSBcIi9sb2dpblwiKSB7XG4gIGNvbnN0IGlzVmFsaWQgPSBhd2FpdCB2YWxpZGF0ZVNlc3Npb24oKTtcblxuICBpZiAoIWlzVmFsaWQpIHtcbiAgICAvLyBSZWRpcmVjdCB0byBsb2dpbiBwYWdlXG4gICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSByZWRpcmVjdFVybDtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn1cblxuLyoqXG4gKiBJbml0aWFsaXplcyBhdXRoIG9uIHBhZ2UgbG9hZFxuICogQ2FsbCB0aGlzIGF0IHRoZSBiZWdpbm5pbmcgb2YgeW91ciBhcHAgaW5pdGlhbGl6YXRpb25cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGluaXRBdXRoKCkge1xuICAvLyBWYWxpZGF0ZSBzZXNzaW9uIG9uIHBhZ2UgbG9hZFxuICBhd2FpdCB2YWxpZGF0ZVNlc3Npb24oKTtcblxuICAvLyBTZXQgdXAgYXV0aCBzdGF0ZSBjaGFuZ2UgbGlzdGVuZXJcbiAgc3VwYWJhc2UuYXV0aC5vbkF1dGhTdGF0ZUNoYW5nZShhc3luYyAoZXZlbnQsIHNlc3Npb24pID0+IHtcbiAgICBjb25zb2xlLmxvZyhcIkF1dGggc3RhdGUgY2hhbmdlZDpcIiwgZXZlbnQpO1xuXG4gICAgaWYgKGV2ZW50ID09PSBcIlNJR05FRF9JTlwiICYmIHNlc3Npb24pIHtcbiAgICAgIHNldEN1cnJlbnRVc2VyKHNlc3Npb24udXNlcik7XG4gICAgICBzZXNzaW9uVmFsaWRhdGVkID0gdHJ1ZTtcbiAgICB9IGVsc2UgaWYgKGV2ZW50ID09PSBcIlNJR05FRF9PVVRcIikge1xuICAgICAgc2V0Q3VycmVudFVzZXIobnVsbCk7XG4gICAgICBzZXNzaW9uVmFsaWRhdGVkID0gZmFsc2U7XG4gICAgfSBlbHNlIGlmIChldmVudCA9PT0gXCJUT0tFTl9SRUZSRVNIRURcIikge1xuICAgICAgc2V0Q3VycmVudFVzZXIoc2Vzc2lvbi51c2VyKTtcbiAgICAgIHNlc3Npb25WYWxpZGF0ZWQgPSB0cnVlO1xuICAgIH0gZWxzZSBpZiAoZXZlbnQgPT09IFwiVVNFUl9VUERBVEVEXCIpIHtcbiAgICAgIHNldEN1cnJlbnRVc2VyKHNlc3Npb24udXNlcik7XG4gICAgICBzZXNzaW9uVmFsaWRhdGVkID0gdHJ1ZTtcbiAgICB9XG4gIH0pO1xufVxuXG4vKipcbiAqIERpc3BsYXlzIGFuIGVycm9yIG1lc3NhZ2VcbiAqIEBwYXJhbSB7c3RyaW5nfSBtZXNzYWdlIC0gRXJyb3IgbWVzc2FnZSB0byBkaXNwbGF5XG4gKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudElkIC0gSUQgb2YgdGhlIGVsZW1lbnQgd2hlcmUgdG8gZGlzcGxheSB0aGUgZXJyb3JcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNob3dFcnJvcihtZXNzYWdlLCBlbGVtZW50SWQgPSBcImVycm9yTWVzc2FnZVwiKSB7XG4gIGNvbnN0IGVycm9yRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRJZCk7XG4gIGlmIChlcnJvckVsZW1lbnQpIHtcbiAgICBlcnJvckVsZW1lbnQuaW5uZXJIVE1MID0gbWVzc2FnZTtcbiAgICBlcnJvckVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZWxlbWVudCBub3QgZm91bmQ6XCIsIGVsZW1lbnRJZCk7XG4gIH1cbn1cblxuLyoqXG4gKiBEaXNwbGF5cyBhIHN0YXR1cyBtZXNzYWdlXG4gKiBAcGFyYW0ge3N0cmluZ30gbWVzc2FnZSAtIE1lc3NhZ2UgdG8gZGlzcGxheVxuICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBNZXNzYWdlIHR5cGUgKHN1Y2Nlc3MsIGluZm8sIHdhcm5pbmcsIGRhbmdlcilcbiAqIEBwYXJhbSB7c3RyaW5nfSBlbGVtZW50SWQgLSBJRCBvZiB0aGUgZWxlbWVudCB3aGVyZSB0byBkaXNwbGF5IHRoZSBtZXNzYWdlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzaG93U3RhdHVzKFxuICBtZXNzYWdlLFxuICB0eXBlID0gXCJpbmZvXCIsXG4gIGVsZW1lbnRJZCA9IFwic3RhdHVzTWVzc2FnZVwiXG4pIHtcbiAgY29uc3Qgc3RhdHVzRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRJZCk7XG4gIGlmIChzdGF0dXNFbGVtZW50KSB7XG4gICAgc3RhdHVzRWxlbWVudC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG5cbiAgICAvLyBSZW1vdmUgYWxsIGFsZXJ0LSogY2xhc3Nlc1xuICAgIHN0YXR1c0VsZW1lbnQuY2xhc3NMaXN0LmZvckVhY2goKGNsYXNzTmFtZSkgPT4ge1xuICAgICAgaWYgKGNsYXNzTmFtZS5zdGFydHNXaXRoKFwiYWxlcnQtXCIpKSB7XG4gICAgICAgIHN0YXR1c0VsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gQWRkIHRoZSBjbGFzcyBjb3JyZXNwb25kaW5nIHRvIHRoZSB0eXBlXG4gICAgc3RhdHVzRWxlbWVudC5jbGFzc0xpc3QuYWRkKGBhbGVydC0ke3R5cGV9YCk7XG4gICAgc3RhdHVzRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJTdGF0dXMgZWxlbWVudCBub3QgZm91bmQ6XCIsIGVsZW1lbnRJZCk7XG4gIH1cbn1cblxuLyoqXG4gKiBIaWRlcyBhbiBlbGVtZW50XG4gKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudElkIC0gSUQgb2YgdGhlIGVsZW1lbnQgdG8gaGlkZVxuICovXG5leHBvcnQgZnVuY3Rpb24gaGlkZUVsZW1lbnQoZWxlbWVudElkKSB7XG4gIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50SWQpO1xuICBpZiAoZWxlbWVudCkge1xuICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgfVxufVxuXG4vKipcbiAqIFNob3dzIGFuIGVsZW1lbnRcbiAqIEBwYXJhbSB7c3RyaW5nfSBlbGVtZW50SWQgLSBJRCBvZiB0aGUgZWxlbWVudCB0byBzaG93XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzaG93RWxlbWVudChlbGVtZW50SWQpIHtcbiAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1lbnRJZCk7XG4gIGlmIChlbGVtZW50KSB7XG4gICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICB9XG59XG5cbi8qKlxuICogU2hvd3MgdGhlIGxvYWRpbmcgaW5kaWNhdG9yXG4gKiBAcGFyYW0ge3N0cmluZ30gYnV0dG9uSWQgLSBJRCBvZiB0aGUgYnV0dG9uXG4gKiBAcGFyYW0ge3N0cmluZ30gc3Bpbm5lcklkIC0gSUQgb2YgdGhlIHNwaW5uZXJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNob3dMb2FkaW5nKGJ1dHRvbklkLCBzcGlubmVySWQpIHtcbiAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYnV0dG9uSWQpO1xuICBjb25zdCBzcGlubmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc3Bpbm5lcklkKTtcblxuICBpZiAoYnV0dG9uKSBidXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICBpZiAoc3Bpbm5lcikgc3Bpbm5lci5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xufVxuXG4vKipcbiAqIEhpZGVzIHRoZSBsb2FkaW5nIGluZGljYXRvclxuICogQHBhcmFtIHtzdHJpbmd9IGJ1dHRvbklkIC0gSUQgb2YgdGhlIGJ1dHRvblxuICogQHBhcmFtIHtzdHJpbmd9IHNwaW5uZXJJZCAtIElEIG9mIHRoZSBzcGlubmVyXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBoaWRlTG9hZGluZyhidXR0b25JZCwgc3Bpbm5lcklkKSB7XG4gIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGJ1dHRvbklkKTtcbiAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNwaW5uZXJJZCk7XG5cbiAgaWYgKGJ1dHRvbikgYnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gIGlmIChzcGlubmVyKSBzcGlubmVyLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG59XG5cbi8vIEV4cG9ydCB0aGUgbmVjZXNzYXJ5IGZ1bmN0aW9ucyBhbmQgdmFyaWFibGVzXG5leHBvcnQgZGVmYXVsdCB7XG4gIGdldEN1cnJlbnRVc2VyLFxuICBnZXRDdXJyZW50VXNlclN5bmMsXG4gIHNldEN1cnJlbnRVc2VyLFxuICBsb2dvdXQsXG4gIGlzTG9nZ2VkSW4sXG4gIGlzTG9nZ2VkSW5TeW5jLFxuICB2YWxpZGF0ZVNlc3Npb24sXG4gIHByb3RlY3RQYWdlLFxuICBpbml0QXV0aCxcbiAgc2hvd0Vycm9yLFxuICBzaG93U3RhdHVzLFxuICBoaWRlRWxlbWVudCxcbiAgc2hvd0VsZW1lbnQsXG4gIHNob3dMb2FkaW5nLFxuICBoaWRlTG9hZGluZyxcbn07XG4iLCIvLyBzcmMvanMvbG9naW4uanNcbi8qKlxuICogTG9naW4gTW9kdWxlXG4gKiBAbW9kdWxlIGxvZ2luXG4gKiBAZGVzY3JpcHRpb24gVGhpcyBtb2R1bGUgaGFuZGxlcyB1c2VyIGxvZ2luIGZ1bmN0aW9uYWxpdHkgdXNpbmcgU3VwYWJhc2UgQXV0aGVudGljYXRpb24uXG4gKiBAdmVyc2lvbiAwLjEuMFxuICogQGF1dGhvciBHcmV5UGFuZGFcbiAqIEB0b2RvIEFkZCBwaG9uZSBudW1iZXIgYXV0aGVudGljYXRpb24gJiBwYXNzd29yZCByZXNldCBmdW5jdGlvbmFsaXR5LlxuICpcbiAqIEBjaGFuZ2Vsb2dcbiAqIC0gMC4xLjAgKDIwMjUtMDUtMTUpOiBNaWdyYXRlZCB0byBTdXBhYmFzZSBjbGllbnQtc2lkZSBhdXRoXG4gKiAtIDAuMC40ICgyMDI1LTA1LTEzKTogRW5zdXJlIHN0YXR1cyBtZXNzYWdlIGlzIGFsc28gaGlkZGVuIG9uIG5ldyBzdWJtaXQuXG4gKiAtIDAuMC4zICgyMDI1LTA1LTA4KTogSW1wbGVtZW50ZWQgYWN0dWFsIGxvZ2luIHdpdGggRmlyZWJhc2UgZnVuY3Rpb24sIGFkZGVkIHBhc3N3b3JkIHZpc2liaWxpdHkgdG9nZ2xlLlxuICogLSAwLjAuMiAoMjAyNS0wNS0wOCk6IFJlZmFjdG9yZWQgdG8gaGFuZGxlIFN1cGFiYXNlIGF1dGhlbnRpZmljYXRpb24uXG4gKiAtIDAuMC4xICgyMDI1LTA0LTI3KTogTG9naW4gZnVuY3Rpb25hbGl0eSBpbXBsZW1lbnRlZCB1c2luZyBGaXJlYmFzZSBBdXRoZW50aWNhdGlvbi5cbiAqL1xuXG5pbXBvcnQge1xuICBzZXRDdXJyZW50VXNlcixcbiAgc2hvd0Vycm9yLFxuICBzaG93U3RhdHVzLFxuICBzaG93TG9hZGluZyxcbiAgaGlkZUxvYWRpbmcsXG59IGZyb20gXCIuL2F1dGguanNcIjtcbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSBcIi4uL3N1cGFiYXNlLWNsaWVudC5qc1wiO1xuXG5sZXQgY2FwdGNoYUxvZ2luVG9rZW4gPSBudWxsOyAvLyBUbyBzdG9yZSB0aGUgY2FwdGNoYSB0b2tlbiBmb3IgbG9naW5cbmxldCB0dXJuc3RpbGVMb2dpbldpZGdldElkID0gbnVsbDsgLy8gVG8gc3RvcmUgVHVybnN0aWxlIHdpZGdldCBJRCBmb3IgbG9naW5cblxuLy8gVGhpcyBmdW5jdGlvbiB3aWxsIGJlIGNhbGxlZCBieSB0aGUgQ2xvdWRmbGFyZSBUdXJuc3RpbGUgc2NyaXB0IG9uY2UgaXQncyBsb2FkZWRcbi8vIChkdWUgdG8gJm9ubG9hZD1vbmxvYWRUdXJuc3RpbGVMb2dpbkNhbGxiYWNrIGluIHRoZSBzY3JpcHQgdGFnIGluIGxvZ2luLmh0bWwpXG53aW5kb3cub25sb2FkVHVybnN0aWxlTG9naW5DYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtcbiAgY29uc29sZS5sb2coXG4gICAgXCJUdXJuc3RpbGUgTG9naW4gQVBJIHJlYWR5IChvbmxvYWRUdXJuc3RpbGVMb2dpbkNhbGxiYWNrIGV4ZWN1dGVkKS5cIlxuICApO1xuICBjb25zdCB0dXJuc3RpbGVDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcbiAgICBcInR1cm5zdGlsZS1sb2dpbi1jb250YWluZXJcIlxuICApO1xuXG4gIGlmICh0dXJuc3RpbGVDb250YWluZXIgJiYgd2luZG93LnR1cm5zdGlsZSAmJiAhdHVybnN0aWxlTG9naW5XaWRnZXRJZCkge1xuICAgIGNvbnNvbGUubG9nKFwiUmVuZGVyaW5nIFR1cm5zdGlsZSB3aWRnZXQgZm9yIGxvZ2luLi4uXCIpO1xuICAgIHRyeSB7XG4gICAgICB0dXJuc3RpbGVMb2dpbldpZGdldElkID0gd2luZG93LnR1cm5zdGlsZS5yZW5kZXIodHVybnN0aWxlQ29udGFpbmVyLCB7XG4gICAgICAgIHNpdGVrZXk6IFwiMHg0QUFBQUFBQmR6WTNJbk9VMl9Jbjk5XCIsXG4gICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAodG9rZW4pIHtcbiAgICAgICAgICBjYXB0Y2hhTG9naW5Ub2tlbiA9IHRva2VuO1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiVHVybnN0aWxlIGxvZ2luIHRva2VuIG9idGFpbmVkOlwiLCB0b2tlbik7XG4gICAgICAgIH0sXG4gICAgICAgIFwiZXhwaXJlZC1jYWxsYmFja1wiOiAoKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICBcIlR1cm5zdGlsZSBsb2dpbiB0b2tlbiBleHBpcmVkLiBSZXNldHRpbmcgd2lkZ2V0LiBJRDpcIixcbiAgICAgICAgICAgIHR1cm5zdGlsZUxvZ2luV2lkZ2V0SWRcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmICh3aW5kb3cudHVybnN0aWxlICYmIHR1cm5zdGlsZUxvZ2luV2lkZ2V0SWQpIHtcbiAgICAgICAgICAgIHdpbmRvdy50dXJuc3RpbGUucmVzZXQodHVybnN0aWxlTG9naW5XaWRnZXRJZCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNhcHRjaGFMb2dpblRva2VuID0gbnVsbDsgLy8gQ2xlYXIgdGhlIHRva2VuXG4gICAgICAgIH0sXG4gICAgICAgIFwiZXJyb3ItY2FsbGJhY2tcIjogKGVycikgPT4ge1xuICAgICAgICAgIGNhcHRjaGFMb2dpblRva2VuID0gbnVsbDtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiVHVybnN0aWxlIGxvZ2luIGVycm9yIGNhbGxiYWNrOlwiLCBlcnIpO1xuICAgICAgICAgIHNob3dFcnJvcihgRXJyZXVyIENBUFRDSEEgKGxvZ2luKTogJHtlcnJ9LiBWZXVpbGxleiByw6llc3NheWVyLmApO1xuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgICBpZiAodHVybnN0aWxlTG9naW5XaWRnZXRJZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgICAgXCJUdXJuc3RpbGUucmVuZGVyIChsb2dpbikgZGlkIG5vdCByZXR1cm4gYSB3aWRnZXRJZC4gU2l0ZWtleSBvciBjb250YWluZXIgaXNzdWU/XCJcbiAgICAgICAgKTtcbiAgICAgICAgc2hvd0Vycm9yKFxuICAgICAgICAgIFwiRXJyZXVyIGluaXRpYWxpc2F0aW9uIENBUFRDSEEgKGxvZ2luLCBJRCB3aWRnZXQgbm9uIHJldG91cm7DqSkuXCJcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgIFwiVHVybnN0aWxlIGxvZ2luIHdpZGdldCByZW5kZXJlZC4gSUQ6XCIsXG4gICAgICAgICAgdHVybnN0aWxlTG9naW5XaWRnZXRJZFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciByZW5kZXJpbmcgVHVybnN0aWxlIGZvciBsb2dpbjpcIiwgZSk7XG4gICAgICBzaG93RXJyb3IoXCJJbXBvc3NpYmxlIGQnYWZmaWNoZXIgbGUgQ0FQVENIQSAobG9naW4pLlwiKTtcbiAgICB9XG4gIH0gZWxzZSBpZiAoIXR1cm5zdGlsZUNvbnRhaW5lcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICBcIm9ubG9hZFR1cm5zdGlsZUxvZ2luQ2FsbGJhY2s6ICN0dXJuc3RpbGUtbG9naW4tY29udGFpbmVyIG5vdCBmb3VuZC5cIlxuICAgICk7XG4gIH0gZWxzZSBpZiAoIXdpbmRvdy50dXJuc3RpbGUpIHtcbiAgICBjb25zb2xlLmVycm9yKFxuICAgICAgXCJvbmxvYWRUdXJuc3RpbGVMb2dpbkNhbGxiYWNrOiB3aW5kb3cudHVybnN0aWxlIEFQSSBub3QgZm91bmQuXCJcbiAgICApO1xuICB9IGVsc2UgaWYgKHR1cm5zdGlsZUxvZ2luV2lkZ2V0SWQpIHtcbiAgICBjb25zb2xlLmxvZyhcbiAgICAgIFwib25sb2FkVHVybnN0aWxlTG9naW5DYWxsYmFjazogTG9naW4gd2lkZ2V0IGFscmVhZHkgc2VlbXMgcmVuZGVyZWQuXCJcbiAgICApO1xuICB9XG59O1xuXG4vKipcbiAqIEluaXRpYWxpemVzIHRoZSBsb2dpbiBwYWdlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbml0TG9naW5QYWdlKCkge1xuICBjb25zdCBsb2dpbkZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImxvZ2luRm9ybVwiKTtcbiAgY29uc3QgZXJyb3JNZXNzYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJlcnJvck1lc3NhZ2VcIik7XG4gIGNvbnN0IHRvZ2dsZVBhc3N3b3JkQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0b2dnbGVQYXNzd29yZFwiKTtcbiAgY29uc3QgcGFzc3dvcmRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGFzc3dvcmRcIik7XG4gIGNvbnN0IGdvb2dsZVNpZ25JbkJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZ29vZ2xlU2lnbkluQnRuXCIpO1xuXG4gIC8vIFNldCB1cCBwYXNzd29yZCB2aXNpYmlsaXR5IHRvZ2dsZVxuICBpZiAodG9nZ2xlUGFzc3dvcmRCdG4gJiYgcGFzc3dvcmRJbnB1dCkge1xuICAgIHRvZ2dsZVBhc3N3b3JkQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBjb25zdCB0eXBlID1cbiAgICAgICAgcGFzc3dvcmRJbnB1dC5nZXRBdHRyaWJ1dGUoXCJ0eXBlXCIpID09PSBcInBhc3N3b3JkXCIgPyBcInRleHRcIiA6IFwicGFzc3dvcmRcIjtcbiAgICAgIHBhc3N3b3JkSW5wdXQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCB0eXBlKTtcblxuICAgICAgLy8gVG9nZ2xlIGljb25cbiAgICAgIGNvbnN0IGljb25FbGVtZW50ID0gdG9nZ2xlUGFzc3dvcmRCdG4ucXVlcnlTZWxlY3RvcihcImlcIik7XG4gICAgICBpZiAodHlwZSA9PT0gXCJwYXNzd29yZFwiKSB7XG4gICAgICAgIGljb25FbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJiaS1leWVcIik7XG4gICAgICAgIGljb25FbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJiaS1leWUtc2xhc2hcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpY29uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwiYmktZXllLXNsYXNoXCIpO1xuICAgICAgICBpY29uRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiYmktZXllXCIpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgaWYgKGxvZ2luRm9ybSkge1xuICAgIGxvZ2luRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGFzeW5jIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgIC8vIFJlc2V0IG1lc3NhZ2VzXG4gICAgICBpZiAoZXJyb3JNZXNzYWdlKSB7XG4gICAgICAgIGVycm9yTWVzc2FnZS5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuICAgICAgICBlcnJvck1lc3NhZ2UudGV4dENvbnRlbnQgPSBcIlwiO1xuICAgICAgfVxuICAgICAgLy8gRW5zdXJlIHN0YXR1cyBtZXNzYWdlIGlzIGFsc28gaGlkZGVuIG9uIG5ldyBzdWJtaXRcbiAgICAgIGNvbnN0IHN0YXR1c01lc3NhZ2VFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdGF0dXNNZXNzYWdlXCIpO1xuICAgICAgaWYgKHN0YXR1c01lc3NhZ2VFbGVtZW50KSB7XG4gICAgICAgIHN0YXR1c01lc3NhZ2VFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gICAgICAgIHN0YXR1c01lc3NhZ2VFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IGZvcm0gdmFsdWVzXG4gICAgICBjb25zdCBlbWFpbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZW1haWxcIikudmFsdWU7XG4gICAgICBjb25zdCBwYXNzd29yZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGFzc3dvcmRcIikudmFsdWU7XG5cbiAgICAgIC8vIEJhc2ljIHZhbGlkYXRpb25cbiAgICAgIGlmICghZW1haWwgfHwgIXBhc3N3b3JkKSB7XG4gICAgICAgIHNob3dFcnJvcihcIlZldWlsbGV6IHJlbXBsaXIgdG91cyBsZXMgY2hhbXBzLlwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWNhcHRjaGFMb2dpblRva2VuKSB7XG4gICAgICAgIHNob3dFcnJvcihcIlZldWlsbGV6IGNvbXBsw6l0ZXIgbGUgQ0FQVENIQS5cIik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gU2hvdyBsb2FkaW5nIHN0YXRlXG4gICAgICBzaG93TG9hZGluZyhcImxvZ2luQnRuXCIsIFwibG9naW5TcGlubmVyXCIpO1xuXG4gICAgICB0cnkge1xuICAgICAgICAvLyBDYWxsIGxvZ2luIGZ1bmN0aW9uXG4gICAgICAgIGF3YWl0IGxvZ2luKGVtYWlsLCBwYXNzd29yZCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiTG9naW4gZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgc2hvd0Vycm9yKFxuICAgICAgICAgIGVycm9yLm1lc3NhZ2UgfHwgXCJMYSBjb25uZXhpb24gYSDDqWNob3XDqS4gVsOpcmlmaWV6IHZvcyBpZGVudGlmaWFudHMuXCJcbiAgICAgICAgKTtcbiAgICAgIH0gZmluYWxseSB7XG4gICAgICAgIC8vIFJlc2V0IGJ1dHRvbiBzdGF0ZVxuICAgICAgICBoaWRlTG9hZGluZyhcImxvZ2luQnRuXCIsIFwibG9naW5TcGlubmVyXCIpO1xuICAgICAgICBpZiAod2luZG93LnR1cm5zdGlsZSAmJiB0dXJuc3RpbGVMb2dpbldpZGdldElkKSB7XG4gICAgICAgICAgd2luZG93LnR1cm5zdGlsZS5yZXNldCh0dXJuc3RpbGVMb2dpbldpZGdldElkKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIlR1cm5zdGlsZSBsb2dpbiB3aWRnZXQgaGFzIGJlZW4gcmVzZXQuXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNhcHRjaGFMb2dpblRva2VuID0gbnVsbDsgLy8gQ2xlYXIgdG9rZW4gYWZ0ZXIgdXNlXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvLyBFdmVudCBsaXN0ZW5lciBmb3IgR29vZ2xlIFNpZ24tSW4gYnV0dG9uXG4gIGlmIChnb29nbGVTaWduSW5CdG4pIHtcbiAgICBnb29nbGVTaWduSW5CdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIHNob3dMb2FkaW5nKFwiZ29vZ2xlU2lnbkluQnRuXCIsIFwiZ29vZ2xlU2lnbkluU3Bpbm5lclwiKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguc2lnbkluV2l0aE9BdXRoKHtcbiAgICAgICAgICBwcm92aWRlcjogXCJnb29nbGVcIixcbiAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICAvLyBPcHRpb25hbDogcmVkaXJlY3RUbyBjYW4gYmUgdXNlZCB0byBzcGVjaWZ5IHdoZXJlIHVzZXJzIGFyZSBzZW50IGFmdGVyIHNpZ24taW4uXG4gICAgICAgICAgICAvLyByZWRpcmVjdFRvOiBgJHt3aW5kb3cubG9jYXRpb24ub3JpZ2lufS9wcm9maWxlLmh0bWxgXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzaWduaW5nIGluIHdpdGggR29vZ2xlOlwiLCBlcnJvcik7XG4gICAgICAgICAgc2hvd0Vycm9yKFxuICAgICAgICAgICAgZXJyb3IubWVzc2FnZSB8fCBcIkVycmV1ciBsb3JzIGRlIGxhIGNvbm5leGlvbiBhdmVjIEdvb2dsZS5cIlxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gT24gc3VjY2VzcywgU3VwYWJhc2UgaGFuZGxlcyB0aGUgcmVkaXJlY3QuXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXhjZXB0aW9uIGR1cmluZyBHb29nbGUgc2lnbi1pbjpcIiwgZXJyb3IpO1xuICAgICAgICBzaG93RXJyb3IoXG4gICAgICAgICAgXCJVbmUgZXhjZXB0aW9uIGVzdCBzdXJ2ZW51ZSBsb3JzIGRlIGxhIGNvbm5leGlvbiBhdmVjIEdvb2dsZS5cIlxuICAgICAgICApO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgaGlkZUxvYWRpbmcoXCJnb29nbGVTaWduSW5CdG5cIiwgXCJnb29nbGVTaWduSW5TcGlubmVyXCIpO1xuICAgICAgfVxuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUud2FybihcIkdvb2dsZSBTaWduLUluIGJ1dHRvbiAoZ29vZ2xlU2lnbkluQnRuKSBub3QgZm91bmQuXCIpO1xuICB9XG59XG5cbi8qKlxuICogTG9ncyBpbiBhIHVzZXIgd2l0aCBlbWFpbCBhbmQgcGFzc3dvcmQgZGlyZWN0bHkgd2l0aCBTdXBhYmFzZVxuICogQHBhcmFtIHtzdHJpbmd9IGVtYWlsIC0gVXNlcidzIGVtYWlsXG4gKiBAcGFyYW0ge3N0cmluZ30gcGFzc3dvcmQgLSBVc2VyJ3MgcGFzc3dvcmRcbiAqIEByZXR1cm5zIHtQcm9taXNlfSAtIFByb21pc2UgcmVzb2x2ZWQgd2l0aCB0aGUgdXNlciBkYXRhIG9uIHN1Y2Nlc3NcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvZ2luKGVtYWlsLCBwYXNzd29yZCkge1xuICB0cnkge1xuICAgIC8vIENhbGwgU3VwYWJhc2UgYXV0aGVudGljYXRpb24gZGlyZWN0bHlcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLnNpZ25JbldpdGhQYXNzd29yZCh7XG4gICAgICBlbWFpbCxcbiAgICAgIHBhc3N3b3JkLFxuICAgICAgb3B0aW9uczogeyBjYXB0Y2hhVG9rZW46IGNhcHRjaGFMb2dpblRva2VuIH0sIC8vIFBhc3MgY2FwdGNoYSB0b2tlblxuICAgIH0pO1xuXG4gICAgLy8gQ2hlY2sgZm9yIGVycm9yc1xuICAgIGlmIChlcnJvcikge1xuICAgICAgLy8gSGFuZGxlIHNwZWNpZmljIGVycm9yIGNhc2VzXG4gICAgICBpZiAoZXJyb3IubWVzc2FnZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwiZW1haWwgbm90IGNvbmZpcm1lZFwiKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgXCJWb3RyZSBlbWFpbCBuJ2EgcGFzIMOpdMOpIGNvbmZpcm3DqS4gVmV1aWxsZXogdsOpcmlmaWVyIHZvdHJlIGJvw650ZSBkZSByw6ljZXB0aW9uLlwiXG4gICAgICAgICk7XG4gICAgICB9IGVsc2UgaWYgKFxuICAgICAgICBlcnJvci5tZXNzYWdlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJpbnZhbGlkIGxvZ2luIGNyZWRlbnRpYWxzXCIpXG4gICAgICApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRW1haWwgb3UgbW90IGRlIHBhc3NlIGluY29ycmVjdC5cIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3IubWVzc2FnZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gTm8gc2Vzc2lvbiBkYXRhXG4gICAgaWYgKCFkYXRhLnNlc3Npb24pIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgIFwiTG9naW4gZXJyb3I6IE1pc3Npbmcgc2Vzc2lvbiBkYXRhIGZyb20gU3VwYWJhc2UgcmVzcG9uc2VcIixcbiAgICAgICAgZGF0YVxuICAgICAgKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkRvbm7DqWVzIGRlIHNlc3Npb24gbWFucXVhbnRlcyBhcHLDqHMgbGEgY29ubmV4aW9uLlwiKTtcbiAgICB9XG5cbiAgICAvLyBTYXZlIHVzZXIgZGF0YSBsb2NhbGx5IGlmIG5lZWRlZFxuICAgIGlmIChkYXRhLnVzZXIpIHtcbiAgICAgIHNldEN1cnJlbnRVc2VyKGRhdGEudXNlcik7XG4gICAgICBjb25zb2xlLmxvZyhcIltsb2dpbi5qc10gVXNlciBkYXRhIHNhdmVkIGxvY2FsbHlcIik7XG4gICAgfVxuXG4gICAgLy8gU2hvdyBzdWNjZXNzIG1lc3NhZ2UgYmVmb3JlIHJlZGlyZWN0XG4gICAgc2hvd1N0YXR1cyhcIkNvbm5leGlvbiByw6l1c3NpZSEgUmVkaXJlY3Rpb24uLi5cIiwgXCJzdWNjZXNzXCIpO1xuXG4gICAgLy8gUmVkaXJlY3QgdG8gaG9tZSBwYWdlIGFmdGVyIGEgc2hvcnQgZGVsYXlcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCIvXCI7XG4gICAgfSwgNTAwKTtcblxuICAgIHJldHVybiBkYXRhLnVzZXI7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgLy8gTG9nIGFuZCByZS10aHJvdyB0aGUgZXJyb3IgdG8gYmUgaGFuZGxlZCBieSB0aGUgY2FsbGVyXG4gICAgY29uc29sZS5lcnJvcihcIkxvZ2luIGVycm9yOlwiLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuICBpbml0TG9naW5QYWdlLFxuICBsb2dpbixcbn07XG4iLCIvLyBzcmMvZW50cmllcy9zaWdudXAuanNcbi8qKlxuICogTG9naW4gRW50cnkgUG9pbnRcbiAqXG4gKiBUaGlzIG1vZHVsZSBzZXJ2ZXMgYXMgdGhlIGVudHJ5IHBvaW50IGZvciB0aGUgbG9naW4gcGFnZS5cbiAqL1xuXG4vLyBJbXBvcnQgb3VyIGxvZ2luIG1vZHVsZVxuaW1wb3J0IHsgaW5pdExvZ2luUGFnZSB9IGZyb20gXCIuLi9hdXRoL2xvZ2luLmpzXCI7XG5cbi8vIEluaXRpYWxpemUgbG9naW4gcGFnZSB3aGVuIERPTSBpcyBsb2FkZWRcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+IHtcbiAgLy8gSW5pdGlhbGl6ZSBsb2dpbiBwYWdlXG4gIGluaXRMb2dpblBhZ2UoKTtcblxuICBjb25zb2xlLmxvZyhcIkxvZ2luIHBhZ2UgaW5pdGlhbGl6ZWRcIik7XG59KTtcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4vLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuX193ZWJwYWNrX3JlcXVpcmVfXy5tID0gX193ZWJwYWNrX21vZHVsZXNfXztcblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5mID0ge307XG4vLyBUaGlzIGZpbGUgY29udGFpbnMgb25seSB0aGUgZW50cnkgY2h1bmsuXG4vLyBUaGUgY2h1bmsgbG9hZGluZyBmdW5jdGlvbiBmb3IgYWRkaXRpb25hbCBjaHVua3Ncbl9fd2VicGFja19yZXF1aXJlX18uZSA9IChjaHVua0lkKSA9PiB7XG5cdHJldHVybiBQcm9taXNlLmFsbChPYmplY3Qua2V5cyhfX3dlYnBhY2tfcmVxdWlyZV9fLmYpLnJlZHVjZSgocHJvbWlzZXMsIGtleSkgPT4ge1xuXHRcdF9fd2VicGFja19yZXF1aXJlX18uZltrZXldKGNodW5rSWQsIHByb21pc2VzKTtcblx0XHRyZXR1cm4gcHJvbWlzZXM7XG5cdH0sIFtdKSk7XG59OyIsIi8vIFRoaXMgZnVuY3Rpb24gYWxsb3cgdG8gcmVmZXJlbmNlIGFzeW5jIGNodW5rc1xuX193ZWJwYWNrX3JlcXVpcmVfXy51ID0gKGNodW5rSWQpID0+IHtcblx0Ly8gcmV0dXJuIHVybCBmb3IgZmlsZW5hbWVzIGJhc2VkIG9uIHRlbXBsYXRlXG5cdHJldHVybiBcImpzL1wiICsgY2h1bmtJZCArIFwiLmJ1bmRsZS5qc1wiO1xufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLmcgPSAoZnVuY3Rpb24oKSB7XG5cdGlmICh0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gJ29iamVjdCcpIHJldHVybiBnbG9iYWxUaGlzO1xuXHR0cnkge1xuXHRcdHJldHVybiB0aGlzIHx8IG5ldyBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpO1xuXHR9IGNhdGNoIChlKSB7XG5cdFx0aWYgKHR5cGVvZiB3aW5kb3cgPT09ICdvYmplY3QnKSByZXR1cm4gd2luZG93O1xuXHR9XG59KSgpOyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSAoZXhwb3J0cykgPT4ge1xuXHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcblx0fVxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xufTsiLCJ2YXIgc2NyaXB0VXJsO1xuaWYgKF9fd2VicGFja19yZXF1aXJlX18uZy5pbXBvcnRTY3JpcHRzKSBzY3JpcHRVcmwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLmcubG9jYXRpb24gKyBcIlwiO1xudmFyIGRvY3VtZW50ID0gX193ZWJwYWNrX3JlcXVpcmVfXy5nLmRvY3VtZW50O1xuaWYgKCFzY3JpcHRVcmwgJiYgZG9jdW1lbnQpIHtcblx0aWYgKGRvY3VtZW50LmN1cnJlbnRTY3JpcHQgJiYgZG9jdW1lbnQuY3VycmVudFNjcmlwdC50YWdOYW1lLnRvVXBwZXJDYXNlKCkgPT09ICdTQ1JJUFQnKVxuXHRcdHNjcmlwdFVybCA9IGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuc3JjO1xuXHRpZiAoIXNjcmlwdFVybCkge1xuXHRcdHZhciBzY3JpcHRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIik7XG5cdFx0aWYoc2NyaXB0cy5sZW5ndGgpIHtcblx0XHRcdHZhciBpID0gc2NyaXB0cy5sZW5ndGggLSAxO1xuXHRcdFx0d2hpbGUgKGkgPiAtMSAmJiAoIXNjcmlwdFVybCB8fCAhL15odHRwKHM/KTovLnRlc3Qoc2NyaXB0VXJsKSkpIHNjcmlwdFVybCA9IHNjcmlwdHNbaS0tXS5zcmM7XG5cdFx0fVxuXHR9XG59XG4vLyBXaGVuIHN1cHBvcnRpbmcgYnJvd3NlcnMgd2hlcmUgYW4gYXV0b21hdGljIHB1YmxpY1BhdGggaXMgbm90IHN1cHBvcnRlZCB5b3UgbXVzdCBzcGVjaWZ5IGFuIG91dHB1dC5wdWJsaWNQYXRoIG1hbnVhbGx5IHZpYSBjb25maWd1cmF0aW9uXG4vLyBvciBwYXNzIGFuIGVtcHR5IHN0cmluZyAoXCJcIikgYW5kIHNldCB0aGUgX193ZWJwYWNrX3B1YmxpY19wYXRoX18gdmFyaWFibGUgZnJvbSB5b3VyIGNvZGUgdG8gdXNlIHlvdXIgb3duIGxvZ2ljLlxuaWYgKCFzY3JpcHRVcmwpIHRocm93IG5ldyBFcnJvcihcIkF1dG9tYXRpYyBwdWJsaWNQYXRoIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhpcyBicm93c2VyXCIpO1xuc2NyaXB0VXJsID0gc2NyaXB0VXJsLnJlcGxhY2UoL15ibG9iOi8sIFwiXCIpLnJlcGxhY2UoLyMuKiQvLCBcIlwiKS5yZXBsYWNlKC9cXD8uKiQvLCBcIlwiKS5yZXBsYWNlKC9cXC9bXlxcL10rJC8sIFwiL1wiKTtcbl9fd2VicGFja19yZXF1aXJlX18ucCA9IHNjcmlwdFVybCArIFwiLi4vXCI7IiwiLy8gbm8gYmFzZVVSSVxuXG4vLyBvYmplY3QgdG8gc3RvcmUgbG9hZGVkIGFuZCBsb2FkaW5nIGNodW5rc1xuLy8gdW5kZWZpbmVkID0gY2h1bmsgbm90IGxvYWRlZCwgbnVsbCA9IGNodW5rIHByZWxvYWRlZC9wcmVmZXRjaGVkXG4vLyBbcmVzb2x2ZSwgcmVqZWN0LCBQcm9taXNlXSA9IGNodW5rIGxvYWRpbmcsIDAgPSBjaHVuayBsb2FkZWRcbnZhciBpbnN0YWxsZWRDaHVua3MgPSB7XG5cdDk2NjogMFxufTtcblxuX193ZWJwYWNrX3JlcXVpcmVfXy5mLmogPSAoY2h1bmtJZCwgcHJvbWlzZXMpID0+IHtcblx0XHQvLyBKU09OUCBjaHVuayBsb2FkaW5nIGZvciBqYXZhc2NyaXB0XG5cdFx0dmFyIGluc3RhbGxlZENodW5rRGF0YSA9IF9fd2VicGFja19yZXF1aXJlX18ubyhpbnN0YWxsZWRDaHVua3MsIGNodW5rSWQpID8gaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdIDogdW5kZWZpbmVkO1xuXHRcdGlmKGluc3RhbGxlZENodW5rRGF0YSAhPT0gMCkgeyAvLyAwIG1lYW5zIFwiYWxyZWFkeSBpbnN0YWxsZWRcIi5cblxuXHRcdFx0Ly8gYSBQcm9taXNlIG1lYW5zIFwiY3VycmVudGx5IGxvYWRpbmdcIi5cblx0XHRcdGlmKGluc3RhbGxlZENodW5rRGF0YSkge1xuXHRcdFx0XHRwcm9taXNlcy5wdXNoKGluc3RhbGxlZENodW5rRGF0YVsyXSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZih0cnVlKSB7IC8vIGFsbCBjaHVua3MgaGF2ZSBKU1xuXHRcdFx0XHRcdC8vIHNldHVwIFByb21pc2UgaW4gY2h1bmsgY2FjaGVcblx0XHRcdFx0XHR2YXIgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IChpbnN0YWxsZWRDaHVua0RhdGEgPSBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gPSBbcmVzb2x2ZSwgcmVqZWN0XSkpO1xuXHRcdFx0XHRcdHByb21pc2VzLnB1c2goaW5zdGFsbGVkQ2h1bmtEYXRhWzJdID0gcHJvbWlzZSk7XG5cblx0XHRcdFx0XHQvLyBzdGFydCBjaHVuayBsb2FkaW5nXG5cdFx0XHRcdFx0dmFyIHVybCA9IF9fd2VicGFja19yZXF1aXJlX18ucCArIF9fd2VicGFja19yZXF1aXJlX18udShjaHVua0lkKTtcblx0XHRcdFx0XHQvLyBjcmVhdGUgZXJyb3IgYmVmb3JlIHN0YWNrIHVud291bmQgdG8gZ2V0IHVzZWZ1bCBzdGFja3RyYWNlIGxhdGVyXG5cdFx0XHRcdFx0dmFyIGVycm9yID0gbmV3IEVycm9yKCk7XG5cdFx0XHRcdFx0dmFyIGxvYWRpbmdFbmRlZCA9IChldmVudCkgPT4ge1xuXHRcdFx0XHRcdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGluc3RhbGxlZENodW5rcywgY2h1bmtJZCkpIHtcblx0XHRcdFx0XHRcdFx0aW5zdGFsbGVkQ2h1bmtEYXRhID0gaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdO1xuXHRcdFx0XHRcdFx0XHRpZihpbnN0YWxsZWRDaHVua0RhdGEgIT09IDApIGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA9IHVuZGVmaW5lZDtcblx0XHRcdFx0XHRcdFx0aWYoaW5zdGFsbGVkQ2h1bmtEYXRhKSB7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIGVycm9yVHlwZSA9IGV2ZW50ICYmIChldmVudC50eXBlID09PSAnbG9hZCcgPyAnbWlzc2luZycgOiBldmVudC50eXBlKTtcblx0XHRcdFx0XHRcdFx0XHR2YXIgcmVhbFNyYyA9IGV2ZW50ICYmIGV2ZW50LnRhcmdldCAmJiBldmVudC50YXJnZXQuc3JjO1xuXHRcdFx0XHRcdFx0XHRcdGVycm9yLm1lc3NhZ2UgPSAnTG9hZGluZyBjaHVuayAnICsgY2h1bmtJZCArICcgZmFpbGVkLlxcbignICsgZXJyb3JUeXBlICsgJzogJyArIHJlYWxTcmMgKyAnKSc7XG5cdFx0XHRcdFx0XHRcdFx0ZXJyb3IubmFtZSA9ICdDaHVua0xvYWRFcnJvcic7XG5cdFx0XHRcdFx0XHRcdFx0ZXJyb3IudHlwZSA9IGVycm9yVHlwZTtcblx0XHRcdFx0XHRcdFx0XHRlcnJvci5yZXF1ZXN0ID0gcmVhbFNyYztcblx0XHRcdFx0XHRcdFx0XHRpbnN0YWxsZWRDaHVua0RhdGFbMV0oZXJyb3IpO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmwodXJsLCBsb2FkaW5nRW5kZWQsIFwiY2h1bmstXCIgKyBjaHVua0lkLCBjaHVua0lkKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cbn07XG5cbi8vIG5vIHByZWZldGNoaW5nXG5cbi8vIG5vIHByZWxvYWRlZFxuXG4vLyBubyBITVJcblxuLy8gbm8gSE1SIG1hbmlmZXN0XG5cbl9fd2VicGFja19yZXF1aXJlX18uTy5qID0gKGNodW5rSWQpID0+IChpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gPT09IDApO1xuXG4vLyBpbnN0YWxsIGEgSlNPTlAgY2FsbGJhY2sgZm9yIGNodW5rIGxvYWRpbmdcbnZhciB3ZWJwYWNrSnNvbnBDYWxsYmFjayA9IChwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbiwgZGF0YSkgPT4ge1xuXHR2YXIgW2NodW5rSWRzLCBtb3JlTW9kdWxlcywgcnVudGltZV0gPSBkYXRhO1xuXHQvLyBhZGQgXCJtb3JlTW9kdWxlc1wiIHRvIHRoZSBtb2R1bGVzIG9iamVjdCxcblx0Ly8gdGhlbiBmbGFnIGFsbCBcImNodW5rSWRzXCIgYXMgbG9hZGVkIGFuZCBmaXJlIGNhbGxiYWNrXG5cdHZhciBtb2R1bGVJZCwgY2h1bmtJZCwgaSA9IDA7XG5cdGlmKGNodW5rSWRzLnNvbWUoKGlkKSA9PiAoaW5zdGFsbGVkQ2h1bmtzW2lkXSAhPT0gMCkpKSB7XG5cdFx0Zm9yKG1vZHVsZUlkIGluIG1vcmVNb2R1bGVzKSB7XG5cdFx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8obW9yZU1vZHVsZXMsIG1vZHVsZUlkKSkge1xuXHRcdFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLm1bbW9kdWxlSWRdID0gbW9yZU1vZHVsZXNbbW9kdWxlSWRdO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZihydW50aW1lKSB2YXIgcmVzdWx0ID0gcnVudGltZShfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblx0fVxuXHRpZihwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbikgcGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24oZGF0YSk7XG5cdGZvcig7aSA8IGNodW5rSWRzLmxlbmd0aDsgaSsrKSB7XG5cdFx0Y2h1bmtJZCA9IGNodW5rSWRzW2ldO1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhpbnN0YWxsZWRDaHVua3MsIGNodW5rSWQpICYmIGluc3RhbGxlZENodW5rc1tjaHVua0lkXSkge1xuXHRcdFx0aW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdWzBdKCk7XG5cdFx0fVxuXHRcdGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA9IDA7XG5cdH1cblx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18uTyhyZXN1bHQpO1xufVxuXG52YXIgY2h1bmtMb2FkaW5nR2xvYmFsID0gc2VsZltcIndlYnBhY2tDaHVua3VyYmFuZG9jc193ZWJhcHBcIl0gPSBzZWxmW1wid2VicGFja0NodW5rdXJiYW5kb2NzX3dlYmFwcFwiXSB8fCBbXTtcbmNodW5rTG9hZGluZ0dsb2JhbC5mb3JFYWNoKHdlYnBhY2tKc29ucENhbGxiYWNrLmJpbmQobnVsbCwgMCkpO1xuY2h1bmtMb2FkaW5nR2xvYmFsLnB1c2ggPSB3ZWJwYWNrSnNvbnBDYWxsYmFjay5iaW5kKG51bGwsIGNodW5rTG9hZGluZ0dsb2JhbC5wdXNoLmJpbmQoY2h1bmtMb2FkaW5nR2xvYmFsKSk7IiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4vLyBUaGlzIGVudHJ5IG1vZHVsZSBkZXBlbmRzIG9uIG90aGVyIGxvYWRlZCBjaHVua3MgYW5kIGV4ZWN1dGlvbiBuZWVkIHRvIGJlIGRlbGF5ZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXy5PKHVuZGVmaW5lZCwgWzMwM10sICgpID0+IChfX3dlYnBhY2tfcmVxdWlyZV9fKDQxOCkpKVxuX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18uTyhfX3dlYnBhY2tfZXhwb3J0c19fKTtcbiJdLCJuYW1lcyI6WyJkZWZlcnJlZCIsImxlYWZQcm90b3R5cGVzIiwiZ2V0UHJvdG8iLCJpblByb2dyZXNzIiwiZGF0YVdlYnBhY2tQcmVmaXgiLCJzdXBhYmFzZSIsImN1cnJlbnRVc2VyIiwic2hvd0Vycm9yIiwibWVzc2FnZSIsImVsZW1lbnRJZCIsImVycm9yRWxlbWVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJpbm5lckhUTUwiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJjb25zb2xlIiwiZXJyb3IiLCJzaG93TG9hZGluZyIsImJ1dHRvbklkIiwic3Bpbm5lcklkIiwiYnV0dG9uIiwic3Bpbm5lciIsImRpc2FibGVkIiwiaGlkZUxvYWRpbmciLCJhZGQiLCJjYXB0Y2hhTG9naW5Ub2tlbiIsInR1cm5zdGlsZUxvZ2luV2lkZ2V0SWQiLCJpbml0TG9naW5QYWdlIiwibG9naW5Gb3JtIiwiZXJyb3JNZXNzYWdlIiwidG9nZ2xlUGFzc3dvcmRCdG4iLCJwYXNzd29yZElucHV0IiwiZ29vZ2xlU2lnbkluQnRuIiwiYWRkRXZlbnRMaXN0ZW5lciIsInR5cGUiLCJnZXRBdHRyaWJ1dGUiLCJzZXRBdHRyaWJ1dGUiLCJpY29uRWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJhc3luYyIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInRleHRDb250ZW50Iiwic3RhdHVzTWVzc2FnZUVsZW1lbnQiLCJlbWFpbCIsInZhbHVlIiwicGFzc3dvcmQiLCJkYXRhIiwiYXV0aCIsInNpZ25JbldpdGhQYXNzd29yZCIsIm9wdGlvbnMiLCJjYXB0Y2hhVG9rZW4iLCJ0b0xvd2VyQ2FzZSIsImluY2x1ZGVzIiwiRXJyb3IiLCJzZXNzaW9uIiwidXNlciIsImxvY2FsU3RvcmFnZSIsInNldEl0ZW0iLCJKU09OIiwic3RyaW5naWZ5IiwicmVtb3ZlSXRlbSIsImxvZyIsInN0YXR1c0VsZW1lbnQiLCJmb3JFYWNoIiwiY2xhc3NOYW1lIiwic3RhcnRzV2l0aCIsInNob3dTdGF0dXMiLCJzZXRUaW1lb3V0Iiwid2luZG93IiwibG9jYXRpb24iLCJocmVmIiwibG9naW4iLCJ0dXJuc3RpbGUiLCJyZXNldCIsInNpZ25JbldpdGhPQXV0aCIsInByb3ZpZGVyIiwid2FybiIsIm9ubG9hZFR1cm5zdGlsZUxvZ2luQ2FsbGJhY2siLCJ0dXJuc3RpbGVDb250YWluZXIiLCJyZW5kZXIiLCJzaXRla2V5IiwiY2FsbGJhY2siLCJ0b2tlbiIsImVyciIsInVuZGVmaW5lZCIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiY2FsbCIsIm0iLCJPIiwicmVzdWx0IiwiY2h1bmtJZHMiLCJmbiIsInByaW9yaXR5Iiwibm90RnVsZmlsbGVkIiwiSW5maW5pdHkiLCJpIiwibGVuZ3RoIiwiZnVsZmlsbGVkIiwiaiIsIk9iamVjdCIsImtleXMiLCJldmVyeSIsImtleSIsInNwbGljZSIsInIiLCJnZXRQcm90b3R5cGVPZiIsIm9iaiIsInQiLCJtb2RlIiwidGhpcyIsIl9fZXNNb2R1bGUiLCJ0aGVuIiwibnMiLCJjcmVhdGUiLCJkZWYiLCJjdXJyZW50IiwiaW5kZXhPZiIsImdldE93blByb3BlcnR5TmFtZXMiLCJkIiwiZGVmaW5pdGlvbiIsIm8iLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJmIiwiY2h1bmtJZCIsIlByb21pc2UiLCJhbGwiLCJyZWR1Y2UiLCJwcm9taXNlcyIsInUiLCJnIiwiZ2xvYmFsVGhpcyIsIkZ1bmN0aW9uIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwibCIsInVybCIsImRvbmUiLCJwdXNoIiwic2NyaXB0IiwibmVlZEF0dGFjaCIsInNjcmlwdHMiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsInMiLCJjcmVhdGVFbGVtZW50IiwiY2hhcnNldCIsInRpbWVvdXQiLCJuYyIsInNyYyIsIm9uU2NyaXB0Q29tcGxldGUiLCJwcmV2IiwiZXZlbnQiLCJvbmVycm9yIiwib25sb2FkIiwiY2xlYXJUaW1lb3V0IiwiZG9uZUZucyIsInBhcmVudE5vZGUiLCJyZW1vdmVDaGlsZCIsImJpbmQiLCJ0YXJnZXQiLCJoZWFkIiwiYXBwZW5kQ2hpbGQiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInNjcmlwdFVybCIsImltcG9ydFNjcmlwdHMiLCJjdXJyZW50U2NyaXB0IiwidGFnTmFtZSIsInRvVXBwZXJDYXNlIiwidGVzdCIsInJlcGxhY2UiLCJwIiwiaW5zdGFsbGVkQ2h1bmtzIiwiaW5zdGFsbGVkQ2h1bmtEYXRhIiwicHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJlcnJvclR5cGUiLCJyZWFsU3JjIiwibmFtZSIsInJlcXVlc3QiLCJ3ZWJwYWNrSnNvbnBDYWxsYmFjayIsInBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uIiwibW9yZU1vZHVsZXMiLCJydW50aW1lIiwic29tZSIsImlkIiwiY2h1bmtMb2FkaW5nR2xvYmFsIiwic2VsZiIsIl9fd2VicGFja19leHBvcnRzX18iXSwic291cmNlUm9vdCI6IiJ9