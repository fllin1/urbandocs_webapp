(()=>{"use strict";var e,n,t,o,r,i={1008:(e,n,t)=>{var o=t(3715),r=t(9660);let i=null,a=null,s=null;async function l(e){if(e.preventDefault(),!a)return void(0,o.Qg)("Veuillez compléter le CAPTCHA avant de confirmer.");if(!i)return void(0,o.Qg)("Données de confirmation manquantes.");const n=document.getElementById("confirmBtn"),t=document.getElementById("confirmSpinner");n&&(n.disabled=!0),t&&t.classList.remove("hidden");try{"url"===i.type?await async function(e){try{const n=decodeURIComponent(e);console.log("Attempting email confirmation with URL:",n);const t=new URL(n),o=t.searchParams.get("token"),i=t.searchParams.get("type");if(!o)throw new Error("Token manquant dans l'URL de confirmation.");console.log("Extracted from URL - token:",o.substring(0,20)+"...","type:",i);const{data:a,error:s}=await r.N.auth.verifyOtp({token_hash:o,type:"email"});if(s)throw console.error("Error during URL-based confirmation:",s),new Error("Erreur lors de la confirmation: "+s.message);if(!a.user||!a.session)throw new Error("Impossible de confirmer l'email. Le lien est peut-être expiré ou déjà utilisé.");console.log("Email confirmed successfully via URL:",a.user.email),c()}catch(e){throw console.error("Confirmation processing error:",e),e}}(i.data):"token"===i.type&&await async function(e,n="signup"){try{console.log("Attempting token confirmation with type:",n);const{data:t,error:o}=await r.N.auth.verifyOtp({token_hash:e,type:"email"});if(o)throw console.error("Error during verifyOtp:",o),new Error("Erreur lors de la vérification du token: "+o.message);if(!t.user||!t.session)throw new Error("Impossible de confirmer l'email. Le token est peut-être invalide ou a expiré.");console.log("Email confirmed successfully:",t.user.email),c()}catch(e){throw console.error("Error during token-based confirmation:",e),e}}(i.data,i.tokenType)}catch(e){console.error("Confirmation error:",e),(0,o.Qg)(`Erreur lors de la confirmation: ${e.message}`)}finally{n&&(n.disabled=!1),t&&t.classList.add("hidden"),window.turnstile&&s&&window.turnstile.reset(s),a=null,n&&(n.disabled=!0)}}function c(e){const n=document.getElementById("confirmationForm"),t=document.getElementById("successMessage");n&&n.classList.add("hidden"),t&&(t.innerHTML='\n      <div class="confirmation-success">\n        <span class="success-icon">✅</span>\n        <h3>Confirmation réussie !</h3>\n        <p>Votre compte a été confirmé avec succès.</p>\n        <p>Vous allez être redirigé vers la page de connexion dans quelques secondes...</p>\n      </div>\n    ',t.classList.remove("hidden")),setTimeout((()=>{window.location.href="/auth/login"}),3e3)}window.onloadTurnstileCallback=function(){console.log("Turnstile API ready for confirmation page.");const e=document.getElementById("turnstile-container");if(e&&window.turnstile&&!s){console.log("Rendering Turnstile widget for confirmation...");try{s=window.turnstile.render(e,{sitekey:"0x4AAAAAABdzY3InOU2_In99",callback:function(e){a=e,console.log("Turnstile token obtained for confirmation:",e);const n=document.getElementById("confirmBtn");n&&(n.disabled=!1)},"expired-callback":()=>{console.log("Turnstile token expired on confirmation page."),window.turnstile&&s&&window.turnstile.reset(s),a=null;const e=document.getElementById("confirmBtn");e&&(e.disabled=!0)},"error-callback":e=>{a=null,console.error("Turnstile error on confirmation page:",e),(0,o.Qg)(`Erreur CAPTCHA: ${e}. Veuillez réessayer.`);const n=document.getElementById("confirmBtn");n&&(n.disabled=!0)}}),void 0===s?(console.error("Turnstile.render did not return a widgetId for confirmation."),(0,o.Qg)("Erreur initialisation CAPTCHA.")):console.log("Turnstile widget rendered for confirmation. ID:",s)}catch(e){console.error("Error rendering Turnstile on confirmation page:",e),(0,o.Qg)("Impossible d'afficher le CAPTCHA.")}}},document.addEventListener("DOMContentLoaded",(()=>{(function(){const e=new URLSearchParams(window.location.search),n=window.location.hash;let t=e.get("token");const r=e.get("type");let a=e.get("confirmation_url");if(n){const e=new URLSearchParams(n.substring(1));t||(t=e.get("access_token")||e.get("token"))}console.log("Confirmation page initialized with:",{confirmationToken:t?"present":"missing",type:r,confirmationUrl:a?"present":"missing",urlHash:n||"none"}),document.getElementById("statusMessage"),document.getElementById("errorMessage");const s=document.getElementById("loading"),c=document.getElementById("confirmationForm"),d=document.getElementById("confirmForm");if(s&&s.classList.remove("hidden"),a)i={type:"url",data:a},u();else{if(!t||"signup"!==r&&"email_change"!==r)return s&&s.classList.add("hidden"),void(0,o.Qg)("Erreur: URL ou jeton de confirmation manquant ou invalide.");i={type:"token",data:t,tokenType:r},u()}function u(){s&&s.classList.add("hidden"),c&&c.classList.remove("hidden"),(0,o.wc)("Lien de confirmation valide. Veuillez compléter le CAPTCHA et confirmer.","info")}d&&d.addEventListener("submit",l)})(),console.log("Confirmation page initialized")}))}},a={};function s(e){var n=a[e];if(void 0!==n)return n.exports;var t=a[e]={exports:{}};return i[e].call(t.exports,t,t.exports,s),t.exports}s.m=i,e=[],s.O=(n,t,o,r)=>{if(!t){var i=1/0;for(d=0;d<e.length;d++){for(var[t,o,r]=e[d],a=!0,l=0;l<t.length;l++)(!1&r||i>=r)&&Object.keys(s.O).every((e=>s.O[e](t[l])))?t.splice(l--,1):(a=!1,r<i&&(i=r));if(a){e.splice(d--,1);var c=o();void 0!==c&&(n=c)}}return n}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[t,o,r]},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,s.t=function(e,o){if(1&o&&(e=this(e)),8&o)return e;if("object"==typeof e&&e){if(4&o&&e.__esModule)return e;if(16&o&&"function"==typeof e.then)return e}var r=Object.create(null);s.r(r);var i={};n=n||[null,t({}),t([]),t(t)];for(var a=2&o&&e;"object"==typeof a&&!~n.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((n=>i[n]=()=>e[n]));return i.default=()=>e,s.d(r,i),r},s.d=(e,n)=>{for(var t in n)s.o(n,t)&&!s.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((n,t)=>(s.f[t](e,n),n)),[])),s.u=e=>"js/"+e+".chunk.js",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),o={},r="urbandocs_webapp:",s.l=(e,n,t,i)=>{if(o[e])o[e].push(n);else{var a,l;if(void 0!==t)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==r+t){a=u;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,s.nc&&a.setAttribute("nonce",s.nc),a.setAttribute("data-webpack",r+t),a.src=e),o[e]=[n];var f=(n,t)=>{a.onerror=a.onload=null,clearTimeout(m);var r=o[e];if(delete o[e],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach((e=>e(t))),n)return n(t)},m=setTimeout(f.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=f.bind(null,a.onerror),a.onload=f.bind(null,a.onload),l&&document.head.appendChild(a)}},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.j=508,s.p="/",(()=>{var e={508:0};s.f.j=(n,t)=>{var o=s.o(e,n)?e[n]:void 0;if(0!==o)if(o)t.push(o[2]);else{var r=new Promise(((t,r)=>o=e[n]=[t,r]));t.push(o[2]=r);var i=s.p+s.u(n),a=new Error;s.l(i,(t=>{if(s.o(e,n)&&(0!==(o=e[n])&&(e[n]=void 0),o)){var r=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;a.message="Loading chunk "+n+" failed.\n("+r+": "+i+")",a.name="ChunkLoadError",a.type=r,a.request=i,o[1](a)}}),"chunk-"+n,n)}},s.O.j=n=>0===e[n];var n=(n,t)=>{var o,r,[i,a,l]=t,c=0;if(i.some((n=>0!==e[n]))){for(o in a)s.o(a,o)&&(s.m[o]=a[o]);if(l)var d=l(s)}for(n&&n(t);c<i.length;c++)r=i[c],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return s.O(d)},t=self.webpackChunkurbandocs_webapp=self.webpackChunkurbandocs_webapp||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))})();var l=s.O(void 0,[76],(()=>s(1008)));l=s.O(l)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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NUIsT0FBTzlDLEVBQW9CUSxFQUFFQyxJQUcxQitGLEVBQXFCQyxLQUFtQyw2QkFBSUEsS0FBbUMsOEJBQUssR0FDeEdELEVBQW1CakUsUUFBUTJELEVBQXFCaEIsS0FBSyxLQUFNLElBQzNEc0IsRUFBbUI1QyxLQUFPc0MsRUFBcUJoQixLQUFLLEtBQU1zQixFQUFtQjVDLEtBQUtzQixLQUFLc0IsRyxLQ2xGdkYsSUFBSUUsRUFBc0IxRyxFQUFvQlEsT0FBRXZCLEVBQVcsQ0FBQyxLQUFLLElBQU9lLEVBQW9CLFFBQzVGMEcsRUFBc0IxRyxFQUFvQlEsRUFBRWtHLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9jaHVuayBsb2FkZWQiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvY3JlYXRlIGZha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9sb2FkIHNjcmlwdCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwLy4vc3JjL2pzL2F1dGgvY29uZmlybWF0aW9uLmpzIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvLi9zcmMvanMvZW50cmllcy9jb25maXJtYXRpb24uanMiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9lbnN1cmUgY2h1bmsiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvZ2V0IGphdmFzY3JpcHQgY2h1bmsgZmlsZW5hbWUiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvZ2xvYmFsIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvcnVudGltZUlkIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL3B1YmxpY1BhdGgiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvanNvbnAgY2h1bmsgbG9hZGluZyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZGVmZXJyZWQgPSBbXTtcbl9fd2VicGFja19yZXF1aXJlX18uTyA9IChyZXN1bHQsIGNodW5rSWRzLCBmbiwgcHJpb3JpdHkpID0+IHtcblx0aWYoY2h1bmtJZHMpIHtcblx0XHRwcmlvcml0eSA9IHByaW9yaXR5IHx8IDA7XG5cdFx0Zm9yKHZhciBpID0gZGVmZXJyZWQubGVuZ3RoOyBpID4gMCAmJiBkZWZlcnJlZFtpIC0gMV1bMl0gPiBwcmlvcml0eTsgaS0tKSBkZWZlcnJlZFtpXSA9IGRlZmVycmVkW2kgLSAxXTtcblx0XHRkZWZlcnJlZFtpXSA9IFtjaHVua0lkcywgZm4sIHByaW9yaXR5XTtcblx0XHRyZXR1cm47XG5cdH1cblx0dmFyIG5vdEZ1bGZpbGxlZCA9IEluZmluaXR5O1xuXHRmb3IgKHZhciBpID0gMDsgaSA8IGRlZmVycmVkLmxlbmd0aDsgaSsrKSB7XG5cdFx0dmFyIFtjaHVua0lkcywgZm4sIHByaW9yaXR5XSA9IGRlZmVycmVkW2ldO1xuXHRcdHZhciBmdWxmaWxsZWQgPSB0cnVlO1xuXHRcdGZvciAodmFyIGogPSAwOyBqIDwgY2h1bmtJZHMubGVuZ3RoOyBqKyspIHtcblx0XHRcdGlmICgocHJpb3JpdHkgJiAxID09PSAwIHx8IG5vdEZ1bGZpbGxlZCA+PSBwcmlvcml0eSkgJiYgT2JqZWN0LmtleXMoX193ZWJwYWNrX3JlcXVpcmVfXy5PKS5ldmVyeSgoa2V5KSA9PiAoX193ZWJwYWNrX3JlcXVpcmVfXy5PW2tleV0oY2h1bmtJZHNbal0pKSkpIHtcblx0XHRcdFx0Y2h1bmtJZHMuc3BsaWNlKGotLSwgMSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRmdWxmaWxsZWQgPSBmYWxzZTtcblx0XHRcdFx0aWYocHJpb3JpdHkgPCBub3RGdWxmaWxsZWQpIG5vdEZ1bGZpbGxlZCA9IHByaW9yaXR5O1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZihmdWxmaWxsZWQpIHtcblx0XHRcdGRlZmVycmVkLnNwbGljZShpLS0sIDEpXG5cdFx0XHR2YXIgciA9IGZuKCk7XG5cdFx0XHRpZiAociAhPT0gdW5kZWZpbmVkKSByZXN1bHQgPSByO1xuXHRcdH1cblx0fVxuXHRyZXR1cm4gcmVzdWx0O1xufTsiLCJ2YXIgZ2V0UHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YgPyAob2JqKSA9PiAoT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iaikpIDogKG9iaikgPT4gKG9iai5fX3Byb3RvX18pO1xudmFyIGxlYWZQcm90b3R5cGVzO1xuLy8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4vLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbi8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuLy8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4vLyBtb2RlICYgMTY6IHJldHVybiB2YWx1ZSB3aGVuIGl0J3MgUHJvbWlzZS1saWtlXG4vLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuXHRpZihtb2RlICYgMSkgdmFsdWUgPSB0aGlzKHZhbHVlKTtcblx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcblx0aWYodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSkge1xuXHRcdGlmKChtb2RlICYgNCkgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuXHRcdGlmKChtb2RlICYgMTYpICYmIHR5cGVvZiB2YWx1ZS50aGVuID09PSAnZnVuY3Rpb24nKSByZXR1cm4gdmFsdWU7XG5cdH1cblx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcblx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcblx0dmFyIGRlZiA9IHt9O1xuXHRsZWFmUHJvdG90eXBlcyA9IGxlYWZQcm90b3R5cGVzIHx8IFtudWxsLCBnZXRQcm90byh7fSksIGdldFByb3RvKFtdKSwgZ2V0UHJvdG8oZ2V0UHJvdG8pXTtcblx0Zm9yKHZhciBjdXJyZW50ID0gbW9kZSAmIDIgJiYgdmFsdWU7IHR5cGVvZiBjdXJyZW50ID09ICdvYmplY3QnICYmICF+bGVhZlByb3RvdHlwZXMuaW5kZXhPZihjdXJyZW50KTsgY3VycmVudCA9IGdldFByb3RvKGN1cnJlbnQpKSB7XG5cdFx0T2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoY3VycmVudCkuZm9yRWFjaCgoa2V5KSA9PiAoZGVmW2tleV0gPSAoKSA9PiAodmFsdWVba2V5XSkpKTtcblx0fVxuXHRkZWZbJ2RlZmF1bHQnXSA9ICgpID0+ICh2YWx1ZSk7XG5cdF9fd2VicGFja19yZXF1aXJlX18uZChucywgZGVmKTtcblx0cmV0dXJuIG5zO1xufTsiLCJ2YXIgaW5Qcm9ncmVzcyA9IHt9O1xudmFyIGRhdGFXZWJwYWNrUHJlZml4ID0gXCJ1cmJhbmRvY3Nfd2ViYXBwOlwiO1xuLy8gbG9hZFNjcmlwdCBmdW5jdGlvbiB0byBsb2FkIGEgc2NyaXB0IHZpYSBzY3JpcHQgdGFnXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmwgPSAodXJsLCBkb25lLCBrZXksIGNodW5rSWQpID0+IHtcblx0aWYoaW5Qcm9ncmVzc1t1cmxdKSB7IGluUHJvZ3Jlc3NbdXJsXS5wdXNoKGRvbmUpOyByZXR1cm47IH1cblx0dmFyIHNjcmlwdCwgbmVlZEF0dGFjaDtcblx0aWYoa2V5ICE9PSB1bmRlZmluZWQpIHtcblx0XHR2YXIgc2NyaXB0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpO1xuXHRcdGZvcih2YXIgaSA9IDA7IGkgPCBzY3JpcHRzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHR2YXIgcyA9IHNjcmlwdHNbaV07XG5cdFx0XHRpZihzLmdldEF0dHJpYnV0ZShcInNyY1wiKSA9PSB1cmwgfHwgcy5nZXRBdHRyaWJ1dGUoXCJkYXRhLXdlYnBhY2tcIikgPT0gZGF0YVdlYnBhY2tQcmVmaXggKyBrZXkpIHsgc2NyaXB0ID0gczsgYnJlYWs7IH1cblx0XHR9XG5cdH1cblx0aWYoIXNjcmlwdCkge1xuXHRcdG5lZWRBdHRhY2ggPSB0cnVlO1xuXHRcdHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuXG5cdFx0c2NyaXB0LmNoYXJzZXQgPSAndXRmLTgnO1xuXHRcdHNjcmlwdC50aW1lb3V0ID0gMTIwO1xuXHRcdGlmIChfX3dlYnBhY2tfcmVxdWlyZV9fLm5jKSB7XG5cdFx0XHRzY3JpcHQuc2V0QXR0cmlidXRlKFwibm9uY2VcIiwgX193ZWJwYWNrX3JlcXVpcmVfXy5uYyk7XG5cdFx0fVxuXHRcdHNjcmlwdC5zZXRBdHRyaWJ1dGUoXCJkYXRhLXdlYnBhY2tcIiwgZGF0YVdlYnBhY2tQcmVmaXggKyBrZXkpO1xuXG5cdFx0c2NyaXB0LnNyYyA9IHVybDtcblx0fVxuXHRpblByb2dyZXNzW3VybF0gPSBbZG9uZV07XG5cdHZhciBvblNjcmlwdENvbXBsZXRlID0gKHByZXYsIGV2ZW50KSA9PiB7XG5cdFx0Ly8gYXZvaWQgbWVtIGxlYWtzIGluIElFLlxuXHRcdHNjcmlwdC5vbmVycm9yID0gc2NyaXB0Lm9ubG9hZCA9IG51bGw7XG5cdFx0Y2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuXHRcdHZhciBkb25lRm5zID0gaW5Qcm9ncmVzc1t1cmxdO1xuXHRcdGRlbGV0ZSBpblByb2dyZXNzW3VybF07XG5cdFx0c2NyaXB0LnBhcmVudE5vZGUgJiYgc2NyaXB0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoc2NyaXB0KTtcblx0XHRkb25lRm5zICYmIGRvbmVGbnMuZm9yRWFjaCgoZm4pID0+IChmbihldmVudCkpKTtcblx0XHRpZihwcmV2KSByZXR1cm4gcHJldihldmVudCk7XG5cdH1cblx0dmFyIHRpbWVvdXQgPSBzZXRUaW1lb3V0KG9uU2NyaXB0Q29tcGxldGUuYmluZChudWxsLCB1bmRlZmluZWQsIHsgdHlwZTogJ3RpbWVvdXQnLCB0YXJnZXQ6IHNjcmlwdCB9KSwgMTIwMDAwKTtcblx0c2NyaXB0Lm9uZXJyb3IgPSBvblNjcmlwdENvbXBsZXRlLmJpbmQobnVsbCwgc2NyaXB0Lm9uZXJyb3IpO1xuXHRzY3JpcHQub25sb2FkID0gb25TY3JpcHRDb21wbGV0ZS5iaW5kKG51bGwsIHNjcmlwdC5vbmxvYWQpO1xuXHRuZWVkQXR0YWNoICYmIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTtcbn07IiwiLy8gc3JjL2F1dGgvY29uZmlybWF0aW9uLmpzXHJcbi8qKlxyXG4gKiBDb25maXJtYXRpb24gTW9kdWxlXHJcbiAqIEBtb2R1bGUgY29uZmlybWF0aW9uXHJcbiAqIEBkZXNjcmlwdGlvbiBIYW5kbGVzIGVtYWlsIGNvbmZpcm1hdGlvbiB3aXRoIG1hbnVhbCBjb25maXJtYXRpb24gYnV0dG9uIGFuZCBDQVBUQ0hBIHZlcmlmaWNhdGlvbi5cclxuICogQHZlcnNpb24gMC4zLjBcclxuICpcclxuICogQGNoYW5nZWxvZ1xyXG4gKiAtIDAuMy4wICgyMDI1LTAxLVhYKTogQWRkZWQgbWFudWFsIGNvbmZpcm1hdGlvbiB3aXRoIENBUFRDSEEgcmVxdWlyZW1lbnQuXHJcbiAqIC0gMC4yLjAgKDIwMjUtMDUtMzEpOiBTaW1wbGlmaWVkIHBhZ2UgdG8gYXV0by1jb25maXJtIGFuZCByZWRpcmVjdC4gUmVtb3ZlZCBUb1MgYWdyZWVtZW50IGZyb20gdGhpcyBwYWdlLlxyXG4gKiAtIDAuMS4xICgyMDI1LTA1LTE3KTogQ29ycmVjdGVkIHN1Y2Nlc3MgbWVzc2FnZSBhbmQgcmVkaXJlY3QgdG8gbG9naW4gcGFnZS5cclxuICogLSAwLjEuMCAoMjAyNS0wNS0xNSk6IENvbnZlcnRlZCB0byB1c2UgZGlyZWN0IFN1cGFiYXNlIEFQSSBjYWxscyBpbnN0ZWFkIG9mIEZpcmViYXNlIENsb3VkIEZ1bmN0aW9ucy5cclxuICogLSAwLjAuMyAoMjAyNS0wNS0xMik6IFVwZGF0ZWQgdGVybXMgb2Ygc2VydmljZSBtb2RhbCBhbmQgY29uZmlybWF0aW9uIGVtYWlsLlxyXG4gKiAtIDAuMC4yICgyMDI1LTA1LTEwKTogQWRkZWQgdGVybXMgb2Ygc2VydmljZSBhbmQgY29uZmlybWF0aW9uIGVtYWlsLlxyXG4gKiAtIDAuMC4xICgyMDI1LTA1LTA4KTogQ3JlYXRlZCB0aGUgY29uZmlybWF0aW9uIG1vZHVsZSB3aXRoIGJhc2ljIGZ1bmN0aW9uYWxpdHkuXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgc2hvd1N0YXR1cywgc2hvd0Vycm9yLCBzaG93TG9hZGluZywgaGlkZUxvYWRpbmcgfSBmcm9tIFwiLi9hdXRoLmpzXCI7XHJcbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSBcIi4uL3N1cGFiYXNlLWNsaWVudC5qc1wiO1xyXG5cclxuLy8gU3RvcmUgY29uZmlybWF0aW9uIGRhdGEgYW5kIGNhcHRjaGEgdG9rZW5cclxubGV0IGNvbmZpcm1hdGlvbkRhdGEgPSBudWxsO1xyXG5sZXQgY2FwdGNoYVRva2VuID0gbnVsbDtcclxubGV0IHR1cm5zdGlsZVdpZGdldElkID0gbnVsbDtcclxuXHJcbi8vIFR1cm5zdGlsZSBjYWxsYmFjayBmdW5jdGlvblxyXG53aW5kb3cub25sb2FkVHVybnN0aWxlQ2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7XHJcbiAgY29uc29sZS5sb2coXCJUdXJuc3RpbGUgQVBJIHJlYWR5IGZvciBjb25maXJtYXRpb24gcGFnZS5cIik7XHJcbiAgY29uc3QgdHVybnN0aWxlQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ0dXJuc3RpbGUtY29udGFpbmVyXCIpO1xyXG5cclxuICBpZiAodHVybnN0aWxlQ29udGFpbmVyICYmIHdpbmRvdy50dXJuc3RpbGUgJiYgIXR1cm5zdGlsZVdpZGdldElkKSB7XHJcbiAgICBjb25zb2xlLmxvZyhcIlJlbmRlcmluZyBUdXJuc3RpbGUgd2lkZ2V0IGZvciBjb25maXJtYXRpb24uLi5cIik7XHJcbiAgICB0cnkge1xyXG4gICAgICB0dXJuc3RpbGVXaWRnZXRJZCA9IHdpbmRvdy50dXJuc3RpbGUucmVuZGVyKHR1cm5zdGlsZUNvbnRhaW5lciwge1xyXG4gICAgICAgIHNpdGVrZXk6IFwiMHg0QUFBQUFBQmR6WTNJbk9VMl9Jbjk5XCIsXHJcbiAgICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uICh0b2tlbikge1xyXG4gICAgICAgICAgY2FwdGNoYVRva2VuID0gdG9rZW47XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIlR1cm5zdGlsZSB0b2tlbiBvYnRhaW5lZCBmb3IgY29uZmlybWF0aW9uOlwiLCB0b2tlbik7XHJcblxyXG4gICAgICAgICAgLy8gRW5hYmxlIGNvbmZpcm0gYnV0dG9uIHdoZW4gQ0FQVENIQSBpcyBzb2x2ZWRcclxuICAgICAgICAgIGNvbnN0IGNvbmZpcm1CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbmZpcm1CdG5cIik7XHJcbiAgICAgICAgICBpZiAoY29uZmlybUJ0bikge1xyXG4gICAgICAgICAgICBjb25maXJtQnRuLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBcImV4cGlyZWQtY2FsbGJhY2tcIjogKCkgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coXCJUdXJuc3RpbGUgdG9rZW4gZXhwaXJlZCBvbiBjb25maXJtYXRpb24gcGFnZS5cIik7XHJcbiAgICAgICAgICBpZiAod2luZG93LnR1cm5zdGlsZSAmJiB0dXJuc3RpbGVXaWRnZXRJZCkge1xyXG4gICAgICAgICAgICB3aW5kb3cudHVybnN0aWxlLnJlc2V0KHR1cm5zdGlsZVdpZGdldElkKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGNhcHRjaGFUb2tlbiA9IG51bGw7XHJcblxyXG4gICAgICAgICAgLy8gRGlzYWJsZSBjb25maXJtIGJ1dHRvbiB3aGVuIENBUFRDSEEgZXhwaXJlc1xyXG4gICAgICAgICAgY29uc3QgY29uZmlybUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29uZmlybUJ0blwiKTtcclxuICAgICAgICAgIGlmIChjb25maXJtQnRuKSB7XHJcbiAgICAgICAgICAgIGNvbmZpcm1CdG4uZGlzYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgXCJlcnJvci1jYWxsYmFja1wiOiAoZXJyKSA9PiB7XHJcbiAgICAgICAgICBjYXB0Y2hhVG9rZW4gPSBudWxsO1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIlR1cm5zdGlsZSBlcnJvciBvbiBjb25maXJtYXRpb24gcGFnZTpcIiwgZXJyKTtcclxuICAgICAgICAgIHNob3dFcnJvcihgRXJyZXVyIENBUFRDSEE6ICR7ZXJyfS4gVmV1aWxsZXogcsOpZXNzYXllci5gKTtcclxuXHJcbiAgICAgICAgICAvLyBEaXNhYmxlIGNvbmZpcm0gYnV0dG9uIG9uIENBUFRDSEEgZXJyb3JcclxuICAgICAgICAgIGNvbnN0IGNvbmZpcm1CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbmZpcm1CdG5cIik7XHJcbiAgICAgICAgICBpZiAoY29uZmlybUJ0bikge1xyXG4gICAgICAgICAgICBjb25maXJtQnRuLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIGlmICh0dXJuc3RpbGVXaWRnZXRJZCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcclxuICAgICAgICAgIFwiVHVybnN0aWxlLnJlbmRlciBkaWQgbm90IHJldHVybiBhIHdpZGdldElkIGZvciBjb25maXJtYXRpb24uXCJcclxuICAgICAgICApO1xyXG4gICAgICAgIHNob3dFcnJvcihcIkVycmV1ciBpbml0aWFsaXNhdGlvbiBDQVBUQ0hBLlwiKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcclxuICAgICAgICAgIFwiVHVybnN0aWxlIHdpZGdldCByZW5kZXJlZCBmb3IgY29uZmlybWF0aW9uLiBJRDpcIixcclxuICAgICAgICAgIHR1cm5zdGlsZVdpZGdldElkXHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmVuZGVyaW5nIFR1cm5zdGlsZSBvbiBjb25maXJtYXRpb24gcGFnZTpcIiwgZSk7XHJcbiAgICAgIHNob3dFcnJvcihcIkltcG9zc2libGUgZCdhZmZpY2hlciBsZSBDQVBUQ0hBLlwiKTtcclxuICAgIH1cclxuICB9XHJcbn07XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZXMgdGhlIGVtYWlsIGNvbmZpcm1hdGlvbiBwYWdlXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gaW5pdENvbmZpcm1hdGlvblBhZ2UoKSB7XHJcbiAgY29uc3QgdXJsUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKTtcclxuICBjb25zdCB1cmxIYXNoID0gd2luZG93LmxvY2F0aW9uLmhhc2g7XHJcblxyXG4gIC8vIENoZWNrIGZvciBkaWZmZXJlbnQgdHlwZXMgb2YgY29uZmlybWF0aW9uIGRhdGFcclxuICBsZXQgY29uZmlybWF0aW9uVG9rZW4gPSB1cmxQYXJhbXMuZ2V0KFwidG9rZW5cIik7XHJcbiAgY29uc3QgdHlwZSA9IHVybFBhcmFtcy5nZXQoXCJ0eXBlXCIpO1xyXG4gIGxldCBjb25maXJtYXRpb25VcmwgPSB1cmxQYXJhbXMuZ2V0KFwiY29uZmlybWF0aW9uX3VybFwiKTtcclxuXHJcbiAgLy8gQWxzbyBjaGVjayBVUkwgaGFzaCBmb3IgdG9rZW5zIChTdXBhYmFzZSBzb21ldGltZXMgcHV0cyB0b2tlbnMgaW4gaGFzaClcclxuICBpZiAodXJsSGFzaCkge1xyXG4gICAgY29uc3QgaGFzaFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXModXJsSGFzaC5zdWJzdHJpbmcoMSkpO1xyXG4gICAgaWYgKCFjb25maXJtYXRpb25Ub2tlbikge1xyXG4gICAgICBjb25maXJtYXRpb25Ub2tlbiA9XHJcbiAgICAgICAgaGFzaFBhcmFtcy5nZXQoXCJhY2Nlc3NfdG9rZW5cIikgfHwgaGFzaFBhcmFtcy5nZXQoXCJ0b2tlblwiKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNvbnNvbGUubG9nKFwiQ29uZmlybWF0aW9uIHBhZ2UgaW5pdGlhbGl6ZWQgd2l0aDpcIiwge1xyXG4gICAgY29uZmlybWF0aW9uVG9rZW46IGNvbmZpcm1hdGlvblRva2VuID8gXCJwcmVzZW50XCIgOiBcIm1pc3NpbmdcIixcclxuICAgIHR5cGUsXHJcbiAgICBjb25maXJtYXRpb25Vcmw6IGNvbmZpcm1hdGlvblVybCA/IFwicHJlc2VudFwiIDogXCJtaXNzaW5nXCIsXHJcbiAgICB1cmxIYXNoOiB1cmxIYXNoIHx8IFwibm9uZVwiLFxyXG4gIH0pO1xyXG5cclxuICBjb25zdCBzdGF0dXNNZXNzYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdGF0dXNNZXNzYWdlXCIpO1xyXG4gIGNvbnN0IGVycm9yTWVzc2FnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZXJyb3JNZXNzYWdlXCIpO1xyXG4gIGNvbnN0IGxvYWRpbmcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImxvYWRpbmdcIik7XHJcbiAgY29uc3QgY29uZmlybWF0aW9uRm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29uZmlybWF0aW9uRm9ybVwiKTtcclxuICBjb25zdCBjb25maXJtRm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29uZmlybUZvcm1cIik7XHJcblxyXG4gIGlmIChsb2FkaW5nKSBsb2FkaW5nLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XHJcblxyXG4gIC8vIFZhbGlkYXRlIHRoYXQgd2UgaGF2ZSB0aGUgbmVjZXNzYXJ5IGNvbmZpcm1hdGlvbiBkYXRhXHJcbiAgaWYgKGNvbmZpcm1hdGlvblVybCkge1xyXG4gICAgY29uZmlybWF0aW9uRGF0YSA9IHsgdHlwZTogXCJ1cmxcIiwgZGF0YTogY29uZmlybWF0aW9uVXJsIH07XHJcbiAgICBzaG93Q29uZmlybWF0aW9uRm9ybSgpO1xyXG4gIH0gZWxzZSBpZiAoXHJcbiAgICBjb25maXJtYXRpb25Ub2tlbiAmJlxyXG4gICAgKHR5cGUgPT09IFwic2lnbnVwXCIgfHwgdHlwZSA9PT0gXCJlbWFpbF9jaGFuZ2VcIilcclxuICApIHtcclxuICAgIGNvbmZpcm1hdGlvbkRhdGEgPSB7XHJcbiAgICAgIHR5cGU6IFwidG9rZW5cIixcclxuICAgICAgZGF0YTogY29uZmlybWF0aW9uVG9rZW4sXHJcbiAgICAgIHRva2VuVHlwZTogdHlwZSxcclxuICAgIH07XHJcbiAgICBzaG93Q29uZmlybWF0aW9uRm9ybSgpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBpZiAobG9hZGluZykgbG9hZGluZy5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xyXG4gICAgc2hvd0Vycm9yKFwiRXJyZXVyOiBVUkwgb3UgamV0b24gZGUgY29uZmlybWF0aW9uIG1hbnF1YW50IG91IGludmFsaWRlLlwiKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIC8vIFNldCB1cCBmb3JtIHN1Ym1pc3Npb24gaGFuZGxlclxyXG4gIGlmIChjb25maXJtRm9ybSkge1xyXG4gICAgY29uZmlybUZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVDb25maXJtYXRpb24pO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gc2hvd0NvbmZpcm1hdGlvbkZvcm0oKSB7XHJcbiAgICBpZiAobG9hZGluZykgbG9hZGluZy5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xyXG4gICAgaWYgKGNvbmZpcm1hdGlvbkZvcm0pIGNvbmZpcm1hdGlvbkZvcm0uY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcclxuICAgIHNob3dTdGF0dXMoXHJcbiAgICAgIFwiTGllbiBkZSBjb25maXJtYXRpb24gdmFsaWRlLiBWZXVpbGxleiBjb21wbMOpdGVyIGxlIENBUFRDSEEgZXQgY29uZmlybWVyLlwiLFxyXG4gICAgICBcImluZm9cIlxyXG4gICAgKTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBIYW5kbGVzIHRoZSBtYW51YWwgY29uZmlybWF0aW9uIHByb2Nlc3NcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUNvbmZpcm1hdGlvbihlKSB7XHJcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICBpZiAoIWNhcHRjaGFUb2tlbikge1xyXG4gICAgc2hvd0Vycm9yKFwiVmV1aWxsZXogY29tcGzDqXRlciBsZSBDQVBUQ0hBIGF2YW50IGRlIGNvbmZpcm1lci5cIik7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG5cclxuICBpZiAoIWNvbmZpcm1hdGlvbkRhdGEpIHtcclxuICAgIHNob3dFcnJvcihcIkRvbm7DqWVzIGRlIGNvbmZpcm1hdGlvbiBtYW5xdWFudGVzLlwiKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIGNvbnN0IGNvbmZpcm1CdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbmZpcm1CdG5cIik7XHJcbiAgY29uc3QgY29uZmlybVNwaW5uZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbmZpcm1TcGlubmVyXCIpO1xyXG5cclxuICAvLyBTaG93IGxvYWRpbmcgc3RhdGVcclxuICBpZiAoY29uZmlybUJ0bikgY29uZmlybUJ0bi5kaXNhYmxlZCA9IHRydWU7XHJcbiAgaWYgKGNvbmZpcm1TcGlubmVyKSBjb25maXJtU3Bpbm5lci5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xyXG5cclxuICB0cnkge1xyXG4gICAgaWYgKGNvbmZpcm1hdGlvbkRhdGEudHlwZSA9PT0gXCJ1cmxcIikge1xyXG4gICAgICBhd2FpdCBjb25maXJtRW1haWxXaXRoVXJsKGNvbmZpcm1hdGlvbkRhdGEuZGF0YSk7XHJcbiAgICB9IGVsc2UgaWYgKGNvbmZpcm1hdGlvbkRhdGEudHlwZSA9PT0gXCJ0b2tlblwiKSB7XHJcbiAgICAgIGF3YWl0IGNvbmZpcm1FbWFpbFdpdGhUb2tlbihcclxuICAgICAgICBjb25maXJtYXRpb25EYXRhLmRhdGEsXHJcbiAgICAgICAgY29uZmlybWF0aW9uRGF0YS50b2tlblR5cGVcclxuICAgICAgKTtcclxuICAgIH1cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkNvbmZpcm1hdGlvbiBlcnJvcjpcIiwgZXJyb3IpO1xyXG4gICAgc2hvd0Vycm9yKGBFcnJldXIgbG9ycyBkZSBsYSBjb25maXJtYXRpb246ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICB9IGZpbmFsbHkge1xyXG4gICAgLy8gUmVzZXQgbG9hZGluZyBzdGF0ZVxyXG4gICAgaWYgKGNvbmZpcm1CdG4pIGNvbmZpcm1CdG4uZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgIGlmIChjb25maXJtU3Bpbm5lcikgY29uZmlybVNwaW5uZXIuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcclxuXHJcbiAgICAvLyBSZXNldCBDQVBUQ0hBXHJcbiAgICBpZiAod2luZG93LnR1cm5zdGlsZSAmJiB0dXJuc3RpbGVXaWRnZXRJZCkge1xyXG4gICAgICB3aW5kb3cudHVybnN0aWxlLnJlc2V0KHR1cm5zdGlsZVdpZGdldElkKTtcclxuICAgIH1cclxuICAgIGNhcHRjaGFUb2tlbiA9IG51bGw7XHJcbiAgICBpZiAoY29uZmlybUJ0bikgY29uZmlybUJ0bi5kaXNhYmxlZCA9IHRydWU7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogQ29uZmlybXMgdGhlIGVtYWlsIGFkZHJlc3Mgd2l0aCB0b2tlbi1iYXNlZCBjb25maXJtYXRpb25cclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGNvbmZpcm1FbWFpbFdpdGhUb2tlbih0b2tlbiwgdG9rZW5UeXBlID0gXCJzaWdudXBcIikge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zb2xlLmxvZyhcIkF0dGVtcHRpbmcgdG9rZW4gY29uZmlybWF0aW9uIHdpdGggdHlwZTpcIiwgdG9rZW5UeXBlKTtcclxuXHJcbiAgICAvLyBGb3Igc2lnbnVwIGNvbmZpcm1hdGlvbnMsIHVzZSB2ZXJpZnlPdHAgd2l0aCB0aGUgdG9rZW5faGFzaFxyXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC52ZXJpZnlPdHAoe1xyXG4gICAgICB0b2tlbl9oYXNoOiB0b2tlbixcclxuICAgICAgdHlwZTogXCJlbWFpbFwiLCAvLyBVc2UgJ2VtYWlsJyB0eXBlIGZvciBlbWFpbCBjb25maXJtYXRpb25zXHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGR1cmluZyB2ZXJpZnlPdHA6XCIsIGVycm9yKTtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKFxyXG4gICAgICAgIFwiRXJyZXVyIGxvcnMgZGUgbGEgdsOpcmlmaWNhdGlvbiBkdSB0b2tlbjogXCIgKyBlcnJvci5tZXNzYWdlXHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGRhdGEudXNlciAmJiBkYXRhLnNlc3Npb24pIHtcclxuICAgICAgY29uc29sZS5sb2coXCJFbWFpbCBjb25maXJtZWQgc3VjY2Vzc2Z1bGx5OlwiLCBkYXRhLnVzZXIuZW1haWwpO1xyXG4gICAgICBzaG93U3VjY2Vzc0FuZFJlZGlyZWN0KFxyXG4gICAgICAgIFwiRW1haWwgdsOpcmlmacOpIGF2ZWMgc3VjY8OocyAhIFJlZGlyZWN0aW9uIHZlcnMgbGEgY29ubmV4aW9uLi4uXCJcclxuICAgICAgKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihcclxuICAgICAgICBcIkltcG9zc2libGUgZGUgY29uZmlybWVyIGwnZW1haWwuIExlIHRva2VuIGVzdCBwZXV0LcOqdHJlIGludmFsaWRlIG91IGEgZXhwaXLDqS5cIlxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZHVyaW5nIHRva2VuLWJhc2VkIGNvbmZpcm1hdGlvbjpcIiwgZXJyb3IpO1xyXG4gICAgdGhyb3cgZXJyb3I7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogQ29uZmlybXMgdGhlIGVtYWlsIGFkZHJlc3MgZGlyZWN0bHkgd2l0aCBTdXBhYmFzZSB1c2luZyB0aGUgY29uZmlybWF0aW9uIFVSTFxyXG4gKi9cclxuYXN5bmMgZnVuY3Rpb24gY29uZmlybUVtYWlsV2l0aFVybChjb25maXJtYXRpb25VcmxQYXJhbSkge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBkZWNvZGVkVXJsID0gZGVjb2RlVVJJQ29tcG9uZW50KGNvbmZpcm1hdGlvblVybFBhcmFtKTtcclxuICAgIGNvbnNvbGUubG9nKFwiQXR0ZW1wdGluZyBlbWFpbCBjb25maXJtYXRpb24gd2l0aCBVUkw6XCIsIGRlY29kZWRVcmwpO1xyXG5cclxuICAgIC8vIEV4dHJhY3QgdG9rZW4gZnJvbSB0aGUgY29uZmlybWF0aW9uIFVSTFxyXG4gICAgY29uc3QgdXJsID0gbmV3IFVSTChkZWNvZGVkVXJsKTtcclxuICAgIGNvbnN0IHRva2VuID0gdXJsLnNlYXJjaFBhcmFtcy5nZXQoXCJ0b2tlblwiKTtcclxuICAgIGNvbnN0IHR5cGUgPSB1cmwuc2VhcmNoUGFyYW1zLmdldChcInR5cGVcIik7XHJcblxyXG4gICAgaWYgKCF0b2tlbikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUb2tlbiBtYW5xdWFudCBkYW5zIGwnVVJMIGRlIGNvbmZpcm1hdGlvbi5cIik7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc29sZS5sb2coXHJcbiAgICAgIFwiRXh0cmFjdGVkIGZyb20gVVJMIC0gdG9rZW46XCIsXHJcbiAgICAgIHRva2VuLnN1YnN0cmluZygwLCAyMCkgKyBcIi4uLlwiLFxyXG4gICAgICBcInR5cGU6XCIsXHJcbiAgICAgIHR5cGVcclxuICAgICk7XHJcblxyXG4gICAgLy8gVXNlIHZlcmlmeU90cCB3aXRoIHRva2VuX2hhc2ggZm9yIGVtYWlsIGNvbmZpcm1hdGlvbnNcclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGgudmVyaWZ5T3RwKHtcclxuICAgICAgdG9rZW5faGFzaDogdG9rZW4sXHJcbiAgICAgIHR5cGU6IFwiZW1haWxcIiwgLy8gVXNlICdlbWFpbCcgdHlwZSBmb3IgZW1haWwgY29uZmlybWF0aW9ucyByZWdhcmRsZXNzIG9mIFVSTCB0eXBlXHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGR1cmluZyBVUkwtYmFzZWQgY29uZmlybWF0aW9uOlwiLCBlcnJvcik7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkVycmV1ciBsb3JzIGRlIGxhIGNvbmZpcm1hdGlvbjogXCIgKyBlcnJvci5tZXNzYWdlKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZGF0YS51c2VyICYmIGRhdGEuc2Vzc2lvbikge1xyXG4gICAgICBjb25zb2xlLmxvZyhcIkVtYWlsIGNvbmZpcm1lZCBzdWNjZXNzZnVsbHkgdmlhIFVSTDpcIiwgZGF0YS51c2VyLmVtYWlsKTtcclxuICAgICAgc2hvd1N1Y2Nlc3NBbmRSZWRpcmVjdChcclxuICAgICAgICBcIkVtYWlsIHbDqXJpZmnDqSBhdmVjIHN1Y2PDqHMgISBWb3VzIGFsbGV6IMOqdHJlIHJlZGlyaWfDqSB2ZXJzIGxhIHBhZ2UgZGUgY29ubmV4aW9uLlwiXHJcbiAgICAgICk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXHJcbiAgICAgICAgXCJJbXBvc3NpYmxlIGRlIGNvbmZpcm1lciBsJ2VtYWlsLiBMZSBsaWVuIGVzdCBwZXV0LcOqdHJlIGV4cGlyw6kgb3UgZMOpasOgIHV0aWxpc8OpLlwiXHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJDb25maXJtYXRpb24gcHJvY2Vzc2luZyBlcnJvcjpcIiwgZXJyb3IpO1xyXG4gICAgdGhyb3cgZXJyb3I7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogU2hvd3Mgc3VjY2VzcyBtZXNzYWdlIGFuZCByZWRpcmVjdHMgdG8gbG9naW5cclxuICovXHJcbmZ1bmN0aW9uIHNob3dTdWNjZXNzQW5kUmVkaXJlY3QobWVzc2FnZSkge1xyXG4gIGNvbnN0IGNvbmZpcm1hdGlvbkZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbmZpcm1hdGlvbkZvcm1cIik7XHJcbiAgY29uc3Qgc3VjY2Vzc01lc3NhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN1Y2Nlc3NNZXNzYWdlXCIpO1xyXG5cclxuICBpZiAoY29uZmlybWF0aW9uRm9ybSkgY29uZmlybWF0aW9uRm9ybS5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xyXG5cclxuICBpZiAoc3VjY2Vzc01lc3NhZ2UpIHtcclxuICAgIHN1Y2Nlc3NNZXNzYWdlLmlubmVySFRNTCA9IGBcclxuICAgICAgPGRpdiBjbGFzcz1cImNvbmZpcm1hdGlvbi1zdWNjZXNzXCI+XHJcbiAgICAgICAgPHNwYW4gY2xhc3M9XCJzdWNjZXNzLWljb25cIj7inIU8L3NwYW4+XHJcbiAgICAgICAgPGgzPkNvbmZpcm1hdGlvbiByw6l1c3NpZSAhPC9oMz5cclxuICAgICAgICA8cD5Wb3RyZSBjb21wdGUgYSDDqXTDqSBjb25maXJtw6kgYXZlYyBzdWNjw6hzLjwvcD5cclxuICAgICAgICA8cD5Wb3VzIGFsbGV6IMOqdHJlIHJlZGlyaWfDqSB2ZXJzIGxhIHBhZ2UgZGUgY29ubmV4aW9uIGRhbnMgcXVlbHF1ZXMgc2Vjb25kZXMuLi48L3A+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgYDtcclxuICAgIHN1Y2Nlc3NNZXNzYWdlLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XHJcbiAgfVxyXG5cclxuICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCIvYXV0aC9sb2dpblwiO1xyXG4gIH0sIDMwMDApO1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCB7XHJcbiAgaW5pdENvbmZpcm1hdGlvblBhZ2UsXHJcbn07XHJcbiIsIi8vIHNyYy9lbnRyaWVzL2NvbmZpcm1hdGlvbi5qc1xyXG4vKipcclxuICogQ29uZmlybWF0aW9uIEVudHJ5IFBvaW50XHJcbiAqXHJcbiAqIFRoaXMgbW9kdWxlIHNlcnZlcyBhcyB0aGUgZW50cnkgcG9pbnQgZm9yIHRoZSBlbWFpbCBjb25maXJtYXRpb24gcGFnZS5cclxuICovXHJcblxyXG4vLyBJbXBvcnQgb3VyIGNvbmZpcm1hdGlvbiBtb2R1bGVcclxuaW1wb3J0IHsgaW5pdENvbmZpcm1hdGlvblBhZ2UgfSBmcm9tIFwiLi4vYXV0aC9jb25maXJtYXRpb24uanNcIjtcclxuXHJcbi8vIEluaXRpYWxpemUgY29uZmlybWF0aW9uIHBhZ2Ugd2hlbiBET00gaXMgbG9hZGVkXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+IHtcclxuICAvLyBJbml0aWFsaXplIGNvbmZpcm1hdGlvbiBwYWdlXHJcbiAgaW5pdENvbmZpcm1hdGlvblBhZ2UoKTtcclxuXHJcbiAgY29uc29sZS5sb2coXCJDb25maXJtYXRpb24gcGFnZSBpbml0aWFsaXplZFwiKTtcclxufSk7XHJcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4vLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuX193ZWJwYWNrX3JlcXVpcmVfXy5tID0gX193ZWJwYWNrX21vZHVsZXNfXztcblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5mID0ge307XG4vLyBUaGlzIGZpbGUgY29udGFpbnMgb25seSB0aGUgZW50cnkgY2h1bmsuXG4vLyBUaGUgY2h1bmsgbG9hZGluZyBmdW5jdGlvbiBmb3IgYWRkaXRpb25hbCBjaHVua3Ncbl9fd2VicGFja19yZXF1aXJlX18uZSA9IChjaHVua0lkKSA9PiB7XG5cdHJldHVybiBQcm9taXNlLmFsbChPYmplY3Qua2V5cyhfX3dlYnBhY2tfcmVxdWlyZV9fLmYpLnJlZHVjZSgocHJvbWlzZXMsIGtleSkgPT4ge1xuXHRcdF9fd2VicGFja19yZXF1aXJlX18uZltrZXldKGNodW5rSWQsIHByb21pc2VzKTtcblx0XHRyZXR1cm4gcHJvbWlzZXM7XG5cdH0sIFtdKSk7XG59OyIsIi8vIFRoaXMgZnVuY3Rpb24gYWxsb3cgdG8gcmVmZXJlbmNlIGFzeW5jIGNodW5rc1xuX193ZWJwYWNrX3JlcXVpcmVfXy51ID0gKGNodW5rSWQpID0+IHtcblx0Ly8gcmV0dXJuIHVybCBmb3IgZmlsZW5hbWVzIGJhc2VkIG9uIHRlbXBsYXRlXG5cdHJldHVybiBcImpzL1wiICsgY2h1bmtJZCArIFwiLmNodW5rLmpzXCI7XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18uZyA9IChmdW5jdGlvbigpIHtcblx0aWYgKHR5cGVvZiBnbG9iYWxUaGlzID09PSAnb2JqZWN0JykgcmV0dXJuIGdsb2JhbFRoaXM7XG5cdHRyeSB7XG5cdFx0cmV0dXJuIHRoaXMgfHwgbmV3IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7XG5cdH0gY2F0Y2ggKGUpIHtcblx0XHRpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcpIHJldHVybiB3aW5kb3c7XG5cdH1cbn0pKCk7IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18uaiA9IDUwODsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIi9cIjsiLCIvLyBubyBiYXNlVVJJXG5cbi8vIG9iamVjdCB0byBzdG9yZSBsb2FkZWQgYW5kIGxvYWRpbmcgY2h1bmtzXG4vLyB1bmRlZmluZWQgPSBjaHVuayBub3QgbG9hZGVkLCBudWxsID0gY2h1bmsgcHJlbG9hZGVkL3ByZWZldGNoZWRcbi8vIFtyZXNvbHZlLCByZWplY3QsIFByb21pc2VdID0gY2h1bmsgbG9hZGluZywgMCA9IGNodW5rIGxvYWRlZFxudmFyIGluc3RhbGxlZENodW5rcyA9IHtcblx0NTA4OiAwXG59O1xuXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmYuaiA9IChjaHVua0lkLCBwcm9taXNlcykgPT4ge1xuXHRcdC8vIEpTT05QIGNodW5rIGxvYWRpbmcgZm9yIGphdmFzY3JpcHRcblx0XHR2YXIgaW5zdGFsbGVkQ2h1bmtEYXRhID0gX193ZWJwYWNrX3JlcXVpcmVfXy5vKGluc3RhbGxlZENodW5rcywgY2h1bmtJZCkgPyBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gOiB1bmRlZmluZWQ7XG5cdFx0aWYoaW5zdGFsbGVkQ2h1bmtEYXRhICE9PSAwKSB7IC8vIDAgbWVhbnMgXCJhbHJlYWR5IGluc3RhbGxlZFwiLlxuXG5cdFx0XHQvLyBhIFByb21pc2UgbWVhbnMgXCJjdXJyZW50bHkgbG9hZGluZ1wiLlxuXHRcdFx0aWYoaW5zdGFsbGVkQ2h1bmtEYXRhKSB7XG5cdFx0XHRcdHByb21pc2VzLnB1c2goaW5zdGFsbGVkQ2h1bmtEYXRhWzJdKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmKHRydWUpIHsgLy8gYWxsIGNodW5rcyBoYXZlIEpTXG5cdFx0XHRcdFx0Ly8gc2V0dXAgUHJvbWlzZSBpbiBjaHVuayBjYWNoZVxuXHRcdFx0XHRcdHZhciBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gKGluc3RhbGxlZENodW5rRGF0YSA9IGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA9IFtyZXNvbHZlLCByZWplY3RdKSk7XG5cdFx0XHRcdFx0cHJvbWlzZXMucHVzaChpbnN0YWxsZWRDaHVua0RhdGFbMl0gPSBwcm9taXNlKTtcblxuXHRcdFx0XHRcdC8vIHN0YXJ0IGNodW5rIGxvYWRpbmdcblx0XHRcdFx0XHR2YXIgdXJsID0gX193ZWJwYWNrX3JlcXVpcmVfXy5wICsgX193ZWJwYWNrX3JlcXVpcmVfXy51KGNodW5rSWQpO1xuXHRcdFx0XHRcdC8vIGNyZWF0ZSBlcnJvciBiZWZvcmUgc3RhY2sgdW53b3VuZCB0byBnZXQgdXNlZnVsIHN0YWNrdHJhY2UgbGF0ZXJcblx0XHRcdFx0XHR2YXIgZXJyb3IgPSBuZXcgRXJyb3IoKTtcblx0XHRcdFx0XHR2YXIgbG9hZGluZ0VuZGVkID0gKGV2ZW50KSA9PiB7XG5cdFx0XHRcdFx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oaW5zdGFsbGVkQ2h1bmtzLCBjaHVua0lkKSkge1xuXHRcdFx0XHRcdFx0XHRpbnN0YWxsZWRDaHVua0RhdGEgPSBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF07XG5cdFx0XHRcdFx0XHRcdGlmKGluc3RhbGxlZENodW5rRGF0YSAhPT0gMCkgaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdID0gdW5kZWZpbmVkO1xuXHRcdFx0XHRcdFx0XHRpZihpbnN0YWxsZWRDaHVua0RhdGEpIHtcblx0XHRcdFx0XHRcdFx0XHR2YXIgZXJyb3JUeXBlID0gZXZlbnQgJiYgKGV2ZW50LnR5cGUgPT09ICdsb2FkJyA/ICdtaXNzaW5nJyA6IGV2ZW50LnR5cGUpO1xuXHRcdFx0XHRcdFx0XHRcdHZhciByZWFsU3JjID0gZXZlbnQgJiYgZXZlbnQudGFyZ2V0ICYmIGV2ZW50LnRhcmdldC5zcmM7XG5cdFx0XHRcdFx0XHRcdFx0ZXJyb3IubWVzc2FnZSA9ICdMb2FkaW5nIGNodW5rICcgKyBjaHVua0lkICsgJyBmYWlsZWQuXFxuKCcgKyBlcnJvclR5cGUgKyAnOiAnICsgcmVhbFNyYyArICcpJztcblx0XHRcdFx0XHRcdFx0XHRlcnJvci5uYW1lID0gJ0NodW5rTG9hZEVycm9yJztcblx0XHRcdFx0XHRcdFx0XHRlcnJvci50eXBlID0gZXJyb3JUeXBlO1xuXHRcdFx0XHRcdFx0XHRcdGVycm9yLnJlcXVlc3QgPSByZWFsU3JjO1xuXHRcdFx0XHRcdFx0XHRcdGluc3RhbGxlZENodW5rRGF0YVsxXShlcnJvcik7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdF9fd2VicGFja19yZXF1aXJlX18ubCh1cmwsIGxvYWRpbmdFbmRlZCwgXCJjaHVuay1cIiArIGNodW5rSWQsIGNodW5rSWQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxufTtcblxuLy8gbm8gcHJlZmV0Y2hpbmdcblxuLy8gbm8gcHJlbG9hZGVkXG5cbi8vIG5vIEhNUlxuXG4vLyBubyBITVIgbWFuaWZlc3RcblxuX193ZWJwYWNrX3JlcXVpcmVfXy5PLmogPSAoY2h1bmtJZCkgPT4gKGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA9PT0gMCk7XG5cbi8vIGluc3RhbGwgYSBKU09OUCBjYWxsYmFjayBmb3IgY2h1bmsgbG9hZGluZ1xudmFyIHdlYnBhY2tKc29ucENhbGxiYWNrID0gKHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uLCBkYXRhKSA9PiB7XG5cdHZhciBbY2h1bmtJZHMsIG1vcmVNb2R1bGVzLCBydW50aW1lXSA9IGRhdGE7XG5cdC8vIGFkZCBcIm1vcmVNb2R1bGVzXCIgdG8gdGhlIG1vZHVsZXMgb2JqZWN0LFxuXHQvLyB0aGVuIGZsYWcgYWxsIFwiY2h1bmtJZHNcIiBhcyBsb2FkZWQgYW5kIGZpcmUgY2FsbGJhY2tcblx0dmFyIG1vZHVsZUlkLCBjaHVua0lkLCBpID0gMDtcblx0aWYoY2h1bmtJZHMuc29tZSgoaWQpID0+IChpbnN0YWxsZWRDaHVua3NbaWRdICE9PSAwKSkpIHtcblx0XHRmb3IobW9kdWxlSWQgaW4gbW9yZU1vZHVsZXMpIHtcblx0XHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhtb3JlTW9kdWxlcywgbW9kdWxlSWQpKSB7XG5cdFx0XHRcdF9fd2VicGFja19yZXF1aXJlX18ubVttb2R1bGVJZF0gPSBtb3JlTW9kdWxlc1ttb2R1bGVJZF07XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmKHJ1bnRpbWUpIHZhciByZXN1bHQgPSBydW50aW1lKF9fd2VicGFja19yZXF1aXJlX18pO1xuXHR9XG5cdGlmKHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uKSBwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbihkYXRhKTtcblx0Zm9yKDtpIDwgY2h1bmtJZHMubGVuZ3RoOyBpKyspIHtcblx0XHRjaHVua0lkID0gY2h1bmtJZHNbaV07XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGluc3RhbGxlZENodW5rcywgY2h1bmtJZCkgJiYgaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdKSB7XG5cdFx0XHRpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF1bMF0oKTtcblx0XHR9XG5cdFx0aW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdID0gMDtcblx0fVxuXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXy5PKHJlc3VsdCk7XG59XG5cbnZhciBjaHVua0xvYWRpbmdHbG9iYWwgPSBzZWxmW1wid2VicGFja0NodW5rdXJiYW5kb2NzX3dlYmFwcFwiXSA9IHNlbGZbXCJ3ZWJwYWNrQ2h1bmt1cmJhbmRvY3Nfd2ViYXBwXCJdIHx8IFtdO1xuY2h1bmtMb2FkaW5nR2xvYmFsLmZvckVhY2god2VicGFja0pzb25wQ2FsbGJhY2suYmluZChudWxsLCAwKSk7XG5jaHVua0xvYWRpbmdHbG9iYWwucHVzaCA9IHdlYnBhY2tKc29ucENhbGxiYWNrLmJpbmQobnVsbCwgY2h1bmtMb2FkaW5nR2xvYmFsLnB1c2guYmluZChjaHVua0xvYWRpbmdHbG9iYWwpKTsiLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGRlcGVuZHMgb24gb3RoZXIgbG9hZGVkIGNodW5rcyBhbmQgZXhlY3V0aW9uIG5lZWQgdG8gYmUgZGVsYXllZFxudmFyIF9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fLk8odW5kZWZpbmVkLCBbNzZdLCAoKSA9PiAoX193ZWJwYWNrX3JlcXVpcmVfXygxMDA4KSkpXG5fX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXy5PKF9fd2VicGFja19leHBvcnRzX18pO1xuIl0sIm5hbWVzIjpbImRlZmVycmVkIiwibGVhZlByb3RvdHlwZXMiLCJnZXRQcm90byIsImluUHJvZ3Jlc3MiLCJkYXRhV2VicGFja1ByZWZpeCIsImNvbmZpcm1hdGlvbkRhdGEiLCJjYXB0Y2hhVG9rZW4iLCJ0dXJuc3RpbGVXaWRnZXRJZCIsImFzeW5jIiwiaGFuZGxlQ29uZmlybWF0aW9uIiwiZSIsInByZXZlbnREZWZhdWx0IiwiY29uZmlybUJ0biIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJjb25maXJtU3Bpbm5lciIsImRpc2FibGVkIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwidHlwZSIsImNvbmZpcm1hdGlvblVybFBhcmFtIiwiZGVjb2RlZFVybCIsImRlY29kZVVSSUNvbXBvbmVudCIsImNvbnNvbGUiLCJsb2ciLCJ1cmwiLCJVUkwiLCJ0b2tlbiIsInNlYXJjaFBhcmFtcyIsImdldCIsIkVycm9yIiwic3Vic3RyaW5nIiwiZGF0YSIsImVycm9yIiwiYXV0aCIsInZlcmlmeU90cCIsInRva2VuX2hhc2giLCJtZXNzYWdlIiwidXNlciIsInNlc3Npb24iLCJlbWFpbCIsInNob3dTdWNjZXNzQW5kUmVkaXJlY3QiLCJjb25maXJtRW1haWxXaXRoVXJsIiwidG9rZW5UeXBlIiwiY29uZmlybUVtYWlsV2l0aFRva2VuIiwiYWRkIiwid2luZG93IiwidHVybnN0aWxlIiwicmVzZXQiLCJjb25maXJtYXRpb25Gb3JtIiwic3VjY2Vzc01lc3NhZ2UiLCJpbm5lckhUTUwiLCJzZXRUaW1lb3V0IiwibG9jYXRpb24iLCJocmVmIiwib25sb2FkVHVybnN0aWxlQ2FsbGJhY2siLCJ0dXJuc3RpbGVDb250YWluZXIiLCJyZW5kZXIiLCJzaXRla2V5IiwiY2FsbGJhY2siLCJlcnIiLCJ1bmRlZmluZWQiLCJhZGRFdmVudExpc3RlbmVyIiwidXJsUGFyYW1zIiwiVVJMU2VhcmNoUGFyYW1zIiwic2VhcmNoIiwidXJsSGFzaCIsImhhc2giLCJjb25maXJtYXRpb25Ub2tlbiIsImNvbmZpcm1hdGlvblVybCIsImhhc2hQYXJhbXMiLCJsb2FkaW5nIiwiY29uZmlybUZvcm0iLCJzaG93Q29uZmlybWF0aW9uRm9ybSIsImluaXRDb25maXJtYXRpb25QYWdlIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwiZXhwb3J0cyIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJjYWxsIiwibSIsIk8iLCJyZXN1bHQiLCJjaHVua0lkcyIsImZuIiwicHJpb3JpdHkiLCJub3RGdWxmaWxsZWQiLCJJbmZpbml0eSIsImkiLCJsZW5ndGgiLCJmdWxmaWxsZWQiLCJqIiwiT2JqZWN0Iiwia2V5cyIsImV2ZXJ5Iiwia2V5Iiwic3BsaWNlIiwiciIsImdldFByb3RvdHlwZU9mIiwib2JqIiwidCIsInZhbHVlIiwibW9kZSIsInRoaXMiLCJfX2VzTW9kdWxlIiwidGhlbiIsIm5zIiwiY3JlYXRlIiwiZGVmIiwiY3VycmVudCIsImluZGV4T2YiLCJnZXRPd25Qcm9wZXJ0eU5hbWVzIiwiZm9yRWFjaCIsImQiLCJkZWZpbml0aW9uIiwibyIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImYiLCJjaHVua0lkIiwiUHJvbWlzZSIsImFsbCIsInJlZHVjZSIsInByb21pc2VzIiwidSIsImciLCJnbG9iYWxUaGlzIiwiRnVuY3Rpb24iLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJsIiwiZG9uZSIsInB1c2giLCJzY3JpcHQiLCJuZWVkQXR0YWNoIiwic2NyaXB0cyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwicyIsImdldEF0dHJpYnV0ZSIsImNyZWF0ZUVsZW1lbnQiLCJjaGFyc2V0IiwidGltZW91dCIsIm5jIiwic2V0QXR0cmlidXRlIiwic3JjIiwib25TY3JpcHRDb21wbGV0ZSIsInByZXYiLCJldmVudCIsIm9uZXJyb3IiLCJvbmxvYWQiLCJjbGVhclRpbWVvdXQiLCJkb25lRm5zIiwicGFyZW50Tm9kZSIsInJlbW92ZUNoaWxkIiwiYmluZCIsInRhcmdldCIsImhlYWQiLCJhcHBlbmRDaGlsZCIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwicCIsImluc3RhbGxlZENodW5rcyIsImluc3RhbGxlZENodW5rRGF0YSIsInByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZXJyb3JUeXBlIiwicmVhbFNyYyIsIm5hbWUiLCJyZXF1ZXN0Iiwid2VicGFja0pzb25wQ2FsbGJhY2siLCJwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbiIsIm1vcmVNb2R1bGVzIiwicnVudGltZSIsInNvbWUiLCJpZCIsImNodW5rTG9hZGluZ0dsb2JhbCIsInNlbGYiLCJfX3dlYnBhY2tfZXhwb3J0c19fIl0sInNvdXJjZVJvb3QiOiIifQ==