(()=>{"use strict";var e,t,n,r,o,i={1008:(e,t,n)=>{var r=n(3715),o=n(9660);let i=null,a=null,s=null;async function l(e){if(e.preventDefault(),!a)return void(0,r.Qg)("Veuillez compléter le CAPTCHA avant de confirmer.");if(!i)return void(0,r.Qg)("Données de confirmation manquantes.");const t=document.getElementById("confirmBtn"),n=document.getElementById("confirmSpinner");t&&(t.disabled=!0),n&&n.classList.remove("hidden");try{"url"===i.type?await async function(e){try{const t=decodeURIComponent(e);console.log("Attempting email confirmation with URL:",t);const n=new URL(t),r=n.searchParams.get("token"),i=n.searchParams.get("type");if(!r)throw new Error("Token manquant dans l'URL de confirmation.");console.log("Extracted from URL - token:",r.substring(0,20)+"...","type:",i);const{data:a,error:s}=await o.N.auth.verifyOtp({token_hash:r,type:"email"});if(s)throw console.error("Error during URL-based confirmation:",s),new Error("Erreur lors de la confirmation: "+s.message);if(!a.user||!a.session)throw new Error("Impossible de confirmer l'email. Le lien est peut-être expiré ou déjà utilisé.");console.log("Email confirmed successfully via URL:",a.user.email),c()}catch(e){throw console.error("Confirmation processing error:",e),e}}(i.data):"token"===i.type&&await async function(e,t="signup"){try{console.log("Attempting token confirmation with type:",t);const{data:n,error:r}=await o.N.auth.verifyOtp({token_hash:e,type:"email"});if(r)throw console.error("Error during verifyOtp:",r),new Error("Erreur lors de la vérification du token: "+r.message);if(!n.user||!n.session)throw new Error("Impossible de confirmer l'email. Le token est peut-être invalide ou a expiré.");console.log("Email confirmed successfully:",n.user.email),c()}catch(e){throw console.error("Error during token-based confirmation:",e),e}}(i.data,i.tokenType)}catch(e){console.error("Confirmation error:",e),(0,r.Qg)(`Erreur lors de la confirmation: ${e.message}`)}finally{t&&(t.disabled=!1),n&&n.classList.add("hidden"),window.turnstile&&s&&window.turnstile.reset(s),a=null,t&&(t.disabled=!0)}}function c(e){const t=document.getElementById("confirmationForm"),n=document.getElementById("successMessage");t&&t.classList.add("hidden"),n&&(n.innerHTML='\n      <div class="confirmation-success">\n        <span class="success-icon">✅</span>\n        <h3>Confirmation réussie !</h3>\n        <p>Votre compte a été confirmé avec succès.</p>\n        <p>Vous allez être redirigé vers la page de connexion dans quelques secondes...</p>\n      </div>\n    ',n.classList.remove("hidden")),setTimeout((()=>{window.location.href="/auth/login"}),3e3)}window.onloadTurnstileCallback=function(){console.log("Turnstile API ready for confirmation page.");const e=document.getElementById("turnstile-container");if(e&&window.turnstile&&!s){console.log("Rendering Turnstile widget for confirmation...");try{s=window.turnstile.render(e,{sitekey:"0x4AAAAAABdzY3InOU2_In99",callback:function(e){a=e,console.log("Turnstile token obtained for confirmation:",e);const t=document.getElementById("confirmBtn");t&&(t.disabled=!1)},"expired-callback":()=>{console.log("Turnstile token expired on confirmation page."),window.turnstile&&s&&window.turnstile.reset(s),a=null;const e=document.getElementById("confirmBtn");e&&(e.disabled=!0)},"error-callback":e=>{a=null,console.error("Turnstile error on confirmation page:",e),(0,r.Qg)(`Erreur CAPTCHA: ${e}. Veuillez réessayer.`);const t=document.getElementById("confirmBtn");t&&(t.disabled=!0)}}),void 0===s?(console.error("Turnstile.render did not return a widgetId for confirmation."),(0,r.Qg)("Erreur initialisation CAPTCHA.")):console.log("Turnstile widget rendered for confirmation. ID:",s)}catch(e){console.error("Error rendering Turnstile on confirmation page:",e),(0,r.Qg)("Impossible d'afficher le CAPTCHA.")}}},document.addEventListener("DOMContentLoaded",(()=>{(function(){const e=new URLSearchParams(window.location.search),t=window.location.hash;let n=e.get("token");const o=e.get("type");let a=e.get("confirmation_url");if(t){const e=new URLSearchParams(t.substring(1));n||(n=e.get("access_token")||e.get("token"))}console.log("Confirmation page initialized with:",{confirmationToken:n?"present":"missing",type:o,confirmationUrl:a?"present":"missing",urlHash:t||"none"}),document.getElementById("statusMessage"),document.getElementById("errorMessage");const s=document.getElementById("loading"),c=document.getElementById("confirmationForm"),d=document.getElementById("confirmForm");if(s&&s.classList.remove("hidden"),a)i={type:"url",data:a},u();else{if(!n||"signup"!==o&&"email_change"!==o)return s&&s.classList.add("hidden"),void(0,r.Qg)("Erreur: URL ou jeton de confirmation manquant ou invalide.");i={type:"token",data:n,tokenType:o},u()}function u(){s&&s.classList.add("hidden"),c&&c.classList.remove("hidden"),(0,r.wc)("Lien de confirmation valide. Veuillez compléter le CAPTCHA et confirmer.","info")}d&&d.addEventListener("submit",l)})(),console.log("Confirmation page initialized")}))}},a={};function s(e){var t=a[e];if(void 0!==t)return t.exports;var n=a[e]={exports:{}};return i[e].call(n.exports,n,n.exports,s),n.exports}s.m=i,e=[],s.O=(t,n,r,o)=>{if(!n){var i=1/0;for(d=0;d<e.length;d++){for(var[n,r,o]=e[d],a=!0,l=0;l<n.length;l++)(!1&o||i>=o)&&Object.keys(s.O).every((e=>s.O[e](n[l])))?n.splice(l--,1):(a=!1,o<i&&(i=o));if(a){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[n,r,o]},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,s.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var o=Object.create(null);s.r(o);var i={};t=t||[null,n({}),n([]),n(n)];for(var a=2&r&&e;"object"==typeof a&&!~t.indexOf(a);a=n(a))Object.getOwnPropertyNames(a).forEach((t=>i[t]=()=>e[t]));return i.default=()=>e,s.d(o,i),o},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,n)=>(s.f[n](e,t),t)),[])),s.u=e=>"js/"+e+".bundle.js",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r={},o="urbandocs_webapp:",s.l=(e,t,n,i)=>{if(r[e])r[e].push(t);else{var a,l;if(void 0!==n)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==o+n){a=u;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,s.nc&&a.setAttribute("nonce",s.nc),a.setAttribute("data-webpack",o+n),a.src=e),r[e]=[t];var m=(t,n)=>{a.onerror=a.onload=null,clearTimeout(f);var o=r[e];if(delete r[e],a.parentNode&&a.parentNode.removeChild(a),o&&o.forEach((e=>e(n))),t)return t(n)},f=setTimeout(m.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=m.bind(null,a.onerror),a.onload=m.bind(null,a.onload),l&&document.head.appendChild(a)}},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.j=508,(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=n[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e+"../"})(),(()=>{var e={508:0};s.f.j=(t,n)=>{var r=s.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var o=new Promise(((n,o)=>r=e[t]=[n,o]));n.push(r[2]=o);var i=s.p+s.u(t),a=new Error;s.l(i,(n=>{if(s.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+o+": "+i+")",a.name="ChunkLoadError",a.type=o,a.request=i,r[1](a)}}),"chunk-"+t,t)}},s.O.j=t=>0===e[t];var t=(t,n)=>{var r,o,[i,a,l]=n,c=0;if(i.some((t=>0!==e[t]))){for(r in a)s.o(a,r)&&(s.m[r]=a[r]);if(l)var d=l(s)}for(t&&t(n);c<i.length;c++)o=i[c],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(d)},n=self.webpackChunkurbandocs_webapp=self.webpackChunkurbandocs_webapp||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var l=s.O(void 0,[76],(()=>s(1008)));l=s.O(l)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUUvRCxHQVlIOUMsRUFBb0JRLEVBQUVVLEVBQUs0QixHQUEwQyxJQUE3QmtELEVBQWdCbEQsR0FHeEQsSUFBSTJELEVBQXVCLENBQUNDLEVBQTRCdEosS0FDdkQsSUFHSTZDLEVBQVU2QyxHQUhUcEMsRUFBVWlHLEVBQWFDLEdBQVd4SixFQUdoQjJELEVBQUksRUFDM0IsR0FBR0wsRUFBU21HLE1BQU1DLEdBQWdDLElBQXhCZCxFQUFnQmMsS0FBYSxDQUN0RCxJQUFJN0csS0FBWTBHLEVBQ1ozRyxFQUFvQjBDLEVBQUVpRSxFQUFhMUcsS0FDckNELEVBQW9CTyxFQUFFTixHQUFZMEcsRUFBWTFHLElBR2hELEdBQUcyRyxFQUFTLElBQUluRyxFQUFTbUcsRUFBUTVHLEVBQ2xDLENBRUEsSUFERzBHLEdBQTRCQSxFQUEyQnRKLEdBQ3JEMkQsRUFBSUwsRUFBU00sT0FBUUQsSUFDekIrQixFQUFVcEMsRUFBU0ssR0FDaEJmLEVBQW9CMEMsRUFBRXNELEVBQWlCbEQsSUFBWWtELEVBQWdCbEQsSUFDckVrRCxFQUFnQmxELEdBQVMsS0FFMUJrRCxFQUFnQmxELEdBQVcsRUFFNUIsT0FBTzlDLEVBQW9CUSxFQUFFQyxJQUcxQnNHLEVBQXFCQyxLQUFtQyw2QkFBSUEsS0FBbUMsOEJBQUssR0FDeEdELEVBQW1CeEUsUUFBUWtFLEVBQXFCdkIsS0FBSyxLQUFNLElBQzNENkIsRUFBbUJuRCxLQUFPNkMsRUFBcUJ2QixLQUFLLEtBQU02QixFQUFtQm5ELEtBQUtzQixLQUFLNkIsRyxLQ2xGdkYsSUFBSUUsRUFBc0JqSCxFQUFvQlEsT0FBRXZCLEVBQVcsQ0FBQyxLQUFLLElBQU9lLEVBQW9CLFFBQzVGaUgsRUFBc0JqSCxFQUFvQlEsRUFBRXlHLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9jaHVuayBsb2FkZWQiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvY3JlYXRlIGZha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9sb2FkIHNjcmlwdCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwLy4vc3JjL2pzL2F1dGgvY29uZmlybWF0aW9uLmpzIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvLi9zcmMvanMvZW50cmllcy9jb25maXJtYXRpb24uanMiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9lbnN1cmUgY2h1bmsiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvZ2V0IGphdmFzY3JpcHQgY2h1bmsgZmlsZW5hbWUiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvZ2xvYmFsIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvcnVudGltZUlkIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL3B1YmxpY1BhdGgiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvanNvbnAgY2h1bmsgbG9hZGluZyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZGVmZXJyZWQgPSBbXTtcbl9fd2VicGFja19yZXF1aXJlX18uTyA9IChyZXN1bHQsIGNodW5rSWRzLCBmbiwgcHJpb3JpdHkpID0+IHtcblx0aWYoY2h1bmtJZHMpIHtcblx0XHRwcmlvcml0eSA9IHByaW9yaXR5IHx8IDA7XG5cdFx0Zm9yKHZhciBpID0gZGVmZXJyZWQubGVuZ3RoOyBpID4gMCAmJiBkZWZlcnJlZFtpIC0gMV1bMl0gPiBwcmlvcml0eTsgaS0tKSBkZWZlcnJlZFtpXSA9IGRlZmVycmVkW2kgLSAxXTtcblx0XHRkZWZlcnJlZFtpXSA9IFtjaHVua0lkcywgZm4sIHByaW9yaXR5XTtcblx0XHRyZXR1cm47XG5cdH1cblx0dmFyIG5vdEZ1bGZpbGxlZCA9IEluZmluaXR5O1xuXHRmb3IgKHZhciBpID0gMDsgaSA8IGRlZmVycmVkLmxlbmd0aDsgaSsrKSB7XG5cdFx0dmFyIFtjaHVua0lkcywgZm4sIHByaW9yaXR5XSA9IGRlZmVycmVkW2ldO1xuXHRcdHZhciBmdWxmaWxsZWQgPSB0cnVlO1xuXHRcdGZvciAodmFyIGogPSAwOyBqIDwgY2h1bmtJZHMubGVuZ3RoOyBqKyspIHtcblx0XHRcdGlmICgocHJpb3JpdHkgJiAxID09PSAwIHx8IG5vdEZ1bGZpbGxlZCA+PSBwcmlvcml0eSkgJiYgT2JqZWN0LmtleXMoX193ZWJwYWNrX3JlcXVpcmVfXy5PKS5ldmVyeSgoa2V5KSA9PiAoX193ZWJwYWNrX3JlcXVpcmVfXy5PW2tleV0oY2h1bmtJZHNbal0pKSkpIHtcblx0XHRcdFx0Y2h1bmtJZHMuc3BsaWNlKGotLSwgMSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRmdWxmaWxsZWQgPSBmYWxzZTtcblx0XHRcdFx0aWYocHJpb3JpdHkgPCBub3RGdWxmaWxsZWQpIG5vdEZ1bGZpbGxlZCA9IHByaW9yaXR5O1xuXHRcdFx0fVxuXHRcdH1cblx0XHRpZihmdWxmaWxsZWQpIHtcblx0XHRcdGRlZmVycmVkLnNwbGljZShpLS0sIDEpXG5cdFx0XHR2YXIgciA9IGZuKCk7XG5cdFx0XHRpZiAociAhPT0gdW5kZWZpbmVkKSByZXN1bHQgPSByO1xuXHRcdH1cblx0fVxuXHRyZXR1cm4gcmVzdWx0O1xufTsiLCJ2YXIgZ2V0UHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YgPyAob2JqKSA9PiAoT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iaikpIDogKG9iaikgPT4gKG9iai5fX3Byb3RvX18pO1xudmFyIGxlYWZQcm90b3R5cGVzO1xuLy8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4vLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbi8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuLy8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4vLyBtb2RlICYgMTY6IHJldHVybiB2YWx1ZSB3aGVuIGl0J3MgUHJvbWlzZS1saWtlXG4vLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuXHRpZihtb2RlICYgMSkgdmFsdWUgPSB0aGlzKHZhbHVlKTtcblx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcblx0aWYodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSkge1xuXHRcdGlmKChtb2RlICYgNCkgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuXHRcdGlmKChtb2RlICYgMTYpICYmIHR5cGVvZiB2YWx1ZS50aGVuID09PSAnZnVuY3Rpb24nKSByZXR1cm4gdmFsdWU7XG5cdH1cblx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcblx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcblx0dmFyIGRlZiA9IHt9O1xuXHRsZWFmUHJvdG90eXBlcyA9IGxlYWZQcm90b3R5cGVzIHx8IFtudWxsLCBnZXRQcm90byh7fSksIGdldFByb3RvKFtdKSwgZ2V0UHJvdG8oZ2V0UHJvdG8pXTtcblx0Zm9yKHZhciBjdXJyZW50ID0gbW9kZSAmIDIgJiYgdmFsdWU7IHR5cGVvZiBjdXJyZW50ID09ICdvYmplY3QnICYmICF+bGVhZlByb3RvdHlwZXMuaW5kZXhPZihjdXJyZW50KTsgY3VycmVudCA9IGdldFByb3RvKGN1cnJlbnQpKSB7XG5cdFx0T2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoY3VycmVudCkuZm9yRWFjaCgoa2V5KSA9PiAoZGVmW2tleV0gPSAoKSA9PiAodmFsdWVba2V5XSkpKTtcblx0fVxuXHRkZWZbJ2RlZmF1bHQnXSA9ICgpID0+ICh2YWx1ZSk7XG5cdF9fd2VicGFja19yZXF1aXJlX18uZChucywgZGVmKTtcblx0cmV0dXJuIG5zO1xufTsiLCJ2YXIgaW5Qcm9ncmVzcyA9IHt9O1xudmFyIGRhdGFXZWJwYWNrUHJlZml4ID0gXCJ1cmJhbmRvY3Nfd2ViYXBwOlwiO1xuLy8gbG9hZFNjcmlwdCBmdW5jdGlvbiB0byBsb2FkIGEgc2NyaXB0IHZpYSBzY3JpcHQgdGFnXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmwgPSAodXJsLCBkb25lLCBrZXksIGNodW5rSWQpID0+IHtcblx0aWYoaW5Qcm9ncmVzc1t1cmxdKSB7IGluUHJvZ3Jlc3NbdXJsXS5wdXNoKGRvbmUpOyByZXR1cm47IH1cblx0dmFyIHNjcmlwdCwgbmVlZEF0dGFjaDtcblx0aWYoa2V5ICE9PSB1bmRlZmluZWQpIHtcblx0XHR2YXIgc2NyaXB0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpO1xuXHRcdGZvcih2YXIgaSA9IDA7IGkgPCBzY3JpcHRzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHR2YXIgcyA9IHNjcmlwdHNbaV07XG5cdFx0XHRpZihzLmdldEF0dHJpYnV0ZShcInNyY1wiKSA9PSB1cmwgfHwgcy5nZXRBdHRyaWJ1dGUoXCJkYXRhLXdlYnBhY2tcIikgPT0gZGF0YVdlYnBhY2tQcmVmaXggKyBrZXkpIHsgc2NyaXB0ID0gczsgYnJlYWs7IH1cblx0XHR9XG5cdH1cblx0aWYoIXNjcmlwdCkge1xuXHRcdG5lZWRBdHRhY2ggPSB0cnVlO1xuXHRcdHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuXG5cdFx0c2NyaXB0LmNoYXJzZXQgPSAndXRmLTgnO1xuXHRcdHNjcmlwdC50aW1lb3V0ID0gMTIwO1xuXHRcdGlmIChfX3dlYnBhY2tfcmVxdWlyZV9fLm5jKSB7XG5cdFx0XHRzY3JpcHQuc2V0QXR0cmlidXRlKFwibm9uY2VcIiwgX193ZWJwYWNrX3JlcXVpcmVfXy5uYyk7XG5cdFx0fVxuXHRcdHNjcmlwdC5zZXRBdHRyaWJ1dGUoXCJkYXRhLXdlYnBhY2tcIiwgZGF0YVdlYnBhY2tQcmVmaXggKyBrZXkpO1xuXG5cdFx0c2NyaXB0LnNyYyA9IHVybDtcblx0fVxuXHRpblByb2dyZXNzW3VybF0gPSBbZG9uZV07XG5cdHZhciBvblNjcmlwdENvbXBsZXRlID0gKHByZXYsIGV2ZW50KSA9PiB7XG5cdFx0Ly8gYXZvaWQgbWVtIGxlYWtzIGluIElFLlxuXHRcdHNjcmlwdC5vbmVycm9yID0gc2NyaXB0Lm9ubG9hZCA9IG51bGw7XG5cdFx0Y2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuXHRcdHZhciBkb25lRm5zID0gaW5Qcm9ncmVzc1t1cmxdO1xuXHRcdGRlbGV0ZSBpblByb2dyZXNzW3VybF07XG5cdFx0c2NyaXB0LnBhcmVudE5vZGUgJiYgc2NyaXB0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoc2NyaXB0KTtcblx0XHRkb25lRm5zICYmIGRvbmVGbnMuZm9yRWFjaCgoZm4pID0+IChmbihldmVudCkpKTtcblx0XHRpZihwcmV2KSByZXR1cm4gcHJldihldmVudCk7XG5cdH1cblx0dmFyIHRpbWVvdXQgPSBzZXRUaW1lb3V0KG9uU2NyaXB0Q29tcGxldGUuYmluZChudWxsLCB1bmRlZmluZWQsIHsgdHlwZTogJ3RpbWVvdXQnLCB0YXJnZXQ6IHNjcmlwdCB9KSwgMTIwMDAwKTtcblx0c2NyaXB0Lm9uZXJyb3IgPSBvblNjcmlwdENvbXBsZXRlLmJpbmQobnVsbCwgc2NyaXB0Lm9uZXJyb3IpO1xuXHRzY3JpcHQub25sb2FkID0gb25TY3JpcHRDb21wbGV0ZS5iaW5kKG51bGwsIHNjcmlwdC5vbmxvYWQpO1xuXHRuZWVkQXR0YWNoICYmIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTtcbn07IiwiLy8gc3JjL2F1dGgvY29uZmlybWF0aW9uLmpzXG4vKipcbiAqIENvbmZpcm1hdGlvbiBNb2R1bGVcbiAqIEBtb2R1bGUgY29uZmlybWF0aW9uXG4gKiBAZGVzY3JpcHRpb24gSGFuZGxlcyBlbWFpbCBjb25maXJtYXRpb24gd2l0aCBtYW51YWwgY29uZmlybWF0aW9uIGJ1dHRvbiBhbmQgQ0FQVENIQSB2ZXJpZmljYXRpb24uXG4gKiBAdmVyc2lvbiAwLjMuMFxuICpcbiAqIEBjaGFuZ2Vsb2dcbiAqIC0gMC4zLjAgKDIwMjUtMDEtWFgpOiBBZGRlZCBtYW51YWwgY29uZmlybWF0aW9uIHdpdGggQ0FQVENIQSByZXF1aXJlbWVudC5cbiAqIC0gMC4yLjAgKDIwMjUtMDUtMzEpOiBTaW1wbGlmaWVkIHBhZ2UgdG8gYXV0by1jb25maXJtIGFuZCByZWRpcmVjdC4gUmVtb3ZlZCBUb1MgYWdyZWVtZW50IGZyb20gdGhpcyBwYWdlLlxuICogLSAwLjEuMSAoMjAyNS0wNS0xNyk6IENvcnJlY3RlZCBzdWNjZXNzIG1lc3NhZ2UgYW5kIHJlZGlyZWN0IHRvIGxvZ2luIHBhZ2UuXG4gKiAtIDAuMS4wICgyMDI1LTA1LTE1KTogQ29udmVydGVkIHRvIHVzZSBkaXJlY3QgU3VwYWJhc2UgQVBJIGNhbGxzIGluc3RlYWQgb2YgRmlyZWJhc2UgQ2xvdWQgRnVuY3Rpb25zLlxuICogLSAwLjAuMyAoMjAyNS0wNS0xMik6IFVwZGF0ZWQgdGVybXMgb2Ygc2VydmljZSBtb2RhbCBhbmQgY29uZmlybWF0aW9uIGVtYWlsLlxuICogLSAwLjAuMiAoMjAyNS0wNS0xMCk6IEFkZGVkIHRlcm1zIG9mIHNlcnZpY2UgYW5kIGNvbmZpcm1hdGlvbiBlbWFpbC5cbiAqIC0gMC4wLjEgKDIwMjUtMDUtMDgpOiBDcmVhdGVkIHRoZSBjb25maXJtYXRpb24gbW9kdWxlIHdpdGggYmFzaWMgZnVuY3Rpb25hbGl0eS5cbiAqL1xuXG5pbXBvcnQgeyBzaG93U3RhdHVzLCBzaG93RXJyb3IsIHNob3dMb2FkaW5nLCBoaWRlTG9hZGluZyB9IGZyb20gXCIuL2F1dGguanNcIjtcbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSBcIi4uL3N1cGFiYXNlLWNsaWVudC5qc1wiO1xuXG4vLyBTdG9yZSBjb25maXJtYXRpb24gZGF0YSBhbmQgY2FwdGNoYSB0b2tlblxubGV0IGNvbmZpcm1hdGlvbkRhdGEgPSBudWxsO1xubGV0IGNhcHRjaGFUb2tlbiA9IG51bGw7XG5sZXQgdHVybnN0aWxlV2lkZ2V0SWQgPSBudWxsO1xuXG4vLyBUdXJuc3RpbGUgY2FsbGJhY2sgZnVuY3Rpb25cbndpbmRvdy5vbmxvYWRUdXJuc3RpbGVDYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtcbiAgY29uc29sZS5sb2coXCJUdXJuc3RpbGUgQVBJIHJlYWR5IGZvciBjb25maXJtYXRpb24gcGFnZS5cIik7XG4gIGNvbnN0IHR1cm5zdGlsZUNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidHVybnN0aWxlLWNvbnRhaW5lclwiKTtcblxuICBpZiAodHVybnN0aWxlQ29udGFpbmVyICYmIHdpbmRvdy50dXJuc3RpbGUgJiYgIXR1cm5zdGlsZVdpZGdldElkKSB7XG4gICAgY29uc29sZS5sb2coXCJSZW5kZXJpbmcgVHVybnN0aWxlIHdpZGdldCBmb3IgY29uZmlybWF0aW9uLi4uXCIpO1xuICAgIHRyeSB7XG4gICAgICB0dXJuc3RpbGVXaWRnZXRJZCA9IHdpbmRvdy50dXJuc3RpbGUucmVuZGVyKHR1cm5zdGlsZUNvbnRhaW5lciwge1xuICAgICAgICBzaXRla2V5OiBcIjB4NEFBQUFBQUJkelkzSW5PVTJfSW45OVwiLFxuICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24gKHRva2VuKSB7XG4gICAgICAgICAgY2FwdGNoYVRva2VuID0gdG9rZW47XG4gICAgICAgICAgY29uc29sZS5sb2coXCJUdXJuc3RpbGUgdG9rZW4gb2J0YWluZWQgZm9yIGNvbmZpcm1hdGlvbjpcIiwgdG9rZW4pO1xuXG4gICAgICAgICAgLy8gRW5hYmxlIGNvbmZpcm0gYnV0dG9uIHdoZW4gQ0FQVENIQSBpcyBzb2x2ZWRcbiAgICAgICAgICBjb25zdCBjb25maXJtQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjb25maXJtQnRuXCIpO1xuICAgICAgICAgIGlmIChjb25maXJtQnRuKSB7XG4gICAgICAgICAgICBjb25maXJtQnRuLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcImV4cGlyZWQtY2FsbGJhY2tcIjogKCkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiVHVybnN0aWxlIHRva2VuIGV4cGlyZWQgb24gY29uZmlybWF0aW9uIHBhZ2UuXCIpO1xuICAgICAgICAgIGlmICh3aW5kb3cudHVybnN0aWxlICYmIHR1cm5zdGlsZVdpZGdldElkKSB7XG4gICAgICAgICAgICB3aW5kb3cudHVybnN0aWxlLnJlc2V0KHR1cm5zdGlsZVdpZGdldElkKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY2FwdGNoYVRva2VuID0gbnVsbDtcblxuICAgICAgICAgIC8vIERpc2FibGUgY29uZmlybSBidXR0b24gd2hlbiBDQVBUQ0hBIGV4cGlyZXNcbiAgICAgICAgICBjb25zdCBjb25maXJtQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjb25maXJtQnRuXCIpO1xuICAgICAgICAgIGlmIChjb25maXJtQnRuKSB7XG4gICAgICAgICAgICBjb25maXJtQnRuLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIFwiZXJyb3ItY2FsbGJhY2tcIjogKGVycikgPT4ge1xuICAgICAgICAgIGNhcHRjaGFUb2tlbiA9IG51bGw7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIlR1cm5zdGlsZSBlcnJvciBvbiBjb25maXJtYXRpb24gcGFnZTpcIiwgZXJyKTtcbiAgICAgICAgICBzaG93RXJyb3IoYEVycmV1ciBDQVBUQ0hBOiAke2Vycn0uIFZldWlsbGV6IHLDqWVzc2F5ZXIuYCk7XG5cbiAgICAgICAgICAvLyBEaXNhYmxlIGNvbmZpcm0gYnV0dG9uIG9uIENBUFRDSEEgZXJyb3JcbiAgICAgICAgICBjb25zdCBjb25maXJtQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjb25maXJtQnRuXCIpO1xuICAgICAgICAgIGlmIChjb25maXJtQnRuKSB7XG4gICAgICAgICAgICBjb25maXJtQnRuLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICB9KTtcblxuICAgICAgaWYgKHR1cm5zdGlsZVdpZGdldElkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcbiAgICAgICAgICBcIlR1cm5zdGlsZS5yZW5kZXIgZGlkIG5vdCByZXR1cm4gYSB3aWRnZXRJZCBmb3IgY29uZmlybWF0aW9uLlwiXG4gICAgICAgICk7XG4gICAgICAgIHNob3dFcnJvcihcIkVycmV1ciBpbml0aWFsaXNhdGlvbiBDQVBUQ0hBLlwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgIFwiVHVybnN0aWxlIHdpZGdldCByZW5kZXJlZCBmb3IgY29uZmlybWF0aW9uLiBJRDpcIixcbiAgICAgICAgICB0dXJuc3RpbGVXaWRnZXRJZFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciByZW5kZXJpbmcgVHVybnN0aWxlIG9uIGNvbmZpcm1hdGlvbiBwYWdlOlwiLCBlKTtcbiAgICAgIHNob3dFcnJvcihcIkltcG9zc2libGUgZCdhZmZpY2hlciBsZSBDQVBUQ0hBLlwiKTtcbiAgICB9XG4gIH1cbn07XG5cbi8qKlxuICogSW5pdGlhbGl6ZXMgdGhlIGVtYWlsIGNvbmZpcm1hdGlvbiBwYWdlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbml0Q29uZmlybWF0aW9uUGFnZSgpIHtcbiAgY29uc3QgdXJsUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKTtcbiAgY29uc3QgdXJsSGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoO1xuXG4gIC8vIENoZWNrIGZvciBkaWZmZXJlbnQgdHlwZXMgb2YgY29uZmlybWF0aW9uIGRhdGFcbiAgbGV0IGNvbmZpcm1hdGlvblRva2VuID0gdXJsUGFyYW1zLmdldChcInRva2VuXCIpO1xuICBjb25zdCB0eXBlID0gdXJsUGFyYW1zLmdldChcInR5cGVcIik7XG4gIGxldCBjb25maXJtYXRpb25VcmwgPSB1cmxQYXJhbXMuZ2V0KFwiY29uZmlybWF0aW9uX3VybFwiKTtcblxuICAvLyBBbHNvIGNoZWNrIFVSTCBoYXNoIGZvciB0b2tlbnMgKFN1cGFiYXNlIHNvbWV0aW1lcyBwdXRzIHRva2VucyBpbiBoYXNoKVxuICBpZiAodXJsSGFzaCkge1xuICAgIGNvbnN0IGhhc2hQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHVybEhhc2guc3Vic3RyaW5nKDEpKTtcbiAgICBpZiAoIWNvbmZpcm1hdGlvblRva2VuKSB7XG4gICAgICBjb25maXJtYXRpb25Ub2tlbiA9XG4gICAgICAgIGhhc2hQYXJhbXMuZ2V0KFwiYWNjZXNzX3Rva2VuXCIpIHx8IGhhc2hQYXJhbXMuZ2V0KFwidG9rZW5cIik7XG4gICAgfVxuICB9XG5cbiAgY29uc29sZS5sb2coXCJDb25maXJtYXRpb24gcGFnZSBpbml0aWFsaXplZCB3aXRoOlwiLCB7XG4gICAgY29uZmlybWF0aW9uVG9rZW46IGNvbmZpcm1hdGlvblRva2VuID8gXCJwcmVzZW50XCIgOiBcIm1pc3NpbmdcIixcbiAgICB0eXBlLFxuICAgIGNvbmZpcm1hdGlvblVybDogY29uZmlybWF0aW9uVXJsID8gXCJwcmVzZW50XCIgOiBcIm1pc3NpbmdcIixcbiAgICB1cmxIYXNoOiB1cmxIYXNoIHx8IFwibm9uZVwiLFxuICB9KTtcblxuICBjb25zdCBzdGF0dXNNZXNzYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdGF0dXNNZXNzYWdlXCIpO1xuICBjb25zdCBlcnJvck1lc3NhZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImVycm9yTWVzc2FnZVwiKTtcbiAgY29uc3QgbG9hZGluZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibG9hZGluZ1wiKTtcbiAgY29uc3QgY29uZmlybWF0aW9uRm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29uZmlybWF0aW9uRm9ybVwiKTtcbiAgY29uc3QgY29uZmlybUZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbmZpcm1Gb3JtXCIpO1xuXG4gIGlmIChsb2FkaW5nKSBsb2FkaW5nLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRkZW5cIik7XG5cbiAgLy8gVmFsaWRhdGUgdGhhdCB3ZSBoYXZlIHRoZSBuZWNlc3NhcnkgY29uZmlybWF0aW9uIGRhdGFcbiAgaWYgKGNvbmZpcm1hdGlvblVybCkge1xuICAgIGNvbmZpcm1hdGlvbkRhdGEgPSB7IHR5cGU6IFwidXJsXCIsIGRhdGE6IGNvbmZpcm1hdGlvblVybCB9O1xuICAgIHNob3dDb25maXJtYXRpb25Gb3JtKCk7XG4gIH0gZWxzZSBpZiAoXG4gICAgY29uZmlybWF0aW9uVG9rZW4gJiZcbiAgICAodHlwZSA9PT0gXCJzaWdudXBcIiB8fCB0eXBlID09PSBcImVtYWlsX2NoYW5nZVwiKVxuICApIHtcbiAgICBjb25maXJtYXRpb25EYXRhID0ge1xuICAgICAgdHlwZTogXCJ0b2tlblwiLFxuICAgICAgZGF0YTogY29uZmlybWF0aW9uVG9rZW4sXG4gICAgICB0b2tlblR5cGU6IHR5cGUsXG4gICAgfTtcbiAgICBzaG93Q29uZmlybWF0aW9uRm9ybSgpO1xuICB9IGVsc2Uge1xuICAgIGlmIChsb2FkaW5nKSBsb2FkaW5nLmNsYXNzTGlzdC5hZGQoXCJoaWRkZW5cIik7XG4gICAgc2hvd0Vycm9yKFwiRXJyZXVyOiBVUkwgb3UgamV0b24gZGUgY29uZmlybWF0aW9uIG1hbnF1YW50IG91IGludmFsaWRlLlwiKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBTZXQgdXAgZm9ybSBzdWJtaXNzaW9uIGhhbmRsZXJcbiAgaWYgKGNvbmZpcm1Gb3JtKSB7XG4gICAgY29uZmlybUZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVDb25maXJtYXRpb24pO1xuICB9XG5cbiAgZnVuY3Rpb24gc2hvd0NvbmZpcm1hdGlvbkZvcm0oKSB7XG4gICAgaWYgKGxvYWRpbmcpIGxvYWRpbmcuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcbiAgICBpZiAoY29uZmlybWF0aW9uRm9ybSkgY29uZmlybWF0aW9uRm9ybS5jbGFzc0xpc3QucmVtb3ZlKFwiaGlkZGVuXCIpO1xuICAgIHNob3dTdGF0dXMoXG4gICAgICBcIkxpZW4gZGUgY29uZmlybWF0aW9uIHZhbGlkZS4gVmV1aWxsZXogY29tcGzDqXRlciBsZSBDQVBUQ0hBIGV0IGNvbmZpcm1lci5cIixcbiAgICAgIFwiaW5mb1wiXG4gICAgKTtcbiAgfVxufVxuXG4vKipcbiAqIEhhbmRsZXMgdGhlIG1hbnVhbCBjb25maXJtYXRpb24gcHJvY2Vzc1xuICovXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVDb25maXJtYXRpb24oZSkge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgaWYgKCFjYXB0Y2hhVG9rZW4pIHtcbiAgICBzaG93RXJyb3IoXCJWZXVpbGxleiBjb21wbMOpdGVyIGxlIENBUFRDSEEgYXZhbnQgZGUgY29uZmlybWVyLlwiKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoIWNvbmZpcm1hdGlvbkRhdGEpIHtcbiAgICBzaG93RXJyb3IoXCJEb25uw6llcyBkZSBjb25maXJtYXRpb24gbWFucXVhbnRlcy5cIik7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgY29uZmlybUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29uZmlybUJ0blwiKTtcbiAgY29uc3QgY29uZmlybVNwaW5uZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbmZpcm1TcGlubmVyXCIpO1xuXG4gIC8vIFNob3cgbG9hZGluZyBzdGF0ZVxuICBpZiAoY29uZmlybUJ0bikgY29uZmlybUJ0bi5kaXNhYmxlZCA9IHRydWU7XG4gIGlmIChjb25maXJtU3Bpbm5lcikgY29uZmlybVNwaW5uZXIuY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcblxuICB0cnkge1xuICAgIGlmIChjb25maXJtYXRpb25EYXRhLnR5cGUgPT09IFwidXJsXCIpIHtcbiAgICAgIGF3YWl0IGNvbmZpcm1FbWFpbFdpdGhVcmwoY29uZmlybWF0aW9uRGF0YS5kYXRhKTtcbiAgICB9IGVsc2UgaWYgKGNvbmZpcm1hdGlvbkRhdGEudHlwZSA9PT0gXCJ0b2tlblwiKSB7XG4gICAgICBhd2FpdCBjb25maXJtRW1haWxXaXRoVG9rZW4oXG4gICAgICAgIGNvbmZpcm1hdGlvbkRhdGEuZGF0YSxcbiAgICAgICAgY29uZmlybWF0aW9uRGF0YS50b2tlblR5cGVcbiAgICAgICk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJDb25maXJtYXRpb24gZXJyb3I6XCIsIGVycm9yKTtcbiAgICBzaG93RXJyb3IoYEVycmV1ciBsb3JzIGRlIGxhIGNvbmZpcm1hdGlvbjogJHtlcnJvci5tZXNzYWdlfWApO1xuICB9IGZpbmFsbHkge1xuICAgIC8vIFJlc2V0IGxvYWRpbmcgc3RhdGVcbiAgICBpZiAoY29uZmlybUJ0bikgY29uZmlybUJ0bi5kaXNhYmxlZCA9IGZhbHNlO1xuICAgIGlmIChjb25maXJtU3Bpbm5lcikgY29uZmlybVNwaW5uZXIuY2xhc3NMaXN0LmFkZChcImhpZGRlblwiKTtcblxuICAgIC8vIFJlc2V0IENBUFRDSEFcbiAgICBpZiAod2luZG93LnR1cm5zdGlsZSAmJiB0dXJuc3RpbGVXaWRnZXRJZCkge1xuICAgICAgd2luZG93LnR1cm5zdGlsZS5yZXNldCh0dXJuc3RpbGVXaWRnZXRJZCk7XG4gICAgfVxuICAgIGNhcHRjaGFUb2tlbiA9IG51bGw7XG4gICAgaWYgKGNvbmZpcm1CdG4pIGNvbmZpcm1CdG4uZGlzYWJsZWQgPSB0cnVlO1xuICB9XG59XG5cbi8qKlxuICogQ29uZmlybXMgdGhlIGVtYWlsIGFkZHJlc3Mgd2l0aCB0b2tlbi1iYXNlZCBjb25maXJtYXRpb25cbiAqL1xuYXN5bmMgZnVuY3Rpb24gY29uZmlybUVtYWlsV2l0aFRva2VuKHRva2VuLCB0b2tlblR5cGUgPSBcInNpZ251cFwiKSB7XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coXCJBdHRlbXB0aW5nIHRva2VuIGNvbmZpcm1hdGlvbiB3aXRoIHR5cGU6XCIsIHRva2VuVHlwZSk7XG5cbiAgICAvLyBGb3Igc2lnbnVwIGNvbmZpcm1hdGlvbnMsIHVzZSB2ZXJpZnlPdHAgd2l0aCB0aGUgdG9rZW5faGFzaFxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGgudmVyaWZ5T3RwKHtcbiAgICAgIHRva2VuX2hhc2g6IHRva2VuLFxuICAgICAgdHlwZTogXCJlbWFpbFwiLCAvLyBVc2UgJ2VtYWlsJyB0eXBlIGZvciBlbWFpbCBjb25maXJtYXRpb25zXG4gICAgfSk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkdXJpbmcgdmVyaWZ5T3RwOlwiLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIFwiRXJyZXVyIGxvcnMgZGUgbGEgdsOpcmlmaWNhdGlvbiBkdSB0b2tlbjogXCIgKyBlcnJvci5tZXNzYWdlXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChkYXRhLnVzZXIgJiYgZGF0YS5zZXNzaW9uKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIkVtYWlsIGNvbmZpcm1lZCBzdWNjZXNzZnVsbHk6XCIsIGRhdGEudXNlci5lbWFpbCk7XG4gICAgICBzaG93U3VjY2Vzc0FuZFJlZGlyZWN0KFxuICAgICAgICBcIkVtYWlsIHbDqXJpZmnDqSBhdmVjIHN1Y2PDqHMgISBSZWRpcmVjdGlvbiB2ZXJzIGxhIGNvbm5leGlvbi4uLlwiXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIFwiSW1wb3NzaWJsZSBkZSBjb25maXJtZXIgbCdlbWFpbC4gTGUgdG9rZW4gZXN0IHBldXQtw6p0cmUgaW52YWxpZGUgb3UgYSBleHBpcsOpLlwiXG4gICAgICApO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZHVyaW5nIHRva2VuLWJhc2VkIGNvbmZpcm1hdGlvbjpcIiwgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8qKlxuICogQ29uZmlybXMgdGhlIGVtYWlsIGFkZHJlc3MgZGlyZWN0bHkgd2l0aCBTdXBhYmFzZSB1c2luZyB0aGUgY29uZmlybWF0aW9uIFVSTFxuICovXG5hc3luYyBmdW5jdGlvbiBjb25maXJtRW1haWxXaXRoVXJsKGNvbmZpcm1hdGlvblVybFBhcmFtKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgZGVjb2RlZFVybCA9IGRlY29kZVVSSUNvbXBvbmVudChjb25maXJtYXRpb25VcmxQYXJhbSk7XG4gICAgY29uc29sZS5sb2coXCJBdHRlbXB0aW5nIGVtYWlsIGNvbmZpcm1hdGlvbiB3aXRoIFVSTDpcIiwgZGVjb2RlZFVybCk7XG5cbiAgICAvLyBFeHRyYWN0IHRva2VuIGZyb20gdGhlIGNvbmZpcm1hdGlvbiBVUkxcbiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKGRlY29kZWRVcmwpO1xuICAgIGNvbnN0IHRva2VuID0gdXJsLnNlYXJjaFBhcmFtcy5nZXQoXCJ0b2tlblwiKTtcbiAgICBjb25zdCB0eXBlID0gdXJsLnNlYXJjaFBhcmFtcy5nZXQoXCJ0eXBlXCIpO1xuXG4gICAgaWYgKCF0b2tlbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVG9rZW4gbWFucXVhbnQgZGFucyBsJ1VSTCBkZSBjb25maXJtYXRpb24uXCIpO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKFxuICAgICAgXCJFeHRyYWN0ZWQgZnJvbSBVUkwgLSB0b2tlbjpcIixcbiAgICAgIHRva2VuLnN1YnN0cmluZygwLCAyMCkgKyBcIi4uLlwiLFxuICAgICAgXCJ0eXBlOlwiLFxuICAgICAgdHlwZVxuICAgICk7XG5cbiAgICAvLyBVc2UgdmVyaWZ5T3RwIHdpdGggdG9rZW5faGFzaCBmb3IgZW1haWwgY29uZmlybWF0aW9uc1xuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGgudmVyaWZ5T3RwKHtcbiAgICAgIHRva2VuX2hhc2g6IHRva2VuLFxuICAgICAgdHlwZTogXCJlbWFpbFwiLCAvLyBVc2UgJ2VtYWlsJyB0eXBlIGZvciBlbWFpbCBjb25maXJtYXRpb25zIHJlZ2FyZGxlc3Mgb2YgVVJMIHR5cGVcbiAgICB9KTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGR1cmluZyBVUkwtYmFzZWQgY29uZmlybWF0aW9uOlwiLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJFcnJldXIgbG9ycyBkZSBsYSBjb25maXJtYXRpb246IFwiICsgZXJyb3IubWVzc2FnZSk7XG4gICAgfVxuXG4gICAgaWYgKGRhdGEudXNlciAmJiBkYXRhLnNlc3Npb24pIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiRW1haWwgY29uZmlybWVkIHN1Y2Nlc3NmdWxseSB2aWEgVVJMOlwiLCBkYXRhLnVzZXIuZW1haWwpO1xuICAgICAgc2hvd1N1Y2Nlc3NBbmRSZWRpcmVjdChcbiAgICAgICAgXCJFbWFpbCB2w6lyaWZpw6kgYXZlYyBzdWNjw6hzICEgVm91cyBhbGxleiDDqnRyZSByZWRpcmlnw6kgdmVycyBsYSBwYWdlIGRlIGNvbm5leGlvbi5cIlxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBcIkltcG9zc2libGUgZGUgY29uZmlybWVyIGwnZW1haWwuIExlIGxpZW4gZXN0IHBldXQtw6p0cmUgZXhwaXLDqSBvdSBkw6lqw6AgdXRpbGlzw6kuXCJcbiAgICAgICk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJDb25maXJtYXRpb24gcHJvY2Vzc2luZyBlcnJvcjpcIiwgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8qKlxuICogU2hvd3Mgc3VjY2VzcyBtZXNzYWdlIGFuZCByZWRpcmVjdHMgdG8gbG9naW5cbiAqL1xuZnVuY3Rpb24gc2hvd1N1Y2Nlc3NBbmRSZWRpcmVjdChtZXNzYWdlKSB7XG4gIGNvbnN0IGNvbmZpcm1hdGlvbkZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbmZpcm1hdGlvbkZvcm1cIik7XG4gIGNvbnN0IHN1Y2Nlc3NNZXNzYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzdWNjZXNzTWVzc2FnZVwiKTtcblxuICBpZiAoY29uZmlybWF0aW9uRm9ybSkgY29uZmlybWF0aW9uRm9ybS5jbGFzc0xpc3QuYWRkKFwiaGlkZGVuXCIpO1xuXG4gIGlmIChzdWNjZXNzTWVzc2FnZSkge1xuICAgIHN1Y2Nlc3NNZXNzYWdlLmlubmVySFRNTCA9IGBcbiAgICAgIDxkaXYgY2xhc3M9XCJjb25maXJtYXRpb24tc3VjY2Vzc1wiPlxuICAgICAgICA8c3BhbiBjbGFzcz1cInN1Y2Nlc3MtaWNvblwiPuKchTwvc3Bhbj5cbiAgICAgICAgPGgzPkNvbmZpcm1hdGlvbiByw6l1c3NpZSAhPC9oMz5cbiAgICAgICAgPHA+Vm90cmUgY29tcHRlIGEgw6l0w6kgY29uZmlybcOpIGF2ZWMgc3VjY8Oocy48L3A+XG4gICAgICAgIDxwPlZvdXMgYWxsZXogw6p0cmUgcmVkaXJpZ8OpIHZlcnMgbGEgcGFnZSBkZSBjb25uZXhpb24gZGFucyBxdWVscXVlcyBzZWNvbmRlcy4uLjwvcD5cbiAgICAgIDwvZGl2PlxuICAgIGA7XG4gICAgc3VjY2Vzc01lc3NhZ2UuY2xhc3NMaXN0LnJlbW92ZShcImhpZGRlblwiKTtcbiAgfVxuXG4gIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gXCIvYXV0aC9sb2dpblwiO1xuICB9LCAzMDAwKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuICBpbml0Q29uZmlybWF0aW9uUGFnZSxcbn07XG4iLCIvLyBzcmMvZW50cmllcy9jb25maXJtYXRpb24uanNcbi8qKlxuICogQ29uZmlybWF0aW9uIEVudHJ5IFBvaW50XG4gKlxuICogVGhpcyBtb2R1bGUgc2VydmVzIGFzIHRoZSBlbnRyeSBwb2ludCBmb3IgdGhlIGVtYWlsIGNvbmZpcm1hdGlvbiBwYWdlLlxuICovXG5cbi8vIEltcG9ydCBvdXIgY29uZmlybWF0aW9uIG1vZHVsZVxuaW1wb3J0IHsgaW5pdENvbmZpcm1hdGlvblBhZ2UgfSBmcm9tIFwiLi4vYXV0aC9jb25maXJtYXRpb24uanNcIjtcblxuLy8gSW5pdGlhbGl6ZSBjb25maXJtYXRpb24gcGFnZSB3aGVuIERPTSBpcyBsb2FkZWRcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+IHtcbiAgLy8gSW5pdGlhbGl6ZSBjb25maXJtYXRpb24gcGFnZVxuICBpbml0Q29uZmlybWF0aW9uUGFnZSgpO1xuXG4gIGNvbnNvbGUubG9nKFwiQ29uZmlybWF0aW9uIHBhZ2UgaW5pdGlhbGl6ZWRcIik7XG59KTtcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4vLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuX193ZWJwYWNrX3JlcXVpcmVfXy5tID0gX193ZWJwYWNrX21vZHVsZXNfXztcblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5mID0ge307XG4vLyBUaGlzIGZpbGUgY29udGFpbnMgb25seSB0aGUgZW50cnkgY2h1bmsuXG4vLyBUaGUgY2h1bmsgbG9hZGluZyBmdW5jdGlvbiBmb3IgYWRkaXRpb25hbCBjaHVua3Ncbl9fd2VicGFja19yZXF1aXJlX18uZSA9IChjaHVua0lkKSA9PiB7XG5cdHJldHVybiBQcm9taXNlLmFsbChPYmplY3Qua2V5cyhfX3dlYnBhY2tfcmVxdWlyZV9fLmYpLnJlZHVjZSgocHJvbWlzZXMsIGtleSkgPT4ge1xuXHRcdF9fd2VicGFja19yZXF1aXJlX18uZltrZXldKGNodW5rSWQsIHByb21pc2VzKTtcblx0XHRyZXR1cm4gcHJvbWlzZXM7XG5cdH0sIFtdKSk7XG59OyIsIi8vIFRoaXMgZnVuY3Rpb24gYWxsb3cgdG8gcmVmZXJlbmNlIGFzeW5jIGNodW5rc1xuX193ZWJwYWNrX3JlcXVpcmVfXy51ID0gKGNodW5rSWQpID0+IHtcblx0Ly8gcmV0dXJuIHVybCBmb3IgZmlsZW5hbWVzIGJhc2VkIG9uIHRlbXBsYXRlXG5cdHJldHVybiBcImpzL1wiICsgY2h1bmtJZCArIFwiLmJ1bmRsZS5qc1wiO1xufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLmcgPSAoZnVuY3Rpb24oKSB7XG5cdGlmICh0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gJ29iamVjdCcpIHJldHVybiBnbG9iYWxUaGlzO1xuXHR0cnkge1xuXHRcdHJldHVybiB0aGlzIHx8IG5ldyBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpO1xuXHR9IGNhdGNoIChlKSB7XG5cdFx0aWYgKHR5cGVvZiB3aW5kb3cgPT09ICdvYmplY3QnKSByZXR1cm4gd2luZG93O1xuXHR9XG59KSgpOyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSAoZXhwb3J0cykgPT4ge1xuXHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcblx0fVxuXHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLmogPSA1MDg7IiwidmFyIHNjcmlwdFVybDtcbmlmIChfX3dlYnBhY2tfcmVxdWlyZV9fLmcuaW1wb3J0U2NyaXB0cykgc2NyaXB0VXJsID0gX193ZWJwYWNrX3JlcXVpcmVfXy5nLmxvY2F0aW9uICsgXCJcIjtcbnZhciBkb2N1bWVudCA9IF9fd2VicGFja19yZXF1aXJlX18uZy5kb2N1bWVudDtcbmlmICghc2NyaXB0VXJsICYmIGRvY3VtZW50KSB7XG5cdGlmIChkb2N1bWVudC5jdXJyZW50U2NyaXB0ICYmIGRvY3VtZW50LmN1cnJlbnRTY3JpcHQudGFnTmFtZS50b1VwcGVyQ2FzZSgpID09PSAnU0NSSVBUJylcblx0XHRzY3JpcHRVcmwgPSBkb2N1bWVudC5jdXJyZW50U2NyaXB0LnNyYztcblx0aWYgKCFzY3JpcHRVcmwpIHtcblx0XHR2YXIgc2NyaXB0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpO1xuXHRcdGlmKHNjcmlwdHMubGVuZ3RoKSB7XG5cdFx0XHR2YXIgaSA9IHNjcmlwdHMubGVuZ3RoIC0gMTtcblx0XHRcdHdoaWxlIChpID4gLTEgJiYgKCFzY3JpcHRVcmwgfHwgIS9eaHR0cChzPyk6Ly50ZXN0KHNjcmlwdFVybCkpKSBzY3JpcHRVcmwgPSBzY3JpcHRzW2ktLV0uc3JjO1xuXHRcdH1cblx0fVxufVxuLy8gV2hlbiBzdXBwb3J0aW5nIGJyb3dzZXJzIHdoZXJlIGFuIGF1dG9tYXRpYyBwdWJsaWNQYXRoIGlzIG5vdCBzdXBwb3J0ZWQgeW91IG11c3Qgc3BlY2lmeSBhbiBvdXRwdXQucHVibGljUGF0aCBtYW51YWxseSB2aWEgY29uZmlndXJhdGlvblxuLy8gb3IgcGFzcyBhbiBlbXB0eSBzdHJpbmcgKFwiXCIpIGFuZCBzZXQgdGhlIF9fd2VicGFja19wdWJsaWNfcGF0aF9fIHZhcmlhYmxlIGZyb20geW91ciBjb2RlIHRvIHVzZSB5b3VyIG93biBsb2dpYy5cbmlmICghc2NyaXB0VXJsKSB0aHJvdyBuZXcgRXJyb3IoXCJBdXRvbWF0aWMgcHVibGljUGF0aCBpcyBub3Qgc3VwcG9ydGVkIGluIHRoaXMgYnJvd3NlclwiKTtcbnNjcmlwdFVybCA9IHNjcmlwdFVybC5yZXBsYWNlKC9eYmxvYjovLCBcIlwiKS5yZXBsYWNlKC8jLiokLywgXCJcIikucmVwbGFjZSgvXFw/LiokLywgXCJcIikucmVwbGFjZSgvXFwvW15cXC9dKyQvLCBcIi9cIik7XG5fX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBzY3JpcHRVcmwgKyBcIi4uL1wiOyIsIi8vIG5vIGJhc2VVUklcblxuLy8gb2JqZWN0IHRvIHN0b3JlIGxvYWRlZCBhbmQgbG9hZGluZyBjaHVua3Ncbi8vIHVuZGVmaW5lZCA9IGNodW5rIG5vdCBsb2FkZWQsIG51bGwgPSBjaHVuayBwcmVsb2FkZWQvcHJlZmV0Y2hlZFxuLy8gW3Jlc29sdmUsIHJlamVjdCwgUHJvbWlzZV0gPSBjaHVuayBsb2FkaW5nLCAwID0gY2h1bmsgbG9hZGVkXG52YXIgaW5zdGFsbGVkQ2h1bmtzID0ge1xuXHQ1MDg6IDBcbn07XG5cbl9fd2VicGFja19yZXF1aXJlX18uZi5qID0gKGNodW5rSWQsIHByb21pc2VzKSA9PiB7XG5cdFx0Ly8gSlNPTlAgY2h1bmsgbG9hZGluZyBmb3IgamF2YXNjcmlwdFxuXHRcdHZhciBpbnN0YWxsZWRDaHVua0RhdGEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLm8oaW5zdGFsbGVkQ2h1bmtzLCBjaHVua0lkKSA/IGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA6IHVuZGVmaW5lZDtcblx0XHRpZihpbnN0YWxsZWRDaHVua0RhdGEgIT09IDApIHsgLy8gMCBtZWFucyBcImFscmVhZHkgaW5zdGFsbGVkXCIuXG5cblx0XHRcdC8vIGEgUHJvbWlzZSBtZWFucyBcImN1cnJlbnRseSBsb2FkaW5nXCIuXG5cdFx0XHRpZihpbnN0YWxsZWRDaHVua0RhdGEpIHtcblx0XHRcdFx0cHJvbWlzZXMucHVzaChpbnN0YWxsZWRDaHVua0RhdGFbMl0pO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYodHJ1ZSkgeyAvLyBhbGwgY2h1bmtzIGhhdmUgSlNcblx0XHRcdFx0XHQvLyBzZXR1cCBQcm9taXNlIGluIGNodW5rIGNhY2hlXG5cdFx0XHRcdFx0dmFyIHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiAoaW5zdGFsbGVkQ2h1bmtEYXRhID0gaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdID0gW3Jlc29sdmUsIHJlamVjdF0pKTtcblx0XHRcdFx0XHRwcm9taXNlcy5wdXNoKGluc3RhbGxlZENodW5rRGF0YVsyXSA9IHByb21pc2UpO1xuXG5cdFx0XHRcdFx0Ly8gc3RhcnQgY2h1bmsgbG9hZGluZ1xuXHRcdFx0XHRcdHZhciB1cmwgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLnAgKyBfX3dlYnBhY2tfcmVxdWlyZV9fLnUoY2h1bmtJZCk7XG5cdFx0XHRcdFx0Ly8gY3JlYXRlIGVycm9yIGJlZm9yZSBzdGFjayB1bndvdW5kIHRvIGdldCB1c2VmdWwgc3RhY2t0cmFjZSBsYXRlclxuXHRcdFx0XHRcdHZhciBlcnJvciA9IG5ldyBFcnJvcigpO1xuXHRcdFx0XHRcdHZhciBsb2FkaW5nRW5kZWQgPSAoZXZlbnQpID0+IHtcblx0XHRcdFx0XHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhpbnN0YWxsZWRDaHVua3MsIGNodW5rSWQpKSB7XG5cdFx0XHRcdFx0XHRcdGluc3RhbGxlZENodW5rRGF0YSA9IGluc3RhbGxlZENodW5rc1tjaHVua0lkXTtcblx0XHRcdFx0XHRcdFx0aWYoaW5zdGFsbGVkQ2h1bmtEYXRhICE9PSAwKSBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gPSB1bmRlZmluZWQ7XG5cdFx0XHRcdFx0XHRcdGlmKGluc3RhbGxlZENodW5rRGF0YSkge1xuXHRcdFx0XHRcdFx0XHRcdHZhciBlcnJvclR5cGUgPSBldmVudCAmJiAoZXZlbnQudHlwZSA9PT0gJ2xvYWQnID8gJ21pc3NpbmcnIDogZXZlbnQudHlwZSk7XG5cdFx0XHRcdFx0XHRcdFx0dmFyIHJlYWxTcmMgPSBldmVudCAmJiBldmVudC50YXJnZXQgJiYgZXZlbnQudGFyZ2V0LnNyYztcblx0XHRcdFx0XHRcdFx0XHRlcnJvci5tZXNzYWdlID0gJ0xvYWRpbmcgY2h1bmsgJyArIGNodW5rSWQgKyAnIGZhaWxlZC5cXG4oJyArIGVycm9yVHlwZSArICc6ICcgKyByZWFsU3JjICsgJyknO1xuXHRcdFx0XHRcdFx0XHRcdGVycm9yLm5hbWUgPSAnQ2h1bmtMb2FkRXJyb3InO1xuXHRcdFx0XHRcdFx0XHRcdGVycm9yLnR5cGUgPSBlcnJvclR5cGU7XG5cdFx0XHRcdFx0XHRcdFx0ZXJyb3IucmVxdWVzdCA9IHJlYWxTcmM7XG5cdFx0XHRcdFx0XHRcdFx0aW5zdGFsbGVkQ2h1bmtEYXRhWzFdKGVycm9yKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5sKHVybCwgbG9hZGluZ0VuZGVkLCBcImNodW5rLVwiICsgY2h1bmtJZCwgY2h1bmtJZCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG59O1xuXG4vLyBubyBwcmVmZXRjaGluZ1xuXG4vLyBubyBwcmVsb2FkZWRcblxuLy8gbm8gSE1SXG5cbi8vIG5vIEhNUiBtYW5pZmVzdFxuXG5fX3dlYnBhY2tfcmVxdWlyZV9fLk8uaiA9IChjaHVua0lkKSA9PiAoaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdID09PSAwKTtcblxuLy8gaW5zdGFsbCBhIEpTT05QIGNhbGxiYWNrIGZvciBjaHVuayBsb2FkaW5nXG52YXIgd2VicGFja0pzb25wQ2FsbGJhY2sgPSAocGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24sIGRhdGEpID0+IHtcblx0dmFyIFtjaHVua0lkcywgbW9yZU1vZHVsZXMsIHJ1bnRpbWVdID0gZGF0YTtcblx0Ly8gYWRkIFwibW9yZU1vZHVsZXNcIiB0byB0aGUgbW9kdWxlcyBvYmplY3QsXG5cdC8vIHRoZW4gZmxhZyBhbGwgXCJjaHVua0lkc1wiIGFzIGxvYWRlZCBhbmQgZmlyZSBjYWxsYmFja1xuXHR2YXIgbW9kdWxlSWQsIGNodW5rSWQsIGkgPSAwO1xuXHRpZihjaHVua0lkcy5zb21lKChpZCkgPT4gKGluc3RhbGxlZENodW5rc1tpZF0gIT09IDApKSkge1xuXHRcdGZvcihtb2R1bGVJZCBpbiBtb3JlTW9kdWxlcykge1xuXHRcdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKG1vcmVNb2R1bGVzLCBtb2R1bGVJZCkpIHtcblx0XHRcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tW21vZHVsZUlkXSA9IG1vcmVNb2R1bGVzW21vZHVsZUlkXTtcblx0XHRcdH1cblx0XHR9XG5cdFx0aWYocnVudGltZSkgdmFyIHJlc3VsdCA9IHJ1bnRpbWUoX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cdH1cblx0aWYocGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24pIHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uKGRhdGEpO1xuXHRmb3IoO2kgPCBjaHVua0lkcy5sZW5ndGg7IGkrKykge1xuXHRcdGNodW5rSWQgPSBjaHVua0lkc1tpXTtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oaW5zdGFsbGVkQ2h1bmtzLCBjaHVua0lkKSAmJiBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0pIHtcblx0XHRcdGluc3RhbGxlZENodW5rc1tjaHVua0lkXVswXSgpO1xuXHRcdH1cblx0XHRpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gPSAwO1xuXHR9XG5cdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fLk8ocmVzdWx0KTtcbn1cblxudmFyIGNodW5rTG9hZGluZ0dsb2JhbCA9IHNlbGZbXCJ3ZWJwYWNrQ2h1bmt1cmJhbmRvY3Nfd2ViYXBwXCJdID0gc2VsZltcIndlYnBhY2tDaHVua3VyYmFuZG9jc193ZWJhcHBcIl0gfHwgW107XG5jaHVua0xvYWRpbmdHbG9iYWwuZm9yRWFjaCh3ZWJwYWNrSnNvbnBDYWxsYmFjay5iaW5kKG51bGwsIDApKTtcbmNodW5rTG9hZGluZ0dsb2JhbC5wdXNoID0gd2VicGFja0pzb25wQ2FsbGJhY2suYmluZChudWxsLCBjaHVua0xvYWRpbmdHbG9iYWwucHVzaC5iaW5kKGNodW5rTG9hZGluZ0dsb2JhbCkpOyIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgZGVwZW5kcyBvbiBvdGhlciBsb2FkZWQgY2h1bmtzIGFuZCBleGVjdXRpb24gbmVlZCB0byBiZSBkZWxheWVkXG52YXIgX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18uTyh1bmRlZmluZWQsIFs3Nl0sICgpID0+IChfX3dlYnBhY2tfcmVxdWlyZV9fKDEwMDgpKSlcbl9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fLk8oX193ZWJwYWNrX2V4cG9ydHNfXyk7XG4iXSwibmFtZXMiOlsiZGVmZXJyZWQiLCJsZWFmUHJvdG90eXBlcyIsImdldFByb3RvIiwiaW5Qcm9ncmVzcyIsImRhdGFXZWJwYWNrUHJlZml4IiwiY29uZmlybWF0aW9uRGF0YSIsImNhcHRjaGFUb2tlbiIsInR1cm5zdGlsZVdpZGdldElkIiwiYXN5bmMiLCJoYW5kbGVDb25maXJtYXRpb24iLCJlIiwicHJldmVudERlZmF1bHQiLCJjb25maXJtQnRuIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImNvbmZpcm1TcGlubmVyIiwiZGlzYWJsZWQiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJ0eXBlIiwiY29uZmlybWF0aW9uVXJsUGFyYW0iLCJkZWNvZGVkVXJsIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwiY29uc29sZSIsImxvZyIsInVybCIsIlVSTCIsInRva2VuIiwic2VhcmNoUGFyYW1zIiwiZ2V0IiwiRXJyb3IiLCJzdWJzdHJpbmciLCJkYXRhIiwiZXJyb3IiLCJhdXRoIiwidmVyaWZ5T3RwIiwidG9rZW5faGFzaCIsIm1lc3NhZ2UiLCJ1c2VyIiwic2Vzc2lvbiIsImVtYWlsIiwic2hvd1N1Y2Nlc3NBbmRSZWRpcmVjdCIsImNvbmZpcm1FbWFpbFdpdGhVcmwiLCJ0b2tlblR5cGUiLCJjb25maXJtRW1haWxXaXRoVG9rZW4iLCJhZGQiLCJ3aW5kb3ciLCJ0dXJuc3RpbGUiLCJyZXNldCIsImNvbmZpcm1hdGlvbkZvcm0iLCJzdWNjZXNzTWVzc2FnZSIsImlubmVySFRNTCIsInNldFRpbWVvdXQiLCJsb2NhdGlvbiIsImhyZWYiLCJvbmxvYWRUdXJuc3RpbGVDYWxsYmFjayIsInR1cm5zdGlsZUNvbnRhaW5lciIsInJlbmRlciIsInNpdGVrZXkiLCJjYWxsYmFjayIsImVyciIsInVuZGVmaW5lZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJ1cmxQYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJzZWFyY2giLCJ1cmxIYXNoIiwiaGFzaCIsImNvbmZpcm1hdGlvblRva2VuIiwiY29uZmlybWF0aW9uVXJsIiwiaGFzaFBhcmFtcyIsImxvYWRpbmciLCJjb25maXJtRm9ybSIsInNob3dDb25maXJtYXRpb25Gb3JtIiwiaW5pdENvbmZpcm1hdGlvblBhZ2UiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsImNhbGwiLCJtIiwiTyIsInJlc3VsdCIsImNodW5rSWRzIiwiZm4iLCJwcmlvcml0eSIsIm5vdEZ1bGZpbGxlZCIsIkluZmluaXR5IiwiaSIsImxlbmd0aCIsImZ1bGZpbGxlZCIsImoiLCJPYmplY3QiLCJrZXlzIiwiZXZlcnkiLCJrZXkiLCJzcGxpY2UiLCJyIiwiZ2V0UHJvdG90eXBlT2YiLCJvYmoiLCJ0IiwidmFsdWUiLCJtb2RlIiwidGhpcyIsIl9fZXNNb2R1bGUiLCJ0aGVuIiwibnMiLCJjcmVhdGUiLCJkZWYiLCJjdXJyZW50IiwiaW5kZXhPZiIsImdldE93blByb3BlcnR5TmFtZXMiLCJmb3JFYWNoIiwiZCIsImRlZmluaXRpb24iLCJvIiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZiIsImNodW5rSWQiLCJQcm9taXNlIiwiYWxsIiwicmVkdWNlIiwicHJvbWlzZXMiLCJ1IiwiZyIsImdsb2JhbFRoaXMiLCJGdW5jdGlvbiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImwiLCJkb25lIiwicHVzaCIsInNjcmlwdCIsIm5lZWRBdHRhY2giLCJzY3JpcHRzIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJzIiwiZ2V0QXR0cmlidXRlIiwiY3JlYXRlRWxlbWVudCIsImNoYXJzZXQiLCJ0aW1lb3V0IiwibmMiLCJzZXRBdHRyaWJ1dGUiLCJzcmMiLCJvblNjcmlwdENvbXBsZXRlIiwicHJldiIsImV2ZW50Iiwib25lcnJvciIsIm9ubG9hZCIsImNsZWFyVGltZW91dCIsImRvbmVGbnMiLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJiaW5kIiwidGFyZ2V0IiwiaGVhZCIsImFwcGVuZENoaWxkIiwiU3ltYm9sIiwidG9TdHJpbmdUYWciLCJzY3JpcHRVcmwiLCJpbXBvcnRTY3JpcHRzIiwiY3VycmVudFNjcmlwdCIsInRhZ05hbWUiLCJ0b1VwcGVyQ2FzZSIsInRlc3QiLCJyZXBsYWNlIiwicCIsImluc3RhbGxlZENodW5rcyIsImluc3RhbGxlZENodW5rRGF0YSIsInByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZXJyb3JUeXBlIiwicmVhbFNyYyIsIm5hbWUiLCJyZXF1ZXN0Iiwid2VicGFja0pzb25wQ2FsbGJhY2siLCJwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbiIsIm1vcmVNb2R1bGVzIiwicnVudGltZSIsInNvbWUiLCJpZCIsImNodW5rTG9hZGluZ0dsb2JhbCIsInNlbGYiLCJfX3dlYnBhY2tfZXhwb3J0c19fIl0sInNvdXJjZVJvb3QiOiIifQ==