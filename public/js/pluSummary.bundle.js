(()=>{"use strict";var e,t,n,o,r,a={5852:(e,t,n)=>{var o=n(9660),r=n(9251),a=n(2387);let i=null,c=null,d=null,l=[],s=null;async function u(){try{const{data:e,error:t}=await o.N.from("ratings").select("rating, user_id").eq("document_id",c.id);if(t)throw t;if(l=e||[],l.length>0){const e=l.reduce(((e,t)=>e+t.rating),0)/l.length;document.getElementById("average-rating").textContent=e.toFixed(1),document.getElementById("rating-count").textContent=l.length;const t=function(e){const t={1:0,2:0,3:0,4:0,5:0};return e.forEach((e=>{t[e.rating]++})),t}(l);m(t);const n=l.find((e=>e.user_id===i.id));s=n?n.rating:null}else document.getElementById("average-rating").textContent="0",document.getElementById("rating-count").textContent="0",m({1:0,2:0,3:0,4:0,5:0}),s=null;y()}catch(e){console.error("Error loading ratings:",e)}}function m(e){const t=l.length||1;for(let n=1;n<=5;n++){const o=e[n]/t*100;document.getElementById(`rating-${n}`).style.width=`${o}%`,document.getElementById(`rating-${n}-percent`).textContent=`${Math.round(o)}%`}}async function g(){try{const{data:e,error:t}=await o.N.from("comments").select("*").eq("document_id",c.id).order("created_at",{ascending:!1});if(t)throw t;if(0===e.length)return void p([]);const n=[...new Set(e.map((e=>e.user_id)))],{data:r,error:a}=await o.N.from("profiles").select("id, full_name, avatar_url").in("id",n);if(a)return console.warn("Could not fetch profiles:",a),void p(e.map((e=>({...e,profiles:null}))));const i=r.reduce(((e,t)=>(e[t.id]=t,e)),{});p(e.map((e=>({...e,profiles:i[e.user_id]||null}))))}catch(e){console.error("Error loading comments:",e),p([])}}function p(e){const t=document.getElementById("comments-list");t.innerHTML="",0!==e.length?e.forEach((e=>{const n=function(e){const t=document.createElement("div");t.className="comment",t.dataset.commentId=e.id;const n=e.user_id===i.id,o=e.profiles?.full_name||"Utilisateur anonyme",r=e.profiles?.avatar_url||"assets/icons/default-avatar.svg",a=new Date(e.created_at).toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}),c=document.createElement("div");c.className="comment-header";const d=document.createElement("div");d.style.display="flex",d.style.alignItems="center",d.style.gap="1rem",d.innerHTML=`\n    <img src="${r}" alt="${o}" class="comment-avatar">\n    <div class="comment-meta">\n      <div class="comment-author">${o}</div>\n      <div class="comment-date">${a}${e.updated_at!==e.created_at?" (modifié)":""}</div>\n    </div>\n  `,c.appendChild(d),t.appendChild(c);const l=document.createElement("div");if(l.className="comment-content",l.textContent=e.content,t.appendChild(l),n){const n=document.createElement("div");n.className="comment-actions",n.innerHTML=`\n      <button class="comment-action edit-comment" data-id="${e.id}">\n        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>\n          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>\n        </svg>\n        Modifier\n      </button>\n      <button class="comment-action delete-comment" data-id="${e.id}">\n        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n          <polyline points="3 6 5 6 21 6"></polyline>\n          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>\n        </svg>\n        Supprimer\n      </button>\n    `,t.appendChild(n)}return t}(e);t.appendChild(n)})):t.innerHTML='<p style="text-align: center; color: var(--text-gray); padding: 2rem;">Aucun commentaire pour le moment. Soyez le premier à commenter!</p>'}function f(e){const t=e.target.dataset.tab;document.querySelectorAll(".tab-btn").forEach((e=>{e.classList.toggle("active",e.dataset.tab===t)})),document.getElementById("synthese-tab").style.display="synthese"===t?"block":"none",document.getElementById("commentaires-tab").style.display="commentaires"===t?"block":"none",document.getElementById("sources-tab").style.display="sources"===t?"block":"none"}function y(){const e=document.querySelectorAll("#user-rating .star-btn");if(s)e.forEach(((e,t)=>{e.classList.toggle("selected",t<s),e.classList.remove("hovered"),e.setAttribute("data-star-type","full")}));else{const t=parseFloat(document.getElementById("average-rating").textContent);!isNaN(t)&&t>0?displayAverageRating(t):e.forEach((e=>{e.classList.remove("selected","hovered"),e.setAttribute("data-star-type","empty")}))}}async function h(e){const t=parseInt(e.target.dataset.rating);if(s!==t)try{const{data:e}=await o.N.from("ratings").select("id").eq("document_id",c.id).eq("user_id",i.id).single();e?await o.N.from("ratings").update({rating:t,updated_at:(new Date).toISOString()}).eq("id",e.id):await o.N.from("ratings").insert({document_id:c.id,user_id:i.id,rating:t}),s=t,await u()}catch(e){console.error("Error rating document:",e),alert("Erreur lors de l'enregistrement de votre note")}else try{const{error:e}=await o.N.from("ratings").delete().eq("document_id",c.id).eq("user_id",i.id);if(e)throw e;s=null,await u()}catch(e){console.error("Error removing rating:",e),alert("Erreur lors de la suppression de votre note")}}async function v(){try{console.log("PDF storage path:",c.pdf_storage_path);const e=c.pdf_storage_path.replace(/^\//,""),{data:t,error:n}=await o.N.storage.from("pdfs").createSignedUrl(e,60,{download:!0});if(n)throw console.error("URL Error details:",n),n;await o.N.from("downloads").insert({document_id:c.id,user_id:i.id});const r=document.createElement("a");r.href=t.signedUrl,r.download=`PLU_${c.zoning.city.name}_${c.zone.name}.pdf`,document.body.appendChild(r),r.click(),document.body.removeChild(r)}catch(e){console.error("Error downloading document:",e),e.message&&e.message.includes("Object not found")?alert("Le fichier PDF n'a pas été trouvé. Veuillez contacter l'administrateur."):alert("Erreur lors du téléchargement")}}async function E(){const e=document.getElementById("comment-input").value.trim();if(e)try{const{error:t}=await o.N.from("comments").insert({document_id:c.id,user_id:i.id,content:e});if(t)throw t;document.getElementById("comment-input").value="",await g()}catch(e){console.error("Error submitting comment:",e),alert("Erreur lors de la publication du commentaire")}else alert("Veuillez entrer un commentaire")}function b(e){const t=e.target.closest(".edit-comment"),n=e.target.closest(".delete-comment");t?async function(e){d=e;const{data:t}=await o.N.from("comments").select("content").eq("id",e).single();document.getElementById("edit-comment-input").value=t.content,document.getElementById("edit-modal").style.display="flex"}(t.dataset.id):n&&async function(e){if(confirm("Êtes-vous sûr de vouloir supprimer ce commentaire?"))try{const{data:t,error:n}=await o.N.rpc("soft_delete_comment",{comment_id:e,user_id:i.id});if(n)throw n;alert("Commentaire supprimé. Il sera définitivement supprimé dans 30 jours. Contactez le support si vous souhaitez le récupérer."),await g()}catch(e){console.error("Error deleting comment:",e),alert("Erreur lors de la suppression")}}(n.dataset.id)}function w(){document.getElementById("edit-modal").style.display="none",d=null}async function _(){const e=document.getElementById("edit-comment-input").value.trim();if(e)try{await o.N.from("comments").update({content:e,updated_at:(new Date).toISOString()}).eq("id",d),w(),await g()}catch(e){console.error("Error updating comment:",e),alert("Erreur lors de la modification")}else alert("Le commentaire ne peut pas être vide")}async function I(){await o.N.auth.signOut(),window.location.href="/auth/login"}function L(e){document.getElementById("loading-state").style.display="none",document.getElementById("error-message").textContent=e,document.getElementById("error-state").style.display="flex"}document.addEventListener("DOMContentLoaded",(async()=>{try{if(!await(0,a.Kv)(!1))return;(0,r.Mt)();const{data:{user:e}}=await o.N.auth.getUser();if(!e)return void(window.location.href="/auth/login");i=e;const t=new URLSearchParams(window.location.search).get("id");if(!t)return void L("Aucun document spécifié");await async function(e){try{const{data:t,error:n}=await o.N.from("documents").select("\n          id,\n          zoning:zonings(name, city:cities(name)),\n          zone:zones(name),\n          html_content,\n          pdf_storage_path,\n          source_plu_date,\n          source_plu_url\n        ").eq("id",e).single();if(n)throw n;c=t,function(e){const t=(a=e.zoning.city.name)?a.replace(/\b\w/g,(e=>e.toUpperCase())):a,n=e.zone.name,o=e.source_plu_date?new Date(e.source_plu_date).toLocaleDateString("fr-FR",{year:"numeric",month:"long"}):"Date inconnue",r=document.getElementById("city-breadcrumb");var a;r.textContent=t,r.href=`/city?name=${encodeURIComponent(e.zoning.city.name)}`,document.getElementById("zone-breadcrumb").textContent=`Zone ${n}`,document.getElementById("document-title").textContent=`Synthèse du PLU de ${t} pour la zone ${n}`,document.getElementById("document-subtitle").textContent=`Basé sur le PLU de ${o}`}(t),document.getElementById("plu-content").innerHTML=t.html_content,await u(),await g(),t.source_plu_url&&(document.getElementById("source-plu-link").href=t.source_plu_url),document.getElementById("loading-state").style.display="none",document.getElementById("document-content").style.display="block"}catch(e){console.error("Error loading document:",e),L("Impossible de charger le document")}}(t),function(){document.querySelectorAll(".tab-btn").forEach((e=>{e.addEventListener("click",f)})),document.querySelectorAll("#user-rating .star-btn").forEach((e=>{e.addEventListener("click",h)})),document.querySelectorAll("#user-rating .star-btn").forEach(((e,t)=>{e.addEventListener("mouseenter",(()=>{return e=t+1,void document.querySelectorAll("#user-rating .star-btn").forEach(((t,n)=>{n<e?t.classList.add("hovered"):t.classList.remove("hovered")}));var e}))})),document.getElementById("user-rating").addEventListener("mouseleave",(()=>{y()})),document.getElementById("download-btn").addEventListener("click",v),document.getElementById("submit-comment").addEventListener("click",E),document.getElementById("comments-list").addEventListener("click",b),document.querySelector(".modal-close").addEventListener("click",w),document.getElementById("cancel-edit").addEventListener("click",w),document.getElementById("save-edit").addEventListener("click",_);const e=document.getElementById("logout-btn");e&&e.addEventListener("click",I)}(),function(){const e=document.getElementById("back-to-top");window.addEventListener("scroll",(()=>{window.scrollY>300?e.classList.add("visible"):e.classList.remove("visible")})),e.addEventListener("click",(()=>{window.scrollTo({top:0,behavior:"smooth"})}))}()}catch(e){console.error("Error initializing PLU summary page:",e),L("Erreur lors de l'initialisation de la page")}}))}},i={};function c(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}};return a[e].call(n.exports,n,n.exports,c),n.exports}c.m=a,e=[],c.O=(t,n,o,r)=>{if(!n){var a=1/0;for(s=0;s<e.length;s++){for(var[n,o,r]=e[s],i=!0,d=0;d<n.length;d++)(!1&r||a>=r)&&Object.keys(c.O).every((e=>c.O[e](n[d])))?n.splice(d--,1):(i=!1,r<a&&(a=r));if(i){e.splice(s--,1);var l=o();void 0!==l&&(t=l)}}return t}r=r||0;for(var s=e.length;s>0&&e[s-1][2]>r;s--)e[s]=e[s-1];e[s]=[n,o,r]},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,c.t=function(e,o){if(1&o&&(e=this(e)),8&o)return e;if("object"==typeof e&&e){if(4&o&&e.__esModule)return e;if(16&o&&"function"==typeof e.then)return e}var r=Object.create(null);c.r(r);var a={};t=t||[null,n({}),n([]),n(n)];for(var i=2&o&&e;"object"==typeof i&&!~t.indexOf(i);i=n(i))Object.getOwnPropertyNames(i).forEach((t=>a[t]=()=>e[t]));return a.default=()=>e,c.d(r,a),r},c.d=(e,t)=>{for(var n in t)c.o(t,n)&&!c.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},c.f={},c.e=e=>Promise.all(Object.keys(c.f).reduce(((t,n)=>(c.f[n](e,t),t)),[])),c.u=e=>"js/"+e+".chunk.js",c.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o={},r="urbandocs_webapp:",c.l=(e,t,n,a)=>{if(o[e])o[e].push(t);else{var i,d;if(void 0!==n)for(var l=document.getElementsByTagName("script"),s=0;s<l.length;s++){var u=l[s];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==r+n){i=u;break}}i||(d=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,c.nc&&i.setAttribute("nonce",c.nc),i.setAttribute("data-webpack",r+n),i.src=e),o[e]=[t];var m=(t,n)=>{i.onerror=i.onload=null,clearTimeout(g);var r=o[e];if(delete o[e],i.parentNode&&i.parentNode.removeChild(i),r&&r.forEach((e=>e(n))),t)return t(n)},g=setTimeout(m.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=m.bind(null,i.onerror),i.onload=m.bind(null,i.onload),d&&document.head.appendChild(i)}},c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.j=628,c.p="/",(()=>{var e={628:0};c.f.j=(t,n)=>{var o=c.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else{var r=new Promise(((n,r)=>o=e[t]=[n,r]));n.push(o[2]=r);var a=c.p+c.u(t),i=new Error;c.l(a,(n=>{if(c.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var r=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;i.message="Loading chunk "+t+" failed.\n("+r+": "+a+")",i.name="ChunkLoadError",i.type=r,i.request=a,o[1](i)}}),"chunk-"+t,t)}},c.O.j=t=>0===e[t];var t=(t,n)=>{var o,r,[a,i,d]=n,l=0;if(a.some((t=>0!==e[t]))){for(o in i)c.o(i,o)&&(c.m[o]=i[o]);if(d)var s=d(c)}for(t&&t(n);l<a.length;l++)r=a[l],c.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return c.O(s)},n=self.webpackChunkurbandocs_webapp=self.webpackChunkurbandocs_webapp||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var d=c.O(void 0,[76],(()=>c(5852)));d=c.O(d)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFFL0QsR0FZSDFDLEVBQW9CUyxFQUFFUSxFQUFLeUIsR0FBMEMsSUFBN0J3QyxFQUFnQnhDLEdBR3hELElBQUlpRCxFQUF1QixDQUFDQyxFQUE0QnBSLEtBQ3ZELElBR0l5TCxFQUFVeUMsR0FIVC9CLEVBQVVrRixFQUFhQyxHQUFXdFIsRUFHaEIyQixFQUFJLEVBQzNCLEdBQUd3SyxFQUFTb0YsTUFBTWpSLEdBQWdDLElBQXhCb1EsRUFBZ0JwUSxLQUFhLENBQ3RELElBQUltTCxLQUFZNEYsRUFDWjdGLEVBQW9Cc0MsRUFBRXVELEVBQWE1RixLQUNyQ0QsRUFBb0JRLEVBQUVQLEdBQVk0RixFQUFZNUYsSUFHaEQsR0FBRzZGLEVBQVMsSUFBSXBGLEVBQVNvRixFQUFROUYsRUFDbEMsQ0FFQSxJQURHNEYsR0FBNEJBLEVBQTJCcFIsR0FDckQyQixFQUFJd0ssRUFBUzVMLE9BQVFvQixJQUN6QnVNLEVBQVUvQixFQUFTeEssR0FDaEI2SixFQUFvQnNDLEVBQUU0QyxFQUFpQnhDLElBQVl3QyxFQUFnQnhDLElBQ3JFd0MsRUFBZ0J4QyxHQUFTLEtBRTFCd0MsRUFBZ0J4QyxHQUFXLEVBRTVCLE9BQU8xQyxFQUFvQlMsRUFBRUMsSUFHMUJzRixFQUFxQkMsS0FBbUMsNkJBQUlBLEtBQW1DLDhCQUFLLEdBQ3hHRCxFQUFtQnRRLFFBQVFpUSxFQUFxQmYsS0FBSyxLQUFNLElBQzNEb0IsRUFBbUJ4QyxLQUFPbUMsRUFBcUJmLEtBQUssS0FBTW9CLEVBQW1CeEMsS0FBS29CLEtBQUtvQixHLEtDbEZ2RixJQUFJRSxFQUFzQmxHLEVBQW9CUyxPQUFFTixFQUFXLENBQUMsS0FBSyxJQUFPSCxFQUFvQixRQUM1RmtHLEVBQXNCbEcsRUFBb0JTLEVBQUV5RixFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvY2h1bmsgbG9hZGVkIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2NyZWF0ZSBmYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvbG9hZCBzY3JpcHQiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC8uL3NyYy9qcy9wbHUtc3VtbWFyeS5qcyIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL2Vuc3VyZSBjaHVuayIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9nZXQgamF2YXNjcmlwdCBjaHVuayBmaWxlbmFtZSIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9nbG9iYWwiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9ydW50aW1lL21ha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9ydW50aW1lSWQiLCJ3ZWJwYWNrOi8vdXJiYW5kb2NzX3dlYmFwcC93ZWJwYWNrL3J1bnRpbWUvcHVibGljUGF0aCIsIndlYnBhY2s6Ly91cmJhbmRvY3Nfd2ViYXBwL3dlYnBhY2svcnVudGltZS9qc29ucCBjaHVuayBsb2FkaW5nIiwid2VicGFjazovL3VyYmFuZG9jc193ZWJhcHAvd2VicGFjay9zdGFydHVwIl0sInNvdXJjZXNDb250ZW50IjpbInZhciBkZWZlcnJlZCA9IFtdO1xuX193ZWJwYWNrX3JlcXVpcmVfXy5PID0gKHJlc3VsdCwgY2h1bmtJZHMsIGZuLCBwcmlvcml0eSkgPT4ge1xuXHRpZihjaHVua0lkcykge1xuXHRcdHByaW9yaXR5ID0gcHJpb3JpdHkgfHwgMDtcblx0XHRmb3IodmFyIGkgPSBkZWZlcnJlZC5sZW5ndGg7IGkgPiAwICYmIGRlZmVycmVkW2kgLSAxXVsyXSA+IHByaW9yaXR5OyBpLS0pIGRlZmVycmVkW2ldID0gZGVmZXJyZWRbaSAtIDFdO1xuXHRcdGRlZmVycmVkW2ldID0gW2NodW5rSWRzLCBmbiwgcHJpb3JpdHldO1xuXHRcdHJldHVybjtcblx0fVxuXHR2YXIgbm90RnVsZmlsbGVkID0gSW5maW5pdHk7XG5cdGZvciAodmFyIGkgPSAwOyBpIDwgZGVmZXJyZWQubGVuZ3RoOyBpKyspIHtcblx0XHR2YXIgW2NodW5rSWRzLCBmbiwgcHJpb3JpdHldID0gZGVmZXJyZWRbaV07XG5cdFx0dmFyIGZ1bGZpbGxlZCA9IHRydWU7XG5cdFx0Zm9yICh2YXIgaiA9IDA7IGogPCBjaHVua0lkcy5sZW5ndGg7IGorKykge1xuXHRcdFx0aWYgKChwcmlvcml0eSAmIDEgPT09IDAgfHwgbm90RnVsZmlsbGVkID49IHByaW9yaXR5KSAmJiBPYmplY3Qua2V5cyhfX3dlYnBhY2tfcmVxdWlyZV9fLk8pLmV2ZXJ5KChrZXkpID0+IChfX3dlYnBhY2tfcmVxdWlyZV9fLk9ba2V5XShjaHVua0lkc1tqXSkpKSkge1xuXHRcdFx0XHRjaHVua0lkcy5zcGxpY2Uoai0tLCAxKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGZ1bGZpbGxlZCA9IGZhbHNlO1xuXHRcdFx0XHRpZihwcmlvcml0eSA8IG5vdEZ1bGZpbGxlZCkgbm90RnVsZmlsbGVkID0gcHJpb3JpdHk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmKGZ1bGZpbGxlZCkge1xuXHRcdFx0ZGVmZXJyZWQuc3BsaWNlKGktLSwgMSlcblx0XHRcdHZhciByID0gZm4oKTtcblx0XHRcdGlmIChyICE9PSB1bmRlZmluZWQpIHJlc3VsdCA9IHI7XG5cdFx0fVxuXHR9XG5cdHJldHVybiByZXN1bHQ7XG59OyIsInZhciBnZXRQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiA/IChvYmopID0+IChPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqKSkgOiAob2JqKSA9PiAob2JqLl9fcHJvdG9fXyk7XG52YXIgbGVhZlByb3RvdHlwZXM7XG4vLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3Rcbi8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuLy8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4vLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3Rcbi8vIG1vZGUgJiAxNjogcmV0dXJuIHZhbHVlIHdoZW4gaXQncyBQcm9taXNlLWxpa2Vcbi8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbl9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG5cdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IHRoaXModmFsdWUpO1xuXHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuXHRpZih0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlKSB7XG5cdFx0aWYoKG1vZGUgJiA0KSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG5cdFx0aWYoKG1vZGUgJiAxNikgJiYgdHlwZW9mIHZhbHVlLnRoZW4gPT09ICdmdW5jdGlvbicpIHJldHVybiB2YWx1ZTtcblx0fVxuXHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuXHR2YXIgZGVmID0ge307XG5cdGxlYWZQcm90b3R5cGVzID0gbGVhZlByb3RvdHlwZXMgfHwgW251bGwsIGdldFByb3RvKHt9KSwgZ2V0UHJvdG8oW10pLCBnZXRQcm90byhnZXRQcm90byldO1xuXHRmb3IodmFyIGN1cnJlbnQgPSBtb2RlICYgMiAmJiB2YWx1ZTsgdHlwZW9mIGN1cnJlbnQgPT0gJ29iamVjdCcgJiYgIX5sZWFmUHJvdG90eXBlcy5pbmRleE9mKGN1cnJlbnQpOyBjdXJyZW50ID0gZ2V0UHJvdG8oY3VycmVudCkpIHtcblx0XHRPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhjdXJyZW50KS5mb3JFYWNoKChrZXkpID0+IChkZWZba2V5XSA9ICgpID0+ICh2YWx1ZVtrZXldKSkpO1xuXHR9XG5cdGRlZlsnZGVmYXVsdCddID0gKCkgPT4gKHZhbHVlKTtcblx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBkZWYpO1xuXHRyZXR1cm4gbnM7XG59OyIsInZhciBpblByb2dyZXNzID0ge307XG52YXIgZGF0YVdlYnBhY2tQcmVmaXggPSBcInVyYmFuZG9jc193ZWJhcHA6XCI7XG4vLyBsb2FkU2NyaXB0IGZ1bmN0aW9uIHRvIGxvYWQgYSBzY3JpcHQgdmlhIHNjcmlwdCB0YWdcbl9fd2VicGFja19yZXF1aXJlX18ubCA9ICh1cmwsIGRvbmUsIGtleSwgY2h1bmtJZCkgPT4ge1xuXHRpZihpblByb2dyZXNzW3VybF0pIHsgaW5Qcm9ncmVzc1t1cmxdLnB1c2goZG9uZSk7IHJldHVybjsgfVxuXHR2YXIgc2NyaXB0LCBuZWVkQXR0YWNoO1xuXHRpZihrZXkgIT09IHVuZGVmaW5lZCkge1xuXHRcdHZhciBzY3JpcHRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIik7XG5cdFx0Zm9yKHZhciBpID0gMDsgaSA8IHNjcmlwdHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdHZhciBzID0gc2NyaXB0c1tpXTtcblx0XHRcdGlmKHMuZ2V0QXR0cmlidXRlKFwic3JjXCIpID09IHVybCB8fCBzLmdldEF0dHJpYnV0ZShcImRhdGEtd2VicGFja1wiKSA9PSBkYXRhV2VicGFja1ByZWZpeCArIGtleSkgeyBzY3JpcHQgPSBzOyBicmVhazsgfVxuXHRcdH1cblx0fVxuXHRpZighc2NyaXB0KSB7XG5cdFx0bmVlZEF0dGFjaCA9IHRydWU7XG5cdFx0c2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG5cblx0XHRzY3JpcHQuY2hhcnNldCA9ICd1dGYtOCc7XG5cdFx0c2NyaXB0LnRpbWVvdXQgPSAxMjA7XG5cdFx0aWYgKF9fd2VicGFja19yZXF1aXJlX18ubmMpIHtcblx0XHRcdHNjcmlwdC5zZXRBdHRyaWJ1dGUoXCJub25jZVwiLCBfX3dlYnBhY2tfcmVxdWlyZV9fLm5jKTtcblx0XHR9XG5cdFx0c2NyaXB0LnNldEF0dHJpYnV0ZShcImRhdGEtd2VicGFja1wiLCBkYXRhV2VicGFja1ByZWZpeCArIGtleSk7XG5cblx0XHRzY3JpcHQuc3JjID0gdXJsO1xuXHR9XG5cdGluUHJvZ3Jlc3NbdXJsXSA9IFtkb25lXTtcblx0dmFyIG9uU2NyaXB0Q29tcGxldGUgPSAocHJldiwgZXZlbnQpID0+IHtcblx0XHQvLyBhdm9pZCBtZW0gbGVha3MgaW4gSUUuXG5cdFx0c2NyaXB0Lm9uZXJyb3IgPSBzY3JpcHQub25sb2FkID0gbnVsbDtcblx0XHRjbGVhclRpbWVvdXQodGltZW91dCk7XG5cdFx0dmFyIGRvbmVGbnMgPSBpblByb2dyZXNzW3VybF07XG5cdFx0ZGVsZXRlIGluUHJvZ3Jlc3NbdXJsXTtcblx0XHRzY3JpcHQucGFyZW50Tm9kZSAmJiBzY3JpcHQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChzY3JpcHQpO1xuXHRcdGRvbmVGbnMgJiYgZG9uZUZucy5mb3JFYWNoKChmbikgPT4gKGZuKGV2ZW50KSkpO1xuXHRcdGlmKHByZXYpIHJldHVybiBwcmV2KGV2ZW50KTtcblx0fVxuXHR2YXIgdGltZW91dCA9IHNldFRpbWVvdXQob25TY3JpcHRDb21wbGV0ZS5iaW5kKG51bGwsIHVuZGVmaW5lZCwgeyB0eXBlOiAndGltZW91dCcsIHRhcmdldDogc2NyaXB0IH0pLCAxMjAwMDApO1xuXHRzY3JpcHQub25lcnJvciA9IG9uU2NyaXB0Q29tcGxldGUuYmluZChudWxsLCBzY3JpcHQub25lcnJvcik7XG5cdHNjcmlwdC5vbmxvYWQgPSBvblNjcmlwdENvbXBsZXRlLmJpbmQobnVsbCwgc2NyaXB0Lm9ubG9hZCk7XG5cdG5lZWRBdHRhY2ggJiYgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpO1xufTsiLCIvLyBzcmMvanMvcGx1LXN1bW1hcnkuanNcclxuLyoqXHJcbiAqIFBMVSBTdW1tYXJ5IC0gUmVkZXNpZ25lZFxyXG4gKiBAbW9kdWxlIHBsdS1zdW1tYXJ5XHJcbiAqIEBkZXNjcmlwdGlvbiBUaGlzIG1vZHVsZSBoYW5kbGVzIHRoZSBQTFUgc3VtbWFyeSBwYWdlIHdpdGggbmV3IGRlc2lnbi5cclxuICogQHZlcnNpb24gMC4xLjBcclxuICogQGF1dGhvciBHcmV5UGFuZGFcclxuICpcclxuICogQGNoYW5nZWxvZ1xyXG4gKiAtIDAuMS4wICgyMDI1LTAxLTI5KTogQ29tcGxldGUgcmVkZXNpZ24gd2l0aCBuZXcgdGFiIHN0cnVjdHVyZSBhbmQgc3R5bGluZ1xyXG4gKiAtIDAuMC4zICgyMDI1LTAxLTI3KTogQWRkZWQgaGVhZGVyIGF1dGhlbnRpY2F0aW9uIGZvciBkeW5hbWljIGhlYWRlciB1cGRhdGVzXHJcbiAqIC0gMC4wLjIgKDIwMjUtMDUtMjcpOiBSZXdvcmsgVUkuXHJcbiAqIC0gMC4wLjEgKDIwMjUtMDUtMTYpOiBJbml0aWFsIHZlcnNpb24gd2l0aCBiYXNpYyBQTFUgc3VtbWFyeSBwYWdlLlxyXG4gKi9cclxuXHJcbmltcG9ydCB7IHN1cGFiYXNlIH0gZnJvbSBcIi4vc3VwYWJhc2UtY2xpZW50LmpzXCI7XHJcbmltcG9ydCB7IGluaXRIZWFkZXJBdXRoIH0gZnJvbSBcIi4vYXV0aC9oZWFkZXItYXV0aC5qc1wiO1xyXG5pbXBvcnQgeyBpbml0RGVsZXRpb25HdWFyZCB9IGZyb20gXCIuL2F1dGgvZGVsZXRpb24tZ3VhcmQuanNcIjtcclxuXHJcbi8vIEdsb2JhbCB2YXJpYWJsZXNcclxubGV0IGN1cnJlbnRVc2VyID0gbnVsbDtcclxubGV0IGN1cnJlbnREb2N1bWVudCA9IG51bGw7XHJcbmxldCBjdXJyZW50Q29tbWVudElkID0gbnVsbDtcclxubGV0IHJhdGluZ3NEYXRhID0gW107XHJcbmxldCB1c2VyQ3VycmVudFJhdGluZyA9IG51bGw7XHJcblxyXG4vLyBJbml0aWFsaXplIHBhZ2VcclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgYXN5bmMgKCkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBJbml0aWFsaXplIGRlbGV0aW9uIGd1YXJkIGZpcnN0IChibG9ja3MgYWNjZXNzIGlmIG5lZWRlZClcclxuICAgIGNvbnN0IGNhbkFjY2VzcyA9IGF3YWl0IGluaXREZWxldGlvbkd1YXJkKGZhbHNlKTtcclxuICAgIGlmICghY2FuQWNjZXNzKSB7XHJcbiAgICAgIHJldHVybjsgLy8gQWNjZXNzIHdhcyBibG9ja2VkLCBzdG9wIGluaXRpYWxpemF0aW9uXHJcbiAgICB9XHJcblxyXG4gICAgLy8gSW5pdGlhbGl6ZSBoZWFkZXIgYXV0aGVudGljYXRpb25cclxuICAgIGluaXRIZWFkZXJBdXRoKCk7XHJcblxyXG4gICAgLy8gQ2hlY2sgYXV0aGVudGljYXRpb25cclxuICAgIGNvbnN0IHtcclxuICAgICAgZGF0YTogeyB1c2VyIH0sXHJcbiAgICB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XHJcbiAgICBpZiAoIXVzZXIpIHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcIi9hdXRoL2xvZ2luXCI7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGN1cnJlbnRVc2VyID0gdXNlcjtcclxuXHJcbiAgICAvLyBHZXQgZG9jdW1lbnQgSUQgZnJvbSBVUkxcclxuICAgIGNvbnN0IHVybFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMod2luZG93LmxvY2F0aW9uLnNlYXJjaCk7XHJcbiAgICBjb25zdCBkb2N1bWVudElkID0gdXJsUGFyYW1zLmdldChcImlkXCIpO1xyXG5cclxuICAgIGlmICghZG9jdW1lbnRJZCkge1xyXG4gICAgICBzaG93RXJyb3IoXCJBdWN1biBkb2N1bWVudCBzcMOpY2lmacOpXCIpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgLy8gTG9hZCBkb2N1bWVudFxyXG4gICAgYXdhaXQgbG9hZERvY3VtZW50KGRvY3VtZW50SWQpO1xyXG5cclxuICAgIC8vIFNldHVwIGV2ZW50IGxpc3RlbmVyc1xyXG4gICAgc2V0dXBFdmVudExpc3RlbmVycygpO1xyXG5cclxuICAgIC8vIEluaXRpYWxpemUgYmFjayB0byB0b3AgZnVuY3Rpb25hbGl0eVxyXG4gICAgaW5pdEJhY2tUb1RvcCgpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgaW5pdGlhbGl6aW5nIFBMVSBzdW1tYXJ5IHBhZ2U6XCIsIGVycm9yKTtcclxuICAgIHNob3dFcnJvcihcIkVycmV1ciBsb3JzIGRlIGwnaW5pdGlhbGlzYXRpb24gZGUgbGEgcGFnZVwiKTtcclxuICB9XHJcbn0pO1xyXG5cclxuLy8gTG9hZCBkb2N1bWVudCBmcm9tIFN1cGFiYXNlXHJcbmFzeW5jIGZ1bmN0aW9uIGxvYWREb2N1bWVudChkb2N1bWVudElkKSB7XHJcbiAgdHJ5IHtcclxuICAgIC8vIEZldGNoIGRvY3VtZW50IHdpdGggcmVsYXRlZCBkYXRhXHJcbiAgICBjb25zdCB7IGRhdGE6IGRvY3VtZW50RGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKFwiZG9jdW1lbnRzXCIpXHJcbiAgICAgIC5zZWxlY3QoXHJcbiAgICAgICAgYFxyXG4gICAgICAgICAgaWQsXHJcbiAgICAgICAgICB6b25pbmc6em9uaW5ncyhuYW1lLCBjaXR5OmNpdGllcyhuYW1lKSksXHJcbiAgICAgICAgICB6b25lOnpvbmVzKG5hbWUpLFxyXG4gICAgICAgICAgaHRtbF9jb250ZW50LFxyXG4gICAgICAgICAgcGRmX3N0b3JhZ2VfcGF0aCxcclxuICAgICAgICAgIHNvdXJjZV9wbHVfZGF0ZSxcclxuICAgICAgICAgIHNvdXJjZV9wbHVfdXJsXHJcbiAgICAgICAgYFxyXG4gICAgICApXHJcbiAgICAgIC5lcShcImlkXCIsIGRvY3VtZW50SWQpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yO1xyXG5cclxuICAgIGN1cnJlbnREb2N1bWVudCA9IGRvY3VtZW50RGF0YTtcclxuXHJcbiAgICAvLyBVcGRhdGUgVUkgd2l0aCBkb2N1bWVudCBpbmZvXHJcbiAgICB1cGRhdGVEb2N1bWVudEluZm8oZG9jdW1lbnREYXRhKTtcclxuXHJcbiAgICAvLyBJbnNlcnQgSFRNTCBjb250ZW50XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInBsdS1jb250ZW50XCIpLmlubmVySFRNTCA9XHJcbiAgICAgIGRvY3VtZW50RGF0YS5odG1sX2NvbnRlbnQ7XHJcblxyXG4gICAgLy8gTG9hZCByYXRpbmdzXHJcbiAgICBhd2FpdCBsb2FkUmF0aW5ncygpO1xyXG5cclxuICAgIC8vIExvYWQgY29tbWVudHNcclxuICAgIGF3YWl0IGxvYWRDb21tZW50cygpO1xyXG5cclxuICAgIC8vIFVwZGF0ZSBzb3VyY2UgbGlua1xyXG4gICAgaWYgKGRvY3VtZW50RGF0YS5zb3VyY2VfcGx1X3VybCkge1xyXG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNvdXJjZS1wbHUtbGlua1wiKS5ocmVmID1cclxuICAgICAgICBkb2N1bWVudERhdGEuc291cmNlX3BsdV91cmw7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gSGlkZSBsb2FkaW5nLCBzaG93IGNvbnRlbnRcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibG9hZGluZy1zdGF0ZVwiKS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImRvY3VtZW50LWNvbnRlbnRcIikuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGxvYWRpbmcgZG9jdW1lbnQ6XCIsIGVycm9yKTtcclxuICAgIHNob3dFcnJvcihcIkltcG9zc2libGUgZGUgY2hhcmdlciBsZSBkb2N1bWVudFwiKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNhcGl0YWxpemVXb3JkcyhzdHIpIHtcclxuICBpZiAoIXN0cikgcmV0dXJuIHN0cjtcclxuICByZXR1cm4gc3RyLnJlcGxhY2UoL1xcYlxcdy9nLCAobGV0dGVyKSA9PiBsZXR0ZXIudG9VcHBlckNhc2UoKSk7XHJcbn1cclxuXHJcbi8vIFVwZGF0ZSBkb2N1bWVudCBpbmZvcm1hdGlvbiBpbiBVSVxyXG5mdW5jdGlvbiB1cGRhdGVEb2N1bWVudEluZm8oZG9jdW1lbnREYXRhKSB7XHJcbiAgY29uc3QgY2l0eU5hbWUgPSBjYXBpdGFsaXplV29yZHMoZG9jdW1lbnREYXRhLnpvbmluZy5jaXR5Lm5hbWUpO1xyXG4gIGNvbnN0IHpvbmVOYW1lID0gZG9jdW1lbnREYXRhLnpvbmUubmFtZTtcclxuICBjb25zdCBzb3VyY2VQbHVEYXRlID0gZG9jdW1lbnREYXRhLnNvdXJjZV9wbHVfZGF0ZVxyXG4gICAgPyBuZXcgRGF0ZShkb2N1bWVudERhdGEuc291cmNlX3BsdV9kYXRlKS50b0xvY2FsZURhdGVTdHJpbmcoXCJmci1GUlwiLCB7XHJcbiAgICAgICAgeWVhcjogXCJudW1lcmljXCIsXHJcbiAgICAgICAgbW9udGg6IFwibG9uZ1wiLFxyXG4gICAgICB9KVxyXG4gICAgOiBcIkRhdGUgaW5jb25udWVcIjtcclxuXHJcbiAgLy8gQnJlYWRjcnVtYlxyXG4gIGNvbnN0IGNpdHlCcmVhZGNydW1iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjaXR5LWJyZWFkY3J1bWJcIik7XHJcbiAgY2l0eUJyZWFkY3J1bWIudGV4dENvbnRlbnQgPSBjaXR5TmFtZTtcclxuICBjaXR5QnJlYWRjcnVtYi5ocmVmID0gYC9jaXR5P25hbWU9JHtlbmNvZGVVUklDb21wb25lbnQoXHJcbiAgICBkb2N1bWVudERhdGEuem9uaW5nLmNpdHkubmFtZVxyXG4gICl9YDtcclxuXHJcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ6b25lLWJyZWFkY3J1bWJcIikudGV4dENvbnRlbnQgPSBgWm9uZSAke3pvbmVOYW1lfWA7XHJcblxyXG4gIC8vIFRpdGxlIGFuZCBzdWJ0aXRsZVxyXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxyXG4gICAgXCJkb2N1bWVudC10aXRsZVwiXHJcbiAgKS50ZXh0Q29udGVudCA9IGBTeW50aMOoc2UgZHUgUExVIGRlICR7Y2l0eU5hbWV9IHBvdXIgbGEgem9uZSAke3pvbmVOYW1lfWA7XHJcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXHJcbiAgICBcImRvY3VtZW50LXN1YnRpdGxlXCJcclxuICApLnRleHRDb250ZW50ID0gYEJhc8OpIHN1ciBsZSBQTFUgZGUgJHtzb3VyY2VQbHVEYXRlfWA7XHJcbn1cclxuXHJcbi8vIExvYWQgYW5kIGRpc3BsYXkgcmF0aW5nc1xyXG5hc3luYyBmdW5jdGlvbiBsb2FkUmF0aW5ncygpIHtcclxuICB0cnkge1xyXG4gICAgLy8gR2V0IGFsbCByYXRpbmdzIGZvciB0aGlzIGRvY3VtZW50XHJcbiAgICBjb25zdCB7IGRhdGE6IHJhdGluZ3MsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbShcInJhdGluZ3NcIilcclxuICAgICAgLnNlbGVjdChcInJhdGluZywgdXNlcl9pZFwiKVxyXG4gICAgICAuZXEoXCJkb2N1bWVudF9pZFwiLCBjdXJyZW50RG9jdW1lbnQuaWQpO1xyXG5cclxuICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XHJcblxyXG4gICAgcmF0aW5nc0RhdGEgPSByYXRpbmdzIHx8IFtdO1xyXG5cclxuICAgIC8vIENhbGN1bGF0ZSBhdmVyYWdlIGFuZCBkaXN0cmlidXRpb25cclxuICAgIGlmIChyYXRpbmdzRGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGNvbnN0IGF2ZXJhZ2UgPVxyXG4gICAgICAgIHJhdGluZ3NEYXRhLnJlZHVjZSgoc3VtLCByKSA9PiBzdW0gKyByLnJhdGluZywgMCkgLyByYXRpbmdzRGF0YS5sZW5ndGg7XHJcblxyXG4gICAgICAvLyBVcGRhdGUgYXZlcmFnZSByYXRpbmcgZGlzcGxheVxyXG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImF2ZXJhZ2UtcmF0aW5nXCIpLnRleHRDb250ZW50ID1cclxuICAgICAgICBhdmVyYWdlLnRvRml4ZWQoMSk7XHJcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmF0aW5nLWNvdW50XCIpLnRleHRDb250ZW50ID0gcmF0aW5nc0RhdGEubGVuZ3RoO1xyXG5cclxuICAgICAgLy8gQ2FsY3VsYXRlIGRpc3RyaWJ1dGlvblxyXG4gICAgICBjb25zdCBkaXN0cmlidXRpb24gPSBjYWxjdWxhdGVSYXRpbmdEaXN0cmlidXRpb24ocmF0aW5nc0RhdGEpO1xyXG4gICAgICB1cGRhdGVSYXRpbmdCYXJzKGRpc3RyaWJ1dGlvbik7XHJcblxyXG4gICAgICAvLyBDaGVjayBpZiBjdXJyZW50IHVzZXIgaGFzIHJhdGVkXHJcbiAgICAgIGNvbnN0IHVzZXJSYXRpbmcgPSByYXRpbmdzRGF0YS5maW5kKChyKSA9PiByLnVzZXJfaWQgPT09IGN1cnJlbnRVc2VyLmlkKTtcclxuICAgICAgaWYgKHVzZXJSYXRpbmcpIHtcclxuICAgICAgICB1c2VyQ3VycmVudFJhdGluZyA9IHVzZXJSYXRpbmcucmF0aW5nO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHVzZXJDdXJyZW50UmF0aW5nID0gbnVsbDtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhdmVyYWdlLXJhdGluZ1wiKS50ZXh0Q29udGVudCA9IFwiMFwiO1xyXG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJhdGluZy1jb3VudFwiKS50ZXh0Q29udGVudCA9IFwiMFwiO1xyXG4gICAgICB1cGRhdGVSYXRpbmdCYXJzKHsgMTogMCwgMjogMCwgMzogMCwgNDogMCwgNTogMCB9KTtcclxuICAgICAgdXNlckN1cnJlbnRSYXRpbmcgPSBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFVwZGF0ZSBzdGFycyBkaXNwbGF5XHJcbiAgICB1cGRhdGVTdGFyc0Rpc3BsYXkoKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGxvYWRpbmcgcmF0aW5nczpcIiwgZXJyb3IpO1xyXG4gIH1cclxufVxyXG4vLyBDYWxjdWxhdGUgcmF0aW5nIGRpc3RyaWJ1dGlvblxyXG5mdW5jdGlvbiBjYWxjdWxhdGVSYXRpbmdEaXN0cmlidXRpb24ocmF0aW5ncykge1xyXG4gIGNvbnN0IGRpc3RyaWJ1dGlvbiA9IHsgMTogMCwgMjogMCwgMzogMCwgNDogMCwgNTogMCB9O1xyXG4gIHJhdGluZ3MuZm9yRWFjaCgocikgPT4ge1xyXG4gICAgZGlzdHJpYnV0aW9uW3IucmF0aW5nXSsrO1xyXG4gIH0pO1xyXG4gIHJldHVybiBkaXN0cmlidXRpb247XHJcbn1cclxuXHJcbi8vIFVwZGF0ZSByYXRpbmcgYmFyc1xyXG5mdW5jdGlvbiB1cGRhdGVSYXRpbmdCYXJzKGRpc3RyaWJ1dGlvbikge1xyXG4gIGNvbnN0IHRvdGFsID0gcmF0aW5nc0RhdGEubGVuZ3RoIHx8IDE7XHJcblxyXG4gIGZvciAobGV0IGkgPSAxOyBpIDw9IDU7IGkrKykge1xyXG4gICAgY29uc3QgcGVyY2VudGFnZSA9IChkaXN0cmlidXRpb25baV0gLyB0b3RhbCkgKiAxMDA7XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgcmF0aW5nLSR7aX1gKS5zdHlsZS53aWR0aCA9IGAke3BlcmNlbnRhZ2V9JWA7XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgcmF0aW5nLSR7aX0tcGVyY2VudGApLnRleHRDb250ZW50ID0gYCR7TWF0aC5yb3VuZChcclxuICAgICAgcGVyY2VudGFnZVxyXG4gICAgKX0lYDtcclxuICB9XHJcbn1cclxuXHJcbi8vIExvYWQgY29tbWVudHNcclxuYXN5bmMgZnVuY3Rpb24gbG9hZENvbW1lbnRzKCkge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBGaXJzdCwgZ2V0IHRoZSBjb21tZW50c1xyXG4gICAgY29uc3QgeyBkYXRhOiBjb21tZW50cywgZXJyb3I6IGNvbW1lbnRzRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKFwiY29tbWVudHNcIilcclxuICAgICAgLnNlbGVjdChcIipcIilcclxuICAgICAgLmVxKFwiZG9jdW1lbnRfaWRcIiwgY3VycmVudERvY3VtZW50LmlkKVxyXG4gICAgICAub3JkZXIoXCJjcmVhdGVkX2F0XCIsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcclxuXHJcbiAgICBpZiAoY29tbWVudHNFcnJvcikgdGhyb3cgY29tbWVudHNFcnJvcjtcclxuXHJcbiAgICBpZiAoY29tbWVudHMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHJlbmRlckNvbW1lbnRzKFtdKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdldCB1bmlxdWUgdXNlciBJRHNcclxuICAgIGNvbnN0IHVzZXJJZHMgPSBbLi4ubmV3IFNldChjb21tZW50cy5tYXAoKGMpID0+IGMudXNlcl9pZCkpXTtcclxuXHJcbiAgICAvLyBGZXRjaCBwcm9maWxlcyBmb3IgdGhvc2UgdXNlcnNcclxuICAgIGNvbnN0IHsgZGF0YTogcHJvZmlsZXMsIGVycm9yOiBwcm9maWxlc0Vycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAuZnJvbShcInByb2ZpbGVzXCIpXHJcbiAgICAgIC5zZWxlY3QoXCJpZCwgZnVsbF9uYW1lLCBhdmF0YXJfdXJsXCIpXHJcbiAgICAgIC5pbihcImlkXCIsIHVzZXJJZHMpO1xyXG5cclxuICAgIGlmIChwcm9maWxlc0Vycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybihcIkNvdWxkIG5vdCBmZXRjaCBwcm9maWxlczpcIiwgcHJvZmlsZXNFcnJvcik7XHJcbiAgICAgIGNvbnN0IGNvbW1lbnRzV2l0aG91dFByb2ZpbGVzID0gY29tbWVudHMubWFwKChjb21tZW50KSA9PiAoe1xyXG4gICAgICAgIC4uLmNvbW1lbnQsXHJcbiAgICAgICAgcHJvZmlsZXM6IG51bGwsXHJcbiAgICAgIH0pKTtcclxuICAgICAgcmVuZGVyQ29tbWVudHMoY29tbWVudHNXaXRob3V0UHJvZmlsZXMpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgLy8gTWFwIHByb2ZpbGVzIHRvIGNvbW1lbnRzXHJcbiAgICBjb25zdCBwcm9maWxlc01hcCA9IHByb2ZpbGVzLnJlZHVjZSgoYWNjLCBwcm9maWxlKSA9PiB7XHJcbiAgICAgIGFjY1twcm9maWxlLmlkXSA9IHByb2ZpbGU7XHJcbiAgICAgIHJldHVybiBhY2M7XHJcbiAgICB9LCB7fSk7XHJcblxyXG4gICAgLy8gQXR0YWNoIHByb2ZpbGVzIHRvIGNvbW1lbnRzXHJcbiAgICBjb25zdCBjb21tZW50c1dpdGhQcm9maWxlcyA9IGNvbW1lbnRzLm1hcCgoY29tbWVudCkgPT4gKHtcclxuICAgICAgLi4uY29tbWVudCxcclxuICAgICAgcHJvZmlsZXM6IHByb2ZpbGVzTWFwW2NvbW1lbnQudXNlcl9pZF0gfHwgbnVsbCxcclxuICAgIH0pKTtcclxuXHJcbiAgICAvLyBSZW5kZXIgY29tbWVudHNcclxuICAgIHJlbmRlckNvbW1lbnRzKGNvbW1lbnRzV2l0aFByb2ZpbGVzKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGxvYWRpbmcgY29tbWVudHM6XCIsIGVycm9yKTtcclxuICAgIHJlbmRlckNvbW1lbnRzKFtdKTtcclxuICB9XHJcbn1cclxuXHJcbi8vIFJlbmRlciBjb21tZW50cyBpbiBVSVxyXG5mdW5jdGlvbiByZW5kZXJDb21tZW50cyhjb21tZW50cykge1xyXG4gIGNvbnN0IGNvbW1lbnRzTGlzdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29tbWVudHMtbGlzdFwiKTtcclxuICBjb21tZW50c0xpc3QuaW5uZXJIVE1MID0gXCJcIjtcclxuXHJcbiAgaWYgKGNvbW1lbnRzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgY29tbWVudHNMaXN0LmlubmVySFRNTCA9XHJcbiAgICAgICc8cCBzdHlsZT1cInRleHQtYWxpZ246IGNlbnRlcjsgY29sb3I6IHZhcigtLXRleHQtZ3JheSk7IHBhZGRpbmc6IDJyZW07XCI+QXVjdW4gY29tbWVudGFpcmUgcG91ciBsZSBtb21lbnQuIFNveWV6IGxlIHByZW1pZXIgw6AgY29tbWVudGVyITwvcD4nO1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuXHJcbiAgY29tbWVudHMuZm9yRWFjaCgoY29tbWVudCkgPT4ge1xyXG4gICAgY29uc3QgY29tbWVudEVsID0gY3JlYXRlQ29tbWVudEVsZW1lbnQoY29tbWVudCk7XHJcbiAgICBjb21tZW50c0xpc3QuYXBwZW5kQ2hpbGQoY29tbWVudEVsKTtcclxuICB9KTtcclxufVxyXG5cclxuLy8gQ3JlYXRlIGNvbW1lbnQgZWxlbWVudFxyXG5mdW5jdGlvbiBjcmVhdGVDb21tZW50RWxlbWVudChjb21tZW50KSB7XHJcbiAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICBkaXYuY2xhc3NOYW1lID0gXCJjb21tZW50XCI7XHJcbiAgZGl2LmRhdGFzZXQuY29tbWVudElkID0gY29tbWVudC5pZDtcclxuXHJcbiAgY29uc3QgaXNPd25lciA9IGNvbW1lbnQudXNlcl9pZCA9PT0gY3VycmVudFVzZXIuaWQ7XHJcbiAgY29uc3QgdXNlck5hbWUgPSBjb21tZW50LnByb2ZpbGVzPy5mdWxsX25hbWUgfHwgXCJVdGlsaXNhdGV1ciBhbm9ueW1lXCI7XHJcbiAgY29uc3QgYXZhdGFyVXJsID1cclxuICAgIGNvbW1lbnQucHJvZmlsZXM/LmF2YXRhcl91cmwgfHwgXCJhc3NldHMvaWNvbnMvZGVmYXVsdC1hdmF0YXIuc3ZnXCI7XHJcbiAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKGNvbW1lbnQuY3JlYXRlZF9hdCkudG9Mb2NhbGVEYXRlU3RyaW5nKFwiZnItRlJcIiwge1xyXG4gICAgZGF5OiBcIm51bWVyaWNcIixcclxuICAgIG1vbnRoOiBcImxvbmdcIixcclxuICAgIHllYXI6IFwibnVtZXJpY1wiLFxyXG4gIH0pO1xyXG5cclxuICBjb25zdCBjb21tZW50SGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICBjb21tZW50SGVhZGVyLmNsYXNzTmFtZSA9IFwiY29tbWVudC1oZWFkZXJcIjtcclxuXHJcbiAgLy8gQXZhdGFyIGFuZCBtZXRhXHJcbiAgY29uc3QgYXZhdGFyTWV0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgYXZhdGFyTWV0YS5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XHJcbiAgYXZhdGFyTWV0YS5zdHlsZS5hbGlnbkl0ZW1zID0gXCJjZW50ZXJcIjtcclxuICBhdmF0YXJNZXRhLnN0eWxlLmdhcCA9IFwiMXJlbVwiO1xyXG4gIGF2YXRhck1ldGEuaW5uZXJIVE1MID0gYFxyXG4gICAgPGltZyBzcmM9XCIke2F2YXRhclVybH1cIiBhbHQ9XCIke3VzZXJOYW1lfVwiIGNsYXNzPVwiY29tbWVudC1hdmF0YXJcIj5cclxuICAgIDxkaXYgY2xhc3M9XCJjb21tZW50LW1ldGFcIj5cclxuICAgICAgPGRpdiBjbGFzcz1cImNvbW1lbnQtYXV0aG9yXCI+JHt1c2VyTmFtZX08L2Rpdj5cclxuICAgICAgPGRpdiBjbGFzcz1cImNvbW1lbnQtZGF0ZVwiPiR7ZGF0ZX0ke1xyXG4gICAgY29tbWVudC51cGRhdGVkX2F0ICE9PSBjb21tZW50LmNyZWF0ZWRfYXQgPyBcIiAobW9kaWZpw6kpXCIgOiBcIlwiXHJcbiAgfTwvZGl2PlxyXG4gICAgPC9kaXY+XHJcbiAgYDtcclxuICBjb21tZW50SGVhZGVyLmFwcGVuZENoaWxkKGF2YXRhck1ldGEpO1xyXG5cclxuICBkaXYuYXBwZW5kQ2hpbGQoY29tbWVudEhlYWRlcik7XHJcblxyXG4gIC8vIENvbW1lbnQgY29udGVudFxyXG4gIGNvbnN0IGNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gIGNvbnRlbnQuY2xhc3NOYW1lID0gXCJjb21tZW50LWNvbnRlbnRcIjtcclxuICBjb250ZW50LnRleHRDb250ZW50ID0gY29tbWVudC5jb250ZW50O1xyXG4gIGRpdi5hcHBlbmRDaGlsZChjb250ZW50KTtcclxuXHJcbiAgLy8gQWN0aW9ucyBmb3Igb3duZXJcclxuICBpZiAoaXNPd25lcikge1xyXG4gICAgY29uc3QgYWN0aW9ucyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICBhY3Rpb25zLmNsYXNzTmFtZSA9IFwiY29tbWVudC1hY3Rpb25zXCI7XHJcbiAgICBhY3Rpb25zLmlubmVySFRNTCA9IGBcclxuICAgICAgPGJ1dHRvbiBjbGFzcz1cImNvbW1lbnQtYWN0aW9uIGVkaXQtY29tbWVudFwiIGRhdGEtaWQ9XCIke2NvbW1lbnQuaWR9XCI+XHJcbiAgICAgICAgPHN2ZyB3aWR0aD1cIjE2XCIgaGVpZ2h0PVwiMTZcIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCIgZmlsbD1cIm5vbmVcIiBzdHJva2U9XCJjdXJyZW50Q29sb3JcIiBzdHJva2Utd2lkdGg9XCIyXCI+XHJcbiAgICAgICAgICA8cGF0aCBkPVwiTTExIDRINGEyIDIgMCAwIDAtMiAydjE0YTIgMiAwIDAgMCAyIDJoMTRhMiAyIDAgMCAwIDItMnYtN1wiPjwvcGF0aD5cclxuICAgICAgICAgIDxwYXRoIGQ9XCJNMTguNSAyLjVhMi4xMjEgMi4xMjEgMCAwIDEgMyAzTDEyIDE1bC00IDEgMS00IDkuNS05LjV6XCI+PC9wYXRoPlxyXG4gICAgICAgIDwvc3ZnPlxyXG4gICAgICAgIE1vZGlmaWVyXHJcbiAgICAgIDwvYnV0dG9uPlxyXG4gICAgICA8YnV0dG9uIGNsYXNzPVwiY29tbWVudC1hY3Rpb24gZGVsZXRlLWNvbW1lbnRcIiBkYXRhLWlkPVwiJHtjb21tZW50LmlkfVwiPlxyXG4gICAgICAgIDxzdmcgd2lkdGg9XCIxNlwiIGhlaWdodD1cIjE2XCIgdmlld0JveD1cIjAgMCAyNCAyNFwiIGZpbGw9XCJub25lXCIgc3Ryb2tlPVwiY3VycmVudENvbG9yXCIgc3Ryb2tlLXdpZHRoPVwiMlwiPlxyXG4gICAgICAgICAgPHBvbHlsaW5lIHBvaW50cz1cIjMgNiA1IDYgMjEgNlwiPjwvcG9seWxpbmU+XHJcbiAgICAgICAgICA8cGF0aCBkPVwiTTE5IDZ2MTRhMiAyIDAgMCAxLTIgMkg3YTIgMiAwIDAgMS0yLTJWNm0zIDBWNGEyIDIgMCAwIDEgMi0yaDRhMiAyIDAgMCAxIDIgMnYyXCI+PC9wYXRoPlxyXG4gICAgICAgIDwvc3ZnPlxyXG4gICAgICAgIFN1cHByaW1lclxyXG4gICAgICA8L2J1dHRvbj5cclxuICAgIGA7XHJcbiAgICBkaXYuYXBwZW5kQ2hpbGQoYWN0aW9ucyk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gZGl2O1xyXG59XHJcblxyXG4vLyBTZXR1cCBldmVudCBsaXN0ZW5lcnNcclxuZnVuY3Rpb24gc2V0dXBFdmVudExpc3RlbmVycygpIHtcclxuICAvLyBUYWIgc3dpdGNoaW5nXHJcbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi50YWItYnRuXCIpLmZvckVhY2goKGJ0bikgPT4ge1xyXG4gICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBzd2l0Y2hUYWIpO1xyXG4gIH0pO1xyXG5cclxuICAvLyBSYXRpbmcgc3RhcnMgY2xpY2tcclxuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiI3VzZXItcmF0aW5nIC5zdGFyLWJ0blwiKS5mb3JFYWNoKChzdGFyKSA9PiB7XHJcbiAgICBzdGFyLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVSYXRpbmcpO1xyXG4gIH0pO1xyXG5cclxuICAvLyBSYXRpbmcgc3RhcnMgaG92ZXJcclxuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiI3VzZXItcmF0aW5nIC5zdGFyLWJ0blwiKS5mb3JFYWNoKChzdGFyLCBpbmRleCkgPT4ge1xyXG4gICAgc3Rhci5hZGRFdmVudExpc3RlbmVyKFwibW91c2VlbnRlclwiLCAoKSA9PiBoYW5kbGVTdGFySG92ZXIoaW5kZXggKyAxKSk7XHJcbiAgfSk7XHJcblxyXG4gIC8vIFJlc2V0IHN0YXJzIG9uIG1vdXNlIGxlYXZlXHJcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJ1c2VyLXJhdGluZ1wiKS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLCAoKSA9PiB7XHJcbiAgICB1cGRhdGVTdGFyc0Rpc3BsYXkoKTtcclxuICB9KTtcclxuXHJcbiAgLy8gRG93bmxvYWQgYnV0dG9uXHJcbiAgZG9jdW1lbnRcclxuICAgIC5nZXRFbGVtZW50QnlJZChcImRvd25sb2FkLWJ0blwiKVxyXG4gICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVEb3dubG9hZCk7XHJcblxyXG4gIC8vIENvbW1lbnQgc3VibWlzc2lvblxyXG4gIGRvY3VtZW50XHJcbiAgICAuZ2V0RWxlbWVudEJ5SWQoXCJzdWJtaXQtY29tbWVudFwiKVxyXG4gICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBzdWJtaXRDb21tZW50KTtcclxuXHJcbiAgLy8gQ29tbWVudCBhY3Rpb25zIChkZWxlZ2F0aW9uKVxyXG4gIGRvY3VtZW50XHJcbiAgICAuZ2V0RWxlbWVudEJ5SWQoXCJjb21tZW50cy1saXN0XCIpXHJcbiAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZUNvbW1lbnRBY3Rpb24pO1xyXG5cclxuICAvLyBNb2RhbCBldmVudHNcclxuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsLWNsb3NlXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjbG9zZU1vZGFsKTtcclxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNhbmNlbC1lZGl0XCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjbG9zZU1vZGFsKTtcclxuICBkb2N1bWVudFxyXG4gICAgLmdldEVsZW1lbnRCeUlkKFwic2F2ZS1lZGl0XCIpXHJcbiAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHNhdmVDb21tZW50RWRpdCk7XHJcblxyXG4gIC8vIExvZ291dFxyXG4gIGNvbnN0IGxvZ291dEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibG9nb3V0LWJ0blwiKTtcclxuICBpZiAobG9nb3V0QnRuKSB7XHJcbiAgICBsb2dvdXRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZUxvZ291dCk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVTdGFySG92ZXIocmF0aW5nKSB7XHJcbiAgY29uc3Qgc3RhcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiI3VzZXItcmF0aW5nIC5zdGFyLWJ0blwiKTtcclxuICBzdGFycy5mb3JFYWNoKChzdGFyLCBpbmRleCkgPT4ge1xyXG4gICAgaWYgKGluZGV4IDwgcmF0aW5nKSB7XHJcbiAgICAgIHN0YXIuY2xhc3NMaXN0LmFkZChcImhvdmVyZWRcIik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzdGFyLmNsYXNzTGlzdC5yZW1vdmUoXCJob3ZlcmVkXCIpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcbi8vIEluaXRpYWxpemUgYmFjayB0byB0b3AgZnVuY3Rpb25hbGl0eVxyXG5mdW5jdGlvbiBpbml0QmFja1RvVG9wKCkge1xyXG4gIGNvbnN0IGJhY2tUb1RvcEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYmFjay10by10b3BcIik7XHJcblxyXG4gIC8vIFNob3cvaGlkZSBidXR0b24gYmFzZWQgb24gc2Nyb2xsIHBvc2l0aW9uXHJcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJzY3JvbGxcIiwgKCkgPT4ge1xyXG4gICAgaWYgKHdpbmRvdy5zY3JvbGxZID4gMzAwKSB7XHJcbiAgICAgIGJhY2tUb1RvcEJ0bi5jbGFzc0xpc3QuYWRkKFwidmlzaWJsZVwiKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGJhY2tUb1RvcEJ0bi5jbGFzc0xpc3QucmVtb3ZlKFwidmlzaWJsZVwiKTtcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgLy8gU21vb3RoIHNjcm9sbCB0byB0b3BcclxuICBiYWNrVG9Ub3BCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgIHdpbmRvdy5zY3JvbGxUbyh7XHJcbiAgICAgIHRvcDogMCxcclxuICAgICAgYmVoYXZpb3I6IFwic21vb3RoXCIsXHJcbiAgICB9KTtcclxuICB9KTtcclxufVxyXG5cclxuLy8gU3dpdGNoIHRhYnNcclxuZnVuY3Rpb24gc3dpdGNoVGFiKGUpIHtcclxuICBjb25zdCB0YXJnZXRUYWIgPSBlLnRhcmdldC5kYXRhc2V0LnRhYjtcclxuXHJcbiAgLy8gVXBkYXRlIGFjdGl2ZSBzdGF0ZXNcclxuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnRhYi1idG5cIikuZm9yRWFjaCgoYnRuKSA9PiB7XHJcbiAgICBidG4uY2xhc3NMaXN0LnRvZ2dsZShcImFjdGl2ZVwiLCBidG4uZGF0YXNldC50YWIgPT09IHRhcmdldFRhYik7XHJcbiAgfSk7XHJcblxyXG4gIC8vIFNob3cvaGlkZSBjb250ZW50XHJcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzeW50aGVzZS10YWJcIikuc3R5bGUuZGlzcGxheSA9XHJcbiAgICB0YXJnZXRUYWIgPT09IFwic3ludGhlc2VcIiA/IFwiYmxvY2tcIiA6IFwibm9uZVwiO1xyXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29tbWVudGFpcmVzLXRhYlwiKS5zdHlsZS5kaXNwbGF5ID1cclxuICAgIHRhcmdldFRhYiA9PT0gXCJjb21tZW50YWlyZXNcIiA/IFwiYmxvY2tcIiA6IFwibm9uZVwiO1xyXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic291cmNlcy10YWJcIikuc3R5bGUuZGlzcGxheSA9XHJcbiAgICB0YXJnZXRUYWIgPT09IFwic291cmNlc1wiID8gXCJibG9ja1wiIDogXCJub25lXCI7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHVwZGF0ZVN0YXJzRGlzcGxheSgpIHtcclxuICBjb25zdCBzdGFycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIjdXNlci1yYXRpbmcgLnN0YXItYnRuXCIpO1xyXG5cclxuICAvLyBJZiB1c2VyIGhhcyBhIHJhdGluZywgc2hvdyBpdFxyXG4gIGlmICh1c2VyQ3VycmVudFJhdGluZykge1xyXG4gICAgc3RhcnMuZm9yRWFjaCgoc3RhciwgaW5kZXgpID0+IHtcclxuICAgICAgc3Rhci5jbGFzc0xpc3QudG9nZ2xlKFwic2VsZWN0ZWRcIiwgaW5kZXggPCB1c2VyQ3VycmVudFJhdGluZyk7XHJcbiAgICAgIHN0YXIuY2xhc3NMaXN0LnJlbW92ZShcImhvdmVyZWRcIik7XHJcbiAgICAgIHN0YXIuc2V0QXR0cmlidXRlKFwiZGF0YS1zdGFyLXR5cGVcIiwgXCJmdWxsXCIpO1xyXG4gICAgfSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIC8vIFNob3cgYXZlcmFnZSByYXRpbmcgd2l0aCBoYWxmIHN0YXJzXHJcbiAgICBjb25zdCBhdmdSYXRpbmcgPSBwYXJzZUZsb2F0KFxyXG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImF2ZXJhZ2UtcmF0aW5nXCIpLnRleHRDb250ZW50XHJcbiAgICApO1xyXG4gICAgaWYgKCFpc05hTihhdmdSYXRpbmcpICYmIGF2Z1JhdGluZyA+IDApIHtcclxuICAgICAgZGlzcGxheUF2ZXJhZ2VSYXRpbmcoYXZnUmF0aW5nKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIE5vIHJhdGluZ3MgYXQgYWxsLCBzaG93IGVtcHR5IHN0YXJzXHJcbiAgICAgIHN0YXJzLmZvckVhY2goKHN0YXIpID0+IHtcclxuICAgICAgICBzdGFyLmNsYXNzTGlzdC5yZW1vdmUoXCJzZWxlY3RlZFwiLCBcImhvdmVyZWRcIik7XHJcbiAgICAgICAgc3Rhci5zZXRBdHRyaWJ1dGUoXCJkYXRhLXN0YXItdHlwZVwiLCBcImVtcHR5XCIpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbi8vIEhhbmRsZSByYXRpbmdcclxuYXN5bmMgZnVuY3Rpb24gaGFuZGxlUmF0aW5nKGUpIHtcclxuICBjb25zdCByYXRpbmcgPSBwYXJzZUludChlLnRhcmdldC5kYXRhc2V0LnJhdGluZyk7XHJcblxyXG4gIC8vIElmIGNsaWNraW5nIG9uIHRoZSBzYW1lIHJhdGluZywgcmVtb3ZlIGl0XHJcbiAgaWYgKHVzZXJDdXJyZW50UmF0aW5nID09PSByYXRpbmcpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIERlbGV0ZSB0aGUgcmF0aW5nXHJcbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oXCJyYXRpbmdzXCIpXHJcbiAgICAgICAgLmRlbGV0ZSgpXHJcbiAgICAgICAgLmVxKFwiZG9jdW1lbnRfaWRcIiwgY3VycmVudERvY3VtZW50LmlkKVxyXG4gICAgICAgIC5lcShcInVzZXJfaWRcIiwgY3VycmVudFVzZXIuaWQpO1xyXG5cclxuICAgICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcclxuXHJcbiAgICAgIHVzZXJDdXJyZW50UmF0aW5nID0gbnVsbDtcclxuXHJcbiAgICAgIC8vIFJlbG9hZCByYXRpbmdzIHRvIHVwZGF0ZSBhdmVyYWdlXHJcbiAgICAgIGF3YWl0IGxvYWRSYXRpbmdzKCk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmVtb3ZpbmcgcmF0aW5nOlwiLCBlcnJvcik7XHJcbiAgICAgIGFsZXJ0KFwiRXJyZXVyIGxvcnMgZGUgbGEgc3VwcHJlc3Npb24gZGUgdm90cmUgbm90ZVwiKTtcclxuICAgIH1cclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIC8vIE90aGVyd2lzZSwgc2V0L3VwZGF0ZSB0aGUgcmF0aW5nXHJcbiAgdHJ5IHtcclxuICAgIC8vIENoZWNrIGlmIHVzZXIgYWxyZWFkeSByYXRlZFxyXG4gICAgY29uc3QgeyBkYXRhOiBleGlzdGluZyB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oXCJyYXRpbmdzXCIpXHJcbiAgICAgIC5zZWxlY3QoXCJpZFwiKVxyXG4gICAgICAuZXEoXCJkb2N1bWVudF9pZFwiLCBjdXJyZW50RG9jdW1lbnQuaWQpXHJcbiAgICAgIC5lcShcInVzZXJfaWRcIiwgY3VycmVudFVzZXIuaWQpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuXHJcbiAgICBpZiAoZXhpc3RpbmcpIHtcclxuICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIHJhdGluZ1xyXG4gICAgICBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKFwicmF0aW5nc1wiKVxyXG4gICAgICAgIC51cGRhdGUoeyByYXRpbmcsIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSB9KVxyXG4gICAgICAgIC5lcShcImlkXCIsIGV4aXN0aW5nLmlkKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIEluc2VydCBuZXcgcmF0aW5nXHJcbiAgICAgIGF3YWl0IHN1cGFiYXNlLmZyb20oXCJyYXRpbmdzXCIpLmluc2VydCh7XHJcbiAgICAgICAgZG9jdW1lbnRfaWQ6IGN1cnJlbnREb2N1bWVudC5pZCxcclxuICAgICAgICB1c2VyX2lkOiBjdXJyZW50VXNlci5pZCxcclxuICAgICAgICByYXRpbmcsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHVzZXJDdXJyZW50UmF0aW5nID0gcmF0aW5nO1xyXG5cclxuICAgIC8vIFJlbG9hZCByYXRpbmdzIHRvIHVwZGF0ZSBhdmVyYWdlXHJcbiAgICBhd2FpdCBsb2FkUmF0aW5ncygpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmF0aW5nIGRvY3VtZW50OlwiLCBlcnJvcik7XHJcbiAgICBhbGVydChcIkVycmV1ciBsb3JzIGRlIGwnZW5yZWdpc3RyZW1lbnQgZGUgdm90cmUgbm90ZVwiKTtcclxuICB9XHJcbn1cclxuXHJcbi8vIEhhbmRsZSBkb3dubG9hZFxyXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVEb3dubG9hZCgpIHtcclxuICB0cnkge1xyXG4gICAgY29uc29sZS5sb2coXCJQREYgc3RvcmFnZSBwYXRoOlwiLCBjdXJyZW50RG9jdW1lbnQucGRmX3N0b3JhZ2VfcGF0aCk7XHJcblxyXG4gICAgLy8gUmVtb3ZlIGFueSBsZWFkaW5nIHNsYXNoZXMgaWYgcHJlc2VudFxyXG4gICAgY29uc3QgY2xlYW5QYXRoID0gY3VycmVudERvY3VtZW50LnBkZl9zdG9yYWdlX3BhdGgucmVwbGFjZSgvXlxcLy8sIFwiXCIpO1xyXG5cclxuICAgIC8vIEdldCBkb3dubG9hZCBVUkwgZnJvbSBTdXBhYmFzZSBTdG9yYWdlIHdpdGggZG93bmxvYWQgcGFyYW1ldGVyXHJcbiAgICBjb25zdCB7IGRhdGE6IHVybERhdGEsIGVycm9yOiB1cmxFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Uuc3RvcmFnZVxyXG4gICAgICAuZnJvbShcInBkZnNcIilcclxuICAgICAgLmNyZWF0ZVNpZ25lZFVybChjbGVhblBhdGgsIDYwLCB7XHJcbiAgICAgICAgZG93bmxvYWQ6IHRydWUsIC8vIFRoaXMgZm9yY2VzIHRoZSBkb3dubG9hZCBiZWhhdmlvclxyXG4gICAgICB9KTtcclxuXHJcbiAgICBpZiAodXJsRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIlVSTCBFcnJvciBkZXRhaWxzOlwiLCB1cmxFcnJvcik7XHJcbiAgICAgIHRocm93IHVybEVycm9yO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFRyYWNrIGRvd25sb2FkXHJcbiAgICBhd2FpdCBzdXBhYmFzZS5mcm9tKFwiZG93bmxvYWRzXCIpLmluc2VydCh7XHJcbiAgICAgIGRvY3VtZW50X2lkOiBjdXJyZW50RG9jdW1lbnQuaWQsXHJcbiAgICAgIHVzZXJfaWQ6IGN1cnJlbnRVc2VyLmlkLFxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gVHJpZ2dlciBkb3dubG9hZFxyXG4gICAgY29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpO1xyXG4gICAgYS5ocmVmID0gdXJsRGF0YS5zaWduZWRVcmw7XHJcbiAgICBhLmRvd25sb2FkID0gYFBMVV8ke2N1cnJlbnREb2N1bWVudC56b25pbmcuY2l0eS5uYW1lfV8ke2N1cnJlbnREb2N1bWVudC56b25lLm5hbWV9LnBkZmA7XHJcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGEpOyAvLyBBZGQgdG8gRE9NXHJcbiAgICBhLmNsaWNrKCk7XHJcbiAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGEpOyAvLyBSZW1vdmUgZnJvbSBET01cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGRvd25sb2FkaW5nIGRvY3VtZW50OlwiLCBlcnJvcik7XHJcblxyXG4gICAgaWYgKGVycm9yLm1lc3NhZ2UgJiYgZXJyb3IubWVzc2FnZS5pbmNsdWRlcyhcIk9iamVjdCBub3QgZm91bmRcIikpIHtcclxuICAgICAgYWxlcnQoXHJcbiAgICAgICAgXCJMZSBmaWNoaWVyIFBERiBuJ2EgcGFzIMOpdMOpIHRyb3V2w6kuIFZldWlsbGV6IGNvbnRhY3RlciBsJ2FkbWluaXN0cmF0ZXVyLlwiXHJcbiAgICAgICk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBhbGVydChcIkVycmV1ciBsb3JzIGR1IHTDqWzDqWNoYXJnZW1lbnRcIik7XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG4vLyBTdWJtaXQgY29tbWVudFxyXG5hc3luYyBmdW5jdGlvbiBzdWJtaXRDb21tZW50KCkge1xyXG4gIGNvbnN0IGNvbnRlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbW1lbnQtaW5wdXRcIikudmFsdWUudHJpbSgpO1xyXG5cclxuICBpZiAoIWNvbnRlbnQpIHtcclxuICAgIGFsZXJ0KFwiVmV1aWxsZXogZW50cmVyIHVuIGNvbW1lbnRhaXJlXCIpO1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oXCJjb21tZW50c1wiKS5pbnNlcnQoe1xyXG4gICAgICBkb2N1bWVudF9pZDogY3VycmVudERvY3VtZW50LmlkLFxyXG4gICAgICB1c2VyX2lkOiBjdXJyZW50VXNlci5pZCxcclxuICAgICAgY29udGVudCxcclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChlcnJvcikgdGhyb3cgZXJyb3I7XHJcblxyXG4gICAgLy8gQ2xlYXIgaW5wdXRcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29tbWVudC1pbnB1dFwiKS52YWx1ZSA9IFwiXCI7XHJcblxyXG4gICAgLy8gUmVsb2FkIGNvbW1lbnRzXHJcbiAgICBhd2FpdCBsb2FkQ29tbWVudHMoKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIHN1Ym1pdHRpbmcgY29tbWVudDpcIiwgZXJyb3IpO1xyXG4gICAgYWxlcnQoXCJFcnJldXIgbG9ycyBkZSBsYSBwdWJsaWNhdGlvbiBkdSBjb21tZW50YWlyZVwiKTtcclxuICB9XHJcbn1cclxuXHJcbi8vIEhhbmRsZSBjb21tZW50IGFjdGlvbnNcclxuZnVuY3Rpb24gaGFuZGxlQ29tbWVudEFjdGlvbihlKSB7XHJcbiAgY29uc3QgZWRpdEJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoXCIuZWRpdC1jb21tZW50XCIpO1xyXG4gIGNvbnN0IGRlbGV0ZUJ0biA9IGUudGFyZ2V0LmNsb3Nlc3QoXCIuZGVsZXRlLWNvbW1lbnRcIik7XHJcblxyXG4gIGlmIChlZGl0QnRuKSB7XHJcbiAgICBvcGVuRWRpdE1vZGFsKGVkaXRCdG4uZGF0YXNldC5pZCk7XHJcbiAgfSBlbHNlIGlmIChkZWxldGVCdG4pIHtcclxuICAgIGRlbGV0ZUNvbW1lbnQoZGVsZXRlQnRuLmRhdGFzZXQuaWQpO1xyXG4gIH1cclxufVxyXG5cclxuLy8gT3BlbiBlZGl0IG1vZGFsXHJcbmFzeW5jIGZ1bmN0aW9uIG9wZW5FZGl0TW9kYWwoY29tbWVudElkKSB7XHJcbiAgY3VycmVudENvbW1lbnRJZCA9IGNvbW1lbnRJZDtcclxuXHJcbiAgLy8gR2V0IGNvbW1lbnQgY29udGVudFxyXG4gIGNvbnN0IHsgZGF0YTogY29tbWVudCB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgIC5mcm9tKFwiY29tbWVudHNcIilcclxuICAgIC5zZWxlY3QoXCJjb250ZW50XCIpXHJcbiAgICAuZXEoXCJpZFwiLCBjb21tZW50SWQpXHJcbiAgICAuc2luZ2xlKCk7XHJcblxyXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZWRpdC1jb21tZW50LWlucHV0XCIpLnZhbHVlID0gY29tbWVudC5jb250ZW50O1xyXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZWRpdC1tb2RhbFwiKS5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XHJcbn1cclxuXHJcbi8vIENsb3NlIG1vZGFsXHJcbmZ1bmN0aW9uIGNsb3NlTW9kYWwoKSB7XHJcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJlZGl0LW1vZGFsXCIpLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICBjdXJyZW50Q29tbWVudElkID0gbnVsbDtcclxufVxyXG5cclxuLy8gU2F2ZSBjb21tZW50IGVkaXRcclxuYXN5bmMgZnVuY3Rpb24gc2F2ZUNvbW1lbnRFZGl0KCkge1xyXG4gIGNvbnN0IGNvbnRlbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImVkaXQtY29tbWVudC1pbnB1dFwiKS52YWx1ZS50cmltKCk7XHJcblxyXG4gIGlmICghY29udGVudCkge1xyXG4gICAgYWxlcnQoXCJMZSBjb21tZW50YWlyZSBuZSBwZXV0IHBhcyDDqnRyZSB2aWRlXCIpO1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuXHJcbiAgdHJ5IHtcclxuICAgIGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgIC5mcm9tKFwiY29tbWVudHNcIilcclxuICAgICAgLnVwZGF0ZSh7XHJcbiAgICAgICAgY29udGVudCxcclxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXHJcbiAgICAgIH0pXHJcbiAgICAgIC5lcShcImlkXCIsIGN1cnJlbnRDb21tZW50SWQpO1xyXG5cclxuICAgIGNsb3NlTW9kYWwoKTtcclxuICAgIGF3YWl0IGxvYWRDb21tZW50cygpO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgdXBkYXRpbmcgY29tbWVudDpcIiwgZXJyb3IpO1xyXG4gICAgYWxlcnQoXCJFcnJldXIgbG9ycyBkZSBsYSBtb2RpZmljYXRpb25cIik7XHJcbiAgfVxyXG59XHJcblxyXG4vLyBEZWxldGUgY29tbWVudFxyXG5hc3luYyBmdW5jdGlvbiBkZWxldGVDb21tZW50KGNvbW1lbnRJZCkge1xyXG4gIGlmICghY29uZmlybShcIsOKdGVzLXZvdXMgc8O7ciBkZSB2b3Vsb2lyIHN1cHByaW1lciBjZSBjb21tZW50YWlyZT9cIikpIHtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIHRyeSB7XHJcbiAgICAvLyBVc2UgdGhlIHNvZnQgZGVsZXRlIGZ1bmN0aW9uIGluc3RlYWQgb2YgZGlyZWN0IGRlbGV0aW9uXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5ycGMoXCJzb2Z0X2RlbGV0ZV9jb21tZW50XCIsIHtcclxuICAgICAgY29tbWVudF9pZDogY29tbWVudElkLFxyXG4gICAgICB1c2VyX2lkOiBjdXJyZW50VXNlci5pZCxcclxuICAgIH0pO1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICB0aHJvdyBlcnJvcjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTaG93IHN1Y2Nlc3MgbWVzc2FnZSB3aXRoIGluZm9ybWF0aW9uIGFib3V0IHJlY292ZXJ5IHBlcmlvZFxyXG4gICAgYWxlcnQoXHJcbiAgICAgIFwiQ29tbWVudGFpcmUgc3VwcHJpbcOpLiBJbCBzZXJhIGTDqWZpbml0aXZlbWVudCBzdXBwcmltw6kgZGFucyAzMCBqb3Vycy4gQ29udGFjdGV6IGxlIHN1cHBvcnQgc2kgdm91cyBzb3VoYWl0ZXogbGUgcsOpY3Vww6lyZXIuXCJcclxuICAgICk7XHJcblxyXG4gICAgYXdhaXQgbG9hZENvbW1lbnRzKCk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkZWxldGluZyBjb21tZW50OlwiLCBlcnJvcik7XHJcbiAgICBhbGVydChcIkVycmV1ciBsb3JzIGRlIGxhIHN1cHByZXNzaW9uXCIpO1xyXG4gIH1cclxufVxyXG5cclxuLy8gSGFuZGxlIGxvZ291dFxyXG5hc3luYyBmdW5jdGlvbiBoYW5kbGVMb2dvdXQoKSB7XHJcbiAgYXdhaXQgc3VwYWJhc2UuYXV0aC5zaWduT3V0KCk7XHJcbiAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBcIi9hdXRoL2xvZ2luXCI7XHJcbn1cclxuXHJcbi8vIFNob3cgZXJyb3Igc3RhdGVcclxuZnVuY3Rpb24gc2hvd0Vycm9yKG1lc3NhZ2UpIHtcclxuICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImxvYWRpbmctc3RhdGVcIikuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZXJyb3ItbWVzc2FnZVwiKS50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XHJcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJlcnJvci1zdGF0ZVwiKS5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XHJcbn1cclxuXHJcbi8vIFV0aWxpdHkgZnVuY3Rpb24gdG8gZXNjYXBlIEhUTUxcclxuZnVuY3Rpb24gZXNjYXBlSHRtbCh0ZXh0KSB7XHJcbiAgY29uc3QgbWFwID0ge1xyXG4gICAgXCImXCI6IFwiJmFtcDtcIixcclxuICAgIFwiPFwiOiBcIiZsdDtcIixcclxuICAgIFwiPlwiOiBcIiZndDtcIixcclxuICAgICdcIic6IFwiJnF1b3Q7XCIsXHJcbiAgICBcIidcIjogXCImIzAzOTtcIixcclxuICB9O1xyXG4gIHJldHVybiB0ZXh0LnJlcGxhY2UoL1smPD5cIiddL2csIChtKSA9PiBtYXBbbV0pO1xyXG59XHJcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4vLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuX193ZWJwYWNrX3JlcXVpcmVfXy5tID0gX193ZWJwYWNrX21vZHVsZXNfXztcblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5mID0ge307XG4vLyBUaGlzIGZpbGUgY29udGFpbnMgb25seSB0aGUgZW50cnkgY2h1bmsuXG4vLyBUaGUgY2h1bmsgbG9hZGluZyBmdW5jdGlvbiBmb3IgYWRkaXRpb25hbCBjaHVua3Ncbl9fd2VicGFja19yZXF1aXJlX18uZSA9IChjaHVua0lkKSA9PiB7XG5cdHJldHVybiBQcm9taXNlLmFsbChPYmplY3Qua2V5cyhfX3dlYnBhY2tfcmVxdWlyZV9fLmYpLnJlZHVjZSgocHJvbWlzZXMsIGtleSkgPT4ge1xuXHRcdF9fd2VicGFja19yZXF1aXJlX18uZltrZXldKGNodW5rSWQsIHByb21pc2VzKTtcblx0XHRyZXR1cm4gcHJvbWlzZXM7XG5cdH0sIFtdKSk7XG59OyIsIi8vIFRoaXMgZnVuY3Rpb24gYWxsb3cgdG8gcmVmZXJlbmNlIGFzeW5jIGNodW5rc1xuX193ZWJwYWNrX3JlcXVpcmVfXy51ID0gKGNodW5rSWQpID0+IHtcblx0Ly8gcmV0dXJuIHVybCBmb3IgZmlsZW5hbWVzIGJhc2VkIG9uIHRlbXBsYXRlXG5cdHJldHVybiBcImpzL1wiICsgY2h1bmtJZCArIFwiLmNodW5rLmpzXCI7XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18uZyA9IChmdW5jdGlvbigpIHtcblx0aWYgKHR5cGVvZiBnbG9iYWxUaGlzID09PSAnb2JqZWN0JykgcmV0dXJuIGdsb2JhbFRoaXM7XG5cdHRyeSB7XG5cdFx0cmV0dXJuIHRoaXMgfHwgbmV3IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7XG5cdH0gY2F0Y2ggKGUpIHtcblx0XHRpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcpIHJldHVybiB3aW5kb3c7XG5cdH1cbn0pKCk7IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18uaiA9IDYyODsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIi9cIjsiLCIvLyBubyBiYXNlVVJJXG5cbi8vIG9iamVjdCB0byBzdG9yZSBsb2FkZWQgYW5kIGxvYWRpbmcgY2h1bmtzXG4vLyB1bmRlZmluZWQgPSBjaHVuayBub3QgbG9hZGVkLCBudWxsID0gY2h1bmsgcHJlbG9hZGVkL3ByZWZldGNoZWRcbi8vIFtyZXNvbHZlLCByZWplY3QsIFByb21pc2VdID0gY2h1bmsgbG9hZGluZywgMCA9IGNodW5rIGxvYWRlZFxudmFyIGluc3RhbGxlZENodW5rcyA9IHtcblx0NjI4OiAwXG59O1xuXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmYuaiA9IChjaHVua0lkLCBwcm9taXNlcykgPT4ge1xuXHRcdC8vIEpTT05QIGNodW5rIGxvYWRpbmcgZm9yIGphdmFzY3JpcHRcblx0XHR2YXIgaW5zdGFsbGVkQ2h1bmtEYXRhID0gX193ZWJwYWNrX3JlcXVpcmVfXy5vKGluc3RhbGxlZENodW5rcywgY2h1bmtJZCkgPyBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF0gOiB1bmRlZmluZWQ7XG5cdFx0aWYoaW5zdGFsbGVkQ2h1bmtEYXRhICE9PSAwKSB7IC8vIDAgbWVhbnMgXCJhbHJlYWR5IGluc3RhbGxlZFwiLlxuXG5cdFx0XHQvLyBhIFByb21pc2UgbWVhbnMgXCJjdXJyZW50bHkgbG9hZGluZ1wiLlxuXHRcdFx0aWYoaW5zdGFsbGVkQ2h1bmtEYXRhKSB7XG5cdFx0XHRcdHByb21pc2VzLnB1c2goaW5zdGFsbGVkQ2h1bmtEYXRhWzJdKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmKHRydWUpIHsgLy8gYWxsIGNodW5rcyBoYXZlIEpTXG5cdFx0XHRcdFx0Ly8gc2V0dXAgUHJvbWlzZSBpbiBjaHVuayBjYWNoZVxuXHRcdFx0XHRcdHZhciBwcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gKGluc3RhbGxlZENodW5rRGF0YSA9IGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA9IFtyZXNvbHZlLCByZWplY3RdKSk7XG5cdFx0XHRcdFx0cHJvbWlzZXMucHVzaChpbnN0YWxsZWRDaHVua0RhdGFbMl0gPSBwcm9taXNlKTtcblxuXHRcdFx0XHRcdC8vIHN0YXJ0IGNodW5rIGxvYWRpbmdcblx0XHRcdFx0XHR2YXIgdXJsID0gX193ZWJwYWNrX3JlcXVpcmVfXy5wICsgX193ZWJwYWNrX3JlcXVpcmVfXy51KGNodW5rSWQpO1xuXHRcdFx0XHRcdC8vIGNyZWF0ZSBlcnJvciBiZWZvcmUgc3RhY2sgdW53b3VuZCB0byBnZXQgdXNlZnVsIHN0YWNrdHJhY2UgbGF0ZXJcblx0XHRcdFx0XHR2YXIgZXJyb3IgPSBuZXcgRXJyb3IoKTtcblx0XHRcdFx0XHR2YXIgbG9hZGluZ0VuZGVkID0gKGV2ZW50KSA9PiB7XG5cdFx0XHRcdFx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oaW5zdGFsbGVkQ2h1bmtzLCBjaHVua0lkKSkge1xuXHRcdFx0XHRcdFx0XHRpbnN0YWxsZWRDaHVua0RhdGEgPSBpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF07XG5cdFx0XHRcdFx0XHRcdGlmKGluc3RhbGxlZENodW5rRGF0YSAhPT0gMCkgaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdID0gdW5kZWZpbmVkO1xuXHRcdFx0XHRcdFx0XHRpZihpbnN0YWxsZWRDaHVua0RhdGEpIHtcblx0XHRcdFx0XHRcdFx0XHR2YXIgZXJyb3JUeXBlID0gZXZlbnQgJiYgKGV2ZW50LnR5cGUgPT09ICdsb2FkJyA/ICdtaXNzaW5nJyA6IGV2ZW50LnR5cGUpO1xuXHRcdFx0XHRcdFx0XHRcdHZhciByZWFsU3JjID0gZXZlbnQgJiYgZXZlbnQudGFyZ2V0ICYmIGV2ZW50LnRhcmdldC5zcmM7XG5cdFx0XHRcdFx0XHRcdFx0ZXJyb3IubWVzc2FnZSA9ICdMb2FkaW5nIGNodW5rICcgKyBjaHVua0lkICsgJyBmYWlsZWQuXFxuKCcgKyBlcnJvclR5cGUgKyAnOiAnICsgcmVhbFNyYyArICcpJztcblx0XHRcdFx0XHRcdFx0XHRlcnJvci5uYW1lID0gJ0NodW5rTG9hZEVycm9yJztcblx0XHRcdFx0XHRcdFx0XHRlcnJvci50eXBlID0gZXJyb3JUeXBlO1xuXHRcdFx0XHRcdFx0XHRcdGVycm9yLnJlcXVlc3QgPSByZWFsU3JjO1xuXHRcdFx0XHRcdFx0XHRcdGluc3RhbGxlZENodW5rRGF0YVsxXShlcnJvcik7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdF9fd2VicGFja19yZXF1aXJlX18ubCh1cmwsIGxvYWRpbmdFbmRlZCwgXCJjaHVuay1cIiArIGNodW5rSWQsIGNodW5rSWQpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxufTtcblxuLy8gbm8gcHJlZmV0Y2hpbmdcblxuLy8gbm8gcHJlbG9hZGVkXG5cbi8vIG5vIEhNUlxuXG4vLyBubyBITVIgbWFuaWZlc3RcblxuX193ZWJwYWNrX3JlcXVpcmVfXy5PLmogPSAoY2h1bmtJZCkgPT4gKGluc3RhbGxlZENodW5rc1tjaHVua0lkXSA9PT0gMCk7XG5cbi8vIGluc3RhbGwgYSBKU09OUCBjYWxsYmFjayBmb3IgY2h1bmsgbG9hZGluZ1xudmFyIHdlYnBhY2tKc29ucENhbGxiYWNrID0gKHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uLCBkYXRhKSA9PiB7XG5cdHZhciBbY2h1bmtJZHMsIG1vcmVNb2R1bGVzLCBydW50aW1lXSA9IGRhdGE7XG5cdC8vIGFkZCBcIm1vcmVNb2R1bGVzXCIgdG8gdGhlIG1vZHVsZXMgb2JqZWN0LFxuXHQvLyB0aGVuIGZsYWcgYWxsIFwiY2h1bmtJZHNcIiBhcyBsb2FkZWQgYW5kIGZpcmUgY2FsbGJhY2tcblx0dmFyIG1vZHVsZUlkLCBjaHVua0lkLCBpID0gMDtcblx0aWYoY2h1bmtJZHMuc29tZSgoaWQpID0+IChpbnN0YWxsZWRDaHVua3NbaWRdICE9PSAwKSkpIHtcblx0XHRmb3IobW9kdWxlSWQgaW4gbW9yZU1vZHVsZXMpIHtcblx0XHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhtb3JlTW9kdWxlcywgbW9kdWxlSWQpKSB7XG5cdFx0XHRcdF9fd2VicGFja19yZXF1aXJlX18ubVttb2R1bGVJZF0gPSBtb3JlTW9kdWxlc1ttb2R1bGVJZF07XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGlmKHJ1bnRpbWUpIHZhciByZXN1bHQgPSBydW50aW1lKF9fd2VicGFja19yZXF1aXJlX18pO1xuXHR9XG5cdGlmKHBhcmVudENodW5rTG9hZGluZ0Z1bmN0aW9uKSBwYXJlbnRDaHVua0xvYWRpbmdGdW5jdGlvbihkYXRhKTtcblx0Zm9yKDtpIDwgY2h1bmtJZHMubGVuZ3RoOyBpKyspIHtcblx0XHRjaHVua0lkID0gY2h1bmtJZHNbaV07XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGluc3RhbGxlZENodW5rcywgY2h1bmtJZCkgJiYgaW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdKSB7XG5cdFx0XHRpbnN0YWxsZWRDaHVua3NbY2h1bmtJZF1bMF0oKTtcblx0XHR9XG5cdFx0aW5zdGFsbGVkQ2h1bmtzW2NodW5rSWRdID0gMDtcblx0fVxuXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXy5PKHJlc3VsdCk7XG59XG5cbnZhciBjaHVua0xvYWRpbmdHbG9iYWwgPSBzZWxmW1wid2VicGFja0NodW5rdXJiYW5kb2NzX3dlYmFwcFwiXSA9IHNlbGZbXCJ3ZWJwYWNrQ2h1bmt1cmJhbmRvY3Nfd2ViYXBwXCJdIHx8IFtdO1xuY2h1bmtMb2FkaW5nR2xvYmFsLmZvckVhY2god2VicGFja0pzb25wQ2FsbGJhY2suYmluZChudWxsLCAwKSk7XG5jaHVua0xvYWRpbmdHbG9iYWwucHVzaCA9IHdlYnBhY2tKc29ucENhbGxiYWNrLmJpbmQobnVsbCwgY2h1bmtMb2FkaW5nR2xvYmFsLnB1c2guYmluZChjaHVua0xvYWRpbmdHbG9iYWwpKTsiLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGRlcGVuZHMgb24gb3RoZXIgbG9hZGVkIGNodW5rcyBhbmQgZXhlY3V0aW9uIG5lZWQgdG8gYmUgZGVsYXllZFxudmFyIF9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fLk8odW5kZWZpbmVkLCBbNzZdLCAoKSA9PiAoX193ZWJwYWNrX3JlcXVpcmVfXyg1ODUyKSkpXG5fX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXy5PKF9fd2VicGFja19leHBvcnRzX18pO1xuIl0sIm5hbWVzIjpbImRlZmVycmVkIiwibGVhZlByb3RvdHlwZXMiLCJnZXRQcm90byIsImluUHJvZ3Jlc3MiLCJkYXRhV2VicGFja1ByZWZpeCIsImN1cnJlbnRVc2VyIiwiY3VycmVudERvY3VtZW50IiwiY3VycmVudENvbW1lbnRJZCIsInJhdGluZ3NEYXRhIiwidXNlckN1cnJlbnRSYXRpbmciLCJhc3luYyIsImxvYWRSYXRpbmdzIiwiZGF0YSIsInJhdGluZ3MiLCJlcnJvciIsImZyb20iLCJzZWxlY3QiLCJlcSIsImlkIiwibGVuZ3RoIiwiYXZlcmFnZSIsInJlZHVjZSIsInN1bSIsInIiLCJyYXRpbmciLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwidGV4dENvbnRlbnQiLCJ0b0ZpeGVkIiwiZGlzdHJpYnV0aW9uIiwiZm9yRWFjaCIsImNhbGN1bGF0ZVJhdGluZ0Rpc3RyaWJ1dGlvbiIsInVwZGF0ZVJhdGluZ0JhcnMiLCJ1c2VyUmF0aW5nIiwiZmluZCIsInVzZXJfaWQiLCJ1cGRhdGVTdGFyc0Rpc3BsYXkiLCJjb25zb2xlIiwidG90YWwiLCJpIiwicGVyY2VudGFnZSIsInN0eWxlIiwid2lkdGgiLCJNYXRoIiwicm91bmQiLCJsb2FkQ29tbWVudHMiLCJjb21tZW50cyIsImNvbW1lbnRzRXJyb3IiLCJvcmRlciIsImFzY2VuZGluZyIsInJlbmRlckNvbW1lbnRzIiwidXNlcklkcyIsIlNldCIsIm1hcCIsImMiLCJwcm9maWxlcyIsInByb2ZpbGVzRXJyb3IiLCJpbiIsIndhcm4iLCJjb21tZW50IiwicHJvZmlsZXNNYXAiLCJhY2MiLCJwcm9maWxlIiwiY29tbWVudHNMaXN0IiwiaW5uZXJIVE1MIiwiY29tbWVudEVsIiwiZGl2IiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTmFtZSIsImRhdGFzZXQiLCJjb21tZW50SWQiLCJpc093bmVyIiwidXNlck5hbWUiLCJmdWxsX25hbWUiLCJhdmF0YXJVcmwiLCJhdmF0YXJfdXJsIiwiZGF0ZSIsIkRhdGUiLCJjcmVhdGVkX2F0IiwidG9Mb2NhbGVEYXRlU3RyaW5nIiwiZGF5IiwibW9udGgiLCJ5ZWFyIiwiY29tbWVudEhlYWRlciIsImF2YXRhck1ldGEiLCJkaXNwbGF5IiwiYWxpZ25JdGVtcyIsImdhcCIsInVwZGF0ZWRfYXQiLCJhcHBlbmRDaGlsZCIsImNvbnRlbnQiLCJhY3Rpb25zIiwiY3JlYXRlQ29tbWVudEVsZW1lbnQiLCJzd2l0Y2hUYWIiLCJlIiwidGFyZ2V0VGFiIiwidGFyZ2V0IiwidGFiIiwicXVlcnlTZWxlY3RvckFsbCIsImJ0biIsImNsYXNzTGlzdCIsInRvZ2dsZSIsInN0YXJzIiwic3RhciIsImluZGV4IiwicmVtb3ZlIiwic2V0QXR0cmlidXRlIiwiYXZnUmF0aW5nIiwicGFyc2VGbG9hdCIsImlzTmFOIiwiZGlzcGxheUF2ZXJhZ2VSYXRpbmciLCJoYW5kbGVSYXRpbmciLCJwYXJzZUludCIsImV4aXN0aW5nIiwic2luZ2xlIiwidXBkYXRlIiwidG9JU09TdHJpbmciLCJpbnNlcnQiLCJkb2N1bWVudF9pZCIsImFsZXJ0IiwiZGVsZXRlIiwiaGFuZGxlRG93bmxvYWQiLCJsb2ciLCJwZGZfc3RvcmFnZV9wYXRoIiwiY2xlYW5QYXRoIiwicmVwbGFjZSIsInVybERhdGEiLCJ1cmxFcnJvciIsInN0b3JhZ2UiLCJjcmVhdGVTaWduZWRVcmwiLCJkb3dubG9hZCIsImEiLCJocmVmIiwic2lnbmVkVXJsIiwiem9uaW5nIiwiY2l0eSIsIm5hbWUiLCJ6b25lIiwiYm9keSIsImNsaWNrIiwicmVtb3ZlQ2hpbGQiLCJtZXNzYWdlIiwiaW5jbHVkZXMiLCJzdWJtaXRDb21tZW50IiwidmFsdWUiLCJ0cmltIiwiaGFuZGxlQ29tbWVudEFjdGlvbiIsImVkaXRCdG4iLCJjbG9zZXN0IiwiZGVsZXRlQnRuIiwib3BlbkVkaXRNb2RhbCIsImNvbmZpcm0iLCJycGMiLCJjb21tZW50X2lkIiwiZGVsZXRlQ29tbWVudCIsImNsb3NlTW9kYWwiLCJzYXZlQ29tbWVudEVkaXQiLCJoYW5kbGVMb2dvdXQiLCJhdXRoIiwic2lnbk91dCIsIndpbmRvdyIsImxvY2F0aW9uIiwic2hvd0Vycm9yIiwiYWRkRXZlbnRMaXN0ZW5lciIsInVzZXIiLCJnZXRVc2VyIiwiZG9jdW1lbnRJZCIsIlVSTFNlYXJjaFBhcmFtcyIsInNlYXJjaCIsImdldCIsImRvY3VtZW50RGF0YSIsImNpdHlOYW1lIiwic3RyIiwibGV0dGVyIiwidG9VcHBlckNhc2UiLCJ6b25lTmFtZSIsInNvdXJjZVBsdURhdGUiLCJzb3VyY2VfcGx1X2RhdGUiLCJjaXR5QnJlYWRjcnVtYiIsImVuY29kZVVSSUNvbXBvbmVudCIsInVwZGF0ZURvY3VtZW50SW5mbyIsImh0bWxfY29udGVudCIsInNvdXJjZV9wbHVfdXJsIiwibG9hZERvY3VtZW50IiwiaGFuZGxlU3RhckhvdmVyIiwiYWRkIiwicXVlcnlTZWxlY3RvciIsImxvZ291dEJ0biIsInNldHVwRXZlbnRMaXN0ZW5lcnMiLCJiYWNrVG9Ub3BCdG4iLCJzY3JvbGxZIiwic2Nyb2xsVG8iLCJ0b3AiLCJiZWhhdmlvciIsImluaXRCYWNrVG9Ub3AiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJ1bmRlZmluZWQiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsImNhbGwiLCJtIiwiTyIsInJlc3VsdCIsImNodW5rSWRzIiwiZm4iLCJwcmlvcml0eSIsIm5vdEZ1bGZpbGxlZCIsIkluZmluaXR5IiwiZnVsZmlsbGVkIiwiaiIsIk9iamVjdCIsImtleXMiLCJldmVyeSIsImtleSIsInNwbGljZSIsImdldFByb3RvdHlwZU9mIiwib2JqIiwidCIsIm1vZGUiLCJ0aGlzIiwiX19lc01vZHVsZSIsInRoZW4iLCJucyIsImNyZWF0ZSIsImRlZiIsImN1cnJlbnQiLCJpbmRleE9mIiwiZ2V0T3duUHJvcGVydHlOYW1lcyIsImQiLCJkZWZpbml0aW9uIiwibyIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImYiLCJjaHVua0lkIiwiUHJvbWlzZSIsImFsbCIsInByb21pc2VzIiwidSIsImciLCJnbG9iYWxUaGlzIiwiRnVuY3Rpb24iLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJsIiwidXJsIiwiZG9uZSIsInB1c2giLCJzY3JpcHQiLCJuZWVkQXR0YWNoIiwic2NyaXB0cyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwicyIsImdldEF0dHJpYnV0ZSIsImNoYXJzZXQiLCJ0aW1lb3V0IiwibmMiLCJzcmMiLCJvblNjcmlwdENvbXBsZXRlIiwicHJldiIsImV2ZW50Iiwib25lcnJvciIsIm9ubG9hZCIsImNsZWFyVGltZW91dCIsImRvbmVGbnMiLCJwYXJlbnROb2RlIiwic2V0VGltZW91dCIsImJpbmQiLCJ0eXBlIiwiaGVhZCIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwicCIsImluc3RhbGxlZENodW5rcyIsImluc3RhbGxlZENodW5rRGF0YSIsInByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiRXJyb3IiLCJlcnJvclR5cGUiLCJyZWFsU3JjIiwicmVxdWVzdCIsIndlYnBhY2tKc29ucENhbGxiYWNrIiwicGFyZW50Q2h1bmtMb2FkaW5nRnVuY3Rpb24iLCJtb3JlTW9kdWxlcyIsInJ1bnRpbWUiLCJzb21lIiwiY2h1bmtMb2FkaW5nR2xvYmFsIiwic2VsZiIsIl9fd2VicGFja19leHBvcnRzX18iXSwic291cmNlUm9vdCI6IiJ9